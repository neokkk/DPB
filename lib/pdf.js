/*! For license information please see pdf.js.LICENSE.txt */
(()=>{"use strict";var t,e,n,i,a,r,s,o,l,h,u,c,d,f={};function v(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function p(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?v(Object(n),!0).forEach((function(e){P(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function g(t,e,n){e||(e=[]);var i=e.length++;return Object.defineProperty({},"_",{set:function(a){e[i]=a,t.apply(n,e)}})}function y(t,e,n,i){var a=m(V(1&i?t.prototype:t),e,n);return 2&i&&"function"==typeof a?function(t){return a.apply(n,t)}:a}function m(){return m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var i=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=V(t)););return t}(t,e);if(i){var a=Object.getOwnPropertyDescriptor(i,e);return a.get?a.get.call(arguments.length<3?t:n):a.value}},m.apply(null,arguments)}function k(t){return function(t){if(Array.isArray(t))return O(t)}(t)||b(t)||N(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function w(){w=function(){return e};var t,e={},n=Object.prototype,i=n.hasOwnProperty,a=Object.defineProperty||function(t,e,n){t[e]=n.value},r="function"==typeof Symbol?Symbol:{},s=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",l=r.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(t){h=function(t,e,n){return t[e]=n}}function u(t,e,n,i){var r=e&&e.prototype instanceof y?e:y,s=Object.create(r.prototype),o=new R(i||[]);return a(s,"_invoke",{value:E(t,n,o)}),s}function c(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=u;var d="suspendedStart",f="suspendedYield",v="executing",p="completed",g={};function y(){}function m(){}function k(){}var b={};h(b,s,(function(){return this}));var A=Object.getPrototypeOf,_=A&&A(A(I([])));_&&_!==n&&i.call(_,s)&&(b=_);var x=k.prototype=y.prototype=Object.create(b);function S(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function M(t,e){function n(a,r,s,o){var l=c(t[a],t,r);if("throw"!==l.type){var h=l.arg,u=h.value;return u&&"object"==X(u)&&i.call(u,"__await")?e.resolve(u.__await).then((function(t){n("next",t,s,o)}),(function(t){n("throw",t,s,o)})):e.resolve(u).then((function(t){h.value=t,s(h)}),(function(t){return n("throw",t,s,o)}))}o(l.arg)}var r;a(this,"_invoke",{value:function(t,i){function a(){return new e((function(e,a){n(t,i,e,a)}))}return r=r?r.then(a,a):a()}})}function E(e,n,i){var a=d;return function(r,s){if(a===v)throw Error("Generator is already running");if(a===p){if("throw"===r)throw s;return{value:t,done:!0}}for(i.method=r,i.arg=s;;){var o=i.delegate;if(o){var l=C(o,i);if(l){if(l===g)continue;return l}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if(a===d)throw a=p,i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);a=v;var h=c(e,n,i);if("normal"===h.type){if(a=i.done?p:f,h.arg===g)continue;return{value:h.arg,done:i.done}}"throw"===h.type&&(a=p,i.method="throw",i.arg=h.arg)}}}function C(e,n){var i=n.method,a=e.iterator[i];if(a===t)return n.delegate=null,"throw"===i&&e.iterator.return&&(n.method="return",n.arg=t,C(e,n),"throw"===n.method)||"return"!==i&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+i+"' method")),g;var r=c(a,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,g;var s=r.arg;return s?s.done?(n[e.resultName]=s.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,g):s:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function P(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function I(e){if(e||""===e){var n=e[s];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,r=function n(){for(;++a<e.length;)if(i.call(e,a))return n.value=e[a],n.done=!1,n;return n.value=t,n.done=!0,n};return r.next=r}}throw new TypeError(X(e)+" is not iterable")}return m.prototype=k,a(x,"constructor",{value:k,configurable:!0}),a(k,"constructor",{value:m,configurable:!0}),m.displayName=h(k,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,k):(t.__proto__=k,h(t,l,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},S(M.prototype),h(M.prototype,o,(function(){return this})),e.AsyncIterator=M,e.async=function(t,n,i,a,r){void 0===r&&(r=Promise);var s=new M(u(t,n,i,a),r);return e.isGeneratorFunction(n)?s:s.next().then((function(t){return t.done?t.value:s.next()}))},S(x),h(x,l,"Generator"),h(x,s,(function(){return this})),h(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var i in e)n.push(i);return n.reverse(),function t(){for(;n.length;){var i=n.pop();if(i in e)return t.value=i,t.done=!1,t}return t.done=!0,t}},e.values=I,R.prototype={constructor:R,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var n in this)"t"===n.charAt(0)&&i.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function a(i,a){return o.type="throw",o.arg=e,n.next=i,a&&(n.method="next",n.arg=t),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var s=this.tryEntries[r],o=s.completion;if("root"===s.tryLoc)return a("end");if(s.tryLoc<=this.prev){var l=i.call(s,"catchLoc"),h=i.call(s,"finallyLoc");if(l&&h){if(this.prev<s.catchLoc)return a(s.catchLoc,!0);if(this.prev<s.finallyLoc)return a(s.finallyLoc)}else if(l){if(this.prev<s.catchLoc)return a(s.catchLoc,!0)}else{if(!h)throw Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return a(s.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&i.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var r=a;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var s=r?r.completion:{};return s.type=t,s.arg=e,r?(this.method="next",this.next=r.finallyLoc,g):this.complete(s)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),g},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),P(n),g}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var i=n.completion;if("throw"===i.type){var a=i.arg;P(n)}return a}}throw Error("illegal catch attempt")},delegateYield:function(e,n,i){return this.delegate={iterator:I(e),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=t),g}},e}function A(t,e){x(t,e),e.add(t)}function _(t,e,n){x(t,e),e.set(t,n)}function x(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function S(t,e,n){return n(R(t,e))}function M(t,e){return t.get(R(t,e))}function E(t,e,n){return t.set(R(t,e),n),n}function C(t,e,n,i,a,r,s){try{var o=t[r](s),l=o.value}catch(t){return void n(t)}o.done?e(l):Promise.resolve(l).then(i,a)}function T(t){return function(){var e=this,n=arguments;return new Promise((function(i,a){var r=t.apply(e,n);function s(t){C(r,i,a,s,o,"next",t)}function o(t){C(r,i,a,s,o,"throw",t)}s(void 0)}))}}function P(t,e,n){return(e=H(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function R(t,e,n){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:n;throw new TypeError("Private element is not present on this object")}function I(t,e){return D(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var i,a,r,s,o=[],l=!0,h=!1;try{if(r=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=r.call(n)).done)&&(o.push(i.value),o.length!==e);l=!0);}catch(t){h=!0,a=t}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(h)throw a}}return o}}(t,e)||N(t,e)||L()}function L(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function D(t){if(Array.isArray(t))return t}function F(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=N(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,o=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return s=t.done,t},e:function(t){o=!0,r=t},f:function(){try{s||null==n.return||n.return()}finally{if(o)throw r}}}}function N(t,e){if(t){if("string"==typeof t)return O(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(t,e):void 0}}function O(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=Array(e);n<e;n++)i[n]=t[n];return i}function W(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,H(i.key),i)}}function B(t,e,n){return e&&W(t.prototype,e),n&&W(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function H(t){var e=function(t){if("object"!=X(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=X(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==X(e)?e:e+""}function j(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function z(t,e,n){return e=V(e),function(t,e){if(e&&("object"==X(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,G()?Reflect.construct(e,n||[],V(t).constructor):e.apply(t,n))}function G(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(t){}return(G=function(){return!!t})()}function V(t){return V=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},V(t)}function U(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&q(t,e)}function q(t,e){return q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},q(t,e)}function X(t){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},X(t)}f.d=(t,e)=>{for(var n in e)f.o(e,n)&&!f.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},f.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var Y={d:function(t,e){for(var n in e)Y.o(e,n)&&!Y.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o:function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}},K=globalThis.pdfjsLib={};Y.d(K,{AbortException:function(){return xt},AnnotationEditorLayer:function(){return Kf},AnnotationEditorParamsType:function(){return nt},AnnotationEditorType:function(){return et},AnnotationEditorUIManager:function(){return On},AnnotationLayer:function(){return qh},AnnotationMode:function(){return tt},ColorPicker:function(){return Ac},DOMSVGFactory:function(){return vl},DrawLayer:function(){return ov},FeatureTest:function(){return Ct},GlobalWorkerOptions:function(){return Hr},ImageKind:function(){return at},InvalidPDFException:function(){return bt},MissingPDFException:function(){return wt},OPS:function(){return st},OutputScale:function(){return re},PDFDataRangeTransport:function(){return Eo},PDFDateString:function(){return Zt},PDFWorker:function(){return Bo},PasswordResponses:function(){return ot},PermissionFlag:function(){return it},PixelsPerInch:function(){return Wt},RenderingCancelledException:function(){return zt},TextLayer:function(){return io},TouchManager:function(){return _v},UnexpectedResponseException:function(){return At},Util:function(){return Pt},VerbosityLevel:function(){return rt},XfaLayer:function(){return pl},build:function(){return ul},createValidAbsoluteUrl:function(){return pt},fetchData:function(){return Bt},getDocument:function(){return _o},getFilenameFromUrl:function(){return Ut},getPdfFilenameFromUrl:function(){return qt},getXfaPageViewport:function(){return te},isDataScheme:function(){return Gt},isPdfFile:function(){return Vt},noContextMenu:function(){return Kt},normalizeUnicode:function(){return Ft},setLayerDimensions:function(){return ae},shadow:function(){return gt},stopEvent:function(){return Qt},version:function(){return hl}});var Q=!("object"!==("undefined"==typeof process?"undefined":X(process))||process+""!="[object process]"||process.versions.nw||process.versions.electron&&process.type&&"browser"!==process.type),J=[1,0,0,1,0,0],Z=[.001,0,0,.001,0,0],$=1.35,tt={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},et={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},nt={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35,DRAW_STEP:41},it={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},at={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},rt={ERRORS:0,WARNINGS:1,INFOS:5},st={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93},ot={NEED_PASSWORD:1,INCORRECT_PASSWORD:2},lt=rt.WARNINGS;function ht(t){Number.isInteger(t)&&(lt=t)}function ut(){return lt}function ct(t){lt>=rt.INFOS&&console.log("Info: ".concat(t))}function dt(t){lt>=rt.WARNINGS&&console.log("Warning: ".concat(t))}function ft(t){throw new Error(t)}function vt(t,e){t||ft(e)}function pt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!t)return null;try{if(n&&"string"==typeof t){if(n.addDefaultProtocol&&t.startsWith("www.")){var i=t.match(/\./g);(null==i?void 0:i.length)>=2&&(t="http://".concat(t))}if(n.tryConvertEncoding)try{t=decodeURIComponent(escape(t))}catch(t){}}var a=e?new URL(t,e):new URL(t);if(function(t){switch(null==t?void 0:t.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}(a))return a}catch(t){}return null}function gt(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Object.defineProperty(t,e,{value:n,enumerable:!i,configurable:!0,writable:!1}),n}var yt=function(){function t(t,e){this.message=t,this.name=e}return t.prototype=new Error,t.constructor=t,t}(),mt=function(t){function e(t,n){var i;return j(this,e),(i=z(this,e,[t,"PasswordException"])).code=n,i}return U(e,t),B(e)}(yt),kt=function(t){function e(t,n){var i;return j(this,e),(i=z(this,e,[t,"UnknownErrorException"])).details=n,i}return U(e,t),B(e)}(yt),bt=function(t){function e(t){return j(this,e),z(this,e,[t,"InvalidPDFException"])}return U(e,t),B(e)}(yt),wt=function(t){function e(t){return j(this,e),z(this,e,[t,"MissingPDFException"])}return U(e,t),B(e)}(yt),At=function(t){function e(t,n){var i;return j(this,e),(i=z(this,e,[t,"UnexpectedResponseException"])).status=n,i}return U(e,t),B(e)}(yt),_t=function(t){function e(t){return j(this,e),z(this,e,[t,"FormatError"])}return U(e,t),B(e)}(yt),xt=function(t){function e(t){return j(this,e),z(this,e,[t,"AbortException"])}return U(e,t),B(e)}(yt);function St(t){"object"===X(t)&&void 0!==(null==t?void 0:t.length)||ft("Invalid argument for bytesToString");var e=t.length,n=8192;if(e<n)return String.fromCharCode.apply(null,t);for(var i=[],a=0;a<e;a+=n){var r=Math.min(a+n,e),s=t.subarray(a,r);i.push(String.fromCharCode.apply(null,s))}return i.join("")}function Mt(t){"string"!=typeof t&&ft("Invalid argument for stringToBytes");for(var e=t.length,n=new Uint8Array(e),i=0;i<e;++i)n[i]=255&t.charCodeAt(i);return n}function Et(t){var e,n=Object.create(null),i=F(t);try{for(i.s();!(e=i.n()).done;){var a=I(e.value,2),r=a[0],s=a[1];n[r]=s}}catch(t){i.e(t)}finally{i.f()}return n}var Ct=function(){return B((function t(){j(this,t)}),null,[{key:"isLittleEndian",get:function(){return gt(this,"isLittleEndian",((t=new Uint8Array(4))[0]=1,1===new Uint32Array(t.buffer,0,1)[0]));var t}},{key:"isEvalSupported",get:function(){return gt(this,"isEvalSupported",function(){try{return new Function(""),!0}catch(t){return!1}}())}},{key:"isOffscreenCanvasSupported",get:function(){return gt(this,"isOffscreenCanvasSupported","undefined"!=typeof OffscreenCanvas)}},{key:"isImageDecoderSupported",get:function(){return gt(this,"isImageDecoderSupported","undefined"!=typeof ImageDecoder)}},{key:"platform",get:function(){var t,e;return"undefined"!=typeof navigator&&"string"==typeof(null===(t=navigator)||void 0===t?void 0:t.platform)?gt(this,"platform",{isMac:navigator.platform.includes("Mac"),isWindows:navigator.platform.includes("Win"),isFirefox:"string"==typeof(null===(e=navigator)||void 0===e?void 0:e.userAgent)&&navigator.userAgent.includes("Firefox")}):gt(this,"platform",{isMac:!1,isWindows:!1,isFirefox:!1})}},{key:"isCSSRoundSupported",get:function(){var t,e;return gt(this,"isCSSRoundSupported",null===(t=globalThis.CSS)||void 0===t||null===(e=t.supports)||void 0===e?void 0:e.call(t,"width: round(1.5px, 1px)"))}}])}(),Tt=Array.from(Array(256).keys(),(function(t){return t.toString(16).padStart(2,"0")})),Pt=function(){function t(){j(this,t)}return B(t,null,[{key:"makeHexColor",value:function(t,e,n){return"#".concat(Tt[t]).concat(Tt[e]).concat(Tt[n])}},{key:"scaleMinMax",value:function(t,e){var n;t[0]?(t[0]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[3],e[3]*=t[3]):(n=e[0],e[0]=e[1],e[1]=n,n=e[2],e[2]=e[3],e[3]=n,t[1]<0&&(n=e[1],e[1]=e[3],e[3]=n),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(n=e[0],e[0]=e[2],e[2]=n),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}},{key:"transform",value:function(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}},{key:"applyTransform",value:function(t,e){return[t[0]*e[0]+t[1]*e[2]+e[4],t[0]*e[1]+t[1]*e[3]+e[5]]}},{key:"applyInverseTransform",value:function(t,e){var n=e[0]*e[3]-e[1]*e[2];return[(t[0]*e[3]-t[1]*e[2]+e[2]*e[5]-e[4]*e[3])/n,(-t[0]*e[1]+t[1]*e[0]+e[4]*e[1]-e[5]*e[0])/n]}},{key:"getAxialAlignedBoundingBox",value:function(t,e){var n=this.applyTransform(t,e),i=this.applyTransform(t.slice(2,4),e),a=this.applyTransform([t[0],t[3]],e),r=this.applyTransform([t[2],t[1]],e);return[Math.min(n[0],i[0],a[0],r[0]),Math.min(n[1],i[1],a[1],r[1]),Math.max(n[0],i[0],a[0],r[0]),Math.max(n[1],i[1],a[1],r[1])]}},{key:"inverseTransform",value:function(t){var e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}},{key:"singularValueDecompose2dScale",value:function(t){var e=[t[0],t[2],t[1],t[3]],n=t[0]*e[0]+t[1]*e[2],i=t[0]*e[1]+t[1]*e[3],a=t[2]*e[0]+t[3]*e[2],r=t[2]*e[1]+t[3]*e[3],s=(n+r)/2,o=Math.sqrt(Math.pow(n+r,2)-4*(n*r-a*i))/2,l=s+o||1,h=s-o||1;return[Math.sqrt(l),Math.sqrt(h)]}},{key:"normalizeRect",value:function(t){var e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}},{key:"intersect",value:function(t,e){var n=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),i=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(n>i)return null;var a=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),r=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return a>r?null:[n,a,i,r]}},{key:"bezierBoundingBox",value:function(e,n,i,a,r,s,o,l,h){return h?(h[0]=Math.min(h[0],e,o),h[1]=Math.min(h[1],n,l),h[2]=Math.max(h[2],e,o),h[3]=Math.max(h[3],n,l)):h=[Math.min(e,o),Math.min(n,l),Math.max(e,o),Math.max(n,l)],R(t,this,It).call(this,e,i,r,o,n,a,s,l,3*(3*(i-r)-e+o),6*(e-2*i+r),3*(i-e),h),R(t,this,It).call(this,e,i,r,o,n,a,s,l,3*(3*(a-s)-n+l),6*(n-2*a+s),3*(a-n),h),h}}])}();function Rt(t,e,n,i,a,r,s,o,l,h){if(!(l<=0||l>=1)){var u=1-l,c=l*l,d=c*l,f=u*(u*(u*t+3*l*e)+3*c*n)+d*i,v=u*(u*(u*a+3*l*r)+3*c*s)+d*o;h[0]=Math.min(h[0],f),h[1]=Math.min(h[1],v),h[2]=Math.max(h[2],f),h[3]=Math.max(h[3],v)}}function It(e,n,i,a,r,s,o,l,h,u,c,d){if(Math.abs(h)<1e-12)Math.abs(u)>=1e-12&&R(t,this,Rt).call(this,e,n,i,a,r,s,o,l,-c/u,d);else{var f=Math.pow(u,2)-4*c*h;if(!(f<0)){var v=Math.sqrt(f),p=2*h;R(t,this,Rt).call(this,e,n,i,a,r,s,o,l,(-u+v)/p,d),R(t,this,Rt).call(this,e,n,i,a,r,s,o,l,(-u-v)/p,d)}}}t=Pt;var Lt=null,Dt=null;function Ft(t){return Lt||(Lt=/([\xA0\xB5\u037E\u0EB3\u2000-\u200A\u202F\u2126\uFB00-\uFB04\uFB06\uFB20-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBA1\uFBA4-\uFBA9\uFBAE-\uFBB1\uFBD3-\uFBDC\uFBDE-\uFBE7\uFBEA-\uFBF8\uFBFC\uFBFD\uFC00-\uFC5D\uFC64-\uFCF1\uFCF5-\uFD3D\uFD88\uFDF4\uFDFA\uFDFB\uFE71\uFE77\uFE79\uFE7B\uFE7D]+)|(\uFB05+)/g,Dt=new Map([["ﬅ","ſt"]])),t.replaceAll(Lt,(function(t,e,n){return e?e.normalize("NFKC"):Dt.get(n)}))}var Nt="pdfjs_internal_id_";"function"!=typeof Promise.try&&(Promise.try=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return new Promise((function(e){e(t.apply(void 0,n))}))});var Ot="http://www.w3.org/2000/svg",Wt=B((function t(){j(this,t)}));function Bt(t){return Ht.apply(this,arguments)}function Ht(){return Ht=T(w().mark((function t(e){var n,i,a=arguments;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:"text",!Yt(e,document.baseURI)){t.next=14;break}return t.next=4,fetch(e);case 4:if((i=t.sent).ok){t.next=7;break}throw new Error(i.statusText);case 7:t.t0=n,t.next="arraybuffer"===t.t0?10:"blob"===t.t0?11:"json"===t.t0?12:13;break;case 10:return t.abrupt("return",i.arrayBuffer());case 11:return t.abrupt("return",i.blob());case 12:return t.abrupt("return",i.json());case 13:return t.abrupt("return",i.text());case 14:return t.abrupt("return",new Promise((function(t,i){var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType=n,a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE)if(200!==a.status&&0!==a.status)i(new Error(a.statusText));else{switch(n){case"arraybuffer":case"blob":case"json":return void t(a.response)}t(a.responseText)}},a.send(null)})));case 15:case"end":return t.stop()}}),t)}))),Ht.apply(this,arguments)}e=Wt,P(Wt,"CSS",96),P(Wt,"PDF",72),P(Wt,"PDF_TO_CSS_UNITS",e.CSS/e.PDF);var jt=function(){function t(e){var n=e.viewBox,i=e.userUnit,a=e.scale,r=e.rotation,s=e.offsetX,o=void 0===s?0:s,l=e.offsetY,h=void 0===l?0:l,u=e.dontFlip,c=void 0!==u&&u;j(this,t),this.viewBox=n,this.userUnit=i,this.scale=a,this.rotation=r,this.offsetX=o,this.offsetY=h,a*=i;var d,f,v,p,g,y,m,k,b=(n[2]+n[0])/2,w=(n[3]+n[1])/2;switch((r%=360)<0&&(r+=360),r){case 180:d=-1,f=0,v=0,p=1;break;case 90:d=0,f=1,v=1,p=0;break;case 270:d=0,f=-1,v=-1,p=0;break;case 0:d=1,f=0,v=0,p=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}c&&(v=-v,p=-p),0===d?(g=Math.abs(w-n[1])*a+o,y=Math.abs(b-n[0])*a+h,m=(n[3]-n[1])*a,k=(n[2]-n[0])*a):(g=Math.abs(b-n[0])*a+o,y=Math.abs(w-n[1])*a+h,m=(n[2]-n[0])*a,k=(n[3]-n[1])*a),this.transform=[d*a,f*a,v*a,p*a,g-d*a*b-v*a*w,y-f*a*b-p*a*w],this.width=m,this.height=k}return B(t,[{key:"rawDims",get:function(){var t=this.userUnit,e=this.viewBox.map((function(e){return e*t}));return gt(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}},{key:"clone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.scale,i=void 0===n?this.scale:n,a=e.rotation,r=void 0===a?this.rotation:a,s=e.offsetX,o=void 0===s?this.offsetX:s,l=e.offsetY,h=void 0===l?this.offsetY:l,u=e.dontFlip,c=void 0!==u&&u;return new t({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:i,rotation:r,offsetX:o,offsetY:h,dontFlip:c})}},{key:"convertToViewportPoint",value:function(t,e){return Pt.applyTransform([t,e],this.transform)}},{key:"convertToViewportRectangle",value:function(t){var e=Pt.applyTransform([t[0],t[1]],this.transform),n=Pt.applyTransform([t[2],t[3]],this.transform);return[e[0],e[1],n[0],n[1]]}},{key:"convertToPdfPoint",value:function(t,e){return Pt.applyInverseTransform([t,e],this.transform)}}])}(),zt=function(t){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return j(this,e),(n=z(this,e,[t,"RenderingCancelledException"])).extraDelay=i,n}return U(e,t),B(e)}(yt);function Gt(t){for(var e=t.length,n=0;n<e&&""===t[n].trim();)n++;return"data:"===t.substring(n,n+5).toLowerCase()}function Vt(t){return"string"==typeof t&&/\.pdf$/i.test(t)}function Ut(t){var e=t.split(/[#?]/,1);return(t=I(e,1)[0]).substring(t.lastIndexOf("/")+1)}function qt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"document.pdf";if("string"!=typeof t)return e;if(Gt(t))return dt('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;var n=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,i=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/.exec(t),a=n.exec(i[1])||n.exec(i[2])||n.exec(i[3]);if(a&&(a=a[0]).includes("%"))try{a=n.exec(decodeURIComponent(a))[0]}catch(t){}return a||e}var Xt=function(){return B((function t(){j(this,t),P(this,"started",Object.create(null)),P(this,"times",[])}),[{key:"time",value:function(t){t in this.started&&dt("Timer is already running for ".concat(t)),this.started[t]=Date.now()}},{key:"timeEnd",value:function(t){t in this.started||dt("Timer has not been started for ".concat(t)),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}},{key:"toString",value:function(){var t,e=[],n=0,i=F(this.times);try{for(i.s();!(t=i.n()).done;){var a=t.value.name;n=Math.max(a.length,n)}}catch(t){i.e(t)}finally{i.f()}var r,s=F(this.times);try{for(s.s();!(r=s.n()).done;){var o=r.value,l=o.name,h=o.start,u=o.end;e.push("".concat(l.padEnd(n)," ").concat(u-h,"ms\n"))}}catch(t){s.e(t)}finally{s.f()}return e.join("")}}])}();function Yt(t,e){try{var n=(e?new URL(t,e):new URL(t)).protocol;return"http:"===n||"https:"===n}catch(t){return!1}}function Kt(t){t.preventDefault()}function Qt(t){t.preventDefault(),t.stopPropagation()}function Jt(t){console.log("Deprecated API usage: "+t)}var Zt=function(){function t(){j(this,t)}return B(t,null,[{key:"toDateObject",value:function(e){if(!e||"string"!=typeof e)return null;R(t,this,$t)._||($t._=R(t,this,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?")));var n=R(t,this,$t)._.exec(e);if(!n)return null;var i=parseInt(n[1],10),a=parseInt(n[2],10);a=a>=1&&a<=12?a-1:0;var r=parseInt(n[3],10);r=r>=1&&r<=31?r:1;var s=parseInt(n[4],10);s=s>=0&&s<=23?s:0;var o=parseInt(n[5],10);o=o>=0&&o<=59?o:0;var l=parseInt(n[6],10);l=l>=0&&l<=59?l:0;var h=n[7]||"Z",u=parseInt(n[8],10);u=u>=0&&u<=23?u:0;var c=parseInt(n[9],10)||0;return c=c>=0&&c<=59?c:0,"-"===h?(s+=u,o+=c):"+"===h&&(s-=u,o-=c),new Date(Date.UTC(i,a,r,s,o,l))}}])}(),$t={_:void 0};function te(t,e){var n=e.scale,i=void 0===n?1:n,a=e.rotation,r=void 0===a?0:a,s=t.attributes.style,o=s.width,l=s.height,h=[0,0,parseInt(o),parseInt(l)];return new jt({viewBox:h,userUnit:1,scale:i,rotation:r})}function ee(t){if(t.startsWith("#")){var e=parseInt(t.slice(1),16);return[(16711680&e)>>16,(65280&e)>>8,255&e]}return t.startsWith("rgb(")?t.slice(4,-1).split(",").map((function(t){return parseInt(t)})):t.startsWith("rgba(")?t.slice(5,-1).split(",").map((function(t){return parseInt(t)})).slice(0,3):(dt('Not a valid color format: "'.concat(t,'"')),[0,0,0])}function ne(t){var e=t.getTransform();return[e.a,e.b,e.c,e.d,e.e,e.f]}function ie(t){var e=t.getTransform().invertSelf();return[e.a,e.b,e.c,e.d,e.e,e.f]}function ae(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(e instanceof jt){var a=e.rawDims,r=a.pageWidth,s=a.pageHeight,o=t.style,l=Ct.isCSSRoundSupported,h="var(--scale-factor) * ".concat(r,"px"),u="var(--scale-factor) * ".concat(s,"px"),c=l?"round(down, ".concat(h,", var(--scale-round-x, 1px))"):"calc(".concat(h,")"),d=l?"round(down, ".concat(u,", var(--scale-round-y, 1px))"):"calc(".concat(u,")");n&&e.rotation%180!=0?(o.width=d,o.height=c):(o.width=c,o.height=d)}i&&t.setAttribute("data-main-rotation",e.rotation)}var re=function(){return B((function t(){j(this,t);var e=window.devicePixelRatio||1;this.sx=e,this.sy=e}),[{key:"scaled",get:function(){return 1!==this.sx||1!==this.sy}},{key:"symmetric",get:function(){return this.sx===this.sy}}])}(),se=new WeakMap,oe=new WeakMap,le=new WeakMap,he=new WeakMap,ue=new WeakMap,ce=new WeakSet,de=function(){return B((function t(e){j(this,t),A(this,ce),_(this,se,null),_(this,oe,null),_(this,le,void 0),_(this,he,null),_(this,ue,null),E(le,this,e),ke._||(ke._=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button"}))}),[{key:"render",value:function(){var t=E(se,this,document.createElement("div"));t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");var e=M(le,this)._uiManager._signal;t.addEventListener("contextmenu",Kt,{signal:e}),t.addEventListener("pointerdown",fe,{signal:e});var n=E(he,this,document.createElement("div"));n.className="buttons",t.append(n);var i=M(le,this).toolbarPosition;if(i){var a=t.style,r="ltr"===M(le,this)._uiManager.direction?1-i[0]:i[0];a.insetInlineEnd="".concat(100*r,"%"),a.top="calc(".concat(100*i[1],"% + var(--editor-toolbar-vert-offset))")}return R(ce,this,ye).call(this),t}},{key:"div",get:function(){return M(se,this)}},{key:"hide",value:function(){var t;M(se,this).classList.add("hidden"),null===(t=M(oe,this))||void 0===t||t.hideDropdown()}},{key:"show",value:function(){var t;M(se,this).classList.remove("hidden"),null===(t=M(ue,this))||void 0===t||t.shown()}},{key:"addAltText",value:(t=T(w().mark((function t(e){var n;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.render();case 2:n=t.sent,R(ce,this,ge).call(this,n),M(he,this).prepend(n,S(ce,this,me)),E(ue,this,e);case 6:case"end":return t.stop()}}),t,this)}))),function(e){return t.apply(this,arguments)})},{key:"addColorPicker",value:function(t){E(oe,this,t);var e=t.renderButton();R(ce,this,ge).call(this,e),M(he,this).prepend(e,S(ce,this,me))}},{key:"remove",value:function(){var t;M(se,this).remove(),null===(t=M(oe,this))||void 0===t||t.destroy(),E(oe,this,null)}}]);var t}();function fe(t){t.stopPropagation()}function ve(t){M(le,this)._focusEventsAllowed=!1,Qt(t)}function pe(t){M(le,this)._focusEventsAllowed=!0,Qt(t)}function ge(t){var e=M(le,this)._uiManager._signal;t.addEventListener("focusin",R(ce,this,ve).bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",R(ce,this,pe).bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",Kt,{signal:e})}function ye(){var t=M(le,this),e=t.editorType,n=t._uiManager,i=document.createElement("button");i.className="delete",i.tabIndex=0,i.setAttribute("data-l10n-id",ke._[e]),R(ce,this,ge).call(this,i),i.addEventListener("click",(function(t){n.delete()}),{signal:n._signal}),M(he,this).append(i)}function me(t){var e=document.createElement("div");return e.className="divider",e}var ke={_:null},be=new WeakMap,we=new WeakMap,Ae=new WeakMap,_e=new WeakSet,xe=function(){return B((function t(e){j(this,t),A(this,_e),_(this,be,null),_(this,we,null),_(this,Ae,void 0),E(Ae,this,e)}),[{key:"show",value:function(t,e,n){var i=I(R(_e,this,Me).call(this,e,n),2),a=i[0],r=i[1],s=(M(we,this)||E(we,this,R(_e,this,Se).call(this))).style;t.append(M(we,this)),s.insetInlineEnd="".concat(100*a,"%"),s.top="calc(".concat(100*r,"% + var(--editor-toolbar-vert-offset))")}},{key:"hide",value:function(){M(we,this).remove()}}])}();function Se(){var t=E(we,this,document.createElement("div"));t.className="editToolbar",t.setAttribute("role","toolbar"),t.addEventListener("contextmenu",Kt,{signal:M(Ae,this)._signal});var e=E(be,this,document.createElement("div"));return e.className="buttons",t.append(e),R(_e,this,Ee).call(this),t}function Me(t,e){var n,i=0,a=0,r=F(t);try{for(r.s();!(n=r.n()).done;){var s=n.value,o=s.y+s.height;if(!(o<i)){var l=s.x+(e?s.width:0);o>i?(a=l,i=o):e?l>a&&(a=l):l<a&&(a=l)}}}catch(t){r.e(t)}finally{r.f()}return[e?1-a:a,i]}function Ee(){var t=this,e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");var n=document.createElement("span");e.append(n),n.className="visuallyHidden",n.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");var i=M(Ae,this)._signal;e.addEventListener("contextmenu",Kt,{signal:i}),e.addEventListener("click",(function(){M(Ae,t).highlightSelection("floating_button")}),{signal:i}),M(be,this).append(e)}function Ce(t,e,n){var i,a=F(n);try{for(a.s();!(i=a.n()).done;){var r=i.value;e.addEventListener(r,t[r].bind(t))}}catch(t){a.e(t)}finally{a.f()}}var Te=new WeakMap,Pe=function(){return B((function t(){j(this,t),_(this,Te,0)}),[{key:"id",get:function(){var t,e;return"".concat("pdfjs_internal_editor_").concat((E(Te,this,(t=M(Te,this),e=t++,t)),e))}}])}(),Re=new WeakMap,Ie=new WeakMap,Le=new WeakMap,De=new WeakSet,Fe=function(){return B((function t(){j(this,t),A(this,De),_(this,Re,function(){if("function"==typeof crypto.randomUUID)return crypto.randomUUID();var t=new Uint8Array(32);return crypto.getRandomValues(t),St(t)}()),_(this,Ie,0),_(this,Le,null)}),[{key:"getFromFile",value:(i=T(w().mark((function t(e){var n,i,a,r;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.lastModified,i=e.name,a=e.size,r=e.type,t.abrupt("return",R(De,this,Ne).call(this,"".concat(n,"_").concat(i,"_").concat(a,"_").concat(r),e));case 2:case"end":return t.stop()}}),t,this)}))),function(t){return i.apply(this,arguments)})},{key:"getFromUrl",value:(n=T(w().mark((function t(e){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",R(De,this,Ne).call(this,e,e));case 1:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"getFromBlob",value:(e=T(w().mark((function t(e,n){var i;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n;case 2:return i=t.sent,t.abrupt("return",R(De,this,Ne).call(this,e,i));case 4:case"end":return t.stop()}}),t,this)}))),function(t,n){return e.apply(this,arguments)})},{key:"getFromId",value:(t=T(w().mark((function t(e){var n,i;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(M(Le,this)||E(Le,this,new Map),n=M(Le,this).get(e)){t.next=4;break}return t.abrupt("return",null);case 4:if(!n.bitmap){t.next=7;break}return n.refCounter+=1,t.abrupt("return",n);case 7:if(!n.file){t.next=9;break}return t.abrupt("return",this.getFromFile(n.file));case 9:if(!n.blobPromise){t.next=13;break}return i=n.blobPromise,delete n.blobPromise,t.abrupt("return",this.getFromBlob(n.id,i));case 13:return t.abrupt("return",this.getFromUrl(n.url));case 14:case"end":return t.stop()}}),t,this)}))),function(e){return t.apply(this,arguments)})},{key:"getFromCanvas",value:function(t,e){var n,i,a;M(Le,this)||E(Le,this,new Map);var r=M(Le,this).get(t);if(null!==(a=r)&&void 0!==a&&a.bitmap)return r.refCounter+=1,r;var s=new OffscreenCanvas(e.width,e.height);return s.getContext("2d").drawImage(e,0,0),r={bitmap:s.transferToImageBitmap(),id:"image_".concat(M(Re,this),"_").concat((E(Ie,this,(n=M(Ie,this),i=n++,n)),i)),refCounter:1,isSvg:!1},M(Le,this).set(t,r),M(Le,this).set(r.id,r),r}},{key:"getSvgUrl",value:function(t){var e=M(Le,this).get(t);return null!=e&&e.isSvg?e.svgUrl:null}},{key:"deleteId",value:function(t){var e;M(Le,this)||E(Le,this,new Map);var n=M(Le,this).get(t);if(n&&(n.refCounter-=1,0===n.refCounter)){var i=n.bitmap;if(!n.url&&!n.file){var a=new OffscreenCanvas(i.width,i.height);a.getContext("bitmaprenderer").transferFromImageBitmap(i),n.blobPromise=a.convertToBlob()}null===(e=i.close)||void 0===e||e.call(i),n.bitmap=null}}},{key:"isValidId",value:function(t){return t.startsWith("image_".concat(M(Re,this),"_"))}}],[{key:"_isSVGFittingCanvas",get:function(){var t=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),e=new Image;return e.src='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',gt(this,"_isSVGFittingCanvas",e.decode().then((function(){return t.drawImage(e,0,0,1,1,0,0,1,3),0===new Uint32Array(t.getImageData(0,0,1,1).data.buffer)[0]})))}}]);var t,e,n,i}();function Ne(t,e){return Oe.apply(this,arguments)}function Oe(){return(Oe=T(w().mark((function t(e,i){var a,r,s,o,l,h,u,c,d;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(M(Le,this)||E(Le,this,new Map),null!==(r=M(Le,this).get(e))){t.next=4;break}return t.abrupt("return",null);case 4:if(null===(a=r)||void 0===a||!a.bitmap){t.next=7;break}return r.refCounter+=1,t.abrupt("return",r);case 7:if(t.prev=7,r||(r={bitmap:null,id:"image_".concat(M(Re,this),"_").concat((E(Ie,this,(s=M(Ie,this),o=s++,s)),o)),refCounter:0,isSvg:!1}),"string"!=typeof i){t.next=16;break}return r.url=i,t.next=13,Bt(i,"blob");case 13:l=t.sent,t.next=17;break;case 16:i instanceof File?l=r.file=i:i instanceof Blob&&(l=i);case 17:if("image/svg+xml"!==l.type){t.next=27;break}return h=n._isSVGFittingCanvas,u=new FileReader,c=new Image,d=new Promise((function(t,e){c.onload=function(){r.bitmap=c,r.isSvg=!0,t()},u.onload=T(w().mark((function t(){var e;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=r.svgUrl=u.result,t.next=3,h;case 3:if(!t.sent){t.next=7;break}t.t0="".concat(e,"#svgView(preserveAspectRatio(none))"),t.next=8;break;case 7:t.t0=e;case 8:c.src=t.t0;case 9:case"end":return t.stop()}}),t)}))),c.onerror=u.onerror=e})),u.readAsDataURL(l),t.next=25,d;case 25:t.next=30;break;case 27:return t.next=29,createImageBitmap(l);case 29:r.bitmap=t.sent;case 30:r.refCounter=1,t.next=37;break;case 33:t.prev=33,t.t0=t.catch(7),dt(t.t0),r=null;case 37:return M(Le,this).set(e,r),r&&M(Le,this).set(r.id,r),t.abrupt("return",r);case 40:case"end":return t.stop()}}),t,this,[[7,33]])})))).apply(this,arguments)}n=Fe;var We=new WeakMap,Be=new WeakMap,He=new WeakMap,je=new WeakMap,ze=function(){return B((function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128;j(this,t),_(this,We,[]),_(this,Be,!1),_(this,He,void 0),_(this,je,-1),E(He,this,e)}),[{key:"add",value:function(t){var e=t.cmd,n=t.undo,i=t.post,a=t.mustExec,r=t.type,s=void 0===r?NaN:r,o=t.overwriteIfSameType,l=void 0!==o&&o,h=t.keepUndo,u=void 0!==h&&h;if(a&&e(),!M(Be,this)){var c={cmd:e,undo:n,post:i,type:s};if(-1===M(je,this))return M(We,this).length>0&&(M(We,this).length=0),E(je,this,0),void M(We,this).push(c);if(l&&M(We,this)[M(je,this)].type===s)return u&&(c.undo=M(We,this)[M(je,this)].undo),void(M(We,this)[M(je,this)]=c);var d=M(je,this)+1;d===M(He,this)?M(We,this).splice(0,1):(E(je,this,d),d<M(We,this).length&&M(We,this).splice(d)),M(We,this).push(c)}}},{key:"undo",value:function(){if(-1!==M(je,this)){E(Be,this,!0);var t=M(We,this)[M(je,this)],e=t.undo,n=t.post;e(),null==n||n(),E(Be,this,!1),E(je,this,M(je,this)-1)}}},{key:"redo",value:function(){if(M(je,this)<M(We,this).length-1){E(je,this,M(je,this)+1),E(Be,this,!0);var t=M(We,this)[M(je,this)],e=t.cmd,n=t.post;e(),null==n||n(),E(Be,this,!1)}}},{key:"hasSomethingToUndo",value:function(){return-1!==M(je,this)}},{key:"hasSomethingToRedo",value:function(){return M(je,this)<M(We,this).length-1}},{key:"cleanType",value:function(t){if(-1!==M(je,this)){for(var e=M(je,this);e>=0;e--)if(M(We,this)[e].type!==t)return M(We,this).splice(e+1,M(je,this)-e),void E(je,this,e);M(We,this).length=0,E(je,this,-1)}}},{key:"destroy",value:function(){E(We,this,null)}}])}(),Ge=new WeakSet,Ve=function(){return B((function t(e){j(this,t),A(this,Ge),this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;var n,i=Ct.platform.isMac,a=F(e);try{for(a.s();!(n=a.n()).done;){var r,s=I(n.value,3),o=s[0],l=s[1],h=s[2],u=void 0===h?{}:h,c=F(o);try{for(c.s();!(r=c.n()).done;){var d=r.value,f=d.startsWith("mac+");i&&f?(this.callbacks.set(d.slice(4),{callback:l,options:u}),this.allKeys.add(d.split("+").at(-1))):i||f||(this.callbacks.set(d,{callback:l,options:u}),this.allKeys.add(d.split("+").at(-1)))}}catch(t){c.e(t)}finally{c.f()}}}catch(t){a.e(t)}finally{a.f()}}),[{key:"exec",value:function(t,e){if(this.allKeys.has(e.key)){var n=this.callbacks.get(R(Ge,this,Ue).call(this,e));if(n){var i=n.callback,a=n.options,r=a.bubbles,s=void 0!==r&&r,o=a.args,l=void 0===o?[]:o,h=a.checker,u=void 0===h?null:h;u&&!u(t,e)||(i.bind.apply(i,[t].concat(k(l),[e]))(),s||Qt(e))}}}}])}();function Ue(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);var e=this.buffer.join("+");return this.buffer.length=0,e}var qe=function(){function t(){j(this,t)}return B(t,[{key:"_colors",get:function(){var t=new Map([["CanvasText",null],["Canvas",null]]);return function(t){var e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);var n,i=F(t.keys());try{for(i.s();!(n=i.n()).done;){var a=n.value;e.style.color=a;var r=window.getComputedStyle(e).color;t.set(a,ee(r))}}catch(t){i.e(t)}finally{i.f()}e.remove()}(t),gt(this,"_colors",t)}},{key:"convert",value:function(e){var n=ee(e);if(!window.matchMedia("(forced-colors: active)").matches)return n;var i,a=F(this._colors);try{for(a.s();!(i=a.n()).done;){var r=I(i.value,2),s=r[0];if(r[1].every((function(t,e){return t===n[e]})))return t._colorsMapping.get(s)}}catch(t){a.e(t)}finally{a.f()}return n}},{key:"getHexCode",value:function(t){var e=this._colors.get(t);return e?Pt.makeHexColor.apply(Pt,k(e)):t}}])}();P(qe,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));var Xe=new WeakMap,Ye=new WeakMap,Ke=new WeakMap,Qe=new WeakMap,Je=new WeakMap,Ze=new WeakMap,$e=new WeakMap,tn=new WeakMap,en=new WeakMap,nn=new WeakMap,an=new WeakMap,rn=new WeakMap,sn=new WeakMap,on=new WeakMap,ln=new WeakMap,hn=new WeakMap,un=new WeakMap,cn=new WeakMap,dn=new WeakMap,fn=new WeakMap,vn=new WeakMap,pn=new WeakMap,gn=new WeakMap,yn=new WeakMap,mn=new WeakMap,kn=new WeakMap,bn=new WeakMap,wn=new WeakMap,An=new WeakMap,_n=new WeakMap,xn=new WeakMap,Sn=new WeakMap,Mn=new WeakMap,En=new WeakMap,Cn=new WeakMap,Tn=new WeakMap,Pn=new WeakMap,Rn=new WeakMap,In=new WeakMap,Ln=new WeakMap,Dn=new WeakMap,Fn=new WeakMap,Nn=new WeakSet,On=function(){function t(e,n,i,a,r,s,o,l,h,u,c,d){var f=this;j(this,t),A(this,Nn),_(this,Xe,new AbortController),_(this,Ye,null),_(this,Ke,new Map),_(this,Qe,new Map),_(this,Je,null),_(this,Ze,null),_(this,$e,null),_(this,tn,new ze),_(this,en,null),_(this,nn,null),_(this,an,0),_(this,rn,new Set),_(this,sn,null),_(this,on,null),_(this,ln,new Set),P(this,"_editorUndoBar",null),_(this,hn,!1),_(this,un,!1),_(this,cn,!1),_(this,dn,null),_(this,fn,null),_(this,vn,null),_(this,pn,null),_(this,gn,!1),_(this,yn,null),_(this,mn,new Pe),_(this,kn,!1),_(this,bn,!1),_(this,wn,null),_(this,An,null),_(this,_n,null),_(this,xn,null),_(this,Sn,et.NONE),_(this,Mn,new Set),_(this,En,null),_(this,Cn,null),_(this,Tn,null),_(this,Pn,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1}),_(this,Rn,[0,0]),_(this,In,null),_(this,Ln,null),_(this,Dn,null),_(this,Fn,null);var v=this._signal=M(Xe,this).signal;E(Ln,this,e),E(Dn,this,n),E(Je,this,i),this._eventBus=a,a._on("editingaction",this.onEditingAction.bind(this),{signal:v}),a._on("pagechanging",this.onPageChanging.bind(this),{signal:v}),a._on("scalechanging",this.onScaleChanging.bind(this),{signal:v}),a._on("rotationchanging",this.onRotationChanging.bind(this),{signal:v}),a._on("setpreference",this.onSetPreference.bind(this),{signal:v}),a._on("switchannotationeditorparams",(function(t){return f.updateParams(t.type,t.value)}),{signal:v}),R(Nn,this,Gn).call(this),R(Nn,this,Qn).call(this),R(Nn,this,qn).call(this),E(Ze,this,r.annotationStorage),E(dn,this,r.filterFactory),E(Cn,this,s),E(pn,this,o||null),E(hn,this,l),E(un,this,h),E(cn,this,u),E(xn,this,c||null),this.viewParameters={realScale:Wt.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=d||null}return B(t,[{key:"destroy",value:function(){var t,e,n,i,a;null===(t=M(Fn,this))||void 0===t||t.resolve(),E(Fn,this,null),null===(e=M(Xe,this))||void 0===e||e.abort(),E(Xe,this,null),this._signal=null;var r,s=F(M(Qe,this).values());try{for(s.s();!(r=s.n()).done;)r.value.destroy()}catch(t){s.e(t)}finally{s.f()}M(Qe,this).clear(),M(Ke,this).clear(),M(ln,this).clear(),E(Ye,this,null),M(Mn,this).clear(),M(tn,this).destroy(),null===(n=M(Je,this))||void 0===n||n.destroy(),null===(i=M(yn,this))||void 0===i||i.hide(),E(yn,this,null),M(fn,this)&&(clearTimeout(M(fn,this)),E(fn,this,null)),M(In,this)&&(clearTimeout(M(In,this)),E(In,this,null)),null===(a=this._editorUndoBar)||void 0===a||a.destroy()}},{key:"combinedSignal",value:function(t){return AbortSignal.any([this._signal,t.signal])}},{key:"mlManager",get:function(){return M(xn,this)}},{key:"useNewAltTextFlow",get:function(){return M(un,this)}},{key:"useNewAltTextWhenAddingImage",get:function(){return M(cn,this)}},{key:"hcmFilter",get:function(){return gt(this,"hcmFilter",M(Cn,this)?M(dn,this).addHCMFilter(M(Cn,this).foreground,M(Cn,this).background):"none")}},{key:"direction",get:function(){return gt(this,"direction",getComputedStyle(M(Ln,this)).direction)}},{key:"highlightColors",get:function(){return gt(this,"highlightColors",M(pn,this)?new Map(M(pn,this).split(",").map((function(t){return t.split("=").map((function(t){return t.trim()}))}))):null)}},{key:"highlightColorNames",get:function(){return gt(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,(function(t){return t.reverse()}))):null)}},{key:"setCurrentDrawingSession",value:function(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),E(nn,this,t)}},{key:"setMainHighlightColorPicker",value:function(t){E(_n,this,t)}},{key:"editAltText",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];null===(e=M(Je,this))||void 0===e||e.editAltText(this,t,n)}},{key:"switchToMode",value:function(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}},{key:"setPreference",value:function(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}},{key:"onSetPreference",value:function(t){var e=t.name,n=t.value;"enableNewAltTextWhenAddingImage"===e&&E(cn,this,n)}},{key:"onPageChanging",value:function(t){var e=t.pageNumber;E(an,this,e-1)}},{key:"focusMainContainer",value:function(){M(Ln,this).focus()}},{key:"findParent",value:function(t,e){var n,i=F(M(Qe,this).values());try{for(i.s();!(n=i.n()).done;){var a=n.value,r=a.div.getBoundingClientRect(),s=r.x,o=r.y,l=r.width,h=r.height;if(t>=s&&t<=s+l&&e>=o&&e<=o+h)return a}}catch(t){i.e(t)}finally{i.f()}return null}},{key:"disableUserSelect",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];M(Dn,this).classList.toggle("noUserSelect",t)}},{key:"addShouldRescale",value:function(t){M(ln,this).add(t)}},{key:"removeShouldRescale",value:function(t){M(ln,this).delete(t)}},{key:"onScaleChanging",value:function(t){var e,n=t.scale;this.commitOrRemove(),this.viewParameters.realScale=n*Wt.PDF_TO_CSS_UNITS;var i,a=F(M(ln,this));try{for(a.s();!(i=a.n()).done;)i.value.onScaleChanging()}catch(t){a.e(t)}finally{a.f()}null===(e=M(nn,this))||void 0===e||e.onScaleChanging()}},{key:"onRotationChanging",value:function(t){var e=t.pagesRotation;this.commitOrRemove(),this.viewParameters.rotation=e}},{key:"highlightSelection",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=document.getSelection();if(n&&!n.isCollapsed){var i=n.anchorNode,a=n.anchorOffset,r=n.focusNode,s=n.focusOffset,o=n.toString(),l=R(Nn,this,Wn).call(this,n).closest(".textLayer"),h=this.getSelectionBoxes(l);if(h){n.empty();var u=R(Nn,this,Bn).call(this,l),c=M(Sn,this)===et.NONE,d=function(){null==u||u.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:h,anchorNode:i,anchorOffset:a,focusNode:r,focusOffset:s,text:o}),c&&t.showAllEditors("highlight",!0,!0)};c?this.switchToMode(et.HIGHLIGHT,d):d()}}}},{key:"addToAnnotationStorage",value:function(t){t.isEmpty()||!M(Ze,this)||M(Ze,this).has(t.id)||M(Ze,this).setValue(t.id,t)}},{key:"blur",value:function(){if(this.isShiftKeyDown=!1,M(gn,this)&&(E(gn,this,!1),R(Nn,this,zn).call(this,"main_toolbar")),this.hasSelection){var t,e=document.activeElement,n=F(M(Mn,this));try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i.div.contains(e)){E(An,this,[i,e]),i._focusEventsAllowed=!1;break}}}catch(t){n.e(t)}finally{n.f()}}}},{key:"focus",value:function(){if(M(An,this)){var t=I(M(An,this),2),e=t[0],n=t[1];E(An,this,null),n.addEventListener("focusin",(function(){e._focusEventsAllowed=!0}),{once:!0,signal:this._signal}),n.focus()}}},{key:"addEditListeners",value:function(){R(Nn,this,qn).call(this),R(Nn,this,Yn).call(this)}},{key:"removeEditListeners",value:function(){R(Nn,this,Xn).call(this),R(Nn,this,Kn).call(this)}},{key:"dragOver",value:function(t){var e,n=F(t.dataTransfer.items);try{for(n.s();!(e=n.n()).done;){var i,a=e.value.type,r=F(M(on,this));try{for(r.s();!(i=r.n()).done;)if(i.value.isHandlingMimeForPasting(a))return t.dataTransfer.dropEffect="copy",void t.preventDefault()}catch(t){r.e(t)}finally{r.f()}}}catch(t){n.e(t)}finally{n.f()}}},{key:"drop",value:function(t){var e,n=F(t.dataTransfer.items);try{for(n.s();!(e=n.n()).done;){var i,a=e.value,r=F(M(on,this));try{for(r.s();!(i=r.n()).done;){var s=i.value;if(s.isHandlingMimeForPasting(a.type))return s.paste(a,this.currentLayer),void t.preventDefault()}}catch(t){r.e(t)}finally{r.f()}}}catch(t){n.e(t)}finally{n.f()}}},{key:"copy",value:function(t){var e;if(t.preventDefault(),null===(e=M(Ye,this))||void 0===e||e.commitOrRemove(),this.hasSelection){var n,i=[],a=F(M(Mn,this));try{for(a.s();!(n=a.n()).done;){var r=n.value.serialize(!0);r&&i.push(r)}}catch(t){a.e(t)}finally{a.f()}0!==i.length&&t.clipboardData.setData("application/pdfjs",JSON.stringify(i))}}},{key:"cut",value:function(t){this.copy(t),this.delete()}},{key:"paste",value:(n=T(w().mark((function t(e){var n,i,a,r,s,o,l,h,u,c,d,f,v,p,g,y,m=this;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.preventDefault(),n=e.clipboardData,i=F(n.items),t.prev=3,i.s();case 5:if((a=i.n()).done){t.next=27;break}r=a.value,s=F(M(on,this)),t.prev=8,s.s();case 10:if((o=s.n()).done){t.next=17;break}if(!(l=o.value).isHandlingMimeForPasting(r.type)){t.next=15;break}return l.paste(r,this.currentLayer),t.abrupt("return");case 15:t.next=10;break;case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(8),s.e(t.t0);case 22:return t.prev=22,s.f(),t.finish(22);case 25:t.next=5;break;case 27:t.next=32;break;case 29:t.prev=29,t.t1=t.catch(3),i.e(t.t1);case 32:return t.prev=32,i.f(),t.finish(32);case 35:if(h=n.getData("application/pdfjs")){t.next=38;break}return t.abrupt("return");case 38:t.prev=38,h=JSON.parse(h),t.next=46;break;case 42:return t.prev=42,t.t2=t.catch(38),dt('paste: "'.concat(t.t2.message,'".')),t.abrupt("return");case 46:if(Array.isArray(h)){t.next=48;break}return t.abrupt("return");case 48:this.unselectAll(),u=this.currentLayer,t.prev=50,c=[],d=F(h),t.prev=53,d.s();case 55:if((f=d.n()).done){t.next=65;break}return v=f.value,t.next=59,u.deserialize(v);case 59:if(p=t.sent){t.next=62;break}return t.abrupt("return");case 62:c.push(p);case 63:t.next=55;break;case 65:t.next=70;break;case 67:t.prev=67,t.t3=t.catch(53),d.e(t.t3);case 70:return t.prev=70,d.f(),t.finish(70);case 73:g=function(){for(var t=0,e=c;t<e.length;t++){var n=e[t];R(Nn,m,ni).call(m,n)}R(Nn,m,ri).call(m,c)},y=function(){for(var t=0,e=c;t<e.length;t++)e[t].remove()},this.addCommands({cmd:g,undo:y,mustExec:!0}),t.next=81;break;case 78:t.prev=78,t.t4=t.catch(50),dt('paste: "'.concat(t.t4.message,'".'));case 81:case"end":return t.stop()}}),t,this,[[3,29,32,35],[8,19,22,25],[38,42],[50,78],[53,67,70,73]])}))),function(t){return n.apply(this,arguments)})},{key:"keydown",value:function(e){this.isShiftKeyDown||"Shift"!==e.key||(this.isShiftKeyDown=!0),M(Sn,this)===et.NONE||this.isEditorHandlingKeyboard||t._keyboardManager.exec(this,e)}},{key:"keyup",value:function(t){this.isShiftKeyDown&&"Shift"===t.key&&(this.isShiftKeyDown=!1,M(gn,this)&&(E(gn,this,!1),R(Nn,this,zn).call(this,"main_toolbar")))}},{key:"onEditingAction",value:function(t){var e=t.name;switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu")}}},{key:"setEditingState",value:function(t){t?(R(Nn,this,Vn).call(this),R(Nn,this,Yn).call(this),R(Nn,this,Jn).call(this,{isEditing:M(Sn,this)!==et.NONE,isEmpty:R(Nn,this,ai).call(this),hasSomethingToUndo:M(tn,this).hasSomethingToUndo(),hasSomethingToRedo:M(tn,this).hasSomethingToRedo(),hasSelectedEditor:!1})):(R(Nn,this,Un).call(this),R(Nn,this,Kn).call(this),R(Nn,this,Jn).call(this,{isEditing:!1}),this.disableUserSelect(!1))}},{key:"registerEditorTypes",value:function(t){if(!M(on,this)){E(on,this,t);var e,n=F(M(on,this));try{for(n.s();!(e=n.n()).done;){var i=e.value;R(Nn,this,Zn).call(this,i.defaultPropertiesToUpdate)}}catch(t){n.e(t)}finally{n.f()}}}},{key:"getId",value:function(){return M(mn,this).id}},{key:"currentLayer",get:function(){return M(Qe,this).get(M(an,this))}},{key:"getLayer",value:function(t){return M(Qe,this).get(t)}},{key:"currentPageIndex",get:function(){return M(an,this)}},{key:"addLayer",value:function(t){M(Qe,this).set(t.pageIndex,t),M(kn,this)?t.enable():t.disable()}},{key:"removeLayer",value:function(t){M(Qe,this).delete(t.pageIndex)}},{key:"updateMode",value:(e=T(w().mark((function t(e){var n,i,a,r,s,o,l,h,u=arguments;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=u.length>1&&void 0!==u[1]?u[1]:null,i=u.length>2&&void 0!==u[2]&&u[2],M(Sn,this)!==e){t.next=4;break}return t.abrupt("return");case 4:if(!M(Fn,this)){t.next=9;break}return t.next=7,M(Fn,this).promise;case 7:if(M(Fn,this)){t.next=9;break}return t.abrupt("return");case 9:if(E(Fn,this,Promise.withResolvers()),E(Sn,this,e),e!==et.NONE){t.next=17;break}return this.setEditingState(!1),R(Nn,this,ei).call(this),null===(a=this._editorUndoBar)||void 0===a||a.hide(),M(Fn,this).resolve(),t.abrupt("return");case 17:return this.setEditingState(!0),t.next=20,R(Nn,this,$n).call(this);case 20:this.unselectAll(),r=F(M(Qe,this).values());try{for(r.s();!(s=r.n()).done;)s.value.updateMode(e)}catch(t){r.e(t)}finally{r.f()}if(n){t.next=27;break}return i&&this.addNewEditorFromKeyboard(),M(Fn,this).resolve(),t.abrupt("return");case 27:o=F(M(Ke,this).values());try{for(o.s();!(l=o.n()).done;)(h=l.value).annotationElementId===n?(this.setSelected(h),h.enterInEditMode()):h.unselect()}catch(t){o.e(t)}finally{o.f()}M(Fn,this).resolve();case 30:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"addNewEditorFromKeyboard",value:function(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}},{key:"updateToolbar",value:function(t){t!==M(Sn,this)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:t})}},{key:"updateParams",value:function(t,e){var n;if(M(on,this)){switch(t){case nt.CREATE:return void this.currentLayer.addNewEditor();case nt.HIGHLIGHT_DEFAULT_COLOR:null===(n=M(_n,this))||void 0===n||n.updateColor(e);break;case nt.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(M(Tn,this)||E(Tn,this,new Map)).set(t,e),this.showAllEditors("highlight",e)}var i,a=F(M(Mn,this));try{for(a.s();!(i=a.n()).done;)i.value.updateParams(t,e)}catch(t){a.e(t)}finally{a.f()}var r,s=F(M(on,this));try{for(s.s();!(r=s.n()).done;)r.value.updateDefaultParams(t,e)}catch(t){s.e(t)}finally{s.f()}}}},{key:"showAllEditors",value:function(t,e){var n,i,a,r=F(M(Ke,this).values());try{for(r.s();!(a=r.n()).done;){var s=a.value;s.editorType===t&&s.show(e)}}catch(t){r.e(t)}finally{r.f()}(null===(n=null===(i=M(Tn,this))||void 0===i?void 0:i.get(nt.HIGHLIGHT_SHOW_ALL))||void 0===n||n)!==e&&R(Nn,this,Zn).call(this,[[nt.HIGHLIGHT_SHOW_ALL,e]])}},{key:"enableWaiting",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(M(bn,this)!==t){E(bn,this,t);var e,n=F(M(Qe,this).values());try{for(n.s();!(e=n.n()).done;){var i=e.value;t?i.disableClick():i.enableClick(),i.div.classList.toggle("waiting",t)}}catch(t){n.e(t)}finally{n.f()}}}},{key:"getEditors",value:function(t){var e,n=[],i=F(M(Ke,this).values());try{for(i.s();!(e=i.n()).done;){var a=e.value;a.pageIndex===t&&n.push(a)}}catch(t){i.e(t)}finally{i.f()}return n}},{key:"getEditor",value:function(t){return M(Ke,this).get(t)}},{key:"addEditor",value:function(t){M(Ke,this).set(t.id,t)}},{key:"removeEditor",value:function(t){var e,n=this;t.div.contains(document.activeElement)&&(M(fn,this)&&clearTimeout(M(fn,this)),E(fn,this,setTimeout((function(){n.focusMainContainer(),E(fn,n,null)}),0))),M(Ke,this).delete(t.id),this.unselect(t),t.annotationElementId&&M(rn,this).has(t.annotationElementId)||null===(e=M(Ze,this))||void 0===e||e.remove(t.id)}},{key:"addDeletedAnnotationElement",value:function(t){M(rn,this).add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}},{key:"isDeletedAnnotationElement",value:function(t){return M(rn,this).has(t)}},{key:"removeDeletedAnnotationElement",value:function(t){M(rn,this).delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}},{key:"setActiveEditor",value:function(t){M(Ye,this)!==t&&(E(Ye,this,t),t&&R(Nn,this,Zn).call(this,t.propertiesToUpdate))}},{key:"updateUI",value:function(t){S(Nn,this,ii)===t&&R(Nn,this,Zn).call(this,t.propertiesToUpdate)}},{key:"updateUIForDefaultProperties",value:function(t){R(Nn,this,Zn).call(this,t.defaultPropertiesToUpdate)}},{key:"toggleSelected",value:function(t){if(M(Mn,this).has(t))return M(Mn,this).delete(t),t.unselect(),void R(Nn,this,Jn).call(this,{hasSelectedEditor:this.hasSelection});M(Mn,this).add(t),t.select(),R(Nn,this,Zn).call(this,t.propertiesToUpdate),R(Nn,this,Jn).call(this,{hasSelectedEditor:!0})}},{key:"setSelected",value:function(t){var e;null===(e=M(nn,this))||void 0===e||e.commitOrRemove();var n,i=F(M(Mn,this));try{for(i.s();!(n=i.n()).done;){var a=n.value;a!==t&&a.unselect()}}catch(t){i.e(t)}finally{i.f()}M(Mn,this).clear(),M(Mn,this).add(t),t.select(),R(Nn,this,Zn).call(this,t.propertiesToUpdate),R(Nn,this,Jn).call(this,{hasSelectedEditor:!0})}},{key:"isSelected",value:function(t){return M(Mn,this).has(t)}},{key:"firstSelectedEditor",get:function(){return M(Mn,this).values().next().value}},{key:"unselect",value:function(t){t.unselect(),M(Mn,this).delete(t),R(Nn,this,Jn).call(this,{hasSelectedEditor:this.hasSelection})}},{key:"hasSelection",get:function(){return 0!==M(Mn,this).size}},{key:"isEnterHandled",get:function(){return 1===M(Mn,this).size&&this.firstSelectedEditor.isEnterHandled}},{key:"undo",value:function(){var t;M(tn,this).undo(),R(Nn,this,Jn).call(this,{hasSomethingToUndo:M(tn,this).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:R(Nn,this,ai).call(this)}),null===(t=this._editorUndoBar)||void 0===t||t.hide()}},{key:"redo",value:function(){M(tn,this).redo(),R(Nn,this,Jn).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:M(tn,this).hasSomethingToRedo(),isEmpty:R(Nn,this,ai).call(this)})}},{key:"addCommands",value:function(t){M(tn,this).add(t),R(Nn,this,Jn).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:R(Nn,this,ai).call(this)})}},{key:"cleanUndoStack",value:function(t){M(tn,this).cleanType(t)}},{key:"delete",value:function(){var t,e=this;this.commitOrRemove();var n=null===(t=this.currentLayer)||void 0===t?void 0:t.endDrawingSession(!0);if(this.hasSelection||n){var i=n?[n]:k(M(Mn,this)),a=function(){var t,n=F(i);try{for(n.s();!(t=n.n()).done;){var a=t.value;R(Nn,e,ni).call(e,a)}}catch(t){n.e(t)}finally{n.f()}};this.addCommands({cmd:function(){var t;null===(t=e._editorUndoBar)||void 0===t||t.show(a,1===i.length?i[0].editorType:i.length);var n,r=F(i);try{for(r.s();!(n=r.n()).done;)n.value.remove()}catch(t){r.e(t)}finally{r.f()}},undo:a,mustExec:!0})}}},{key:"commitOrRemove",value:function(){var t;null===(t=M(Ye,this))||void 0===t||t.commitOrRemove()}},{key:"hasSomethingToControl",value:function(){return M(Ye,this)||this.hasSelection}},{key:"selectAll",value:function(){var t,e=F(M(Mn,this));try{for(e.s();!(t=e.n()).done;)t.value.commit()}catch(t){e.e(t)}finally{e.f()}R(Nn,this,ri).call(this,M(Ke,this).values())}},{key:"unselectAll",value:function(){var t;if((!M(Ye,this)||(M(Ye,this).commitOrRemove(),M(Sn,this)===et.NONE))&&(null===(t=M(nn,this))||void 0===t||!t.commitOrRemove())&&this.hasSelection){var e,n=F(M(Mn,this));try{for(n.s();!(e=n.n()).done;)e.value.unselect()}catch(t){n.e(t)}finally{n.f()}M(Mn,this).clear(),R(Nn,this,Jn).call(this,{hasSelectedEditor:!1})}}},{key:"translateSelectedEditors",value:function(t,e){var n=this;if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]||this.commitOrRemove(),this.hasSelection){M(Rn,this)[0]+=t,M(Rn,this)[1]+=e;var i=I(M(Rn,this),2),a=i[0],r=i[1],s=k(M(Mn,this));M(In,this)&&clearTimeout(M(In,this)),E(In,this,setTimeout((function(){E(In,n,null),M(Rn,n)[0]=M(Rn,n)[1]=0,n.addCommands({cmd:function(){var t,e=F(s);try{for(e.s();!(t=e.n()).done;){var i=t.value;M(Ke,n).has(i.id)&&i.translateInPage(a,r)}}catch(t){e.e(t)}finally{e.f()}},undo:function(){var t,e=F(s);try{for(e.s();!(t=e.n()).done;){var i=t.value;M(Ke,n).has(i.id)&&i.translateInPage(-a,-r)}}catch(t){e.e(t)}finally{e.f()}},mustExec:!1})}),1e3));var o,l=F(s);try{for(l.s();!(o=l.n()).done;)o.value.translateInPage(t,e)}catch(t){l.e(t)}finally{l.f()}}}},{key:"setUpDragSession",value:function(){if(this.hasSelection){this.disableUserSelect(!0),E(sn,this,new Map);var t,e=F(M(Mn,this));try{for(e.s();!(t=e.n()).done;){var n=t.value;M(sn,this).set(n,{savedX:n.x,savedY:n.y,savedPageIndex:n.pageIndex,newX:0,newY:0,newPageIndex:-1})}}catch(t){e.e(t)}finally{e.f()}}}},{key:"endDragSession",value:function(){var t=this;if(!M(sn,this))return!1;this.disableUserSelect(!1);var e=M(sn,this);E(sn,this,null);var n,i=!1,a=F(e);try{for(a.s();!(n=a.n()).done;){var r=I(n.value,2),s=r[0],o=s.x,l=s.y,h=s.pageIndex,u=r[1];u.newX=o,u.newY=l,u.newPageIndex=h,i||(i=o!==u.savedX||l!==u.savedY||h!==u.savedPageIndex)}}catch(t){a.e(t)}finally{a.f()}if(!i)return!1;var c=function(e,n,i,a){if(M(Ke,t).has(e.id)){var r=M(Qe,t).get(a);r?e._setParentAndPosition(r,n,i):(e.pageIndex=a,e.x=n,e.y=i)}};return this.addCommands({cmd:function(){var t,n=F(e);try{for(n.s();!(t=n.n()).done;){var i=I(t.value,2),a=i[0],r=i[1],s=r.newX,o=r.newY,l=r.newPageIndex;c(a,s,o,l)}}catch(t){n.e(t)}finally{n.f()}},undo:function(){var t,n=F(e);try{for(n.s();!(t=n.n()).done;){var i=I(t.value,2),a=i[0],r=i[1],s=r.savedX,o=r.savedY,l=r.savedPageIndex;c(a,s,o,l)}}catch(t){n.e(t)}finally{n.f()}},mustExec:!0}),!0}},{key:"dragSelectedEditors",value:function(t,e){if(M(sn,this)){var n,i=F(M(sn,this).keys());try{for(i.s();!(n=i.n()).done;)n.value.drag(t,e)}catch(t){i.e(t)}finally{i.f()}}}},{key:"rebuild",value:function(t){if(null===t.parent){var e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}},{key:"isEditorHandlingKeyboard",get:function(){var t;return(null===(t=this.getActive())||void 0===t?void 0:t.shouldGetKeyboardEvents())||1===M(Mn,this).size&&this.firstSelectedEditor.shouldGetKeyboardEvents()}},{key:"isActive",value:function(t){return M(Ye,this)===t}},{key:"getActive",value:function(){return M(Ye,this)}},{key:"getMode",value:function(){return M(Sn,this)}},{key:"imageManager",get:function(){return gt(this,"imageManager",new Fe)}},{key:"getSelectionBoxes",value:function(t){if(!t)return null;for(var e=document.getSelection(),n=0,i=e.rangeCount;n<i;n++)if(!t.contains(e.getRangeAt(n).commonAncestorContainer))return null;var a,r=t.getBoundingClientRect(),s=r.x,o=r.y,l=r.width,h=r.height;switch(t.getAttribute("data-main-rotation")){case"90":a=function(t,e,n,i){return{x:(e-o)/h,y:1-(t+n-s)/l,width:i/h,height:n/l}};break;case"180":a=function(t,e,n,i){return{x:1-(t+n-s)/l,y:1-(e+i-o)/h,width:n/l,height:i/h}};break;case"270":a=function(t,e,n,i){return{x:1-(e+i-o)/h,y:(t-s)/l,width:i/h,height:n/l}};break;default:a=function(t,e,n,i){return{x:(t-s)/l,y:(e-o)/h,width:n/l,height:i/h}}}for(var u=[],c=0,d=e.rangeCount;c<d;c++){var f=e.getRangeAt(c);if(!f.collapsed){var v,p=F(f.getClientRects());try{for(p.s();!(v=p.n()).done;){var g=v.value,y=g.x,m=g.y,k=g.width,b=g.height;0!==k&&0!==b&&u.push(a(y,m,k,b))}}catch(t){p.e(t)}finally{p.f()}}}return 0===u.length?null:u}},{key:"addChangedExistingAnnotation",value:function(t){var e=t.annotationElementId,n=t.id;(M($e,this)||E($e,this,new Map)).set(e,n)}},{key:"removeChangedExistingAnnotation",value:function(t){var e,n=t.annotationElementId;null===(e=M($e,this))||void 0===e||e.delete(n)}},{key:"renderAnnotationElement",value:function(t){var e,n=null===(e=M($e,this))||void 0===e?void 0:e.get(t.data.id);if(n){var i=M(Ze,this).getRawValue(n);i&&(M(Sn,this)!==et.NONE||i.hasBeenModified)&&i.renderAnnotationElement(t)}}}],[{key:"_keyboardManager",get:function(){var e=t.prototype,n=function(t){return M(Ln,t).contains(document.activeElement)&&"BUTTON"!==document.activeElement.tagName&&t.hasSomethingToControl()},i=function(t,e){var n=e.target;if(n instanceof HTMLInputElement){var i=n.type;return"text"!==i&&"number"!==i}return!0},a=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return gt(this,"_keyboardManager",new Ve([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:i}],[["ctrl+z","mac+meta+z"],e.undo,{checker:i}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:i}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:i}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:function(t,e){var n=e.target;return!(n instanceof HTMLButtonElement)&&M(Ln,t).contains(n)&&!t.isEnterHandled}}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:function(t,e){return!(e.target instanceof HTMLButtonElement)&&M(Ln,t).contains(document.activeElement)}}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-a,0],checker:n}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:n}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[a,0],checker:n}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:n}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-a],checker:n}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:n}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,a],checker:n}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:n}]]))}}]);var e,n}();function Wn(t){var e=t.anchorNode;return e.nodeType===Node.TEXT_NODE?e.parentElement:e}function Bn(t){var e=this.currentLayer;if(e.hasTextLayer(t))return e;var n,i=F(M(Qe,this).values());try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a.hasTextLayer(t))return a}}catch(t){i.e(t)}finally{i.f()}return null}function Hn(){var t=document.getSelection();if(t&&!t.isCollapsed){var e=R(Nn,this,Wn).call(this,t).closest(".textLayer"),n=this.getSelectionBoxes(e);n&&(M(yn,this)||E(yn,this,new xe(this)),M(yn,this).show(e,n,"ltr"===this.direction))}}function jn(){var t,e=this,n=document.getSelection();if(n&&!n.isCollapsed){var i=n.anchorNode;if(i!==M(En,this)){var a,r=R(Nn,this,Wn).call(this,n).closest(".textLayer");if(r){if(null===(t=M(yn,this))||void 0===t||t.hide(),E(En,this,i),R(Nn,this,Jn).call(this,{hasSelectedText:!0}),(M(Sn,this)===et.HIGHLIGHT||M(Sn,this)===et.NONE)&&(M(Sn,this)===et.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),E(gn,this,this.isShiftKeyDown),!this.isShiftKeyDown)){var s=M(Sn,this)===et.HIGHLIGHT?R(Nn,this,Bn).call(this,r):null;null==s||s.toggleDrawing();var o=new AbortController,l=this.combinedSignal(o),h=function(t){"pointerup"===t.type&&0!==t.button||(o.abort(),null==s||s.toggleDrawing(!0),"pointerup"===t.type&&R(Nn,e,zn).call(e,"main_toolbar"))};window.addEventListener("pointerup",h,{signal:l}),window.addEventListener("blur",h,{signal:l})}}else M(En,this)&&(null===(a=M(yn,this))||void 0===a||a.hide(),E(En,this,null),R(Nn,this,Jn).call(this,{hasSelectedText:!1}))}}else{var u;M(En,this)&&(null===(u=M(yn,this))||void 0===u||u.hide(),E(En,this,null),R(Nn,this,Jn).call(this,{hasSelectedText:!1}))}}function zn(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";M(Sn,this)===et.HIGHLIGHT?this.highlightSelection(t):M(hn,this)&&R(Nn,this,Hn).call(this)}function Gn(){document.addEventListener("selectionchange",R(Nn,this,jn).bind(this),{signal:this._signal})}function Vn(){if(!M(vn,this)){E(vn,this,new AbortController);var t=this.combinedSignal(M(vn,this));window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}}function Un(){var t;null===(t=M(vn,this))||void 0===t||t.abort(),E(vn,this,null)}function qn(){if(!M(wn,this)){E(wn,this,new AbortController);var t=this.combinedSignal(M(wn,this));window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}}function Xn(){var t;null===(t=M(wn,this))||void 0===t||t.abort(),E(wn,this,null)}function Yn(){if(!M(en,this)){E(en,this,new AbortController);var t=this.combinedSignal(M(en,this));document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}}function Kn(){var t;null===(t=M(en,this))||void 0===t||t.abort(),E(en,this,null)}function Qn(){var t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}function Jn(t){var e=this;Object.entries(t).some((function(t){var n=I(t,2),i=n[0],a=n[1];return M(Pn,e)[i]!==a}))&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(M(Pn,this),t)}),M(Sn,this)===et.HIGHLIGHT&&!1===t.hasSelectedEditor&&R(Nn,this,Zn).call(this,[[nt.HIGHLIGHT_FREE,!0]]))}function Zn(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}function $n(){return ti.apply(this,arguments)}function ti(){return(ti=T(w().mark((function t(){var e,n,i,a,r,s;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(M(kn,this)){t.next=9;break}E(kn,this,!0),e=[],n=F(M(Qe,this).values());try{for(n.s();!(i=n.n()).done;)a=i.value,e.push(a.enable())}catch(t){n.e(t)}finally{n.f()}return t.next=7,Promise.all(e);case 7:r=F(M(Ke,this).values());try{for(r.s();!(s=r.n()).done;)s.value.enable()}catch(t){r.e(t)}finally{r.f()}case 9:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function ei(){if(this.unselectAll(),M(kn,this)){E(kn,this,!1);var t,e=F(M(Qe,this).values());try{for(e.s();!(t=e.n()).done;)t.value.disable()}catch(t){e.e(t)}finally{e.f()}var n,i=F(M(Ke,this).values());try{for(i.s();!(n=i.n()).done;)n.value.disable()}catch(t){i.e(t)}finally{i.f()}}}function ni(t){var e=M(Qe,this).get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}function ii(t){var e,n=null,i=F(M(Mn,t));try{for(i.s();!(e=i.n()).done;)n=e.value}catch(t){i.e(t)}finally{i.f()}return n}function ai(){if(0===M(Ke,this).size)return!0;if(1===M(Ke,this).size){var t,e=F(M(Ke,this).values());try{for(e.s();!(t=e.n()).done;)return t.value.isEmpty()}catch(t){e.e(t)}finally{e.f()}}return!1}function ri(t){var e,n=F(M(Mn,this));try{for(n.s();!(e=n.n()).done;)e.value.unselect()}catch(t){n.e(t)}finally{n.f()}M(Mn,this).clear();var i,a=F(t);try{for(a.s();!(i=a.n()).done;){var r=i.value;r.isEmpty()||(M(Mn,this).add(r),r.select())}}catch(t){a.e(t)}finally{a.f()}R(Nn,this,Jn).call(this,{hasSelectedEditor:this.hasSelection})}P(On,"TRANSLATE_SMALL",1),P(On,"TRANSLATE_BIG",10);var si=new WeakMap,oi=new WeakMap,li=new WeakMap,hi=new WeakMap,ui=new WeakMap,ci=new WeakMap,di=new WeakMap,fi=new WeakMap,vi=new WeakMap,pi=new WeakMap,gi=new WeakMap,yi=new WeakMap,mi=new WeakSet,ki=function(){function t(e){j(this,t),A(this,mi),_(this,si,null),_(this,oi,!1),_(this,li,null),_(this,hi,null),_(this,ui,null),_(this,ci,null),_(this,di,!1),_(this,fi,null),_(this,vi,null),_(this,pi,null),_(this,gi,null),_(this,yi,!1),E(vi,this,e),E(yi,this,e._uiManager.useNewAltTextFlow),_i._||(_i._=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}return B(t,[{key:"render",value:(n=T(w().mark((function t(){var e,n,i,a,r=this;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(e=E(li,this,document.createElement("button"))).className="altText",e.tabIndex="0",n=E(hi,this,document.createElement("span")),e.append(n),M(yi,this)?(e.classList.add("new"),e.setAttribute("data-l10n-id",_i._.missing),n.setAttribute("data-l10n-id",_i._["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),n.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label")),i=M(vi,this)._uiManager._signal,e.addEventListener("contextmenu",Kt,{signal:i}),e.addEventListener("pointerdown",(function(t){return t.stopPropagation()}),{signal:i}),a=function(t){t.preventDefault(),M(vi,r)._uiManager.editAltText(M(vi,r)),M(yi,r)&&M(vi,r)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:S(mi,r,bi)}})},e.addEventListener("click",a,{capture:!0,signal:i}),e.addEventListener("keydown",(function(t){t.target===e&&"Enter"===t.key&&(E(di,r,!0),a(t))}),{signal:i}),t.next=14,R(mi,this,wi).call(this);case 14:return t.abrupt("return",e);case 15:case"end":return t.stop()}}),t,this)}))),function(){return n.apply(this,arguments)})},{key:"finish",value:function(){M(li,this)&&(M(li,this).focus({focusVisible:M(di,this)}),E(di,this,!1))}},{key:"isEmpty",value:function(){return M(yi,this)?null===M(si,this):!M(si,this)&&!M(oi,this)}},{key:"hasData",value:function(){return M(yi,this)?null!==M(si,this)||!!M(pi,this):this.isEmpty()}},{key:"guessedText",get:function(){return M(pi,this)}},{key:"setGuessedText",value:(e=T(w().mark((function e(n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===M(si,this)){e.next=2;break}return e.abrupt("return");case 2:return E(pi,this,n),e.t0=E,e.t1=gi,e.t2=this,e.next=8,t._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:n});case 8:e.t3=e.sent,(0,e.t0)(e.t1,e.t2,e.t3),R(mi,this,wi).call(this);case 11:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)})},{key:"toggleAltTextBadge",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!M(yi,this)||M(si,this))return null===(t=M(fi,this))||void 0===t||t.remove(),void E(fi,this,null);if(!M(fi,this)){var n=E(fi,this,document.createElement("div"));n.className="noAltTextBadge",M(vi,this).div.append(n)}M(fi,this).classList.toggle("hidden",!e)}},{key:"serialize",value:function(t){var e=M(si,this);return t||M(pi,this)!==e||(e=M(gi,this)),{altText:e,decorative:M(oi,this),guessedText:M(pi,this),textWithDisclaimer:M(gi,this)}}},{key:"data",get:function(){return{altText:M(si,this),decorative:M(oi,this)}},set:function(t){var e=t.altText,n=t.decorative,i=t.guessedText,a=t.textWithDisclaimer,r=t.cancel,s=void 0!==r&&r;i&&(E(pi,this,i),E(gi,this,a)),M(si,this)===e&&M(oi,this)===n||(s||(E(si,this,e),E(oi,this,n)),R(mi,this,wi).call(this))}},{key:"toggle",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];M(li,this)&&(!t&&M(ci,this)&&(clearTimeout(M(ci,this)),E(ci,this,null)),M(li,this).disabled=!t)}},{key:"shown",value:function(){M(vi,this)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:S(mi,this,bi)}})}},{key:"destroy",value:function(){var t,e;null===(t=M(li,this))||void 0===t||t.remove(),E(li,this,null),E(hi,this,null),E(ui,this,null),null===(e=M(fi,this))||void 0===e||e.remove(),E(fi,this,null)}}],[{key:"initialize",value:function(e){var n;null!==(n=t._l10n)&&void 0!==n||(t._l10n=e)}}]);var e,n}();function bi(t){return(M(si,t)?"added":null===M(si,t)&&t.guessedText&&"review")||"missing"}function wi(){return Ai.apply(this,arguments)}function Ai(){return(Ai=T(w().mark((function t(){var e,n,i,a,r,s,o,l=this;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=M(li,this)){t.next=3;break}return t.abrupt("return");case 3:if(!M(yi,this)){t.next=12;break}if(e.classList.toggle("done",!!M(si,this)),e.setAttribute("data-l10n-id",_i._[S(mi,this,bi)]),null===(n=M(hi,this))||void 0===n||n.setAttribute("data-l10n-id",_i._["".concat(S(mi,this,bi),"-label")]),M(si,this)){t.next=10;break}return null===(i=M(ui,this))||void 0===i||i.remove(),t.abrupt("return");case 10:t.next=18;break;case 12:if(M(si,this)||M(oi,this)){t.next=16;break}return e.classList.remove("done"),null===(a=M(ui,this))||void 0===a||a.remove(),t.abrupt("return");case 16:e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button");case 18:(r=M(ui,this))||(E(ui,this,r=document.createElement("span")),r.className="tooltip",r.setAttribute("role","tooltip"),r.id="alt-text-tooltip-".concat(M(vi,this).id),(s=M(vi,this)._uiManager._signal).addEventListener("abort",(function(){clearTimeout(M(ci,l)),E(ci,l,null)}),{once:!0}),e.addEventListener("mouseenter",(function(){E(ci,l,setTimeout((function(){E(ci,l,null),M(ui,l).classList.add("show"),M(vi,l)._reportTelemetry({action:"alt_text_tooltip"})}),100))}),{signal:s}),e.addEventListener("mouseleave",(function(){var t;M(ci,l)&&(clearTimeout(M(ci,l)),E(ci,l,null)),null===(t=M(ui,l))||void 0===t||t.classList.remove("show")}),{signal:s})),M(oi,this)?r.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(r.removeAttribute("data-l10n-id"),r.textContent=M(si,this)),r.parentNode||e.append(r),null==(o=M(vi,this).getImageForAltText())||o.setAttribute("aria-describedby",r.id);case 24:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}var _i={_:null};P(ki,"_l10n",null);var xi=new WeakMap,Si=new WeakMap,Mi=new WeakMap,Ei=new WeakMap,Ci=new WeakMap,Ti=new WeakMap,Pi=new WeakMap,Ri=new WeakMap,Ii=new WeakMap,Li=new WeakMap,Di=new WeakMap,Fi=new WeakMap,Ni=new WeakMap,Oi=new WeakMap,Wi=new WeakMap,Bi=new WeakMap,Hi=new WeakMap,ji=new WeakMap,zi=new WeakMap,Gi=new WeakMap,Vi=new WeakMap,Ui=new WeakMap,qi=new WeakMap,Xi=new WeakSet,Yi=function(){function t(e){j(this,t),A(this,Xi),_(this,xi,null),_(this,Si,null),_(this,Mi,null),_(this,Ei,!1),_(this,Ci,null),_(this,Ti,""),_(this,Pi,!1),_(this,Ri,null),_(this,Ii,null),_(this,Li,null),_(this,Di,null),_(this,Fi,""),_(this,Ni,!1),_(this,Oi,null),_(this,Wi,!1),_(this,Bi,!1),_(this,Hi,!1),_(this,ji,null),_(this,zi,0),_(this,Gi,0),_(this,Vi,null),P(this,"_editToolbar",null),P(this,"_initialOptions",Object.create(null)),P(this,"_initialData",null),P(this,"_isVisible",!0),P(this,"_uiManager",null),P(this,"_focusEventsAllowed",!0),_(this,Ui,!1),_(this,qi,t._zIndex++),this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;var n=this.parent.viewport,i=n.rotation,a=n.rawDims,r=a.pageWidth,s=a.pageHeight,o=a.pageX,l=a.pageY;this.rotation=i,this.pageRotation=(360+i-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[r,s],this.pageTranslation=[o,l];var h=I(this.parentDimensions,2),u=h[0],c=h[1];this.x=e.x/u,this.y=e.y/c,this.isAttachedToDOM=!1,this.deleted=!1}return B(t,[{key:"editorType",get:function(){return Object.getPrototypeOf(this).constructor._type}},{key:"propertiesToUpdate",get:function(){return[]}},{key:"_isDraggable",get:function(){return M(Ui,this)},set:function(t){var e;E(Ui,this,t),null===(e=this.div)||void 0===e||e.classList.toggle("draggable",t)}},{key:"isEnterHandled",get:function(){return!0}},{key:"center",value:function(){var t=I(this.pageDimensions,2),e=t[0],n=t[1];switch(this.parentRotation){case 90:this.x-=this.height*n/(2*e),this.y+=this.width*e/(2*n);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*n/(2*e),this.y-=this.width*e/(2*n);break;default:this.x-=this.width/2,this.y-=this.height/2}this.fixAndSetPosition()}},{key:"addCommands",value:function(t){this._uiManager.addCommands(t)}},{key:"currentLayer",get:function(){return this._uiManager.currentLayer}},{key:"setInBackground",value:function(){this.div.style.zIndex=0}},{key:"setInForeground",value:function(){this.div.style.zIndex=M(qi,this)}},{key:"setParent",value:function(t){null!==t?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):R(Xi,this,ua).call(this),this.parent=t}},{key:"focusin",value:function(t){this._focusEventsAllowed&&(M(Ni,this)?E(Ni,this,!1):this.parent.setSelected(this))}},{key:"focusout",value:function(t){var e;if(this._focusEventsAllowed&&this.isAttachedToDOM){var n=t.relatedTarget;null!=n&&n.closest("#".concat(this.id))||(t.preventDefault(),null!==(e=this.parent)&&void 0!==e&&e.isMultipleSelection||this.commitOrRemove())}}},{key:"commitOrRemove",value:function(){this.isEmpty()?this.remove():this.commit()}},{key:"commit",value:function(){this.addToAnnotationStorage()}},{key:"addToAnnotationStorage",value:function(){this._uiManager.addToAnnotationStorage(this)}},{key:"setAt",value:function(t,e,n,i){var a=I(this.parentDimensions,2),r=a[0],s=a[1],o=I(this.screenToPageTranslation(n,i),2);n=o[0],i=o[1],this.x=(t+n)/r,this.y=(e+i)/s,this.fixAndSetPosition()}},{key:"translate",value:function(t,e){R(Xi,this,Ki).call(this,this.parentDimensions,t,e)}},{key:"translateInPage",value:function(t,e){M(Oi,this)||E(Oi,this,[this.x,this.y,this.width,this.height]),R(Xi,this,Ki).call(this,this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}},{key:"drag",value:function(t,e){M(Oi,this)||E(Oi,this,[this.x,this.y,this.width,this.height]);var n=this.div,i=I(this.parentDimensions,2),a=i[0],r=i[1];if(this.x+=t/a,this.y+=e/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){var s=this.div.getBoundingClientRect(),o=s.x,l=s.y;this.parent.findNewParent(this,o,l)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}var h=this.x,u=this.y,c=I(this.getBaseTranslation(),2);h+=c[0],u+=c[1];var d=n.style;d.left="".concat((100*h).toFixed(2),"%"),d.top="".concat((100*u).toFixed(2),"%"),this._onTranslating(h,u),n.scrollIntoView({block:"nearest"})}},{key:"_onTranslating",value:function(t,e){}},{key:"_onTranslated",value:function(t,e){}},{key:"_hasBeenMoved",get:function(){return!!M(Oi,this)&&(M(Oi,this)[0]!==this.x||M(Oi,this)[1]!==this.y)}},{key:"_hasBeenResized",get:function(){return!!M(Oi,this)&&(M(Oi,this)[2]!==this.width||M(Oi,this)[3]!==this.height)}},{key:"getBaseTranslation",value:function(){var e=I(this.parentDimensions,2),n=e[0],i=e[1],a=t._borderLineWidth,r=a/n,s=a/i;switch(this.rotation){case 90:return[-r,s];case 180:return[r,s];case 270:return[r,-s];default:return[-r,-s]}}},{key:"_mustFixPosition",get:function(){return!0}},{key:"fixAndSetPosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.rotation,e=this.div.style,n=I(this.pageDimensions,2),i=n[0],a=n[1],r=this.x,s=this.y,o=this.width,l=this.height;if(o*=i,l*=a,r*=i,s*=a,this._mustFixPosition)switch(t){case 0:r=Math.max(0,Math.min(i-o,r)),s=Math.max(0,Math.min(a-l,s));break;case 90:r=Math.max(0,Math.min(i-l,r)),s=Math.min(a,Math.max(o,s));break;case 180:r=Math.min(i,Math.max(o,r)),s=Math.min(a,Math.max(l,s));break;case 270:r=Math.min(i,Math.max(l,r)),s=Math.max(0,Math.min(a-o,s))}this.x=r/=i,this.y=s/=a;var h=I(this.getBaseTranslation(),2);r+=h[0],s+=h[1],e.left="".concat((100*r).toFixed(2),"%"),e.top="".concat((100*s).toFixed(2),"%"),this.moveInDOM()}},{key:"screenToPageTranslation",value:function(e,n){return Qi.call(t,e,n,this.parentRotation)}},{key:"pageTranslationToScreen",value:function(e,n){return Qi.call(t,e,n,360-this.parentRotation)}},{key:"parentScale",get:function(){return this._uiManager.viewParameters.realScale}},{key:"parentRotation",get:function(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}},{key:"parentDimensions",get:function(){var t=this.parentScale,e=I(this.pageDimensions,2);return[e[0]*t,e[1]*t]}},{key:"setDims",value:function(t,e){var n=I(this.parentDimensions,2),i=n[0],a=n[1],r=this.div.style;r.width="".concat((100*t/i).toFixed(2),"%"),M(Pi,this)||(r.height="".concat((100*e/a).toFixed(2),"%"))}},{key:"fixDims",value:function(){var t=this.div.style,e=t.height,n=t.width,i=n.endsWith("%"),a=!M(Pi,this)&&e.endsWith("%");if(!i||!a){var r=I(this.parentDimensions,2),s=r[0],o=r[1];i||(t.width="".concat((100*parseFloat(n)/s).toFixed(2),"%")),M(Pi,this)||a||(t.height="".concat((100*parseFloat(e)/o).toFixed(2),"%"))}}},{key:"getInitialTranslation",value:function(){return[0,0]}},{key:"_onResized",value:function(){}},{key:"_onResizing",value:function(){}},{key:"altTextFinish",value:function(){var t;null===(t=M(Mi,this))||void 0===t||t.finish()}},{key:"addEditToolbar",value:(a=T(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._editToolbar&&!M(Bi,this)){t.next=2;break}return t.abrupt("return",this._editToolbar);case 2:if(this._editToolbar=new de(this),this.div.append(this._editToolbar.render()),!M(Mi,this)){t.next=7;break}return t.next=7,this._editToolbar.addAltText(M(Mi,this));case 7:return t.abrupt("return",this._editToolbar);case 8:case"end":return t.stop()}}),t,this)}))),function(){return a.apply(this,arguments)})},{key:"removeEditToolbar",value:function(){var t;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,null===(t=M(Mi,this))||void 0===t||t.destroy())}},{key:"addContainer",value:function(t){var e,n=null===(e=this._editToolbar)||void 0===e?void 0:e.div;n?n.before(t):this.div.append(t)}},{key:"getClientDimensions",value:function(){return this.div.getBoundingClientRect()}},{key:"addAltTextButton",value:(i=T(w().mark((function e(){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!M(Mi,this)){e.next=2;break}return e.abrupt("return");case 2:return ki.initialize(t._l10n),E(Mi,this,new ki(this)),M(xi,this)&&(M(Mi,this).data=M(xi,this),E(xi,this,null)),e.next=7,this.addEditToolbar();case 7:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"altTextData",get:function(){var t;return null===(t=M(Mi,this))||void 0===t?void 0:t.data},set:function(t){M(Mi,this)&&(M(Mi,this).data=t)}},{key:"guessedAltText",get:function(){var t;return null===(t=M(Mi,this))||void 0===t?void 0:t.guessedText}},{key:"setGuessedAltText",value:(n=T(w().mark((function t(e){var n;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,null===(n=M(Mi,this))||void 0===n?void 0:n.setGuessedText(e);case 2:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"serializeAltText",value:function(t){var e;return null===(e=M(Mi,this))||void 0===e?void 0:e.serialize(t)}},{key:"hasAltText",value:function(){return!!M(Mi,this)&&!M(Mi,this).isEmpty()}},{key:"hasAltTextData",value:function(){var t,e;return null!==(t=null===(e=M(Mi,this))||void 0===e?void 0:e.hasData())&&void 0!==t&&t}},{key:"render",value:function(){var t;this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=M(Ei,this)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground(),R(Xi,this,ra).call(this);var e=I(this.parentDimensions,2),n=e[0],i=e[1];this.parentRotation%180!=0&&(this.div.style.maxWidth="".concat((100*i/n).toFixed(2),"%"),this.div.style.maxHeight="".concat((100*n/i).toFixed(2),"%"));var a=I(this.getInitialTranslation(),2),r=a[0],s=a[1];return this.translate(r,s),Ce(this,this.div,["pointerdown"]),null===(t=this._uiManager._editorUndoBar)||void 0===t||t.hide(),this.div}},{key:"pointerdown",value:function(t){var e=Ct.platform.isMac;0!==t.button||t.ctrlKey&&e?t.preventDefault():(E(Ni,this,!0),this._isDraggable?R(Xi,this,aa).call(this,t):R(Xi,this,ia).call(this,t))}},{key:"isSelected",get:function(){return this._uiManager.isSelected(this)}},{key:"_onStartDragging",value:function(){}},{key:"_onStopDragging",value:function(){}},{key:"moveInDOM",value:function(){var t=this;M(ji,this)&&clearTimeout(M(ji,this)),E(ji,this,setTimeout((function(){var e;E(ji,t,null),null===(e=t.parent)||void 0===e||e.moveEditorInDOM(t)}),0))}},{key:"_setParentAndPosition",value:function(t,e,n){t.changeParent(this),this.x=e,this.y=n,this.fixAndSetPosition(),this._onTranslated()}},{key:"getRect",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.rotation,i=this.parentScale,a=I(this.pageDimensions,2),r=a[0],s=a[1],o=I(this.pageTranslation,2),l=o[0],h=o[1],u=t/i,c=e/i,d=this.x*r,f=this.y*s,v=this.width*r,p=this.height*s;switch(n){case 0:return[d+u+l,s-f-c-p+h,d+u+v+l,s-f-c+h];case 90:return[d+c+l,s-f+u+h,d+c+p+l,s-f+u+v+h];case 180:return[d-u-v+l,s-f+c+h,d-u+l,s-f+c+p+h];case 270:return[d-c-p+l,s-f-u-v+h,d-c+l,s-f-u+h];default:throw new Error("Invalid rotation")}}},{key:"getRectInCurrentCoords",value:function(t,e){var n=I(t,4),i=n[0],a=n[1],r=n[2],s=n[3],o=r-i,l=s-a;switch(this.rotation){case 0:return[i,e-s,o,l];case 90:return[i,e-a,l,o];case 180:return[r,e-a,o,l];case 270:return[r,e-s,l,o];default:throw new Error("Invalid rotation")}}},{key:"onceAdded",value:function(t){}},{key:"isEmpty",value:function(){return!1}},{key:"enableEditMode",value:function(){E(Bi,this,!0)}},{key:"disableEditMode",value:function(){E(Bi,this,!1)}},{key:"isInEditMode",value:function(){return M(Bi,this)}},{key:"shouldGetKeyboardEvents",value:function(){return M(Hi,this)}},{key:"needsToBeRebuilt",value:function(){return this.div&&!this.isAttachedToDOM}},{key:"isOnScreen",get:function(){var t=this.getClientDimensions(),e=t.top,n=t.left,i=t.bottom,a=t.right,r=window,s=r.innerHeight;return n<r.innerWidth&&a>0&&e<s&&i>0}},{key:"rebuild",value:function(){R(Xi,this,ra).call(this)}},{key:"rotate",value:function(t){}},{key:"resize",value:function(){}},{key:"serializeDeleted",value:function(){var t;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:(null===(t=this._initialData)||void 0===t?void 0:t.popupRef)||""}}},{key:"serialize",value:function(){ft("An editor must be serializable")}},{key:"hasBeenModified",get:function(){return!!this.annotationElementId&&(this.deleted||null!==this.serialize())}},{key:"remove",value:function(){var t;if(null===(t=M(Di,this))||void 0===t||t.abort(),E(Di,this,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),M(ji,this)&&(clearTimeout(M(ji,this)),E(ji,this,null)),R(Xi,this,ua).call(this),this.removeEditToolbar(),M(Vi,this)){var e,n=F(M(Vi,this).values());try{for(n.s();!(e=n.n()).done;){var i=e.value;clearTimeout(i)}}catch(t){n.e(t)}finally{n.f()}E(Vi,this,null)}this.parent=null}},{key:"isResizable",get:function(){return!1}},{key:"makeResizable",value:function(){this.isResizable&&(R(Xi,this,Zi).call(this),M(Ri,this).classList.remove("hidden"),Ce(this,this.div,["keydown"]))}},{key:"toolbarPosition",get:function(){return null}},{key:"keydown",value:function(e){if(this.isResizable&&e.target===this.div&&"Enter"===e.key){this._uiManager.setSelected(this),E(Li,this,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});var n=M(Ri,this).children;if(!M(Si,this)){E(Si,this,Array.from(n));var i,a=R(Xi,this,sa).bind(this),r=R(Xi,this,oa).bind(this),s=this._uiManager._signal,o=F(M(Si,this));try{for(o.s();!(i=o.n()).done;){var l=i.value,h=l.getAttribute("data-resizer-name");l.setAttribute("role","spinbutton"),l.addEventListener("keydown",a,{signal:s}),l.addEventListener("blur",r,{signal:s}),l.addEventListener("focus",R(Xi,this,la).bind(this,h),{signal:s}),l.setAttribute("data-l10n-id",t._l10nResizer[h])}}catch(t){o.e(t)}finally{o.f()}}var u,c=M(Si,this)[0],d=0,f=F(n);try{for(f.s();!(u=f.n()).done&&u.value!==c;)d++}catch(t){f.e(t)}finally{f.f()}var v=(360-this.rotation+this.parentRotation)%360/90*(M(Si,this).length/4);if(v!==d){if(v<d)for(var p=0;p<d-v;p++)M(Ri,this).append(M(Ri,this).firstChild);else if(v>d)for(var g=0;g<v-d;g++)M(Ri,this).firstChild.before(M(Ri,this).lastChild);var y,m=0,k=F(n);try{for(k.s();!(y=k.n()).done;){var b=y.value,w=M(Si,this)[m++].getAttribute("data-resizer-name");b.setAttribute("data-l10n-id",t._l10nResizer[w])}}catch(t){k.e(t)}finally{k.f()}}R(Xi,this,ha).call(this,0),E(Hi,this,!0),M(Ri,this).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}}},{key:"_resizeWithKeyboard",value:function(t,e){M(Hi,this)&&R(Xi,this,na).call(this,M(Fi,this),{deltaX:t,deltaY:e,fromKeyboard:!0})}},{key:"_stopResizingWithKeyboard",value:function(){R(Xi,this,ua).call(this),this.div.focus()}},{key:"select",value:function(){var t,e,n,i=this;this.makeResizable(),null===(t=this.div)||void 0===t||t.classList.add("selectedEditor"),this._editToolbar?(null===(e=this._editToolbar)||void 0===e||e.show(),null===(n=M(Mi,this))||void 0===n||n.toggleAltTextBadge(!1)):this.addEditToolbar().then((function(){var t,e;null!==(t=i.div)&&void 0!==t&&t.classList.contains("selectedEditor")&&(null===(e=i._editToolbar)||void 0===e||e.show())}))}},{key:"unselect",value:function(){var t,e,n,i,a;null===(t=M(Ri,this))||void 0===t||t.classList.add("hidden"),null===(e=this.div)||void 0===e||e.classList.remove("selectedEditor"),null!==(n=this.div)&&void 0!==n&&n.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),null===(i=this._editToolbar)||void 0===i||i.hide(),null===(a=M(Mi,this))||void 0===a||a.toggleAltTextBadge(!0)}},{key:"updateParams",value:function(t,e){}},{key:"disableEditing",value:function(){}},{key:"enableEditing",value:function(){}},{key:"enterInEditMode",value:function(){}},{key:"getImageForAltText",value:function(){return null}},{key:"contentDiv",get:function(){return this.div}},{key:"isEditing",get:function(){return M(Wi,this)},set:function(t){E(Wi,this,t),this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}},{key:"setAspectRatio",value:function(t,e){E(Pi,this,!0);var n=t/e,i=this.div.style;i.aspectRatio=n,i.height="auto"}},{key:"telemetryInitialData",get:function(){return{action:"added"}}},{key:"telemetryFinalData",get:function(){return null}},{key:"_reportTelemetry",value:function(e){var n=this;if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){M(Vi,this)||E(Vi,this,new Map);var i=e.action,a=M(Vi,this).get(i);return a&&clearTimeout(a),a=setTimeout((function(){n._reportTelemetry(e),M(Vi,n).delete(i),0===M(Vi,n).size&&E(Vi,n,null)}),t._telemetryTimeout),void M(Vi,this).set(i,a)}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}},{key:"show",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._isVisible;this.div.classList.toggle("hidden",!t),this._isVisible=t}},{key:"enable",value:function(){this.div&&(this.div.tabIndex=0),E(Ei,this,!1)}},{key:"disable",value:function(){this.div&&(this.div.tabIndex=-1),E(Ei,this,!0)}},{key:"renderAnnotationElement",value:function(t){var e=t.container.querySelector(".annotationContent");if(e){if("CANVAS"===e.nodeName){var n=e;(e=document.createElement("div")).classList.add("annotationContent",this.editorType),n.before(e)}}else(e=document.createElement("div")).classList.add("annotationContent",this.editorType),t.container.prepend(e);return e}},{key:"resetAnnotationElement",value:function(t){var e=t.container.firstChild;"DIV"===(null==e?void 0:e.nodeName)&&e.classList.contains("annotationContent")&&e.remove()}}],[{key:"_resizerKeyboardManager",get:function(){var e=t.prototype._resizeWithKeyboard,n=On.TRANSLATE_SMALL,i=On.TRANSLATE_BIG;return gt(this,"_resizerKeyboardManager",new Ve([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-n,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[n,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-n]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,n]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,i]}],[["Escape","mac+Escape"],t.prototype._stopResizingWithKeyboard]]))}},{key:"isDrawer",get:function(){return!1}},{key:"_defaultLineColor",get:function(){return gt(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}},{key:"deleteAnnotationElement",value:function(t){var e=new ca({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}},{key:"initialize",value:function(e,n){var i;if(null!==(i=t._l10n)&&void 0!==i||(t._l10n=e),t._l10nResizer||(t._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),-1===t._borderLineWidth){var a=getComputedStyle(document.documentElement);t._borderLineWidth=parseFloat(a.getPropertyValue("--outline-width"))||0}}},{key:"updateDefaultParams",value:function(t,e){}},{key:"defaultPropertiesToUpdate",get:function(){return[]}},{key:"isHandlingMimeForPasting",value:function(t){return!1}},{key:"paste",value:function(t,e){ft("Not implemented")}},{key:"deserialize",value:(e=T(w().mark((function t(e,n,i){var a,r,s,o,l,h,u,c,d,f;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(a=new this.prototype.constructor({parent:n,id:n.getNextId(),uiManager:i})).rotation=e.rotation,E(xi,a,e.accessibilityData),r=I(a.pageDimensions,2),s=r[0],o=r[1],l=a.getRectInCurrentCoords(e.rect,o),h=I(l,4),u=h[0],c=h[1],d=h[2],f=h[3],a.x=u/s,a.y=c/o,a.width=d/s,a.height=f/o,t.abrupt("return",a);case 10:case"end":return t.stop()}}),t,this)}))),function(t,n,i){return e.apply(this,arguments)})},{key:"MIN_SIZE",get:function(){return 16}},{key:"canCreateNewEmptyEditor",value:function(){return!0}}]);var e,n,i,a}();function Ki(t,e,n){var i=I(t,2),a=i[0],r=i[1],s=I(this.screenToPageTranslation(e,n),2);e=s[0],n=s[1],this.x+=e/a,this.y+=n/r,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}function Qi(t,e,n){switch(n){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}function Ji(t){switch(t){case 90:var e=I(this.pageDimensions,2),n=e[0],i=e[1];return[0,-n/i,i/n,0];case 180:return[-1,0,0,-1];case 270:var a=I(this.pageDimensions,2),r=a[0],s=a[1];return[0,r/s,-s/r,0];default:return[1,0,0,1]}}function Zi(){if(!M(Ri,this)){E(Ri,this,document.createElement("div")),M(Ri,this).classList.add("resizers");for(var t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal,n=0,i=t;n<i.length;n++){var a=i[n],r=document.createElement("div");M(Ri,this).append(r),r.classList.add("resizer",a),r.setAttribute("data-resizer-name",a),r.addEventListener("pointerdown",R(Xi,this,$i).bind(this,a),{signal:e}),r.addEventListener("contextmenu",Kt,{signal:e}),r.tabIndex=-1}this.div.prepend(M(Ri,this))}}function $i(t,e){var n,i=this;e.preventDefault();var a=Ct.platform.isMac;if(!(0!==e.button||e.ctrlKey&&a)){null===(n=M(Mi,this))||void 0===n||n.toggle(!1);var r=this._isDraggable;this._isDraggable=!1,E(Ii,this,[e.screenX,e.screenY]);var s=new AbortController,o=this._uiManager.combinedSignal(s);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",R(Xi,this,na).bind(this,t),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",Qt,{passive:!1,signal:o}),window.addEventListener("contextmenu",Kt,{signal:o}),E(Li,this,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});var l=this.parent.div.style.cursor,h=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;var u=function(){var t;s.abort(),i.parent.togglePointerEvents(!0),null===(t=M(Mi,i))||void 0===t||t.toggle(!0),i._isDraggable=r,i.parent.div.style.cursor=l,i.div.style.cursor=h,R(Xi,i,ea).call(i)};window.addEventListener("pointerup",u,{signal:o}),window.addEventListener("blur",u,{signal:o})}}function ta(t,e,n,i){this.width=n,this.height=i,this.x=t,this.y=e;var a=I(this.parentDimensions,2),r=a[0],s=a[1];this.setDims(r*n,s*i),this.fixAndSetPosition(),this._onResized()}function ea(){if(M(Li,this)){var t=M(Li,this),e=t.savedX,n=t.savedY,i=t.savedWidth,a=t.savedHeight;E(Li,this,null);var r=this.x,s=this.y,o=this.width,l=this.height;r===e&&s===n&&o===i&&l===a||this.addCommands({cmd:R(Xi,this,ta).bind(this,r,s,o,l),undo:R(Xi,this,ta).bind(this,e,n,i,a),mustExec:!0})}}function na(t,e){var n,a,r=I(this.parentDimensions,2),s=r[0],o=r[1],l=this.x,h=this.y,u=this.width,c=this.height,d=i.MIN_SIZE/s,f=i.MIN_SIZE/o,v=function(t){return Math.round(1e4*t)/1e4},p=R(Xi,this,Ji).call(this,this.rotation),g=function(t,e){return[p[0]*t+p[2]*e,p[1]*t+p[3]*e]},y=R(Xi,this,Ji).call(this,360-this.rotation),m=!1,b=!1;switch(t){case"topLeft":m=!0,n=function(t,e){return[0,0]},a=function(t,e){return[t,e]};break;case"topMiddle":n=function(t,e){return[t/2,0]},a=function(t,e){return[t/2,e]};break;case"topRight":m=!0,n=function(t,e){return[t,0]},a=function(t,e){return[0,e]};break;case"middleRight":b=!0,n=function(t,e){return[t,e/2]},a=function(t,e){return[0,e/2]};break;case"bottomRight":m=!0,n=function(t,e){return[t,e]},a=function(t,e){return[0,0]};break;case"bottomMiddle":n=function(t,e){return[t/2,e]},a=function(t,e){return[t/2,0]};break;case"bottomLeft":m=!0,n=function(t,e){return[0,e]},a=function(t,e){return[t,0]};break;case"middleLeft":b=!0,n=function(t,e){return[0,e/2]},a=function(t,e){return[t,e/2]}}var w,A,_=n(u,c),x=a(u,c),S=g.apply(void 0,k(x)),C=v(l+S[0]),T=v(h+S[1]),P=1,L=1;if(e.fromKeyboard)w=e.deltaX,A=e.deltaY;else{var D=e.screenX,F=e.screenY,N=I(M(Ii,this),2),O=N[0],W=N[1],B=I(this.screenToPageTranslation(D-O,F-W),2);w=B[0],A=B[1],M(Ii,this)[0]=D,M(Ii,this)[1]=F}var H,j,z=I((H=w/s,j=A/o,[y[0]*H+y[2]*j,y[1]*H+y[3]*j]),2);if(w=z[0],A=z[1],m){var G=Math.hypot(u,c);P=L=Math.max(Math.min(Math.hypot(x[0]-_[0]-w,x[1]-_[1]-A)/G,1/u,1/c),d/u,f/c)}else b?P=Math.max(d,Math.min(1,Math.abs(x[0]-_[0]-w)))/u:L=Math.max(f,Math.min(1,Math.abs(x[1]-_[1]-A)))/c;var V=v(u*P),U=v(c*L),q=C-(S=g.apply(void 0,k(a(V,U))))[0],X=T-S[1];M(Oi,this)||E(Oi,this,[this.x,this.y,this.width,this.height]),this.width=V,this.height=U,this.x=q,this.y=X,this.setDims(s*V,o*U),this.fixAndSetPosition(),this._onResizing()}function ia(t){var e=Ct.platform.isMac;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}function aa(t){var e=this,n=this.isSelected;this._uiManager.setUpDragSession();var i=new AbortController,a=this._uiManager.combinedSignal(i),r={capture:!0,passive:!1,signal:a},s=function(t){i.abort(),E(Ci,e,null),E(Ni,e,!1),e._uiManager.endDragSession()||R(Xi,e,ia).call(e,t)};n&&(E(zi,this,t.clientX),E(Gi,this,t.clientY),E(Ci,this,t.pointerId),E(Ti,this,t.pointerType),window.addEventListener("pointermove",(function(t){var n=t.clientX,i=t.clientY;if(t.pointerId===M(Ci,e)){var a=I(e.screenToPageTranslation(n-M(zi,e),i-M(Gi,e)),2),r=a[0],s=a[1];E(zi,e,n),E(Gi,e,i),e._uiManager.dragSelectedEditors(r,s)}else Qt(t)}),r),window.addEventListener("touchmove",Qt,r),window.addEventListener("pointerdown",(function(t){t.isPrimary&&t.pointerType===M(Ti,e)&&s(t),Qt(t)}),r)),this._onStartDragging();var o=function(t){if(!M(Ci,e)||M(Ci,e)===t.pointerId)return s(t),void e._onStopDragging();Qt(t)};window.addEventListener("pointerup",o,{signal:a}),window.addEventListener("blur",o,{signal:a})}function ra(){if(!M(Di,this)&&this.div){E(Di,this,new AbortController);var t=this._uiManager.combinedSignal(M(Di,this));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}}function sa(t){i._resizerKeyboardManager.exec(this,t)}function oa(t){var e;M(Hi,this)&&(null===(e=t.relatedTarget)||void 0===e?void 0:e.parentNode)!==M(Ri,this)&&R(Xi,this,ua).call(this)}function la(t){E(Fi,this,M(Hi,this)?t:"")}function ha(t){if(M(Si,this)){var e,n=F(M(Si,this));try{for(n.s();!(e=n.n()).done;)e.value.tabIndex=t}catch(t){n.e(t)}finally{n.f()}}}function ua(){E(Hi,this,!1),R(Xi,this,ha).call(this,-1),R(Xi,this,ea).call(this)}i=Yi,P(Yi,"_l10n",null),P(Yi,"_l10nResizer",null),P(Yi,"_borderLineWidth",-1),P(Yi,"_colorManager",new qe),P(Yi,"_zIndex",1),P(Yi,"_telemetryTimeout",1e3);var ca=function(t){function e(t){var n;return j(this,e),(n=z(this,e,[t])).annotationElementId=t.annotationElementId,n.deleted=!0,n}return U(e,t),B(e,[{key:"serialize",value:function(){return this.serializeDeleted()}}])}(Yi),da=3285377520,fa=4294901760,va=65535,pa=function(){return B((function t(e){j(this,t),this.h1=e?4294967295&e:da,this.h2=e?4294967295&e:da}),[{key:"update",value:function(t){var e,n;if("string"==typeof t){e=new Uint8Array(2*t.length),n=0;for(var i=0,a=t.length;i<a;i++){var r=t.charCodeAt(i);r<=255?e[n++]=r:(e[n++]=r>>>8,e[n++]=255&r)}}else{if(!ArrayBuffer.isView(t))throw new Error("Invalid data format, must be a string or TypedArray.");n=(e=t.slice()).byteLength}for(var s=n>>2,o=n-4*s,l=new Uint32Array(e.buffer,0,s),h=0,u=0,c=this.h1,d=this.h2,f=3432918353,v=461845907,p=11601,g=13715,y=0;y<s;y++)1&y?c=5*(c=(c^=h=(h=(h=(h=l[y])*f&fa|h*p&va)<<15|h>>>17)*v&fa|h*g&va)<<13|c>>>19)+3864292196:d=5*(d=(d^=u=(u=(u=(u=l[y])*f&fa|u*p&va)<<15|u>>>17)*v&fa|u*g&va)<<13|d>>>19)+3864292196;switch(h=0,o){case 3:h^=e[4*s+2]<<16;case 2:h^=e[4*s+1]<<8;case 1:h=(h=(h=(h^=e[4*s])*f&fa|h*p&va)<<15|h>>>17)*v&fa|h*g&va,1&s?c^=h:d^=h}this.h1=c,this.h2=d}},{key:"hexdigest",value:function(){var t=this.h1,e=this.h2;return t=3981806797*(t^=e>>>1)&fa|36045*t&va,t=444984403*(t^=(e=4283543511*e&fa|(2950163797*(e<<16|t>>>16)&fa)>>>16)>>>1)&fa|60499*t&va,((t^=(e=3301882366*e&fa|(3120437893*(e<<16|t>>>16)&fa)>>>16)>>>1)>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}])}(),ga=Object.freeze({map:null,hash:"",transfer:void 0}),ya=new WeakMap,ma=new WeakMap,ka=new WeakMap,ba=new WeakSet,wa=function(){return B((function t(){j(this,t),A(this,ba),_(this,ya,!1),_(this,ma,null),_(this,ka,new Map),this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}),[{key:"getValue",value:function(t,e){var n=M(ka,this).get(t);return void 0===n?e:Object.assign(e,n)}},{key:"getRawValue",value:function(t){return M(ka,this).get(t)}},{key:"remove",value:function(t){if(M(ka,this).delete(t),0===M(ka,this).size&&this.resetModified(),"function"==typeof this.onAnnotationEditor){var e,n=F(M(ka,this).values());try{for(n.s();!(e=n.n()).done;)if(e.value instanceof Yi)return}catch(t){n.e(t)}finally{n.f()}this.onAnnotationEditor(null)}}},{key:"setValue",value:function(t,e){var n=M(ka,this).get(t),i=!1;if(void 0!==n)for(var a=0,r=Object.entries(e);a<r.length;a++){var s=I(r[a],2),o=s[0],l=s[1];n[o]!==l&&(i=!0,n[o]=l)}else i=!0,M(ka,this).set(t,e);i&&R(ba,this,Aa).call(this),e instanceof Yi&&"function"==typeof this.onAnnotationEditor&&this.onAnnotationEditor(e.constructor._type)}},{key:"has",value:function(t){return M(ka,this).has(t)}},{key:"getAll",value:function(){return M(ka,this).size>0?Et(M(ka,this)):null}},{key:"setAll",value:function(t){for(var e=0,n=Object.entries(t);e<n.length;e++){var i=I(n[e],2),a=i[0],r=i[1];this.setValue(a,r)}}},{key:"size",get:function(){return M(ka,this).size}},{key:"resetModified",value:function(){M(ya,this)&&(E(ya,this,!1),"function"==typeof this.onResetModified&&this.onResetModified())}},{key:"print",get:function(){return new xa(this)}},{key:"serializable",get:function(){if(0===M(ka,this).size)return ga;var t,e=new Map,n=new pa,i=[],a=Object.create(null),r=!1,s=F(M(ka,this));try{for(s.s();!(t=s.n()).done;){var o=I(t.value,2),l=o[0],h=o[1],u=h instanceof Yi?h.serialize(!1,a):h;u&&(e.set(l,u),n.update("".concat(l,":").concat(JSON.stringify(u))),r||(r=!!u.bitmap))}}catch(t){s.e(t)}finally{s.f()}if(r){var c,d=F(e.values());try{for(d.s();!(c=d.n()).done;){var f=c.value;f.bitmap&&i.push(f.bitmap)}}catch(t){d.e(t)}finally{d.f()}}return e.size>0?{map:e,hash:n.hexdigest(),transfer:i}:ga}},{key:"editorStats",get:function(){var t,e=null,n=new Map,i=F(M(ka,this).values());try{for(i.s();!(t=i.n()).done;){var a,r=t.value;if(r instanceof Yi){var s=r.telemetryFinalData;if(s){var o=s.type;n.has(o)||n.set(o,Object.getPrototypeOf(r).constructor),e||(e=Object.create(null));for(var l=(a=e)[o]||(a[o]=new Map),h=0,u=Object.entries(s);h<u.length;h++){var c,d=I(u[h],2),f=d[0],v=d[1];if("type"!==f){var p=l.get(f);p||(p=new Map,l.set(f,p));var g=null!==(c=p.get(v))&&void 0!==c?c:0;p.set(v,g+1)}}}}}}catch(t){i.e(t)}finally{i.f()}var y,m=F(n);try{for(m.s();!(y=m.n()).done;){var k=I(y.value,2),b=k[0],w=k[1];e[b]=w.computeTelemetryFinalData(e[b])}}catch(t){m.e(t)}finally{m.f()}return e}},{key:"resetModifiedIds",value:function(){E(ma,this,null)}},{key:"modifiedIds",get:function(){if(M(ma,this))return M(ma,this);var t,e=[],n=F(M(ka,this).values());try{for(n.s();!(t=n.n()).done;){var i=t.value;i instanceof Yi&&i.annotationElementId&&i.serialize()&&e.push(i.annotationElementId)}}catch(t){n.e(t)}finally{n.f()}return E(ma,this,{ids:new Set(e),hash:e.join(",")})}}])}();function Aa(){M(ya,this)||(E(ya,this,!0),"function"==typeof this.onSetModified&&this.onSetModified())}var _a=new WeakMap,xa=function(t){function e(t){var n;j(this,e),_(n=z(this,e),_a,void 0);var i=t.serializable,a=i.map,r=i.hash,s=i.transfer,o=structuredClone(a,s?{transfer:s}:null);return E(_a,n,{map:o,hash:r,transfer:s}),n}return U(e,t),B(e,[{key:"print",get:function(){ft("Should not call PrintAnnotationStorage.print")}},{key:"serializable",get:function(){return M(_a,this)}},{key:"modifiedIds",get:function(){return gt(this,"modifiedIds",{ids:new Set,hash:""})}}])}(wa),Sa=new WeakMap,Ma=function(){return B((function t(e){var n=e.ownerDocument,i=void 0===n?globalThis.document:n;e.styleElement,j(this,t),_(this,Sa,new Set),this._document=i,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}),[{key:"addNativeFontFace",value:function(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}},{key:"removeNativeFontFace",value:function(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}},{key:"insertRule",value:function(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));var e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}},{key:"clear",value:function(){var t,e=F(this.nativeFontFaces);try{for(e.s();!(t=e.n()).done;){var n=t.value;this._document.fonts.delete(n)}}catch(t){e.e(t)}finally{e.f()}this.nativeFontFaces.clear(),M(Sa,this).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}},{key:"loadSystemFont",value:(e=T(w().mark((function t(e){var n,i,a,r,s,o;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.systemFontInfo,i=e._inspectFont,n&&!M(Sa,this).has(n.loadedName)){t.next=3;break}return t.abrupt("return");case 3:if(vt(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),!this.isFontLoadingAPISupported){t.next=20;break}return a=n.loadedName,r=n.src,s=n.style,o=new FontFace(a,r,s),this.addNativeFontFace(o),t.prev=8,t.next=11,o.load();case 11:M(Sa,this).add(a),null==i||i(n),t.next=19;break;case 15:t.prev=15,t.t0=t.catch(8),dt("Cannot load system font: ".concat(n.baseFontName,", installing it could help to improve PDF rendering.")),this.removeNativeFontFace(o);case 19:return t.abrupt("return");case 20:ft("Not implemented: loadSystemFont without the Font Loading API.");case 21:case"end":return t.stop()}}),t,this,[[8,15]])}))),function(t){return e.apply(this,arguments)})},{key:"bind",value:(t=T(w().mark((function t(e){var n,i,a=this;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e.attached||e.missingFile&&!e.systemFontInfo)){t.next=2;break}return t.abrupt("return");case 2:if(e.attached=!0,!e.systemFontInfo){t.next=7;break}return t.next=6,this.loadSystemFont(e);case 6:case 21:return t.abrupt("return");case 7:if(!this.isFontLoadingAPISupported){t.next=22;break}if(!(n=e.createNativeFontFace())){t.next=21;break}return this.addNativeFontFace(n),t.prev=11,t.next=14,n.loaded;case 14:t.next=21;break;case 16:throw t.prev=16,t.t0=t.catch(11),dt("Failed to load font '".concat(n.family,"': '").concat(t.t0,"'.")),e.disableFontFace=!0,t.t0;case 22:if(!(i=e.createFontFaceRule())){t.next=29;break}if(this.insertRule(i),!this.isSyncFontLoadingSupported){t.next=27;break}return t.abrupt("return");case 27:return t.next=29,new Promise((function(t){var n=a._queueLoadingCallback(t);a._prepareFontLoadEvent(e,n)}));case 29:case"end":return t.stop()}}),t,this,[[11,16]])}))),function(e){return t.apply(this,arguments)})},{key:"isFontLoadingAPISupported",get:function(){var t;return gt(this,"isFontLoadingAPISupported",!(null===(t=this._document)||void 0===t||!t.fonts))}},{key:"isSyncFontLoadingSupported",get:function(){var t,e=!1;return(Q||"undefined"!=typeof navigator&&"string"==typeof(null===(t=navigator)||void 0===t?void 0:t.userAgent)&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),gt(this,"isSyncFontLoadingSupported",e)}},{key:"_queueLoadingCallback",value:function(t){var e=this.loadingRequests,n={done:!1,complete:function(){for(vt(!n.done,"completeRequest() cannot be called twice."),n.done=!0;e.length>0&&e[0].done;){var t=e.shift();setTimeout(t.callback,0)}},callback:t};return e.push(n),n}},{key:"_loadTestFont",get:function(){return gt(this,"_loadTestFont",atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA=="))}},{key:"_prepareFontLoadEvent",value:function(t,e){function n(t,e){return t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|255&t.charCodeAt(e+3)}function i(t,e,n,i){return t.substring(0,e)+i+t.substring(e+n)}var a,r,s=this._document.createElement("canvas");s.width=1,s.height=1;var o,l=s.getContext("2d"),h=0,u="lt".concat(Date.now()).concat(this.loadTestFontId++),c=this._loadTestFont,d=1482184792,f=n(c=i(c,976,u.length,u),16);for(a=0,r=u.length-3;a<r;a+=4)f=f-d+n(u,a)|0;a<u.length&&(f=f-d+n(u+"XXX",a)|0),c=i(c,16,4,(o=f,String.fromCharCode(o>>24&255,o>>16&255,o>>8&255,255&o)));var v="url(data:font/opentype;base64,".concat(btoa(c),");"),p='@font-face {font-family:"'.concat(u,'";src:').concat(v,"}");this.insertRule(p);var g=this._document.createElement("div");g.style.visibility="hidden",g.style.width=g.style.height="10px",g.style.position="absolute",g.style.top=g.style.left="0px";for(var y=0,m=[t.loadedName,u];y<m.length;y++){var k=m[y],b=this._document.createElement("span");b.textContent="Hi",b.style.fontFamily=k,g.append(b)}this._document.body.append(g),function t(e,n){if(++h>30)return dt("Load test font never loaded."),void n();l.font="30px "+e,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0?n():setTimeout(t.bind(null,e,n))}(u,(function(){g.remove(),e.complete()}))}}]);var t,e}(),Ea=function(){return B((function t(e,n){var i=n.disableFontFace,a=void 0!==i&&i,r=n.fontExtraProperties,s=void 0!==r&&r,o=n.inspectFont,l=void 0===o?null:o;for(var h in j(this,t),this.compiledGlyphs=Object.create(null),e)this[h]=e[h];this.disableFontFace=!0===a,this.fontExtraProperties=!0===s,this._inspectFont=l}),[{key:"createNativeFontFace",value:function(){var t,e;if(!this.data||this.disableFontFace)return null;if(this.cssFontInfo){var n={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(n.style="oblique ".concat(this.cssFontInfo.italicAngle,"deg")),e=new FontFace(this.cssFontInfo.fontFamily,this.data,n)}else e=new FontFace(this.loadedName,this.data,{});return null===(t=this._inspectFont)||void 0===t||t.call(this,this),e}},{key:"createFontFaceRule",value:function(){var t;if(!this.data||this.disableFontFace)return null;var e,n,i="url(data:".concat(this.mimetype,";base64,").concat((e=this.data,Uint8Array.prototype.toBase64?e.toBase64():btoa(St(e))),");");if(this.cssFontInfo){var a="font-weight: ".concat(this.cssFontInfo.fontWeight,";");this.cssFontInfo.italicAngle&&(a+="font-style: oblique ".concat(this.cssFontInfo.italicAngle,"deg;")),n='@font-face {font-family:"'.concat(this.cssFontInfo.fontFamily,'";').concat(a,"src:").concat(i,"}")}else n='@font-face {font-family:"'.concat(this.loadedName,'";src:').concat(i,"}");return null===(t=this._inspectFont)||void 0===t||t.call(this,this,i),n}},{key:"getPathGenerator",value:function(t,e){if(void 0!==this.compiledGlyphs[e])return this.compiledGlyphs[e];var n,i=this.loadedName+"_path_"+e;try{n=t.get(i)}catch(t){dt('getPathGenerator - ignoring character: "'.concat(t,'".'))}var a=new Path2D(n||"");return this.fontExtraProperties||t.delete(i),this.compiledGlyphs[e]=a}}])}(),Ca=new WeakMap,Ta=function(){return B((function t(e){var n=e.enableHWA,i=void 0!==n&&n;j(this,t),_(this,Ca,!1),E(Ca,this,i)}),[{key:"create",value:function(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");var n=this._createCanvas(t,e);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!M(Ca,this)})}}},{key:"reset",value:function(t,e,n){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||n<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=n}},{key:"destroy",value:function(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}},{key:"_createCanvas",value:function(t,e){ft("Abstract method `_createCanvas` called.")}}])}(),Pa=function(t){function e(t){var n,i=t.ownerDocument,a=void 0===i?globalThis.document:i,r=t.enableHWA,s=void 0!==r&&r;return j(this,e),(n=z(this,e,[{enableHWA:s}]))._document=a,n}return U(e,t),B(e,[{key:"_createCanvas",value:function(t,e){var n=this._document.createElement("canvas");return n.width=t,n.height=e,n}}])}(Ta),Ra=function(){return B((function t(e){var n=e.baseUrl,i=void 0===n?null:n,a=e.isCompressed,r=void 0===a||a;j(this,t),this.baseUrl=i,this.isCompressed=r}),[{key:"fetch",value:(e=T(w().mark((function t(e){var n,i,a=this;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.name,this.baseUrl){t.next=3;break}throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");case 3:if(n){t.next=5;break}throw new Error("CMap name must be specified.");case 5:return i=this.baseUrl+n+(this.isCompressed?".bcmap":""),t.abrupt("return",this._fetch(i).then((function(t){return{cMapData:t,isCompressed:a.isCompressed}})).catch((function(t){throw new Error("Unable to load ".concat(a.isCompressed?"binary ":"","CMap at: ").concat(i))})));case 7:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"_fetch",value:(t=T(w().mark((function t(e){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:ft("Abstract method `_fetch` called.");case 1:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)})}]);var t,e}(),Ia=function(t){function e(){return j(this,e),z(this,e,arguments)}return U(e,t),B(e,[{key:"_fetch",value:(n=T(w().mark((function t(e){var n;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Bt(e,this.isCompressed?"arraybuffer":"text");case 2:return n=t.sent,t.abrupt("return",n instanceof ArrayBuffer?new Uint8Array(n):Mt(n));case 4:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})}]);var n}(Ra),La=function(){return B((function t(){j(this,t)}),[{key:"addFilter",value:function(t){return"none"}},{key:"addHCMFilter",value:function(t,e){return"none"}},{key:"addAlphaFilter",value:function(t){return"none"}},{key:"addLuminosityFilter",value:function(t){return"none"}},{key:"addHighlightHCMFilter",value:function(t,e,n,i,a){return"none"}},{key:"destroy",value:function(){}}])}(),Da=new WeakMap,Fa=new WeakMap,Na=new WeakMap,Oa=new WeakMap,Wa=new WeakMap,Ba=new WeakMap,Ha=new WeakMap,ja=new WeakSet,za=function(t){function e(t){var n,i=t.docId,a=t.ownerDocument,r=void 0===a?globalThis.document:a;return j(this,e),A(n=z(this,e),ja),_(n,Da,void 0),_(n,Fa,void 0),_(n,Na,void 0),_(n,Oa,void 0),_(n,Wa,void 0),_(n,Ba,void 0),_(n,Ha,0),E(Oa,n,i),E(Wa,n,r),n}return U(e,t),B(e,[{key:"addFilter",value:function(t){var e,n;if(!t)return"none";var i=S(ja,this,Ga).get(t);if(i)return i;var a=I(R(ja,this,qa).call(this,t),3),r=a[0],s=a[1],o=a[2],l=1===t.length?r:"".concat(r).concat(s).concat(o);if(i=S(ja,this,Ga).get(l))return S(ja,this,Ga).set(t,i),i;var h="g_".concat(M(Oa,this),"_transfer_map_").concat((E(Ha,this,(e=M(Ha,this),n=e++,e)),n)),u=R(ja,this,Xa).call(this,h);S(ja,this,Ga).set(t,u),S(ja,this,Ga).set(l,u);var c=R(ja,this,Qa).call(this,h);return R(ja,this,Za).call(this,r,s,o,c),u}},{key:"addHCMFilter",value:function(t,e){var n,i,a="".concat(t,"-").concat(e),r="base",s=S(ja,this,Va).get(r);if((null===(n=s)||void 0===n?void 0:n.key)===a)return s.url;if(s?(null===(i=s.filter)||void 0===i||i.remove(),s.key=a,s.url="none",s.filter=null):(s={key:a,url:"none",filter:null},S(ja,this,Va).set(r,s)),!t||!e)return s.url;var o=R(ja,this,tr).call(this,t);t=Pt.makeHexColor.apply(Pt,k(o));var l=R(ja,this,tr).call(this,e);if(e=Pt.makeHexColor.apply(Pt,k(l)),S(ja,this,Ua).style.color="","#000000"===t&&"#ffffff"===e||t===e)return s.url;for(var h=new Array(256),u=0;u<=255;u++){var c=u/255;h[u]=c<=.03928?c/12.92:Math.pow((c+.055)/1.055,2.4)}var d=h.join(","),f="g_".concat(M(Oa,this),"_hcm_filter"),v=s.filter=R(ja,this,Qa).call(this,f);R(ja,this,Za).call(this,d,d,d,v),R(ja,this,Ka).call(this,v);var p=function(t,e){for(var n=o[t]/255,i=l[t]/255,a=new Array(e+1),r=0;r<=e;r++)a[r]=n+r/e*(i-n);return a.join(",")};return R(ja,this,Za).call(this,p(0,5),p(1,5),p(2,5),v),s.url=R(ja,this,Xa).call(this,f),s.url}},{key:"addAlphaFilter",value:function(t){var e,n,i=S(ja,this,Ga).get(t);if(i)return i;var a=I(R(ja,this,qa).call(this,[t]),1)[0],r="alpha_".concat(a);if(i=S(ja,this,Ga).get(r))return S(ja,this,Ga).set(t,i),i;var s="g_".concat(M(Oa,this),"_alpha_map_").concat((E(Ha,this,(e=M(Ha,this),n=e++,e)),n)),o=R(ja,this,Xa).call(this,s);S(ja,this,Ga).set(t,o),S(ja,this,Ga).set(r,o);var l=R(ja,this,Qa).call(this,s);return R(ja,this,$a).call(this,a,l),o}},{key:"addLuminosityFilter",value:function(t){var e,n,i,a,r=S(ja,this,Ga).get(t||"luminosity");if(r)return r;if(t?(i=I(R(ja,this,qa).call(this,[t]),1)[0],a="luminosity_".concat(i)):a="luminosity",r=S(ja,this,Ga).get(a))return S(ja,this,Ga).set(t,r),r;var s="g_".concat(M(Oa,this),"_luminosity_map_").concat((E(Ha,this,(e=M(Ha,this),n=e++,e)),n)),o=R(ja,this,Xa).call(this,s);S(ja,this,Ga).set(t,o),S(ja,this,Ga).set(a,o);var l=R(ja,this,Qa).call(this,s);return R(ja,this,Ya).call(this,l),t&&R(ja,this,$a).call(this,i,l),o}},{key:"addHighlightHCMFilter",value:function(t,e,n,i,a){var r,s,o="".concat(e,"-").concat(n,"-").concat(i,"-").concat(a),l=S(ja,this,Va).get(t);if((null===(r=l)||void 0===r?void 0:r.key)===o)return l.url;if(l?(null===(s=l.filter)||void 0===s||s.remove(),l.key=o,l.url="none",l.filter=null):(l={key:o,url:"none",filter:null},S(ja,this,Va).set(t,l)),!e||!n)return l.url;var h=I([e,n].map(R(ja,this,tr).bind(this)),2),u=h[0],c=h[1],d=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),f=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),v=I([i,a].map(R(ja,this,tr).bind(this)),2),p=v[0],g=v[1];if(f<d){var y=[f,d,g,p];d=y[0],f=y[1],p=y[2],g=y[3]}S(ja,this,Ua).style.color="";var m=function(t,e,n){for(var i=new Array(256),a=(f-d)/n,r=t/255,s=(e-t)/(255*n),o=0,l=0;l<=n;l++){for(var h=Math.round(d+l*a),u=r+l*s,c=o;c<=h;c++)i[c]=u;o=h+1}for(var v=o;v<256;v++)i[v]=i[o-1];return i.join(",")},k="g_".concat(M(Oa,this),"_hcm_").concat(t,"_filter"),b=l.filter=R(ja,this,Qa).call(this,k);return R(ja,this,Ka).call(this,b),R(ja,this,Za).call(this,m(p[0],g[0],5),m(p[1],g[1],5),m(p[2],g[2],5),b),l.url=R(ja,this,Xa).call(this,k),l.url}},{key:"destroy",value:function(){var t,e,n,i;arguments.length>0&&void 0!==arguments[0]&&arguments[0]&&null!==(t=M(Ba,this))&&void 0!==t&&t.size||(null===(e=M(Na,this))||void 0===e||e.parentNode.parentNode.remove(),E(Na,this,null),null===(n=M(Fa,this))||void 0===n||n.clear(),E(Fa,this,null),null===(i=M(Ba,this))||void 0===i||i.clear(),E(Ba,this,null),E(Ha,this,0))}}])}(La);function Ga(t){return M(Fa,t)||E(Fa,t,new Map)}function Va(t){return M(Ba,t)||E(Ba,t,new Map)}function Ua(t){if(!M(Na,t)){var e=M(Wa,t).createElement("div"),n=e.style;n.visibility="hidden",n.contain="strict",n.width=n.height=0,n.position="absolute",n.top=n.left=0,n.zIndex=-1;var i=M(Wa,t).createElementNS(Ot,"svg");i.setAttribute("width",0),i.setAttribute("height",0),E(Na,t,M(Wa,t).createElementNS(Ot,"defs")),e.append(i),i.append(M(Na,t)),M(Wa,t).body.append(e)}return M(Na,t)}function qa(t){if(1===t.length){for(var e=t[0],n=new Array(256),i=0;i<256;i++)n[i]=e[i]/255;var a=n.join(",");return[a,a,a]}for(var r=I(t,3),s=r[0],o=r[1],l=r[2],h=new Array(256),u=new Array(256),c=new Array(256),d=0;d<256;d++)h[d]=s[d]/255,u[d]=o[d]/255,c[d]=l[d]/255;return[h.join(","),u.join(","),c.join(",")]}function Xa(t){if(void 0===M(Da,this)){E(Da,this,"");var e=M(Wa,this).URL;e!==M(Wa,this).baseURI&&(Gt(e)?dt('#createUrl: ignore "data:"-URL for performance reasons.'):E(Da,this,e.split("#",1)[0]))}return"url(".concat(M(Da,this),"#").concat(t,")")}function Ya(t){var e=M(Wa,this).createElementNS(Ot,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}function Ka(t){var e=M(Wa,this).createElementNS(Ot,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}function Qa(t){var e=M(Wa,this).createElementNS(Ot,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),S(ja,this,Ua).append(e),e}function Ja(t,e,n){var i=M(Wa,this).createElementNS(Ot,e);i.setAttribute("type","discrete"),i.setAttribute("tableValues",n),t.append(i)}function Za(t,e,n,i){var a=M(Wa,this).createElementNS(Ot,"feComponentTransfer");i.append(a),R(ja,this,Ja).call(this,a,"feFuncR",t),R(ja,this,Ja).call(this,a,"feFuncG",e),R(ja,this,Ja).call(this,a,"feFuncB",n)}function $a(t,e){var n=M(Wa,this).createElementNS(Ot,"feComponentTransfer");e.append(n),R(ja,this,Ja).call(this,n,"feFuncA",t)}function tr(t){return S(ja,this,Ua).style.color=t,ee(getComputedStyle(S(ja,this,Ua)).getPropertyValue("color"))}var er=function(){return B((function t(e){var n=e.baseUrl,i=void 0===n?null:n;j(this,t),this.baseUrl=i}),[{key:"fetch",value:(e=T(w().mark((function t(e){var n,i;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.filename,this.baseUrl){t.next=3;break}throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");case 3:if(n){t.next=5;break}throw new Error("Font filename must be specified.");case 5:return i="".concat(this.baseUrl).concat(n),t.abrupt("return",this._fetch(i).catch((function(t){throw new Error("Unable to load font data at: ".concat(i))})));case 7:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})},{key:"_fetch",value:(t=T(w().mark((function t(e){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:ft("Abstract method `_fetch` called.");case 1:case"end":return t.stop()}}),t)}))),function(e){return t.apply(this,arguments)})}]);var t,e}(),nr=function(t){function e(){return j(this,e),z(this,e,arguments)}return U(e,t),B(e,[{key:"_fetch",value:(n=T(w().mark((function t(e){var n;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Bt(e,"arraybuffer");case 2:return n=t.sent,t.abrupt("return",new Uint8Array(n));case 4:case"end":return t.stop()}}),t)}))),function(t){return n.apply(this,arguments)})}]);var n}(er);function ir(t){return ar.apply(this,arguments)}function ar(){return(ar=T(w().mark((function t(e){var n,i;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=process.getBuiltinModule("fs"),t.next=3,n.promises.readFile(e);case 3:return i=t.sent,t.abrupt("return",new Uint8Array(i));case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}Q&&dt("Please use the `legacy` build in Node.js environments.");var rr=function(t){function e(){return j(this,e),z(this,e,arguments)}return U(e,t),B(e)}(La),sr=function(t){function e(){return j(this,e),z(this,e,arguments)}return U(e,t),B(e,[{key:"_createCanvas",value:function(t,e){return process.getBuiltinModule("module").createRequire("file:///Users/nk/Workspaces/dpb/lib/pdf.mjs")("@napi-rs/canvas").createCanvas(t,e)}}])}(Ta),or=function(t){function e(){return j(this,e),z(this,e,arguments)}return U(e,t),B(e,[{key:"_fetch",value:(n=T(w().mark((function t(e){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",ir(e));case 1:case"end":return t.stop()}}),t)}))),function(t){return n.apply(this,arguments)})}]);var n}(Ra),lr=function(t){function e(){return j(this,e),z(this,e,arguments)}return U(e,t),B(e,[{key:"_fetch",value:(n=T(w().mark((function t(e){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",ir(e));case 1:case"end":return t.stop()}}),t)}))),function(t){return n.apply(this,arguments)})}]);var n}(er),hr="Fill",ur="Stroke",cr="Shading";function dr(t,e){if(e){var n=e[2]-e[0],i=e[3]-e[1],a=new Path2D;a.rect(e[0],e[1],n,i),t.clip(a)}}var fr=function(){return B((function t(){j(this,t)}),[{key:"getPattern",value:function(){ft("Abstract method `getPattern` called.")}}])}(),vr=function(t){function e(t){var n;return j(this,e),(n=z(this,e))._type=t[1],n._bbox=t[2],n._colorStops=t[3],n._p0=t[4],n._p1=t[5],n._r0=t[6],n._r1=t[7],n.matrix=null,n}return U(e,t),B(e,[{key:"_createGradient",value:function(t){var e;"axial"===this._type?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):"radial"===this._type&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));var n,i=F(this._colorStops);try{for(i.s();!(n=i.n()).done;){var a=n.value;e.addColorStop(a[0],a[1])}}catch(t){i.e(t)}finally{i.f()}return e}},{key:"getPattern",value:function(t,e,n,i){var a;if(i===ur||i===hr){var r=e.current.getClippedPathBoundingBox(i,ne(t))||[0,0,0,0],s=Math.ceil(r[2]-r[0])||1,o=Math.ceil(r[3]-r[1])||1,l=e.cachedCanvases.getCanvas("pattern",s,o),h=l.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-r[0],-r[1]),n=Pt.transform(n,[1,0,0,1,r[0],r[1]]),h.transform.apply(h,k(e.baseTransform)),this.matrix&&h.transform.apply(h,k(this.matrix)),dr(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),a=t.createPattern(l.canvas,"no-repeat");var u=new DOMMatrix(n);a.setTransform(u)}else dr(t,this._bbox),a=this._createGradient(t);return a}}])}(fr);function pr(t,e,n,i,a,r,s,o){var l,h=e.coords,u=e.colors,c=t.data,d=4*t.width;h[n+1]>h[i+1]&&(l=n,n=i,i=l,l=r,r=s,s=l),h[i+1]>h[a+1]&&(l=i,i=a,a=l,l=s,s=o,o=l),h[n+1]>h[i+1]&&(l=n,n=i,i=l,l=r,r=s,s=l);var f=(h[n]+e.offsetX)*e.scaleX,v=(h[n+1]+e.offsetY)*e.scaleY,p=(h[i]+e.offsetX)*e.scaleX,g=(h[i+1]+e.offsetY)*e.scaleY,y=(h[a]+e.offsetX)*e.scaleX,m=(h[a+1]+e.offsetY)*e.scaleY;if(!(v>=m))for(var k,b,w,A,_,x,S,M,E=u[r],C=u[r+1],T=u[r+2],P=u[s],R=u[s+1],I=u[s+2],L=u[o],D=u[o+1],F=u[o+2],N=Math.round(v),O=Math.round(m),W=N;W<=O;W++){if(W<g){var B=W<v?0:(v-W)/(v-g);k=f-(f-p)*B,b=E-(E-P)*B,w=C-(C-R)*B,A=T-(T-I)*B}else{var H;k=p-(p-y)*(H=W>m?1:g===m?0:(g-W)/(g-m)),b=P-(P-L)*H,w=R-(R-D)*H,A=I-(I-F)*H}var j=void 0;_=f-(f-y)*(j=W<v?0:W>m?1:(v-W)/(v-m)),x=E-(E-L)*j,S=C-(C-D)*j,M=T-(T-F)*j;for(var z=Math.round(Math.min(k,_)),G=Math.round(Math.max(k,_)),V=d*W+4*z,U=z;U<=G;U++)(j=(k-U)/(k-_))<0?j=0:j>1&&(j=1),c[V++]=b-(b-x)*j|0,c[V++]=w-(w-S)*j|0,c[V++]=A-(A-M)*j|0,c[V++]=255}}function gr(t,e,n){var i,a,r=e.coords,s=e.colors;switch(e.type){case"lattice":var o=e.verticesPerRow,l=Math.floor(r.length/o)-1,h=o-1;for(i=0;i<l;i++)for(var u=i*o,c=0;c<h;c++,u++)pr(t,n,r[u],r[u+1],r[u+o],s[u],s[u+1],s[u+o]),pr(t,n,r[u+o+1],r[u+1],r[u+o],s[u+o+1],s[u+1],s[u+o]);break;case"triangles":for(i=0,a=r.length;i<a;i+=3)pr(t,n,r[i],r[i+1],r[i+2],s[i],s[i+1],s[i+2]);break;default:throw new Error("illegal figure")}}var yr=function(t){function e(t){var n;return j(this,e),(n=z(this,e))._coords=t[2],n._colors=t[3],n._figures=t[4],n._bounds=t[5],n._bbox=t[7],n._background=t[8],n.matrix=null,n}return U(e,t),B(e,[{key:"_createMeshCanvas",value:function(t,e,n){var i=Math.floor(this._bounds[0]),a=Math.floor(this._bounds[1]),r=Math.ceil(this._bounds[2])-i,s=Math.ceil(this._bounds[3])-a,o=Math.min(Math.ceil(Math.abs(r*t[0]*1.1)),3e3),l=Math.min(Math.ceil(Math.abs(s*t[1]*1.1)),3e3),h=r/o,u=s/l,c={coords:this._coords,colors:this._colors,offsetX:-i,offsetY:-a,scaleX:1/h,scaleY:1/u},d=o+4,f=l+4,v=n.getCanvas("mesh",d,f),p=v.context,g=p.createImageData(o,l);if(e)for(var y=g.data,m=0,k=y.length;m<k;m+=4)y[m]=e[0],y[m+1]=e[1],y[m+2]=e[2],y[m+3]=255;var b,w=F(this._figures);try{for(w.s();!(b=w.n()).done;)gr(g,b.value,c)}catch(t){w.e(t)}finally{w.f()}return p.putImageData(g,2,2),{canvas:v.canvas,offsetX:i-2*h,offsetY:a-2*u,scaleX:h,scaleY:u}}},{key:"getPattern",value:function(t,e,n,i){var a;if(dr(t,this._bbox),i===cr)a=Pt.singularValueDecompose2dScale(ne(t));else if(a=Pt.singularValueDecompose2dScale(e.baseTransform),this.matrix){var r=Pt.singularValueDecompose2dScale(this.matrix);a=[a[0]*r[0],a[1]*r[1]]}var s=this._createMeshCanvas(a,i===cr?null:this._background,e.cachedCanvases);return i!==cr&&(t.setTransform.apply(t,k(e.baseTransform)),this.matrix&&t.transform.apply(t,k(this.matrix))),t.translate(s.offsetX,s.offsetY),t.scale(s.scaleX,s.scaleY),t.createPattern(s.canvas,"no-repeat")}}])}(fr),mr=function(t){function e(){return j(this,e),z(this,e,arguments)}return U(e,t),B(e,[{key:"getPattern",value:function(){return"hotpink"}}])}(fr),kr=function(){function t(e,n,i,a,r){j(this,t),this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=n,this.ctx=i,this.canvasGraphicsFactory=a,this.baseTransform=r}return B(t,[{key:"createPatternCanvas",value:function(t){var e=this.bbox,n=this.operatorList,i=this.paintType,a=this.tilingType,r=this.color,s=this.canvasGraphicsFactory,o=this.xstep,l=this.ystep;o=Math.abs(o),l=Math.abs(l),ct("TilingType: "+a);var h=e[0],u=e[1],c=e[2],d=e[3],f=c-h,v=d-u,p=Pt.singularValueDecompose2dScale(this.matrix),g=Pt.singularValueDecompose2dScale(this.baseTransform),y=p[0]*g[0],m=p[1]*g[1],k=f,b=v,w=!1,A=!1,_=Math.ceil(o*y),x=Math.ceil(l*m);_>=Math.ceil(f*y)?k=o:w=!0,x>=Math.ceil(v*m)?b=l:A=!0;var S=this.getSizeAndScale(k,this.ctx.canvas.width,y),M=this.getSizeAndScale(b,this.ctx.canvas.height,m),E=t.cachedCanvases.getCanvas("pattern",S.size,M.size),C=E.context,T=s.createCanvasGraphics(C);if(T.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(T,i,r),C.translate(-S.scale*h,-M.scale*u),T.transform(S.scale,0,0,M.scale,0,0),C.save(),this.clipBbox(T,h,u,c,d),T.baseTransform=ne(T.ctx),T.executeOperatorList(n),T.endDrawing(),C.restore(),w||A){var P=E.canvas;w&&(k=o),A&&(b=l);for(var R=this.getSizeAndScale(k,this.ctx.canvas.width,y),I=this.getSizeAndScale(b,this.ctx.canvas.height,m),L=R.size,D=I.size,F=t.cachedCanvases.getCanvas("pattern-workaround",L,D),N=F.context,O=w?Math.floor(f/o):0,W=A?Math.floor(v/l):0,B=0;B<=O;B++)for(var H=0;H<=W;H++)N.drawImage(P,L*B,D*H,L,D,0,0,L,D);return{canvas:F.canvas,scaleX:R.scale,scaleY:I.scale,offsetX:h,offsetY:u}}return{canvas:E.canvas,scaleX:S.scale,scaleY:M.scale,offsetX:h,offsetY:u}}},{key:"getSizeAndScale",value:function(e,n,i){var a=Math.max(t.MAX_PATTERN_SIZE,n),r=Math.ceil(e*i);return r>=a?r=a:i=r/e,{scale:i,size:r}}},{key:"clipBbox",value:function(t,e,n,i,a){var r=i-e,s=a-n;t.ctx.rect(e,n,r,s),t.current.updateRectMinMax(ne(t.ctx),[e,n,i,a]),t.clip(),t.endPath()}},{key:"setFillAndStrokeStyleToContext",value:function(t,e,n){var i=t.ctx,a=t.current;switch(e){case 1:var r=this.ctx;i.fillStyle=r.fillStyle,i.strokeStyle=r.strokeStyle,a.fillColor=r.fillStyle,a.strokeColor=r.strokeStyle;break;case 2:var s=Pt.makeHexColor(n[0],n[1],n[2]);i.fillStyle=s,i.strokeStyle=s,a.fillColor=s,a.strokeColor=s;break;default:throw new _t("Unsupported paint type: ".concat(e))}}},{key:"getPattern",value:function(t,e,n,i){var a=n;i!==cr&&(a=Pt.transform(a,e.baseTransform),this.matrix&&(a=Pt.transform(a,this.matrix)));var r=this.createPatternCanvas(e),s=new DOMMatrix(a);s=(s=s.translate(r.offsetX,r.offsetY)).scale(1/r.scaleX,1/r.scaleY);var o=t.createPattern(r.canvas,"repeat");return o.setTransform(s),o}}])}();function br(t){var e=t.src,n=t.srcPos,i=void 0===n?0:n,a=t.dest,r=t.width,s=t.height,o=t.nonBlackColor,l=void 0===o?4294967295:o,h=t.inverseDecode,u=void 0!==h&&h,c=Ct.isLittleEndian?4278190080:255,d=I(u?[l,c]:[c,l],2),f=d[0],v=d[1],p=r>>3,g=7&r,y=e.length;a=new Uint32Array(a.buffer);for(var m=0,k=0;k<s;k++){for(var b=i+p;i<b;i++){var w=i<y?e[i]:255;a[m++]=128&w?v:f,a[m++]=64&w?v:f,a[m++]=32&w?v:f,a[m++]=16&w?v:f,a[m++]=8&w?v:f,a[m++]=4&w?v:f,a[m++]=2&w?v:f,a[m++]=1&w?v:f}if(0!==g)for(var A=i<y?e[i++]:255,_=0;_<g;_++)a[m++]=A&1<<7-_?v:f}return{srcPos:i,destPos:m}}P(kr,"MAX_PATTERN_SIZE",3e3);var wr=16,Ar=function(){return B((function t(e){j(this,t),this.canvasFactory=e,this.cache=Object.create(null)}),[{key:"getCanvas",value:function(t,e,n){var i;return void 0!==this.cache[t]?(i=this.cache[t],this.canvasFactory.reset(i,e,n)):(i=this.canvasFactory.create(e,n),this.cache[t]=i),i}},{key:"delete",value:function(t){delete this.cache[t]}},{key:"clear",value:function(){for(var t in this.cache){var e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}])}();function _r(t,e,n,i,a,r,s,o,l,h){var u=I(ne(t),6),c=u[0],d=u[1],f=u[2],v=u[3],p=u[4],g=u[5];if(0===d&&0===f){var y=s*c+p,m=Math.round(y),k=o*v+g,b=Math.round(k),w=(s+l)*c+p,A=Math.abs(Math.round(w)-m)||1,_=(o+h)*v+g,x=Math.abs(Math.round(_)-b)||1;return t.setTransform(Math.sign(c),0,0,Math.sign(v),m,b),t.drawImage(e,n,i,a,r,0,0,A,x),t.setTransform(c,d,f,v,p,g),[A,x]}if(0===c&&0===v){var S=o*f+p,M=Math.round(S),E=s*d+g,C=Math.round(E),T=(o+h)*f+p,P=Math.abs(Math.round(T)-M)||1,R=(s+l)*d+g,L=Math.abs(Math.round(R)-C)||1;return t.setTransform(0,Math.sign(d),Math.sign(f),0,M,C),t.drawImage(e,n,i,a,r,0,0,L,P),t.setTransform(c,d,f,v,p,g),[L,P]}return t.drawImage(e,n,i,a,r,s,o,l,h),[Math.hypot(c,d)*l,Math.hypot(f,v)*h]}var xr=function(){return B((function t(e,n){j(this,t),this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=J,this.textMatrixScale=1,this.fontMatrix=Z,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=0,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.patternStroke=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,n])}),[{key:"clone",value:function(){var t=Object.create(this);return t.clipBox=this.clipBox.slice(),t}},{key:"setCurrentPoint",value:function(t,e){this.x=t,this.y=e}},{key:"updatePathMinMax",value:function(t,e,n){var i=I(Pt.applyTransform([e,n],t),2);e=i[0],n=i[1],this.minX=Math.min(this.minX,e),this.minY=Math.min(this.minY,n),this.maxX=Math.max(this.maxX,e),this.maxY=Math.max(this.maxY,n)}},{key:"updateRectMinMax",value:function(t,e){var n=Pt.applyTransform(e,t),i=Pt.applyTransform(e.slice(2),t),a=Pt.applyTransform([e[0],e[3]],t),r=Pt.applyTransform([e[2],e[1]],t);this.minX=Math.min(this.minX,n[0],i[0],a[0],r[0]),this.minY=Math.min(this.minY,n[1],i[1],a[1],r[1]),this.maxX=Math.max(this.maxX,n[0],i[0],a[0],r[0]),this.maxY=Math.max(this.maxY,n[1],i[1],a[1],r[1])}},{key:"updateScalingPathMinMax",value:function(t,e){Pt.scaleMinMax(t,e),this.minX=Math.min(this.minX,e[0]),this.minY=Math.min(this.minY,e[1]),this.maxX=Math.max(this.maxX,e[2]),this.maxY=Math.max(this.maxY,e[3])}},{key:"updateCurvePathMinMax",value:function(t,e,n,i,a,r,s,o,l,h){var u=Pt.bezierBoundingBox(e,n,i,a,r,s,o,l,h);h||this.updateRectMinMax(t,u)}},{key:"getPathBoundingBox",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hr,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=[this.minX,this.minY,this.maxX,this.maxY];if(t===ur){e||ft("Stroke bounding box must include transform.");var i=Pt.singularValueDecompose2dScale(e),a=i[0]*this.lineWidth/2,r=i[1]*this.lineWidth/2;n[0]-=a,n[1]-=r,n[2]+=a,n[3]+=r}return n}},{key:"updateClipFromPath",value:function(){var t=Pt.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}},{key:"isEmptyClip",value:function(){return this.minX===1/0}},{key:"startNewPathAndClipBox",value:function(t){this.clipBox=t,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}},{key:"getClippedPathBoundingBox",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:hr,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Pt.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}])}();function Sr(t,e){if(e instanceof ImageData)t.putImageData(e,0,0);else{var n,i,a,r,s,o=e.height,l=e.width,h=o%wr,u=(o-h)/wr,c=0===h?u:u+1,d=t.createImageData(l,wr),f=0,v=e.data,p=d.data;if(e.kind===at.GRAYSCALE_1BPP){var g=v.byteLength,y=new Uint32Array(p.buffer,0,p.byteLength>>2),m=y.length,k=l+7>>3,b=4294967295,w=Ct.isLittleEndian?4278190080:255;for(i=0;i<c;i++){for(r=i<u?wr:h,n=0,a=0;a<r;a++){for(var A=g-f,_=0,x=A>k?l:8*A-7,S=-8&x,M=0,E=0;_<S;_+=8)E=v[f++],y[n++]=128&E?b:w,y[n++]=64&E?b:w,y[n++]=32&E?b:w,y[n++]=16&E?b:w,y[n++]=8&E?b:w,y[n++]=4&E?b:w,y[n++]=2&E?b:w,y[n++]=1&E?b:w;for(;_<x;_++)0===M&&(E=v[f++],M=128),y[n++]=E&M?b:w,M>>=1}for(;n<m;)y[n++]=0;t.putImageData(d,0,i*wr)}}else if(e.kind===at.RGBA_32BPP){for(a=0,s=l*wr*4,i=0;i<u;i++)p.set(v.subarray(f,f+s)),f+=s,t.putImageData(d,0,a),a+=wr;i<c&&(s=l*h*4,p.set(v.subarray(f,f+s)),t.putImageData(d,0,a))}else{if(e.kind!==at.RGB_24BPP)throw new Error("bad image kind: ".concat(e.kind));for(s=l*(r=wr),i=0;i<c;i++){for(i>=u&&(s=l*(r=h)),n=0,a=s;a--;)p[n++]=v[f++],p[n++]=v[f++],p[n++]=v[f++],p[n++]=255;t.putImageData(d,0,i*wr)}}}}function Mr(t,e){if(e.bitmap)t.drawImage(e.bitmap,0,0);else for(var n=e.height,i=e.width,a=n%wr,r=(n-a)/wr,s=0===a?r:r+1,o=t.createImageData(i,wr),l=0,h=e.data,u=o.data,c=0;c<s;c++)l=br({src:h,srcPos:l,dest:u,width:i,height:c<r?wr:a,nonBlackColor:0}).srcPos,t.putImageData(o,0,c*wr)}function Er(t,e){for(var n=0,i=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];n<i.length;n++){var a=i[n];void 0!==t[a]&&(e[a]=t[a])}void 0!==t.setLineDash&&(e.setLineDash(t.getLineDash()),e.lineDashOffset=t.lineDashOffset)}function Cr(t){if(t.strokeStyle=t.fillStyle="#000000",t.fillRule="nonzero",t.globalAlpha=1,t.lineWidth=1,t.lineCap="butt",t.lineJoin="miter",t.miterLimit=10,t.globalCompositeOperation="source-over",t.font="10px sans-serif",void 0!==t.setLineDash&&(t.setLineDash([]),t.lineDashOffset=0),!Q){var e=t.filter;"none"!==e&&""!==e&&(t.filter="none")}}function Tr(t,e){if(e)return!0;var n=Pt.singularValueDecompose2dScale(t);n[0]=Math.fround(n[0]),n[1]=Math.fround(n[1]);var i=Math.fround((globalThis.devicePixelRatio||1)*Wt.PDF_TO_CSS_UNITS);return n[0]<=i&&n[1]<=i}var Pr=["butt","round","square"],Rr=["miter","round","bevel"],Ir={},Lr={},Dr=new WeakSet,Fr=function(){function t(e,n,i,a,r,s,o,l){var h=s.optionalContentConfig,u=s.markedContentStack,c=void 0===u?null:u;j(this,t),A(this,Dr),this.ctx=e,this.current=new xr(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=n,this.objs=i,this.canvasFactory=a,this.filterFactory=r,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=c||[],this.optionalContentConfig=h,this.cachedCanvases=new Ar(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=o,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=l,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}return B(t,[{key:"getObject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"string"==typeof t?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):e}},{key:"beginDrawing",value:function(t){var e,n,i=t.transform,a=t.viewport,r=t.transparency,s=void 0!==r&&r,o=t.background,l=void 0===o?null:o,h=this.ctx.canvas.width,u=this.ctx.canvas.height,c=this.ctx.fillStyle;if(this.ctx.fillStyle=l||"#ffffff",this.ctx.fillRect(0,0,h,u),this.ctx.fillStyle=c,s){var d,f=this.cachedCanvases.getCanvas("transparent",h,u);this.compositeCtx=this.ctx,this.transparentCanvas=f.canvas,this.ctx=f.context,this.ctx.save(),(d=this.ctx).transform.apply(d,k(ne(this.compositeCtx)))}this.ctx.save(),Cr(this.ctx),i&&((n=this.ctx).transform.apply(n,k(i)),this.outputScaleX=i[0],this.outputScaleY=i[0]),(e=this.ctx).transform.apply(e,k(a.transform)),this.viewportScale=a.scale,this.baseTransform=ne(this.ctx)}},{key:"executeOperatorList",value:function(t,e,n,i){var a=t.argsArray,r=t.fnArray,s=e||0,o=a.length;if(o===s)return s;for(var l,h=o-s>10&&"function"==typeof n,u=h?Date.now()+15:0,c=0,d=this.commonObjs,f=this.objs;;){if(void 0!==i&&s===i.nextBreakPoint)return i.breakIt(s,n),s;if((l=r[s])!==st.dependency)this[l].apply(this,a[s]);else{var v,p=F(a[s]);try{for(p.s();!(v=p.n()).done;){var g=v.value,y=g.startsWith("g_")?d:f;if(!y.has(g))return y.get(g,n),s}}catch(t){p.e(t)}finally{p.f()}}if(++s===o)return s;if(h&&++c>10){if(Date.now()>u)return n(),s;c=0}}}},{key:"endDrawing",value:function(){R(Dr,this,Nr).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();var t,e=F(this._cachedBitmapsMap.values());try{for(e.s();!(t=e.n()).done;){var n,i=t.value,a=F(i.values());try{for(a.s();!(n=a.n()).done;){var r=n.value;"undefined"!=typeof HTMLCanvasElement&&r instanceof HTMLCanvasElement&&(r.width=r.height=0)}}catch(t){a.e(t)}finally{a.f()}i.clear()}}catch(t){e.e(t)}finally{e.f()}this._cachedBitmapsMap.clear(),R(Dr,this,Or).call(this)}},{key:"_scaleImage",value:function(t,e){for(var n,i,a,r,s=null!==(n=t.width)&&void 0!==n?n:t.displayWidth,o=null!==(i=t.height)&&void 0!==i?i:t.displayHeight,l=Math.max(Math.hypot(e[0],e[1]),1),h=Math.max(Math.hypot(e[2],e[3]),1),u=s,c=o,d="prescale1";l>2&&u>1||h>2&&c>1;){var f=u,v=c;l>2&&u>1&&(l/=u/(f=u>=16384?Math.floor(u/2)-1||1:Math.ceil(u/2))),h>2&&c>1&&(h/=c/(v=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c)/2)),(r=(a=this.cachedCanvases.getCanvas(d,f,v)).context).clearRect(0,0,f,v),r.drawImage(t,0,0,u,c,0,0,f,v),t=a.canvas,u=f,c=v,d="prescale1"===d?"prescale2":"prescale1"}return{img:t,paintWidth:u,paintHeight:c}}},{key:"_createMaskCanvas",value:function(t){var e,n,i,a,r=this.ctx,s=t.width,o=t.height,l=this.current.fillColor,h=this.current.patternFill,u=ne(r);if((t.bitmap||t.data)&&t.count>1){var c=t.bitmap||t.data.buffer;n=JSON.stringify(h?u:[u.slice(0,4),l]),(e=this._cachedBitmapsMap.get(c))||(e=new Map,this._cachedBitmapsMap.set(c,e));var d=e.get(n);if(d&&!h)return{canvas:d,offsetX:Math.round(Math.min(u[0],u[2])+u[4]),offsetY:Math.round(Math.min(u[1],u[3])+u[5])};i=d}i||Mr((a=this.cachedCanvases.getCanvas("maskCanvas",s,o)).context,t);var f=Pt.transform(u,[1/s,0,0,-1/o,0,0]);f=Pt.transform(f,[1,0,0,1,0,-o]);var v=I(Pt.getAxialAlignedBoundingBox([0,0,s,o],f),4),p=v[0],g=v[1],y=v[2],m=v[3],b=Math.round(y-p)||1,w=Math.round(m-g)||1,A=this.cachedCanvases.getCanvas("fillCanvas",b,w),_=A.context,x=p,S=g;_.translate(-x,-S),_.transform.apply(_,k(f)),i||(i=(i=this._scaleImage(a.canvas,ie(_))).img,e&&h&&e.set(n,i)),_.imageSmoothingEnabled=Tr(ne(_),t.interpolate),_r(_,i,0,0,i.width,i.height,0,0,s,o),_.globalCompositeOperation="source-in";var M=Pt.transform(ie(_),[1,0,0,1,-x,-S]);return _.fillStyle=h?l.getPattern(r,this,M,hr):l,_.fillRect(0,0,s,o),e&&!h&&(this.cachedCanvases.delete("fillCanvas"),e.set(n,A.canvas)),{canvas:A.canvas,offsetX:Math.round(x),offsetY:Math.round(S)}}},{key:"setLineWidth",value:function(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}},{key:"setLineCap",value:function(t){this.ctx.lineCap=Pr[t]}},{key:"setLineJoin",value:function(t){this.ctx.lineJoin=Rr[t]}},{key:"setMiterLimit",value:function(t){this.ctx.miterLimit=t}},{key:"setDash",value:function(t,e){var n=this.ctx;void 0!==n.setLineDash&&(n.setLineDash(t),n.lineDashOffset=e)}},{key:"setRenderingIntent",value:function(t){}},{key:"setFlatness",value:function(t){}},{key:"setGState",value:function(t){var e,n=F(t);try{for(n.s();!(e=n.n()).done;){var i=I(e.value,2),a=i[0],r=i[1];switch(a){case"LW":this.setLineWidth(r);break;case"LC":this.setLineCap(r);break;case"LJ":this.setLineJoin(r);break;case"ML":this.setMiterLimit(r);break;case"D":this.setDash(r[0],r[1]);break;case"RI":this.setRenderingIntent(r);break;case"FL":this.setFlatness(r);break;case"Font":this.setFont(r[0],r[1]);break;case"CA":this.current.strokeAlpha=r;break;case"ca":this.current.fillAlpha=r,this.ctx.globalAlpha=r;break;case"BM":this.ctx.globalCompositeOperation=r;break;case"SMask":this.current.activeSMask=r?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(r)}}}catch(t){n.e(t)}finally{n.f()}}},{key:"inSMaskMode",get:function(){return!!this.suspendedCtx}},{key:"checkSMaskState",value:function(){var t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}},{key:"beginSMaskMode",value:function(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");var t=this.ctx.canvas.width,e=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(n,t,e);this.suspendedCtx=this.ctx,this.ctx=i.context;var a=this.ctx;a.setTransform.apply(a,k(ne(this.suspendedCtx))),Er(this.suspendedCtx,a),function(t,e){if(t._removeMirroring)throw new Error("Context is already forwarding operations.");t.__originalSave=t.save,t.__originalRestore=t.restore,t.__originalRotate=t.rotate,t.__originalScale=t.scale,t.__originalTranslate=t.translate,t.__originalTransform=t.transform,t.__originalSetTransform=t.setTransform,t.__originalResetTransform=t.resetTransform,t.__originalClip=t.clip,t.__originalMoveTo=t.moveTo,t.__originalLineTo=t.lineTo,t.__originalBezierCurveTo=t.bezierCurveTo,t.__originalRect=t.rect,t.__originalClosePath=t.closePath,t.__originalBeginPath=t.beginPath,t._removeMirroring=function(){t.save=t.__originalSave,t.restore=t.__originalRestore,t.rotate=t.__originalRotate,t.scale=t.__originalScale,t.translate=t.__originalTranslate,t.transform=t.__originalTransform,t.setTransform=t.__originalSetTransform,t.resetTransform=t.__originalResetTransform,t.clip=t.__originalClip,t.moveTo=t.__originalMoveTo,t.lineTo=t.__originalLineTo,t.bezierCurveTo=t.__originalBezierCurveTo,t.rect=t.__originalRect,t.closePath=t.__originalClosePath,t.beginPath=t.__originalBeginPath,delete t._removeMirroring},t.save=function(){e.save(),this.__originalSave()},t.restore=function(){e.restore(),this.__originalRestore()},t.translate=function(t,n){e.translate(t,n),this.__originalTranslate(t,n)},t.scale=function(t,n){e.scale(t,n),this.__originalScale(t,n)},t.transform=function(t,n,i,a,r,s){e.transform(t,n,i,a,r,s),this.__originalTransform(t,n,i,a,r,s)},t.setTransform=function(t,n,i,a,r,s){e.setTransform(t,n,i,a,r,s),this.__originalSetTransform(t,n,i,a,r,s)},t.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},t.rotate=function(t){e.rotate(t),this.__originalRotate(t)},t.clip=function(t){e.clip(t),this.__originalClip(t)},t.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},t.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},t.bezierCurveTo=function(t,n,i,a,r,s){e.bezierCurveTo(t,n,i,a,r,s),this.__originalBezierCurveTo(t,n,i,a,r,s)},t.rect=function(t,n,i,a){e.rect(t,n,i,a),this.__originalRect(t,n,i,a)},t.closePath=function(){e.closePath(),this.__originalClosePath()},t.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}(a,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}},{key:"endSMaskMode",value:function(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Er(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}},{key:"compose",value:function(t){if(this.current.activeSMask){t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];var e=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}}},{key:"composeSMask",value:function(t,e,n,i){var a=i[0],r=i[1],s=i[2]-a,o=i[3]-r;0!==s&&0!==o&&(this.genericComposeSMask(e.context,n,s,o,e.subtype,e.backdrop,e.transferMap,a,r,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(n.canvas,0,0),t.restore())}},{key:"genericComposeSMask",value:function(t,e,n,i,a,r,s,o,l,h,u){var c=t.canvas,d=o-h,f=l-u;if(r){var v=Pt.makeHexColor.apply(Pt,k(r));if(d<0||f<0||d+n>c.width||f+i>c.height){var p=this.cachedCanvases.getCanvas("maskExtension",n,i),g=p.context;g.drawImage(c,-d,-f),g.globalCompositeOperation="destination-atop",g.fillStyle=v,g.fillRect(0,0,n,i),g.globalCompositeOperation="source-over",c=p.canvas,d=f=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);var y=new Path2D;y.rect(d,f,n,i),t.clip(y),t.globalCompositeOperation="destination-atop",t.fillStyle=v,t.fillRect(d,f,n,i),t.restore()}}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),"Alpha"===a&&s?e.filter=this.filterFactory.addAlphaFilter(s):"Luminosity"===a&&(e.filter=this.filterFactory.addLuminosityFilter(s));var m=new Path2D;m.rect(o,l,n,i),e.clip(m),e.globalCompositeOperation="destination-in",e.drawImage(c,d,f,n,i,o,l,n,i),e.restore()}},{key:"save",value:function(){this.inSMaskMode?(Er(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();var t=this.current;this.stateStack.push(t),this.current=t.clone()}},{key:"restore",value:function(){0===this.stateStack.length&&this.inSMaskMode&&this.endSMaskMode(),0!==this.stateStack.length&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),Er(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}},{key:"transform",value:function(t,e,n,i,a,r){this.ctx.transform(t,e,n,i,a,r),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}},{key:"constructPath",value:function(t,e,n){for(var i,a,r=this.ctx,s=this.current,o=s.x,l=s.y,h=ne(r),u=0===h[0]&&0===h[3]||0===h[1]&&0===h[2],c=u?n.slice(0):null,d=0,f=0,v=t.length;d<v;d++)switch(0|t[d]){case st.rectangle:o=e[f++],l=e[f++];var p=e[f++],g=e[f++],y=o+p,m=l+g;r.moveTo(o,l),0===p||0===g?r.lineTo(y,m):(r.lineTo(y,l),r.lineTo(y,m),r.lineTo(o,m)),u||s.updateRectMinMax(h,[o,l,y,m]),r.closePath();break;case st.moveTo:o=e[f++],l=e[f++],r.moveTo(o,l),u||s.updatePathMinMax(h,o,l);break;case st.lineTo:o=e[f++],l=e[f++],r.lineTo(o,l),u||s.updatePathMinMax(h,o,l);break;case st.curveTo:i=o,a=l,o=e[f+4],l=e[f+5],r.bezierCurveTo(e[f],e[f+1],e[f+2],e[f+3],o,l),s.updateCurvePathMinMax(h,i,a,e[f],e[f+1],e[f+2],e[f+3],o,l,c),f+=6;break;case st.curveTo2:i=o,a=l,r.bezierCurveTo(o,l,e[f],e[f+1],e[f+2],e[f+3]),s.updateCurvePathMinMax(h,i,a,o,l,e[f],e[f+1],e[f+2],e[f+3],c),o=e[f+2],l=e[f+3],f+=4;break;case st.curveTo3:i=o,a=l,o=e[f+2],l=e[f+3],r.bezierCurveTo(e[f],e[f+1],o,l,o,l),s.updateCurvePathMinMax(h,i,a,e[f],e[f+1],o,l,o,l,c),f+=4;break;case st.closePath:r.closePath()}u&&s.updateScalingPathMinMax(h,c),s.setCurrentPoint(o,l)}},{key:"closePath",value:function(){this.ctx.closePath()}},{key:"stroke",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.ctx,n=this.current.strokeColor;e.globalAlpha=this.current.strokeAlpha,this.contentVisible&&("object"===X(n)&&null!=n&&n.getPattern?(e.save(),e.strokeStyle=n.getPattern(e,this,ie(e),ur),this.rescaleAndStroke(!1),e.restore()):this.rescaleAndStroke(!0)),t&&this.consumePath(this.current.getClippedPathBoundingBox()),e.globalAlpha=this.current.fillAlpha}},{key:"closeStroke",value:function(){this.closePath(),this.stroke()}},{key:"fill",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],e=this.ctx,n=this.current.fillColor,i=!1;this.current.patternFill&&(e.save(),e.fillStyle=n.getPattern(e,this,ie(e),hr),i=!0);var a=this.current.getClippedPathBoundingBox();this.contentVisible&&null!==a&&(this.pendingEOFill?(e.fill("evenodd"),this.pendingEOFill=!1):e.fill()),i&&e.restore(),t&&this.consumePath(a)}},{key:"eoFill",value:function(){this.pendingEOFill=!0,this.fill()}},{key:"fillStroke",value:function(){this.fill(!1),this.stroke(!1),this.consumePath()}},{key:"eoFillStroke",value:function(){this.pendingEOFill=!0,this.fillStroke()}},{key:"closeFillStroke",value:function(){this.closePath(),this.fillStroke()}},{key:"closeEOFillStroke",value:function(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}},{key:"endPath",value:function(){this.consumePath()}},{key:"clip",value:function(){this.pendingClip=Ir}},{key:"eoClip",value:function(){this.pendingClip=Lr}},{key:"beginText",value:function(){this.current.textMatrix=J,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}},{key:"endText",value:function(){var t=this.pendingTextPaths,e=this.ctx;if(void 0!==t){var n,i=new Path2D,a=e.getTransform().invertSelf(),r=F(t);try{for(r.s();!(n=r.n()).done;){var s=n.value,o=s.transform,l=s.x,h=s.y,u=s.fontSize,c=s.path;i.addPath(c,new DOMMatrix(o).preMultiplySelf(a).translate(l,h).scale(u,-u))}}catch(t){r.e(t)}finally{r.f()}e.clip(i),e.beginPath(),delete this.pendingTextPaths}else e.beginPath()}},{key:"setCharSpacing",value:function(t){this.current.charSpacing=t}},{key:"setWordSpacing",value:function(t){this.current.wordSpacing=t}},{key:"setHScale",value:function(t){this.current.textHScale=t/100}},{key:"setLeading",value:function(t){this.current.leading=-t}},{key:"setFont",value:function(t,e){var n,i=this.commonObjs.get(t),a=this.current;if(!i)throw new Error("Can't find font for ".concat(t));if(a.fontMatrix=i.fontMatrix||Z,0!==a.fontMatrix[0]&&0!==a.fontMatrix[3]||dt("Invalid font matrix for font "+t),e<0?(e=-e,a.fontDirection=-1):a.fontDirection=1,this.current.font=i,this.current.fontSize=e,!i.isType3Font){var r=i.loadedName||"sans-serif",s=(null===(n=i.systemFontInfo)||void 0===n?void 0:n.css)||'"'.concat(r,'", ').concat(i.fallbackName),o="normal";i.black?o="900":i.bold&&(o="bold");var l=i.italic?"italic":"normal",h=e;e<16?h=16:e>100&&(h=100),this.current.fontSizeScale=e/h,this.ctx.font="".concat(l," ").concat(o," ").concat(h,"px ").concat(s)}}},{key:"setTextRenderingMode",value:function(t){this.current.textRenderingMode=t}},{key:"setTextRise",value:function(t){this.current.textRise=t}},{key:"moveText",value:function(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}},{key:"setLeadingMoveText",value:function(t,e){this.setLeading(-e),this.moveText(t,e)}},{key:"setTextMatrix",value:function(t,e,n,i,a,r){this.current.textMatrix=[t,e,n,i,a,r],this.current.textMatrixScale=Math.hypot(t,e),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}},{key:"nextLine",value:function(){this.moveText(0,this.current.leading)}},{key:"paintChar",value:function(t,e,n,i,a){var r,s=this.ctx,o=this.current,l=o.font,h=o.textRenderingMode,u=o.fontSize/o.fontSizeScale,c=3&h,d=!!(4&h),f=o.patternFill&&!l.missingFile,v=o.patternStroke&&!l.missingFile;if((l.disableFontFace||d||f||v)&&(r=l.getPathGenerator(this.commonObjs,t)),l.disableFontFace||f||v){if(s.save(),s.translate(e,n),s.scale(u,-u),0===c||2===c)if(i){var p=s.getTransform();s.setTransform.apply(s,k(i)),s.fill(R(Dr,this,Wr).call(this,r,p,i))}else s.fill(r);if(1===c||2===c)if(a){var g=s.getTransform();s.setTransform.apply(s,k(a)),s.stroke(R(Dr,this,Wr).call(this,r,g,a))}else s.lineWidth/=u,s.stroke(r);s.restore()}else 0!==c&&2!==c||s.fillText(t,e,n),1!==c&&2!==c||s.strokeText(t,e,n);d&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:ne(s),x:e,y:n,fontSize:u,path:r})}},{key:"isFontSubpixelAAEnabled",get:function(){var t=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10).context;t.scale(1.5,1),t.fillText("I",0,10);for(var e=t.getImageData(0,0,10,10).data,n=!1,i=3;i<e.length;i+=4)if(e[i]>0&&e[i]<255){n=!0;break}return gt(this,"isFontSubpixelAAEnabled",n)}},{key:"showText",value:function(t){var e=this.current,n=e.font;if(n.isType3Font)return this.showType3Text(t);var i=e.fontSize;if(0!==i){var a,r,s=this.ctx,o=e.fontSizeScale,l=e.charSpacing,h=e.wordSpacing,u=e.fontDirection,c=e.textHScale*u,d=t.length,f=n.vertical,v=f?1:-1,p=n.defaultVMetrics,g=i*e.fontMatrix[0],y=0===e.textRenderingMode&&!n.disableFontFace&&!e.patternFill;if(s.save(),s.transform.apply(s,k(e.textMatrix)),s.translate(e.x,e.y+e.textRise),u>0?s.scale(c,-1):s.scale(c,1),e.patternFill){s.save();var m=e.fillColor.getPattern(s,this,ie(s),hr);a=ne(s),s.restore(),s.fillStyle=m}if(e.patternStroke){s.save();var b=e.strokeColor.getPattern(s,this,ie(s),ur);r=ne(s),s.restore(),s.strokeStyle=b}var w=e.lineWidth,A=e.textMatrixScale;if(0===A||0===w){var _=3&e.textRenderingMode;1!==_&&2!==_||(w=this.getSinglePixelWidth())}else w/=A;if(1!==o&&(s.scale(o,o),w/=o),s.lineWidth=w,n.isInvalidPDFjsFont){var x,S=[],M=0,E=F(t);try{for(E.s();!(x=E.n()).done;){var C=x.value;S.push(C.unicode),M+=C.width}}catch(t){E.e(t)}finally{E.f()}return s.fillText(S.join(""),0,0),e.x+=M*g*c,s.restore(),void this.compose()}var T,P=0;for(T=0;T<d;++T){var R=t[T];if("number"!=typeof R){var I=!1,L=(R.isSpace?h:0)+l,D=R.fontChar,N=R.accent,O=void 0,W=void 0,B=R.width;if(f){var H=R.vmetric||p,j=-(R.vmetric?H[1]:.5*B)*g,z=H[2]*g;B=H?-H[0]:B,O=j/o,W=(P+z)/o}else O=P/o,W=0;if(n.remeasure&&B>0){var G=1e3*s.measureText(D).width/i*o;if(B<G&&this.isFontSubpixelAAEnabled){var V=B/G;I=!0,s.save(),s.scale(V,1),O/=V}else B!==G&&(O+=(B-G)/2e3*i/o)}if(this.contentVisible&&(R.isInFont||n.missingFile))if(y&&!N)s.fillText(D,O,W);else if(this.paintChar(D,O,W,a,r),N){var U=O+i*N.offset.x/o,q=W-i*N.offset.y/o;this.paintChar(N.fontChar,U,q,a,r)}P+=f?B*g-L*u:B*g+L*u,I&&s.restore()}else P+=v*R*i/1e3}f?e.y-=P:e.x+=P*c,s.restore(),this.compose()}}},{key:"showType3Text",value:function(t){var e,n,i,a,r=this.ctx,s=this.current,o=s.font,l=s.fontSize,h=s.fontDirection,u=o.vertical?1:-1,c=s.charSpacing,d=s.wordSpacing,f=s.textHScale*h,v=s.fontMatrix||Z,p=t.length;if(3!==s.textRenderingMode&&0!==l){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,r.save(),r.transform.apply(r,k(s.textMatrix)),r.translate(s.x,s.y),r.scale(f,h),e=0;e<p;++e)if("number"!=typeof(n=t[e])){var g=(n.isSpace?d:0)+c,y=o.charProcOperatorList[n.operatorListId];y?(this.contentVisible&&(this.processingType3=n,this.save(),r.scale(l,l),r.transform.apply(r,k(v)),this.executeOperatorList(y),this.restore()),i=Pt.applyTransform([n.width,0],v)[0]*l+g,r.translate(i,0),s.x+=i*f):dt('Type3 character "'.concat(n.operatorListId,'" is not available.'))}else a=u*n*l/1e3,this.ctx.translate(a,0),s.x+=a*f;r.restore(),this.processingType3=null}}},{key:"setCharWidth",value:function(t,e){}},{key:"setCharWidthAndBounds",value:function(t,e,n,i,a,r){this.ctx.rect(n,i,a-n,r-i),this.ctx.clip(),this.endPath()}},{key:"getColorN_Pattern",value:function(e){var n,i=this;if("TilingPattern"===e[0]){var a=e[1],r=this.baseTransform||ne(this.ctx),s={createCanvasGraphics:function(e){return new t(e,i.commonObjs,i.objs,i.canvasFactory,i.filterFactory,{optionalContentConfig:i.optionalContentConfig,markedContentStack:i.markedContentStack})}};n=new kr(e,a,this.ctx,s,r)}else n=this._getPattern(e[1],e[2]);return n}},{key:"setStrokeColorN",value:function(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}},{key:"setFillColorN",value:function(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}},{key:"setStrokeRGBColor",value:function(t,e,n){this.ctx.strokeStyle=this.current.strokeColor=Pt.makeHexColor(t,e,n),this.current.patternStroke=!1}},{key:"setStrokeTransparent",value:function(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}},{key:"setFillRGBColor",value:function(t,e,n){this.ctx.fillStyle=this.current.fillColor=Pt.makeHexColor(t,e,n),this.current.patternFill=!1}},{key:"setFillTransparent",value:function(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}},{key:"_getPattern",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.cachedPatterns.has(t)?e=this.cachedPatterns.get(t):(e=function(t){switch(t[0]){case"RadialAxial":return new vr(t);case"Mesh":return new yr(t);case"Dummy":return new mr}throw new Error("Unknown IR type: ".concat(t[0]))}(this.getObject(t)),this.cachedPatterns.set(t,e)),n&&(e.matrix=n),e}},{key:"shadingFill",value:function(t){if(this.contentVisible){var e=this.ctx;this.save();var n=this._getPattern(t);e.fillStyle=n.getPattern(e,this,ie(e),cr);var i=ie(e);if(i){var a=e.canvas,r=a.width,s=a.height,o=I(Pt.getAxialAlignedBoundingBox([0,0,r,s],i),4),l=o[0],h=o[1],u=o[2],c=o[3];this.ctx.fillRect(l,h,u-l,c-h)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}}},{key:"beginInlineImage",value:function(){ft("Should not call beginInlineImage")}},{key:"beginImageData",value:function(){ft("Should not call beginImageData")}},{key:"paintFormXObjectBegin",value:function(t,e){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),t&&this.transform.apply(this,k(t)),this.baseTransform=ne(this.ctx),e)){var n=e[2]-e[0],i=e[3]-e[1];this.ctx.rect(e[0],e[1],n,i),this.current.updateRectMinMax(ne(this.ctx),e),this.clip(),this.endPath()}}},{key:"paintFormXObjectEnd",value:function(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}},{key:"beginGroup",value:function(t){if(this.contentVisible){this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);var e=this.ctx;t.isolated||ct("TODO: Support non-isolated groups."),t.knockout&&dt("Knockout groups not supported.");var n=ne(e);if(t.matrix&&e.transform.apply(e,k(t.matrix)),!t.bbox)throw new Error("Bounding box is required.");var i=Pt.getAxialAlignedBoundingBox(t.bbox,ne(e)),a=[0,0,e.canvas.width,e.canvas.height];i=Pt.intersect(i,a)||[0,0,0,0];var r=Math.floor(i[0]),s=Math.floor(i[1]),o=Math.max(Math.ceil(i[2])-r,1),l=Math.max(Math.ceil(i[3])-s,1);this.current.startNewPathAndClipBox([0,0,o,l]);var h="groupAt"+this.groupLevel;t.smask&&(h+="_smask_"+this.smaskCounter++%2);var u=this.cachedCanvases.getCanvas(h,o,l),c=u.context;c.translate(-r,-s),c.transform.apply(c,k(n)),t.smask?this.smaskStack.push({canvas:u.canvas,context:c,offsetX:r,offsetY:s,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(r,s),e.save()),Er(e,c),this.ctx=c,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++}}},{key:"endGroup",value:function(t){if(this.contentVisible){this.groupLevel--;var e=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,t.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{var i;this.ctx.restore();var a=ne(this.ctx);this.restore(),this.ctx.save(),(i=this.ctx).setTransform.apply(i,k(a));var r=Pt.getAxialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],a);this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(r)}}}},{key:"beginAnnotation",value:function(t,e,n,i,a){var r;if(R(Dr,this,Nr).call(this),Cr(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&(r=this.ctx).setTransform.apply(r,k(this.baseTransform)),e){var s=e[2]-e[0],o=e[3]-e[1];if(a&&this.annotationCanvasMap){(n=n.slice())[4]-=e[0],n[5]-=e[1],(e=e.slice())[0]=e[1]=0,e[2]=s,e[3]=o;var l=I(Pt.singularValueDecompose2dScale(ne(this.ctx)),2),h=l[0],u=l[1],c=this.viewportScale,d=Math.ceil(s*this.outputScaleX*c),f=Math.ceil(o*this.outputScaleY*c);this.annotationCanvas=this.canvasFactory.create(d,f);var v=this.annotationCanvas,p=v.canvas,g=v.context;this.annotationCanvasMap.set(t,p),this.annotationCanvas.savedCtx=this.ctx,this.ctx=g,this.ctx.save(),this.ctx.setTransform(h,0,0,-u,0,o*u),Cr(this.ctx)}else Cr(this.ctx),this.endPath(),this.ctx.rect(e[0],e[1],s,o),this.ctx.clip(),this.ctx.beginPath()}this.current=new xr(this.ctx.canvas.width,this.ctx.canvas.height),this.transform.apply(this,k(n)),this.transform.apply(this,k(i))}},{key:"endAnnotation",value:function(){this.annotationCanvas&&(this.ctx.restore(),R(Dr,this,Or).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}},{key:"paintImageMaskXObject",value:function(t){if(this.contentVisible){var e=t.count;(t=this.getObject(t.data,t)).count=e;var n=this.ctx,i=this.processingType3;if(i&&(void 0===i.compiled&&(i.compiled=function(t){var e=t.width,n=t.height;if(e>1e3||n>1e3)return null;var i,a,r,s,o=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),l=e+1,h=new Uint8Array(l*(n+1)),u=e+7&-8,c=new Uint8Array(u*n),d=0,f=F(t.data);try{for(f.s();!(s=f.n()).done;)for(var v=s.value,p=128;p>0;)c[d++]=v&p?0:255,p>>=1}catch(t){f.e(t)}finally{f.f()}var g=0;for(0!==c[d=0]&&(h[0]=1,++g),a=1;a<e;a++)c[d]!==c[d+1]&&(h[a]=c[d]?2:1,++g),d++;for(0!==c[d]&&(h[a]=2,++g),i=1;i<n;i++){r=i*l,c[(d=i*u)-u]!==c[d]&&(h[r]=c[d]?1:8,++g);var y=(c[d]?4:0)+(c[d-u]?8:0);for(a=1;a<e;a++)o[y=(y>>2)+(c[d+1]?4:0)+(c[d-u+1]?8:0)]&&(h[r+a]=o[y],++g),d++;if(c[d-u]!==c[d]&&(h[r+a]=c[d]?2:4,++g),g>1e3)return null}for(r=i*l,0!==c[d=u*(n-1)]&&(h[r]=8,++g),a=1;a<e;a++)c[d]!==c[d+1]&&(h[r+a]=c[d]?4:8,++g),d++;if(0!==c[d]&&(h[r+a]=4,++g),g>1e3)return null;var m=new Int32Array([0,l,-1,0,-l,0,0,0,1]),k=new Path2D;for(i=0;g&&i<=n;i++){for(var b=i*l,w=b+e;b<w&&!h[b];)b++;if(b!==w){k.moveTo(b%l,i);var A=b,_=h[b];do{var x=m[_];do{b+=x}while(!h[b]);var S=h[b];5!==S&&10!==S?(_=S,h[b]=0):(_=S&51*_>>4,h[b]&=_>>2|_<<2),k.lineTo(b%l,b/l|0),h[b]||--g}while(A!==b);--i}}return c=null,h=null,function(t){t.save(),t.scale(1/e,-1/n),t.translate(0,-n),t.fill(k),t.beginPath(),t.restore()}}(t)),i.compiled))i.compiled(n);else{var a=this._createMaskCanvas(t),r=a.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(r,a.offsetX,a.offsetY),n.restore(),this.compose()}}}},{key:"paintImageMaskXObjectRepeat",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4?arguments[4]:void 0,r=arguments.length>5?arguments[5]:void 0;if(this.contentVisible){t=this.getObject(t.data,t);var s=this.ctx;s.save();var o=ne(s);s.transform(e,n,i,a,0,0);var l=this._createMaskCanvas(t);s.setTransform(1,0,0,1,l.offsetX-o[4],l.offsetY-o[5]);for(var h=0,u=r.length;h<u;h+=2){var c=Pt.transform(o,[e,n,i,a,r[h],r[h+1]]),d=I(Pt.applyTransform([0,0],c),2),f=d[0],v=d[1];s.drawImage(l.canvas,f,v)}s.restore(),this.compose()}}},{key:"paintImageMaskXObjectGroup",value:function(t){if(this.contentVisible){var e,n=this.ctx,i=this.current.fillColor,a=this.current.patternFill,r=F(t);try{for(r.s();!(e=r.n()).done;){var s=e.value,o=s.data,l=s.width,h=s.height,u=s.transform,c=this.cachedCanvases.getCanvas("maskCanvas",l,h),d=c.context;d.save(),Mr(d,this.getObject(o,s)),d.globalCompositeOperation="source-in",d.fillStyle=a?i.getPattern(d,this,ie(n),hr):i,d.fillRect(0,0,l,h),d.restore(),n.save(),n.transform.apply(n,k(u)),n.scale(1,-1),_r(n,c.canvas,0,0,l,h,0,-1,1,1),n.restore()}}catch(t){r.e(t)}finally{r.f()}this.compose()}}},{key:"paintImageXObject",value:function(t){if(this.contentVisible){var e=this.getObject(t);e?this.paintInlineImageXObject(e):dt("Dependent image isn't ready yet")}}},{key:"paintImageXObjectRepeat",value:function(t,e,n,i){if(this.contentVisible){var a=this.getObject(t);if(a){for(var r=a.width,s=a.height,o=[],l=0,h=i.length;l<h;l+=2)o.push({transform:[e,0,0,n,i[l],i[l+1]],x:0,y:0,w:r,h:s});this.paintInlineImageXObjectGroup(a,o)}else dt("Dependent image isn't ready yet")}}},{key:"applyTransferMapsToCanvas",value:function(t){return"none"!==this.current.transferMaps&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}},{key:"applyTransferMapsToBitmap",value:function(t){if("none"===this.current.transferMaps)return t.bitmap;var e=t.bitmap,n=t.width,i=t.height,a=this.cachedCanvases.getCanvas("inlineImage",n,i),r=a.context;return r.filter=this.current.transferMaps,r.drawImage(e,0,0),r.filter="none",a.canvas}},{key:"paintInlineImageXObject",value:function(t){if(this.contentVisible){var e,n=t.width,i=t.height,a=this.ctx;if(this.save(),!Q){var r=a.filter;"none"!==r&&""!==r&&(a.filter="none")}if(a.scale(1/n,-1/i),t.bitmap)e=this.applyTransferMapsToBitmap(t);else if("function"==typeof HTMLElement&&t instanceof HTMLElement||!t.data)e=t;else{var s=this.cachedCanvases.getCanvas("inlineImage",n,i).context;Sr(s,t),e=this.applyTransferMapsToCanvas(s)}var o=this._scaleImage(e,ie(a));a.imageSmoothingEnabled=Tr(ne(a),t.interpolate),_r(a,o.img,0,0,o.paintWidth,o.paintHeight,0,-i,n,i),this.compose(),this.restore()}}},{key:"paintInlineImageXObjectGroup",value:function(t,e){if(this.contentVisible){var n,i=this.ctx;if(t.bitmap)n=t.bitmap;else{var a=t.width,r=t.height,s=this.cachedCanvases.getCanvas("inlineImage",a,r).context;Sr(s,t),n=this.applyTransferMapsToCanvas(s)}var o,l=F(e);try{for(l.s();!(o=l.n()).done;){var h=o.value;i.save(),i.transform.apply(i,k(h.transform)),i.scale(1,-1),_r(i,n,h.x,h.y,h.w,h.h,0,-1,1,1),i.restore()}}catch(t){l.e(t)}finally{l.f()}this.compose()}}},{key:"paintSolidColorImageMask",value:function(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}},{key:"markPoint",value:function(t){}},{key:"markPointProps",value:function(t,e){}},{key:"beginMarkedContent",value:function(t){this.markedContentStack.push({visible:!0})}},{key:"beginMarkedContentProps",value:function(t,e){"OC"===t?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}},{key:"endMarkedContent",value:function(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}},{key:"beginCompat",value:function(){}},{key:"endCompat",value:function(){}},{key:"consumePath",value:function(t){var e=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(t);var n=this.ctx;this.pendingClip&&(e||(this.pendingClip===Lr?n.clip("evenodd"):n.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),n.beginPath()}},{key:"getSinglePixelWidth",value:function(){if(!this._cachedGetSinglePixelWidth){var t=ne(this.ctx);if(0===t[1]&&0===t[2])this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{var e=Math.abs(t[0]*t[3]-t[2]*t[1]),n=Math.hypot(t[0],t[2]),i=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(n,i)/e}}return this._cachedGetSinglePixelWidth}},{key:"getScaleForStroking",value:function(){if(-1===this._cachedScaleForStroking[0]){var t,e,n=this.current.lineWidth,i=this.ctx.getTransform(),a=i.a,r=i.b,s=i.c,o=i.d;if(0===r&&0===s){var l=Math.abs(a),h=Math.abs(o);if(l===h)if(0===n)t=e=1/l;else{var u=l*n;t=e=u<1?1/u:1}else if(0===n)t=1/l,e=1/h;else{var c=l*n,d=h*n;t=c<1?1/c:1,e=d<1?1/d:1}}else{var f=Math.abs(a*o-r*s),v=Math.hypot(a,r),p=Math.hypot(s,o);if(0===n)t=p/f,e=v/f;else{var g=n*f;t=p>g?p/g:1,e=v>g?v/g:1}}this._cachedScaleForStroking[0]=t,this._cachedScaleForStroking[1]=e}return this._cachedScaleForStroking}},{key:"rescaleAndStroke",value:function(t){var e=this.ctx,n=this.current.lineWidth,i=I(this.getScaleForStroking(),2),a=i[0],r=i[1];if(e.lineWidth=n||1,1!==a||1!==r){var s=e.getLineDash();if(t&&e.save(),e.scale(a,r),s.length>0){var o=Math.max(a,r);e.setLineDash(s.map((function(t){return t/o}))),e.lineDashOffset/=o}e.stroke(),t&&e.restore()}else e.stroke()}},{key:"isContentVisible",value:function(){for(var t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}])}();function Nr(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}function Or(){if(this.pageColors){var t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if("none"!==t){var e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}function Wr(t,e,n){var i=new Path2D;return i.addPath(t,new DOMMatrix(n).invertSelf().multiplySelf(e)),i}for(var Br in st)void 0!==Fr.prototype[Br]&&(Fr.prototype[st[Br]]=Fr.prototype[Br]);var Hr=function(){function t(){j(this,t)}return B(t,null,[{key:"workerPort",get:function(){return R(t,this,jr)._},set:function(e){if(!("undefined"!=typeof Worker&&e instanceof Worker)&&null!==e)throw new Error("Invalid `workerPort` type.");jr._=R(t,this,e)}},{key:"workerSrc",get:function(){return R(t,this,zr)._},set:function(e){if("string"!=typeof e)throw new Error("Invalid `workerSrc` type.");zr._=R(t,this,e)}}])}(),jr={_:null},zr={_:""};function Gr(){}function Vr(t){switch(t instanceof Error||"object"===X(t)&&null!==t||ft('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),t.name){case"AbortException":return new xt(t.message);case"MissingPDFException":return new wt(t.message);case"PasswordException":return new mt(t.message,t.code);case"UnexpectedResponseException":return new At(t.message,t.status);case"UnknownErrorException":return new kt(t.message,t.details);default:return new kt(t.message,t.toString())}}var Ur=new WeakMap,qr=new WeakSet,Xr=function(){return B((function t(e,n,i){j(this,t),A(this,qr),_(this,Ur,new AbortController),this.sourceName=e,this.targetName=n,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),i.addEventListener("message",R(qr,this,Yr).bind(this),{signal:M(Ur,this).signal})}),[{key:"on",value:function(t,e){var n=this.actionHandler;if(n[t])throw new Error('There is already an actionName called "'.concat(t,'"'));n[t]=e}},{key:"send",value:function(t,e,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},n)}},{key:"sendWithPromise",value:function(t,e,n){var i=this.callbackId++,a=Promise.withResolvers();this.callbackCapabilities[i]=a;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:i,data:e},n)}catch(t){a.reject(t)}return a.promise}},{key:"sendWithStream",value:function(t,e,n,i){var a=this,r=this.streamId++,s=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:function(n){var h=Promise.withResolvers();return a.streamControllers[r]={controller:n,startCall:h,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:s,targetName:o,action:t,streamId:r,data:e,desiredSize:n.desiredSize},i),h.promise},pull:function(t){var e=Promise.withResolvers();return a.streamControllers[r].pullCall=e,l.postMessage({sourceName:s,targetName:o,stream:6,streamId:r,desiredSize:t.desiredSize}),e.promise},cancel:function(t){vt(t instanceof Error,"cancel must have a valid reason");var e=Promise.withResolvers();return a.streamControllers[r].cancelCall=e,a.streamControllers[r].isClosed=!0,l.postMessage({sourceName:s,targetName:o,stream:1,streamId:r,reason:Vr(t)}),e.promise}},n)}},{key:"destroy",value:function(){var t;null===(t=M(Ur,this))||void 0===t||t.abort(),E(Ur,this,null)}}])}();function Yr(t){var e=t.data;if(e.targetName===this.sourceName)if(e.stream)R(qr,this,Qr).call(this,e);else if(e.callback){var n=e.callbackId,i=this.callbackCapabilities[n];if(!i)throw new Error("Cannot resolve callback ".concat(n));if(delete this.callbackCapabilities[n],1===e.callback)i.resolve(e.data);else{if(2!==e.callback)throw new Error("Unexpected callback case");i.reject(Vr(e.reason))}}else{var a=this.actionHandler[e.action];if(!a)throw new Error("Unknown action from worker: ".concat(e.action));if(e.callbackId){var r=this.sourceName,s=e.sourceName,o=this.comObj;Promise.try(a,e.data).then((function(t){o.postMessage({sourceName:r,targetName:s,callback:1,callbackId:e.callbackId,data:t})}),(function(t){o.postMessage({sourceName:r,targetName:s,callback:2,callbackId:e.callbackId,reason:Vr(t)})}))}else e.streamId?R(qr,this,Kr).call(this,e):a(e.data)}}function Kr(t){var e=t.streamId,n=this.sourceName,i=t.sourceName,a=this.comObj,r=this,s=this.actionHandler[t.action],o={enqueue:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,s=arguments.length>2?arguments[2]:void 0;if(!this.isCancelled){var o=this.desiredSize;this.desiredSize-=r,o>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),a.postMessage({sourceName:n,targetName:i,stream:4,streamId:e,chunk:t},s)}},close:function(){this.isCancelled||(this.isCancelled=!0,a.postMessage({sourceName:n,targetName:i,stream:3,streamId:e}),delete r.streamSinks[e])},error:function(t){vt(t instanceof Error,"error must have a valid reason"),this.isCancelled||(this.isCancelled=!0,a.postMessage({sourceName:n,targetName:i,stream:5,streamId:e,reason:Vr(t)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};o.sinkCapability.resolve(),o.ready=o.sinkCapability.promise,this.streamSinks[e]=o,Promise.try(s,t.data,o).then((function(){a.postMessage({sourceName:n,targetName:i,stream:8,streamId:e,success:!0})}),(function(t){a.postMessage({sourceName:n,targetName:i,stream:8,streamId:e,reason:Vr(t)})}))}function Qr(t){var e=t.streamId,n=this.sourceName,i=t.sourceName,a=this.comObj,r=this.streamControllers[e],s=this.streamSinks[e];switch(t.stream){case 8:t.success?r.startCall.resolve():r.startCall.reject(Vr(t.reason));break;case 7:t.success?r.pullCall.resolve():r.pullCall.reject(Vr(t.reason));break;case 6:if(!s){a.postMessage({sourceName:n,targetName:i,stream:7,streamId:e,success:!0});break}s.desiredSize<=0&&t.desiredSize>0&&s.sinkCapability.resolve(),s.desiredSize=t.desiredSize,Promise.try(s.onPull||Gr).then((function(){a.postMessage({sourceName:n,targetName:i,stream:7,streamId:e,success:!0})}),(function(t){a.postMessage({sourceName:n,targetName:i,stream:7,streamId:e,reason:Vr(t)})}));break;case 4:if(vt(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(t.chunk);break;case 3:if(vt(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),R(qr,this,Jr).call(this,r,e);break;case 5:vt(r,"error should have stream controller"),r.controller.error(Vr(t.reason)),R(qr,this,Jr).call(this,r,e);break;case 2:t.success?r.cancelCall.resolve():r.cancelCall.reject(Vr(t.reason)),R(qr,this,Jr).call(this,r,e);break;case 1:if(!s)break;var o=Vr(t.reason);Promise.try(s.onCancel||Gr,o).then((function(){a.postMessage({sourceName:n,targetName:i,stream:2,streamId:e,success:!0})}),(function(t){a.postMessage({sourceName:n,targetName:i,stream:2,streamId:e,reason:Vr(t)})})),s.sinkCapability.reject(o),s.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}function Jr(t,e){return Zr.apply(this,arguments)}function Zr(){return(Zr=T(w().mark((function t(e,n){var i,a,r;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.allSettled([null===(i=e.startCall)||void 0===i?void 0:i.promise,null===(a=e.pullCall)||void 0===a?void 0:a.promise,null===(r=e.cancelCall)||void 0===r?void 0:r.promise]);case 2:delete this.streamControllers[n];case 3:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}var $r=new WeakMap,ts=new WeakMap,es=function(){return B((function t(e){var n=e.parsedData,i=e.rawData;j(this,t),_(this,$r,void 0),_(this,ts,void 0),E($r,this,n),E(ts,this,i)}),[{key:"getRaw",value:function(){return M(ts,this)}},{key:"get",value:function(t){var e;return null!==(e=M($r,this).get(t))&&void 0!==e?e:null}},{key:"getAll",value:function(){return Et(M($r,this))}},{key:"has",value:function(t){return M($r,this).has(t)}}])}(),ns=Symbol("INTERNAL"),is=new WeakMap,as=new WeakMap,rs=new WeakMap,ss=new WeakMap,os=function(){return B((function t(e,n){var i=n.name,a=n.intent,r=n.usage,s=n.rbGroups;j(this,t),_(this,is,!1),_(this,as,!1),_(this,rs,!1),_(this,ss,!0),E(is,this,!!(2&e)),E(as,this,!!(4&e)),this.name=i,this.intent=a,this.usage=r,this.rbGroups=s}),[{key:"visible",get:function(){if(M(rs,this))return M(ss,this);if(!M(ss,this))return!1;var t=this.usage,e=t.print,n=t.view;return M(is,this)?"OFF"!==(null==n?void 0:n.viewState):!M(as,this)||"OFF"!==(null==e?void 0:e.printState)}},{key:"_setVisible",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t!==ns&&ft("Internal method `_setVisible` called."),E(rs,this,n),E(ss,this,e)}}])}(),ls=new WeakMap,hs=new WeakMap,us=new WeakMap,cs=new WeakMap,ds=new WeakSet,fs=function(){return B((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(j(this,t),A(this,ds),_(this,ls,null),_(this,hs,new Map),_(this,us,null),_(this,cs,null),this.renderingIntent=n,this.name=null,this.creator=null,null!==e){this.name=e.name,this.creator=e.creator,E(cs,this,e.order);var i,a=F(e.groups);try{for(a.s();!(i=a.n()).done;){var r=i.value;M(hs,this).set(r.id,new os(n,r))}}catch(t){a.e(t)}finally{a.f()}if("OFF"===e.baseState){var s,o=F(M(hs,this).values());try{for(o.s();!(s=o.n()).done;)s.value._setVisible(ns,!1)}catch(t){o.e(t)}finally{o.f()}}var l,h=F(e.on);try{for(h.s();!(l=h.n()).done;){var u=l.value;M(hs,this).get(u)._setVisible(ns,!0)}}catch(t){h.e(t)}finally{h.f()}var c,d=F(e.off);try{for(d.s();!(c=d.n()).done;){var f=c.value;M(hs,this).get(f)._setVisible(ns,!1)}}catch(t){d.e(t)}finally{d.f()}E(us,this,this.getHash())}}),[{key:"isVisible",value:function(t){if(0===M(hs,this).size)return!0;if(!t)return ct("Optional content group not defined."),!0;if("OCG"===t.type)return M(hs,this).has(t.id)?M(hs,this).get(t.id).visible:(dt("Optional content group not found: ".concat(t.id)),!0);if("OCMD"===t.type){if(t.expression)return R(ds,this,vs).call(this,t.expression);if(!t.policy||"AnyOn"===t.policy){var e,n=F(t.ids);try{for(n.s();!(e=n.n()).done;){var i=e.value;if(!M(hs,this).has(i))return dt("Optional content group not found: ".concat(i)),!0;if(M(hs,this).get(i).visible)return!0}}catch(t){n.e(t)}finally{n.f()}return!1}if("AllOn"===t.policy){var a,r=F(t.ids);try{for(r.s();!(a=r.n()).done;){var s=a.value;if(!M(hs,this).has(s))return dt("Optional content group not found: ".concat(s)),!0;if(!M(hs,this).get(s).visible)return!1}}catch(t){r.e(t)}finally{r.f()}return!0}if("AnyOff"===t.policy){var o,l=F(t.ids);try{for(l.s();!(o=l.n()).done;){var h=o.value;if(!M(hs,this).has(h))return dt("Optional content group not found: ".concat(h)),!0;if(!M(hs,this).get(h).visible)return!0}}catch(t){l.e(t)}finally{l.f()}return!1}if("AllOff"===t.policy){var u,c=F(t.ids);try{for(c.s();!(u=c.n()).done;){var d=u.value;if(!M(hs,this).has(d))return dt("Optional content group not found: ".concat(d)),!0;if(M(hs,this).get(d).visible)return!1}}catch(t){c.e(t)}finally{c.f()}return!0}return dt("Unknown optional content policy ".concat(t.policy,".")),!0}return dt("Unknown group type ".concat(t.type,".")),!0}},{key:"setVisibility",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=M(hs,this).get(t);if(i){if(n&&e&&i.rbGroups.length){var a,r=F(i.rbGroups);try{for(r.s();!(a=r.n()).done;){var s,o=F(a.value);try{for(o.s();!(s=o.n()).done;){var l,h=s.value;h!==t&&(null===(l=M(hs,this).get(h))||void 0===l||l._setVisible(ns,!1,!0))}}catch(t){o.e(t)}finally{o.f()}}}catch(t){r.e(t)}finally{r.f()}}i._setVisible(ns,!!e,!0),E(ls,this,null)}else dt("Optional content group not found: ".concat(t))}},{key:"setOCGState",value:function(t){var e,n,i=t.state,a=t.preserveRB,r=F(i);try{for(r.s();!(n=r.n()).done;){var s=n.value;switch(s){case"ON":case"OFF":case"Toggle":e=s;continue}var o=M(hs,this).get(s);if(o)switch(e){case"ON":this.setVisibility(s,!0,a);break;case"OFF":this.setVisibility(s,!1,a);break;case"Toggle":this.setVisibility(s,!o.visible,a)}}}catch(t){r.e(t)}finally{r.f()}E(ls,this,null)}},{key:"hasInitialVisibility",get:function(){return null===M(us,this)||this.getHash()===M(us,this)}},{key:"getOrder",value:function(){return M(hs,this).size?M(cs,this)?M(cs,this).slice():k(M(hs,this).keys()):null}},{key:"getGroups",value:function(){return M(hs,this).size>0?Et(M(hs,this)):null}},{key:"getGroup",value:function(t){return M(hs,this).get(t)||null}},{key:"getHash",value:function(){if(null!==M(ls,this))return M(ls,this);var t,e=new pa,n=F(M(hs,this));try{for(n.s();!(t=n.n()).done;){var i=I(t.value,2),a=i[0],r=i[1];e.update("".concat(a,":").concat(r.visible))}}catch(t){n.e(t)}finally{n.f()}return E(ls,this,e.hexdigest())}}])}();function vs(t){var e=t.length;if(e<2)return!0;for(var n=t[0],i=1;i<e;i++){var a=t[i],r=void 0;if(Array.isArray(a))r=R(ds,this,vs).call(this,a);else{if(!M(hs,this).has(a))return dt("Optional content group not found: ".concat(a)),!0;r=M(hs,this).get(a).visible}switch(n){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return"And"===n}var ps=function(){return B((function t(e,n){var i=this,a=n.disableRange,r=void 0!==a&&a,s=n.disableStream,o=void 0!==s&&s;j(this,t),vt(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');var l=e.length,h=e.initialData,u=e.progressiveDone,c=e.contentDispositionFilename;if(this._queuedChunks=[],this._progressiveDone=u,this._contentDispositionFilename=c,(null==h?void 0:h.length)>0){var d=h instanceof Uint8Array&&h.byteLength===h.buffer.byteLength?h.buffer:new Uint8Array(h).buffer;this._queuedChunks.push(d)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!o,this._isRangeSupported=!r,this._contentLength=l,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((function(t,e){i._onReceiveData({begin:t,chunk:e})})),e.addProgressListener((function(t,e){i._onProgress({loaded:t,total:e})})),e.addProgressiveReadListener((function(t){i._onReceiveData({chunk:t})})),e.addProgressiveDoneListener((function(){i._onProgressiveDone()})),e.transportReady()}),[{key:"_onReceiveData",value:function(t){var e=t.begin,n=t.chunk,i=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;void 0===e?this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i):vt(this._rangeReaders.some((function(t){return t._begin===e&&(t._enqueue(i),!0)})),"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}},{key:"_progressiveDataLength",get:function(){var t,e;return null!==(t=null===(e=this._fullRequestReader)||void 0===e?void 0:e._loaded)&&void 0!==t?t:0}},{key:"_onProgress",value:function(t){var e,n,i,a;void 0===t.total?null===(e=this._rangeReaders[0])||void 0===e||null===(n=e.onProgress)||void 0===n||n.call(e,{loaded:t.loaded}):null===(i=this._fullRequestReader)||void 0===i||null===(a=i.onProgress)||void 0===a||a.call(i,{loaded:t.loaded,total:t.total})}},{key:"_onProgressiveDone",value:function(){var t;null===(t=this._fullRequestReader)||void 0===t||t.progressiveDone(),this._progressiveDone=!0}},{key:"_removeRangeReader",value:function(t){var e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}},{key:"getFullReader",value:function(){vt(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");var t=this._queuedChunks;return this._queuedChunks=null,new gs(this,t,this._progressiveDone,this._contentDispositionFilename)}},{key:"getRangeReader",value:function(t,e){if(e<=this._progressiveDataLength)return null;var n=new ys(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(n),n}},{key:"cancelAllRequests",value:function(t){var e;null===(e=this._fullRequestReader)||void 0===e||e.cancel(t);var n,i=F(this._rangeReaders.slice(0));try{for(i.s();!(n=i.n()).done;)n.value.cancel(t)}catch(t){i.e(t)}finally{i.f()}this._pdfDataRangeTransport.abort()}}])}(),gs=function(){return B((function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;j(this,t),this._stream=e,this._done=i||!1,this._filename=Vt(a)?a:null,this._queuedChunks=n||[],this._loaded=0;var r,s=F(this._queuedChunks);try{for(s.s();!(r=s.n()).done;){var o=r.value;this._loaded+=o.byteLength}}catch(t){s.e(t)}finally{s.f()}this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}),[{key:"_enqueue",value:function(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}},{key:"headersReady",get:function(){return this._headersReady}},{key:"filename",get:function(){return this._filename}},{key:"isRangeSupported",get:function(){return this._stream._isRangeSupported}},{key:"isStreamingSupported",get:function(){return this._stream._isStreamingSupported}},{key:"contentLength",get:function(){return this._stream._contentLength}},{key:"read",value:(t=T(w().mark((function t(){var e,n;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(this._queuedChunks.length>0)){t.next=3;break}return e=this._queuedChunks.shift(),t.abrupt("return",{value:e,done:!1});case 3:if(!this._done){t.next=5;break}return t.abrupt("return",{value:void 0,done:!0});case 5:return n=Promise.withResolvers(),this._requests.push(n),t.abrupt("return",n.promise);case 8:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"cancel",value:function(t){this._done=!0;var e,n=F(this._requests);try{for(n.s();!(e=n.n()).done;)e.value.resolve({value:void 0,done:!0})}catch(t){n.e(t)}finally{n.f()}this._requests.length=0}},{key:"progressiveDone",value:function(){this._done||(this._done=!0)}}]);var t}(),ys=function(){return B((function t(e,n,i){j(this,t),this._stream=e,this._begin=n,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}),[{key:"_enqueue",value:function(t){if(!this._done){if(0===this._requests.length)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});var e,n=F(this._requests);try{for(n.s();!(e=n.n()).done;)e.value.resolve({value:void 0,done:!0})}catch(t){n.e(t)}finally{n.f()}this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}},{key:"isStreamingSupported",get:function(){return!1}},{key:"read",value:(t=T(w().mark((function t(){var e,n;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._queuedChunk){t.next=4;break}return e=this._queuedChunk,this._queuedChunk=null,t.abrupt("return",{value:e,done:!1});case 4:if(!this._done){t.next=6;break}return t.abrupt("return",{value:void 0,done:!0});case 6:return n=Promise.withResolvers(),this._requests.push(n),t.abrupt("return",n.promise);case 9:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"cancel",value:function(t){this._done=!0;var e,n=F(this._requests);try{for(n.s();!(e=n.n()).done;)e.value.resolve({value:void 0,done:!0})}catch(t){n.e(t)}finally{n.f()}this._requests.length=0,this._stream._removeRangeReader(this)}}]);var t}();function ms(t,e){var n=new Headers;if(!t||!e||"object"!==X(e))return n;for(var i in e){var a=e[i];void 0!==a&&n.append(i,a)}return n}function ks(t){try{return new URL(t).origin}catch(t){}return null}function bs(t){var e=t.responseHeaders,n=t.isHttp,i=t.rangeChunkSize,a=t.disableRange,r={allowRangeRequests:!1,suggestedLength:void 0},s=parseInt(e.get("Content-Length"),10);return Number.isInteger(s)?(r.suggestedLength=s,s<=2*i||a||!n||"bytes"!==e.get("Accept-Ranges")||"identity"!==(e.get("Content-Encoding")||"identity")||(r.allowRangeRequests=!0),r):r}function ws(t){var e=t.get("Content-Disposition");if(e){var n=function(t){var e=!0,n=r("filename\\*","i").exec(t);if(n){var i=l(n=n[1]);return o(i=u(i=h(i=unescape(i))))}if(n=function(t){for(var e,n=[],i=r("filename\\*((?!0\\d)\\d+)(\\*?)","ig");null!==(e=i.exec(t));){var a=I(e,4),s=a[1],o=a[2],u=a[3];if((s=parseInt(s,10))in n){if(0===s)break}else n[s]=[o,u]}for(var c=[],d=0;d<n.length&&d in n;++d){var f=I(n[d],2),v=f[0],p=f[1];p=l(p),v&&(p=unescape(p),0===d&&(p=h(p))),c.push(p)}return c.join("")}(t))return o(u(n));if(n=r("filename","i").exec(t)){var a=l(n=n[1]);return o(a=u(a))}function r(t,e){return new RegExp("(?:^|;)\\s*"+t+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',e)}function s(t,n){if(t){if(!/^[\x00-\xFF]+$/.test(n))return n;try{var i=new TextDecoder(t,{fatal:!0}),a=Mt(n);n=i.decode(a),e=!1}catch(t){}}return n}function o(t){return e&&/[\x80-\xff]/.test(t)&&(t=s("utf-8",t),e&&(t=s("iso-8859-1",t))),t}function l(t){if(t.startsWith('"')){for(var e=t.slice(1).split('\\"'),n=0;n<e.length;++n){var i=e[n].indexOf('"');-1!==i&&(e[n]=e[n].slice(0,i),e.length=n+1),e[n]=e[n].replaceAll(/\\(.)/g,"$1")}t=e.join('"')}return t}function h(t){var e=t.indexOf("'");return-1===e?t:s(t.slice(0,e),t.slice(e+1).replace(/^[^']*'/,""))}function u(t){return!t.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(t)?t:t.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,(function(t,e,n,i){if("q"===n||"Q"===n)return s(e,i=(i=i.replaceAll("_"," ")).replaceAll(/=([0-9a-fA-F]{2})/g,(function(t,e){return String.fromCharCode(parseInt(e,16))})));try{i=atob(i)}catch(t){}return s(e,i)}))}return""}(e);if(n.includes("%"))try{n=decodeURIComponent(n)}catch(t){}if(Vt(n))return n}return null}function As(t,e){return 404===t||0===t&&e.startsWith("file:")?new wt('Missing PDF "'+e+'".'):new At("Unexpected server response (".concat(t,') while retrieving PDF "').concat(e,'".'),t)}function _s(t){return 200===t||206===t}function xs(t,e,n){return{method:"GET",headers:t,signal:n.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function Ss(t){return t instanceof Uint8Array?t.buffer:t instanceof ArrayBuffer?t:(dt("getArrayBuffer - unexpected data format: ".concat(t)),new Uint8Array(t).buffer)}var Ms=function(){return B((function t(e){j(this,t),P(this,"_responseOrigin",null),this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=ms(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}),[{key:"_progressiveDataLength",get:function(){var t,e;return null!==(t=null===(e=this._fullRequestReader)||void 0===e?void 0:e._loaded)&&void 0!==t?t:0}},{key:"getFullReader",value:function(){return vt(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new Es(this),this._fullRequestReader}},{key:"getRangeReader",value:function(t,e){if(e<=this._progressiveDataLength)return null;var n=new Cs(this,t,e);return this._rangeRequestReaders.push(n),n}},{key:"cancelAllRequests",value:function(t){var e;null===(e=this._fullRequestReader)||void 0===e||e.cancel(t);var n,i=F(this._rangeRequestReaders.slice(0));try{for(i.s();!(n=i.n()).done;)n.value.cancel(t)}catch(t){i.e(t)}finally{i.f()}}}])}(),Es=function(){return B((function t(e){var n=this;j(this,t),this._stream=e,this._reader=null,this._loaded=0,this._filename=null;var i=e.source;this._withCredentials=i.withCredentials||!1,this._contentLength=i.length,this._headersCapability=Promise.withResolvers(),this._disableRange=i.disableRange||!1,this._rangeChunkSize=i.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!i.disableStream,this._isRangeSupported=!i.disableRange;var a=new Headers(e.headers),r=i.url;fetch(r,xs(a,this._withCredentials,this._abortController)).then((function(t){if(e._responseOrigin=ks(t.url),!_s(t.status))throw As(t.status,r);n._reader=t.body.getReader(),n._headersCapability.resolve();var i=t.headers,a=bs({responseHeaders:i,isHttp:e.isHttp,rangeChunkSize:n._rangeChunkSize,disableRange:n._disableRange}),s=a.allowRangeRequests,o=a.suggestedLength;n._isRangeSupported=s,n._contentLength=o||n._contentLength,n._filename=ws(i),!n._isStreamingSupported&&n._isRangeSupported&&n.cancel(new xt("Streaming is disabled."))})).catch(this._headersCapability.reject),this.onProgress=null}),[{key:"headersReady",get:function(){return this._headersCapability.promise}},{key:"filename",get:function(){return this._filename}},{key:"contentLength",get:function(){return this._contentLength}},{key:"isRangeSupported",get:function(){return this._isRangeSupported}},{key:"isStreamingSupported",get:function(){return this._isStreamingSupported}},{key:"read",value:(t=T(w().mark((function t(){var e,n,i,a;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._headersCapability.promise;case 2:return t.next=4,this._reader.read();case 4:if(n=t.sent,i=n.value,!(a=n.done)){t.next=9;break}return t.abrupt("return",{value:i,done:a});case 9:return this._loaded+=i.byteLength,null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:this._loaded,total:this._contentLength}),t.abrupt("return",{value:Ss(i),done:!1});case 12:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"cancel",value:function(t){var e;null===(e=this._reader)||void 0===e||e.cancel(t),this._abortController.abort()}}]);var t}(),Cs=function(){return B((function t(e,n,i){var a=this;j(this,t),this._stream=e,this._reader=null,this._loaded=0;var r=e.source;this._withCredentials=r.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!r.disableStream,this._abortController=new AbortController;var s=new Headers(e.headers);s.append("Range","bytes=".concat(n,"-").concat(i-1));var o=r.url;fetch(o,xs(s,this._withCredentials,this._abortController)).then((function(t){var n=ks(t.url);if(n!==e._responseOrigin)throw new Error('Expected range response-origin "'.concat(n,'" to match "').concat(e._responseOrigin,'".'));if(!_s(t.status))throw As(t.status,o);a._readCapability.resolve(),a._reader=t.body.getReader()})).catch(this._readCapability.reject),this.onProgress=null}),[{key:"isStreamingSupported",get:function(){return this._isStreamingSupported}},{key:"read",value:(t=T(w().mark((function t(){var e,n,i,a;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._readCapability.promise;case 2:return t.next=4,this._reader.read();case 4:if(n=t.sent,i=n.value,!(a=n.done)){t.next=9;break}return t.abrupt("return",{value:i,done:a});case 9:return this._loaded+=i.byteLength,null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:this._loaded}),t.abrupt("return",{value:Ss(i),done:!1});case 12:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"cancel",value:function(t){var e;null===(e=this._reader)||void 0===e||e.cancel(t),this._abortController.abort()}}]);var t}(),Ts=function(){return B((function t(e){var n=e.url,i=e.httpHeaders,a=e.withCredentials;j(this,t),P(this,"_responseOrigin",null),this.url=n,this.isHttp=/^https?:/i.test(n),this.headers=ms(this.isHttp,i),this.withCredentials=a||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}),[{key:"requestRange",value:function(t,e,n){var i={begin:t,end:e};for(var a in n)i[a]=n[a];return this.request(i)}},{key:"requestFull",value:function(t){return this.request(t)}},{key:"request",value:function(t){var e=new XMLHttpRequest,n=this.currXhrId++,i=this.pendingRequests[n]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;var a,r=F(this.headers);try{for(r.s();!(a=r.n()).done;){var s=I(a.value,2),o=s[0],l=s[1];e.setRequestHeader(o,l)}}catch(t){r.e(t)}finally{r.f()}return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range","bytes=".concat(t.begin,"-").concat(t.end-1)),i.expectedStatus=206):i.expectedStatus=200,e.responseType="arraybuffer",vt(t.onError,"Expected `onError` callback to be provided."),e.onerror=function(){t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,n),e.onprogress=this.onProgress.bind(this,n),i.onHeadersReceived=t.onHeadersReceived,i.onDone=t.onDone,i.onError=t.onError,i.onProgress=t.onProgress,e.send(null),n}},{key:"onProgress",value:function(t,e){var n,i=this.pendingRequests[t];i&&(null===(n=i.onProgress)||void 0===n||n.call(i,e))}},{key:"onStateChange",value:function(t,e){var n=this.pendingRequests[t];if(n){var i=n.xhr;if(i.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),4===i.readyState&&t in this.pendingRequests)if(delete this.pendingRequests[t],0===i.status&&this.isHttp)n.onError(i.status);else{var a=i.status||200;if(200===a&&206===n.expectedStatus||a===n.expectedStatus){var r=function(t){var e=t.response;return"string"!=typeof e?e:Mt(e).buffer}(i);if(206===a){var s=i.getResponseHeader("Content-Range"),o=/bytes (\d+)-(\d+)\/(\d+)/.exec(s);o?n.onDone({begin:parseInt(o[1],10),chunk:r}):(dt('Missing or invalid "Content-Range" header.'),n.onError(0))}else r?n.onDone({begin:0,chunk:r}):n.onError(i.status)}else n.onError(i.status)}}}},{key:"getRequestXhr",value:function(t){return this.pendingRequests[t].xhr}},{key:"isPendingRequest",value:function(t){return t in this.pendingRequests}},{key:"abortRequest",value:function(t){var e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}])}(),Ps=function(){return B((function t(e){j(this,t),this._source=e,this._manager=new Ts(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}),[{key:"_onRangeRequestReaderClosed",value:function(t){var e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}},{key:"getFullReader",value:function(){return vt(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Rs(this._manager,this._source),this._fullRequestReader}},{key:"getRangeReader",value:function(t,e){var n=new Is(this._manager,t,e);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}},{key:"cancelAllRequests",value:function(t){var e;null===(e=this._fullRequestReader)||void 0===e||e.cancel(t);var n,i=F(this._rangeRequestReaders.slice(0));try{for(i.s();!(n=i.n()).done;)n.value.cancel(t)}catch(t){i.e(t)}finally{i.f()}}}])}(),Rs=function(){return B((function t(e,n){j(this,t),this._manager=e;var i={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=n.url,this._fullRequestId=e.requestFull(i),this._headersCapability=Promise.withResolvers(),this._disableRange=n.disableRange||!1,this._contentLength=n.length,this._rangeChunkSize=n.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}),[{key:"_onHeadersReceived",value:function(){var t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=ks(e.responseURL);var n=e.getAllResponseHeaders(),i=new Headers(n?n.trim().split(/[\r\n]+/).map((function(t){var e,n=D(e=t.split(": "))||b(e)||N(e)||L();return[n[0],n.slice(1).join(": ")]})):[]),a=bs({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange}),r=a.allowRangeRequests,s=a.suggestedLength;r&&(this._isRangeSupported=!0),this._contentLength=s||this._contentLength,this._filename=ws(i),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}},{key:"_onDone",value:function(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){var e,n=F(this._requests);try{for(n.s();!(e=n.n()).done;)e.value.resolve({value:void 0,done:!0})}catch(t){n.e(t)}finally{n.f()}this._requests.length=0}}},{key:"_onError",value:function(t){this._storedError=As(t,this._url),this._headersCapability.reject(this._storedError);var e,n=F(this._requests);try{for(n.s();!(e=n.n()).done;)e.value.reject(this._storedError)}catch(t){n.e(t)}finally{n.f()}this._requests.length=0,this._cachedChunks.length=0}},{key:"_onProgress",value:function(t){var e;null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}},{key:"filename",get:function(){return this._filename}},{key:"isRangeSupported",get:function(){return this._isRangeSupported}},{key:"isStreamingSupported",get:function(){return this._isStreamingSupported}},{key:"contentLength",get:function(){return this._contentLength}},{key:"headersReady",get:function(){return this._headersCapability.promise}},{key:"read",value:(t=T(w().mark((function t(){var e,n;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._headersCapability.promise;case 2:if(!this._storedError){t.next=4;break}throw this._storedError;case 4:if(!(this._cachedChunks.length>0)){t.next=7;break}return e=this._cachedChunks.shift(),t.abrupt("return",{value:e,done:!1});case 7:if(!this._done){t.next=9;break}return t.abrupt("return",{value:void 0,done:!0});case 9:return n=Promise.withResolvers(),this._requests.push(n),t.abrupt("return",n.promise);case 12:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"cancel",value:function(t){this._done=!0,this._headersCapability.reject(t);var e,n=F(this._requests);try{for(n.s();!(e=n.n()).done;)e.value.resolve({value:void 0,done:!0})}catch(t){n.e(t)}finally{n.f()}this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}]);var t}(),Is=function(){return B((function t(e,n,i){j(this,t),this._manager=e;var a={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._requestId=e.requestRange(n,i,a),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}),[{key:"_onHeadersReceived",value:function(){var t,e=ks(null===(t=this._manager.getRequestXhr(this._requestId))||void 0===t?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error('Expected range response-origin "'.concat(e,'" to match "').concat(this._manager._responseOrigin,'".')),this._onError(0))}},{key:"_close",value:function(){var t;null===(t=this.onClosed)||void 0===t||t.call(this,this)}},{key:"_onDone",value:function(t){var e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;var n,i=F(this._requests);try{for(i.s();!(n=i.n()).done;)n.value.resolve({value:void 0,done:!0})}catch(t){i.e(t)}finally{i.f()}this._requests.length=0,this._close()}},{key:"_onError",value:function(t){var e;null!==(e=this._storedError)&&void 0!==e||(this._storedError=As(t,this._url));var n,i=F(this._requests);try{for(i.s();!(n=i.n()).done;)n.value.reject(this._storedError)}catch(t){i.e(t)}finally{i.f()}this._requests.length=0,this._queuedChunk=null}},{key:"_onProgress",value:function(t){var e;this.isStreamingSupported||null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:t.loaded})}},{key:"isStreamingSupported",get:function(){return!1}},{key:"read",value:(t=T(w().mark((function t(){var e,n;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._storedError){t.next=2;break}throw this._storedError;case 2:if(null===this._queuedChunk){t.next=6;break}return e=this._queuedChunk,this._queuedChunk=null,t.abrupt("return",{value:e,done:!1});case 6:if(!this._done){t.next=8;break}return t.abrupt("return",{value:void 0,done:!0});case 8:return n=Promise.withResolvers(),this._requests.push(n),t.abrupt("return",n.promise);case 11:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"cancel",value:function(t){this._done=!0;var e,n=F(this._requests);try{for(n.s();!(e=n.n()).done;)e.value.resolve({value:void 0,done:!0})}catch(t){n.e(t)}finally{n.f()}this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}]);var t}(),Ls=/^[a-z][a-z0-9\-+.]+:/i,Ds=function(){return B((function t(e){j(this,t),this.source=e,this.url=function(t){if(Ls.test(t))return new URL(t);var e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(t))}(e.url),vt("file:"===this.url.protocol,"PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}),[{key:"_progressiveDataLength",get:function(){var t,e;return null!==(t=null===(e=this._fullRequestReader)||void 0===e?void 0:e._loaded)&&void 0!==t?t:0}},{key:"getFullReader",value:function(){return vt(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Fs(this),this._fullRequestReader}},{key:"getRangeReader",value:function(t,e){if(e<=this._progressiveDataLength)return null;var n=new Ns(this,t,e);return this._rangeRequestReaders.push(n),n}},{key:"cancelAllRequests",value:function(t){var e;null===(e=this._fullRequestReader)||void 0===e||e.cancel(t);var n,i=F(this._rangeRequestReaders.slice(0));try{for(i.s();!(n=i.n()).done;)n.value.cancel(t)}catch(t){i.e(t)}finally{i.f()}}}])}(),Fs=function(){return B((function t(e){var n=this;j(this,t),this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;var i=e.source;this._contentLength=i.length,this._loaded=0,this._filename=null,this._disableRange=i.disableRange||!1,this._rangeChunkSize=i.rangeChunkSize,this._rangeChunkSize||this._disableRange||(this._disableRange=!0),this._isStreamingSupported=!i.disableStream,this._isRangeSupported=!i.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();var a=process.getBuiltinModule("fs");a.promises.lstat(this._url).then((function(t){n._contentLength=t.size,n._setReadableStream(a.createReadStream(n._url)),n._headersCapability.resolve()}),(function(t){"ENOENT"===t.code&&(t=new wt('Missing PDF "'.concat(n._url,'".'))),n._storedError=t,n._headersCapability.reject(t)}))}),[{key:"headersReady",get:function(){return this._headersCapability.promise}},{key:"filename",get:function(){return this._filename}},{key:"contentLength",get:function(){return this._contentLength}},{key:"isRangeSupported",get:function(){return this._isRangeSupported}},{key:"isStreamingSupported",get:function(){return this._isStreamingSupported}},{key:"read",value:(t=T(w().mark((function t(){var e,n,i;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._readCapability.promise;case 2:if(!this._done){t.next=4;break}return t.abrupt("return",{value:void 0,done:!0});case 4:if(!this._storedError){t.next=6;break}throw this._storedError;case 6:if(null!==(n=this._readableStream.read())){t.next=10;break}return this._readCapability=Promise.withResolvers(),t.abrupt("return",this.read());case 10:return this._loaded+=n.length,null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:this._loaded,total:this._contentLength}),i=new Uint8Array(n).buffer,t.abrupt("return",{value:i,done:!1});case 14:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"cancel",value:function(t){this._readableStream?this._readableStream.destroy(t):this._error(t)}},{key:"_error",value:function(t){this._storedError=t,this._readCapability.resolve()}},{key:"_setReadableStream",value:function(t){var e=this;this._readableStream=t,t.on("readable",(function(){e._readCapability.resolve()})),t.on("end",(function(){t.destroy(),e._done=!0,e._readCapability.resolve()})),t.on("error",(function(t){e._error(t)})),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new xt("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}]);var t}(),Ns=function(){return B((function t(e,n,i){j(this,t),this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();var a=e.source;this._isStreamingSupported=!a.disableStream;var r=process.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:n,end:i-1}))}),[{key:"isStreamingSupported",get:function(){return this._isStreamingSupported}},{key:"read",value:(t=T(w().mark((function t(){var e,n,i;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._readCapability.promise;case 2:if(!this._done){t.next=4;break}return t.abrupt("return",{value:void 0,done:!0});case 4:if(!this._storedError){t.next=6;break}throw this._storedError;case 6:if(null!==(n=this._readableStream.read())){t.next=10;break}return this._readCapability=Promise.withResolvers(),t.abrupt("return",this.read());case 10:return this._loaded+=n.length,null===(e=this.onProgress)||void 0===e||e.call(this,{loaded:this._loaded}),i=new Uint8Array(n).buffer,t.abrupt("return",{value:i,done:!1});case 14:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"cancel",value:function(t){this._readableStream?this._readableStream.destroy(t):this._error(t)}},{key:"_error",value:function(t){this._storedError=t,this._readCapability.resolve()}},{key:"_setReadableStream",value:function(t){var e=this;this._readableStream=t,t.on("readable",(function(){e._readCapability.resolve()})),t.on("end",(function(){t.destroy(),e._done=!0,e._readCapability.resolve()})),t.on("error",(function(t){e._error(t)})),this._storedError&&this._readableStream.destroy(this._storedError)}}]);var t}(),Os=30,Ws=new WeakMap,Bs=new WeakMap,Hs=new WeakMap,js=new WeakMap,zs=new WeakMap,Gs=new WeakMap,Vs=new WeakMap,Us=new WeakMap,qs=new WeakMap,Xs=new WeakMap,Ys=new WeakMap,Ks=new WeakMap,Qs=new WeakMap,Js=new WeakMap,Zs=new WeakMap,$s=new WeakMap,to=new WeakMap,eo=new WeakMap,no=new WeakSet,io=function(){function t(e){var n,i=this,a=e.textContentSource,r=e.container,s=e.viewport;if(j(this,t),A(this,no),_(this,Ws,Promise.withResolvers()),_(this,Bs,null),_(this,Hs,!1),_(this,js,!(null===(n=globalThis.FontInspector)||void 0===n||!n.enabled)),_(this,zs,null),_(this,Gs,null),_(this,Vs,0),_(this,Us,0),_(this,qs,null),_(this,Xs,null),_(this,Ys,0),_(this,Ks,0),_(this,Qs,Object.create(null)),_(this,Js,[]),_(this,Zs,null),_(this,$s,[]),_(this,to,new WeakMap),_(this,eo,null),a instanceof ReadableStream)E(Zs,this,a);else{if("object"!==X(a))throw new Error('No "textContentSource" parameter specified.');E(Zs,this,new ReadableStream({start:function(t){t.enqueue(a),t.close()}}))}E(Bs,this,E(Xs,this,r)),E(Ks,this,s.scale*(globalThis.devicePixelRatio||1)),E(Ys,this,s.rotation),E(Gs,this,{div:null,properties:null,ctx:null});var o=s.rawDims,l=o.pageWidth,h=o.pageHeight,u=o.pageX,c=o.pageY;E(eo,this,[1,0,0,-1,-u,c+h]),E(Us,this,l),E(Vs,this,h),ho.call(t),ae(r,s),M(Ws,this).promise.finally((function(){go._.delete(i),E(Gs,i,null),E(Qs,i,null)})).catch((function(){}))}return B(t,[{key:"render",value:function(){var t=this,e=function(){M(qs,t).read().then((function(n){var i,a=n.value;n.done?M(Ws,t).resolve():(null!==(i=M(zs,t))&&void 0!==i||E(zs,t,a.lang),Object.assign(M(Qs,t),a.styles),R(no,t,ao).call(t,a.items),e())}),M(Ws,t).reject)};return E(qs,this,M(Zs,this).getReader()),go._.add(this),e(),M(Ws,this).promise}},{key:"update",value:function(e){var n=e.viewport,i=e.onBefore,a=void 0===i?null:i,r=n.scale*(globalThis.devicePixelRatio||1),s=n.rotation;if(s!==M(Ys,this)&&(null==a||a(),E(Ys,this,s),ae(M(Xs,this),{rotation:s})),r!==M(Ks,this)){null==a||a(),E(Ks,this,r);var o,l={div:null,properties:null,ctx:oo.call(t,M(zs,this))},h=F(M($s,this));try{for(h.s();!(o=h.n()).done;){var u=o.value;l.properties=M(to,this).get(u),l.div=u,R(no,this,so).call(this,l)}}catch(t){h.e(t)}finally{h.f()}}}},{key:"cancel",value:function(){var t,e=new xt("TextLayer task cancelled.");null===(t=M(qs,this))||void 0===t||t.cancel(e).catch((function(){})),E(qs,this,null),M(Ws,this).reject(e)}},{key:"textDivs",get:function(){return M($s,this)}},{key:"textContentItemsStr",get:function(){return M(Js,this)}}],[{key:"fontFamilyMap",get:function(){var t=Ct.platform,e=t.isWindows,n=t.isFirefox;return gt(this,"fontFamilyMap",new Map([["sans-serif","".concat(e&&n?"Calibri, ":"","sans-serif")],["monospace","".concat(e&&n?"Lucida Console, ":"","monospace")]]))}},{key:"cleanup",value:function(){if(!(R(t,this,go)._.size>0)){R(t,this,co)._.clear();var e,n=F(R(t,this,fo)._.values());try{for(n.s();!(e=n.n()).done;)e.value.canvas.remove()}catch(t){n.e(t)}finally{n.f()}R(t,this,fo)._.clear()}}}])}();function ao(t){var e,n;if(!M(Hs,this)){null!==(n=(e=M(Gs,this)).ctx)&&void 0!==n||(e.ctx=oo.call(a,M(zs,this)));var i,r=M($s,this),s=M(Js,this),o=F(t);try{for(o.s();!(i=o.n()).done;){var l=i.value;if(r.length>1e5)return dt("Ignoring additional textDivs for performance reasons."),void E(Hs,this,!0);if(void 0!==l.str)s.push(l.str),R(no,this,ro).call(this,l);else if("beginMarkedContentProps"===l.type||"beginMarkedContent"===l.type){var h=M(Bs,this);E(Bs,this,document.createElement("span")),M(Bs,this).classList.add("markedContent"),null!==l.id&&M(Bs,this).setAttribute("id","".concat(l.id)),h.append(M(Bs,this))}else"endMarkedContent"===l.type&&E(Bs,this,M(Bs,this).parentNode)}}catch(t){o.e(t)}finally{o.f()}}}function ro(t){var e=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:""!==t.str,hasEOL:t.hasEOL,fontSize:0};M($s,this).push(e);var i=Pt.transform(M(eo,this),t.transform),r=Math.atan2(i[1],i[0]),s=M(Qs,this)[t.fontName];s.vertical&&(r+=Math.PI/2);var o=M(js,this)&&s.fontSubstitution||s.fontFamily;o=a.fontFamilyMap.get(o)||o;var l,h,u=Math.hypot(i[2],i[3]),c=u*uo.call(a,o,M(zs,this));0===r?(l=i[4],h=i[5]-c):(l=i[4]+c*Math.sin(r),h=i[5]-c*Math.cos(r));var d="calc(var(--scale-factor)*",f=e.style;M(Bs,this)===M(Xs,this)?(f.left="".concat((100*l/M(Us,this)).toFixed(2),"%"),f.top="".concat((100*h/M(Vs,this)).toFixed(2),"%")):(f.left="".concat(d).concat(l.toFixed(2),"px)"),f.top="".concat(d).concat(h.toFixed(2),"px)")),f.fontSize="".concat(d).concat((po._*u).toFixed(2),"px)"),f.fontFamily=o,n.fontSize=u,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,M(js,this)&&(e.dataset.fontName=s.fontSubstitutionLoadedName||t.fontName),0!==r&&(n.angle=r*(180/Math.PI));var v=!1;if(t.str.length>1)v=!0;else if(" "!==t.str&&t.transform[0]!==t.transform[3]){var p=Math.abs(t.transform[0]),g=Math.abs(t.transform[3]);p!==g&&Math.max(p,g)/Math.min(p,g)>1.5&&(v=!0)}if(v&&(n.canvasWidth=s.vertical?t.height:t.width),M(to,this).set(e,n),M(Gs,this).div=e,M(Gs,this).properties=n,R(no,this,so).call(this,M(Gs,this)),n.hasText&&M(Bs,this).append(e),n.hasEOL){var y=document.createElement("br");y.setAttribute("role","presentation"),M(Bs,this).append(y)}}function so(t){var e=t.div,n=t.properties,i=t.ctx,r=e.style,s="";if(po._>1&&(s="scale(".concat(1/po._,")")),0!==n.canvasWidth&&n.hasText){var o=r.fontFamily,l=n.canvasWidth,h=n.fontSize;lo.call(a,i,h*M(Ks,this),o);var u=i.measureText(e.textContent).width;u>0&&(s="scaleX(".concat(l*M(Ks,this)/u,") ").concat(s))}0!==n.angle&&(s="rotate(".concat(n.angle,"deg) ").concat(s)),s.length>0&&(r.transform=s)}function oo(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=R(a,this,fo)._.get(t||(t=""));if(!e){var n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=t,document.body.append(n),e=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),R(a,this,fo)._.set(t,e),R(a,this,vo)._.set(e,{size:0,family:""})}return e}function lo(t,e,n){var i=R(a,this,vo)._.get(t);e===i.size&&n===i.family||(t.font="".concat(e,"px ").concat(n),i.size=e,i.family=n)}function ho(){if(null===R(a,this,po)._){var t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),po._=R(a,this,t.getBoundingClientRect().height),t.remove()}}function uo(t,e){var n=R(a,this,co)._.get(t);if(n)return n;var i=R(a,this,oo).call(this,e);i.canvas.width=i.canvas.height=Os,R(a,this,lo).call(this,i,Os,t);var r=i.measureText(""),s=r.fontBoundingBoxAscent,o=Math.abs(r.fontBoundingBoxDescent);if(s){var l=s/(s+o);return R(a,this,co)._.set(t,l),i.canvas.width=i.canvas.height=0,l}i.strokeStyle="red",i.clearRect(0,0,Os,Os),i.strokeText("g",0,0);var h=i.getImageData(0,0,Os,Os).data;o=0;for(var u=h.length-1-3;u>=0;u-=4)if(h[u]>0){o=Math.ceil(u/4/Os);break}i.clearRect(0,0,Os,Os),i.strokeText("A",0,Os),s=0;for(var c=0,d=(h=i.getImageData(0,0,Os,Os).data).length;c<d;c+=4)if(h[c]>0){s=Os-Math.floor(c/4/Os);break}i.canvas.width=i.canvas.height=0;var f=s?s/(s+o):.8;return R(a,this,co)._.set(t,f),f}a=io;var co={_:new Map},fo={_:new Map},vo={_:new WeakMap},po={_:null},go={_:new Set},yo=function(){function t(){j(this,t)}return B(t,null,[{key:"textContent",value:function(e){var n=[],i={items:n,styles:Object.create(null)};return function e(i){var a;if(i){var r=null,s=i.name;if("#text"===s)r=i.value;else{if(!t.shouldBuildText(s))return;null!=i&&null!==(a=i.attributes)&&void 0!==a&&a.textContent?r=i.attributes.textContent:i.value&&(r=i.value)}if(null!==r&&n.push({str:r}),i.children){var o,l=F(i.children);try{for(l.s();!(o=l.n()).done;)e(o.value)}catch(t){l.e(t)}finally{l.f()}}}}(e),i}},{key:"shouldBuildText",value:function(t){return!("textarea"===t||"input"===t||"option"===t||"select"===t)}}])}(),mo=65536,ko=Q?sr:Pa,bo=Q?or:Ia,wo=Q?rr:za,Ao=Q?lr:nr;function _o(){var t,e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"string"==typeof n||n instanceof URL?n={url:n}:(n instanceof ArrayBuffer||ArrayBuffer.isView(n))&&(n={data:n});var i=new So,a=i.docId,r=n.url?function(t){if(t instanceof URL)return t.href;try{return new URL(t,window.location).href}catch(e){if(Q&&"string"==typeof t)return t}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}(n.url):null,s=n.data?function(t){if(Q&&"undefined"!=typeof Buffer&&t instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength)return t;if("string"==typeof t)return Mt(t);if(t instanceof ArrayBuffer||ArrayBuffer.isView(t)||"object"===X(t)&&!isNaN(null==t?void 0:t.length))return new Uint8Array(t);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}(n.data):null,o=n.httpHeaders||null,l=!0===n.withCredentials,h=null!==(t=n.password)&&void 0!==t?t:null,u=n.range instanceof Eo?n.range:null,c=Number.isInteger(n.rangeChunkSize)&&n.rangeChunkSize>0?n.rangeChunkSize:mo,d=n.worker instanceof Bo?n.worker:null,f=n.verbosity,v="string"!=typeof n.docBaseUrl||Gt(n.docBaseUrl)?null:n.docBaseUrl,p="string"==typeof n.cMapUrl?n.cMapUrl:null,g=!1!==n.cMapPacked,y=n.CMapReaderFactory||bo,m="string"==typeof n.standardFontDataUrl?n.standardFontDataUrl:null,k=n.StandardFontDataFactory||Ao,b=!0!==n.stopAtErrors,w=Number.isInteger(n.maxImageSize)&&n.maxImageSize>-1?n.maxImageSize:-1,A=!1!==n.isEvalSupported,_="boolean"==typeof n.isOffscreenCanvasSupported?n.isOffscreenCanvasSupported:!Q,x="boolean"==typeof n.isImageDecoderSupported?n.isImageDecoderSupported:!Q&&(Ct.platform.isFirefox||!globalThis.chrome),S=Number.isInteger(n.canvasMaxAreaInBytes)?n.canvasMaxAreaInBytes:-1,M="boolean"==typeof n.disableFontFace?n.disableFontFace:Q,E=!0===n.fontExtraProperties,C=!0===n.enableXfa,T=n.ownerDocument||globalThis.document,P=!0===n.disableRange,R=!0===n.disableStream,I=!0===n.disableAutoFetch,L=!0===n.pdfBug,D=n.CanvasFactory||ko,F=n.FilterFactory||wo,N=!0===n.enableHWA,O=u?u.length:null!==(e=n.length)&&void 0!==e?e:NaN,W="boolean"==typeof n.useSystemFonts?n.useSystemFonts:!Q&&!M,B="boolean"==typeof n.useWorkerFetch?n.useWorkerFetch:y===Ia&&k===nr&&p&&m&&Yt(p,document.baseURI)&&Yt(m,document.baseURI);n.canvasFactory&&Jt("`canvasFactory`-instance option, please use `CanvasFactory` instead."),n.filterFactory&&Jt("`filterFactory`-instance option, please use `FilterFactory` instead."),ht(f);var H={canvasFactory:new D({ownerDocument:T,enableHWA:N}),filterFactory:new F({docId:a,ownerDocument:T}),cMapReaderFactory:B?null:new y({baseUrl:p,isCompressed:g}),standardFontDataFactory:B?null:new k({baseUrl:m})};if(!d){var j={verbosity:f,port:Hr.workerPort};d=j.port?Bo.fromPort(j):new Bo(j),i._worker=d}var z={docId:a,apiVersion:"4.9.206",data:s,password:h,disableAutoFetch:I,rangeChunkSize:c,length:O,docBaseUrl:v,enableXfa:C,evaluatorOptions:{maxImageSize:w,disableFontFace:M,ignoreErrors:b,isEvalSupported:A,isOffscreenCanvasSupported:_,isImageDecoderSupported:x,canvasMaxAreaInBytes:S,fontExtraProperties:E,useSystemFonts:W,cMapUrl:B?p:null,standardFontDataUrl:B?m:null}},G={disableFontFace:M,fontExtraProperties:E,ownerDocument:T,pdfBug:L,styleElement:null,loadingParams:{disableAutoFetch:I,enableXfa:C}};return d.promise.then((function(){if(i.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");var t,e=d.messageHandler.sendWithPromise("GetDocRequest",z,s?[s.buffer]:null);if(u)t=new ps(u,{disableRange:P,disableStream:R});else if(!s){if(!r)throw new Error("getDocument - no `url` parameter provided.");var n;if(Q)if(Yt(r)){if("undefined"==typeof fetch||"undefined"==typeof Response||!("body"in Response.prototype))throw new Error("getDocument - the Fetch API was disabled in Node.js, see `--no-experimental-fetch`.");n=Ms}else n=Ds;else n=Yt(r)?Ms:Ps;t=new n({url:r,length:O,httpHeaders:o,withCredentials:l,rangeChunkSize:c,disableRange:P,disableStream:R})}return e.then((function(e){if(i.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");var n=new Xr(a,e,d.port),r=new Jo(n,i,t,G,H);i._transport=r,n.send("Ready",null)}))})).catch(i._capability.reject),i}function xo(t){return"object"===X(t)&&Number.isInteger(null==t?void 0:t.num)&&t.num>=0&&Number.isInteger(null==t?void 0:t.gen)&&t.gen>=0}var So=function(){return B((function t(){var e,n;j(this,t),this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId="d".concat((Mo._=(e=Mo._,n=e++,e),n)),this.destroyed=!1,this.onPassword=null,this.onProgress=null}),[{key:"promise",get:function(){return this._capability.promise}},{key:"destroy",value:(t=T(w().mark((function t(){var e,n,i,a;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.destroyed=!0,t.prev=1,null!==(n=this._worker)&&void 0!==n&&n.port&&(this._worker._pendingDestroy=!0),t.next=5,null===(i=this._transport)||void 0===i?void 0:i.destroy();case 5:t.next=11;break;case 7:throw t.prev=7,t.t0=t.catch(1),null!==(a=this._worker)&&void 0!==a&&a.port&&delete this._worker._pendingDestroy,t.t0;case 11:this._transport=null,null===(e=this._worker)||void 0===e||e.destroy(),this._worker=null;case 14:case"end":return t.stop()}}),t,this,[[1,7]])}))),function(){return t.apply(this,arguments)})}]);var t}(),Mo={_:0},Eo=function(){return B((function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;j(this,t),this.length=e,this.initialData=n,this.progressiveDone=i,this.contentDispositionFilename=a,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}),[{key:"addRangeListener",value:function(t){this._rangeListeners.push(t)}},{key:"addProgressListener",value:function(t){this._progressListeners.push(t)}},{key:"addProgressiveReadListener",value:function(t){this._progressiveReadListeners.push(t)}},{key:"addProgressiveDoneListener",value:function(t){this._progressiveDoneListeners.push(t)}},{key:"onDataRange",value:function(t,e){var n,i=F(this._rangeListeners);try{for(i.s();!(n=i.n()).done;)(0,n.value)(t,e)}catch(t){i.e(t)}finally{i.f()}}},{key:"onDataProgress",value:function(t,e){var n=this;this._readyCapability.promise.then((function(){var i,a=F(n._progressListeners);try{for(a.s();!(i=a.n()).done;)(0,i.value)(t,e)}catch(t){a.e(t)}finally{a.f()}}))}},{key:"onDataProgressiveRead",value:function(t){var e=this;this._readyCapability.promise.then((function(){var n,i=F(e._progressiveReadListeners);try{for(i.s();!(n=i.n()).done;)(0,n.value)(t)}catch(t){i.e(t)}finally{i.f()}}))}},{key:"onDataProgressiveDone",value:function(){var t=this;this._readyCapability.promise.then((function(){var e,n=F(t._progressiveDoneListeners);try{for(n.s();!(e=n.n()).done;)(0,e.value)()}catch(t){n.e(t)}finally{n.f()}}))}},{key:"transportReady",value:function(){this._readyCapability.resolve()}},{key:"requestDataRange",value:function(t,e){ft("Abstract method PDFDataRangeTransport.requestDataRange")}},{key:"abort",value:function(){}}])}(),Co=function(){return B((function t(e,n){j(this,t),this._pdfInfo=e,this._transport=n}),[{key:"annotationStorage",get:function(){return this._transport.annotationStorage}},{key:"canvasFactory",get:function(){return this._transport.canvasFactory}},{key:"filterFactory",get:function(){return this._transport.filterFactory}},{key:"numPages",get:function(){return this._pdfInfo.numPages}},{key:"fingerprints",get:function(){return this._pdfInfo.fingerprints}},{key:"isPureXfa",get:function(){return gt(this,"isPureXfa",!!this._transport._htmlForXfa)}},{key:"allXfaHtml",get:function(){return this._transport._htmlForXfa}},{key:"getPage",value:function(t){return this._transport.getPage(t)}},{key:"getPageIndex",value:function(t){return this._transport.getPageIndex(t)}},{key:"getDestinations",value:function(){return this._transport.getDestinations()}},{key:"getDestination",value:function(t){return this._transport.getDestination(t)}},{key:"getPageLabels",value:function(){return this._transport.getPageLabels()}},{key:"getPageLayout",value:function(){return this._transport.getPageLayout()}},{key:"getPageMode",value:function(){return this._transport.getPageMode()}},{key:"getViewerPreferences",value:function(){return this._transport.getViewerPreferences()}},{key:"getOpenAction",value:function(){return this._transport.getOpenAction()}},{key:"getAttachments",value:function(){return this._transport.getAttachments()}},{key:"getJSActions",value:function(){return this._transport.getDocJSActions()}},{key:"getOutline",value:function(){return this._transport.getOutline()}},{key:"getOptionalContentConfig",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).intent,e=void 0===t?"display":t,n=this._transport.getRenderingIntent(e).renderingIntent;return this._transport.getOptionalContentConfig(n)}},{key:"getPermissions",value:function(){return this._transport.getPermissions()}},{key:"getMetadata",value:function(){return this._transport.getMetadata()}},{key:"getMarkInfo",value:function(){return this._transport.getMarkInfo()}},{key:"getData",value:function(){return this._transport.getData()}},{key:"saveDocument",value:function(){return this._transport.saveDocument()}},{key:"getDownloadInfo",value:function(){return this._transport.downloadInfoCapability.promise}},{key:"cleanup",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._transport.startCleanup(t||this.isPureXfa)}},{key:"destroy",value:function(){return this.loadingTask.destroy()}},{key:"cachedPageNumber",value:function(t){return this._transport.cachedPageNumber(t)}},{key:"loadingParams",get:function(){return this._transport.loadingParams}},{key:"loadingTask",get:function(){return this._transport.loadingTask}},{key:"getFieldObjects",value:function(){return this._transport.getFieldObjects()}},{key:"hasJSActions",value:function(){return this._transport.hasJSActions()}},{key:"getCalculationOrderIds",value:function(){return this._transport.getCalculationOrderIds()}}])}(),To=new WeakMap,Po=new WeakMap,Ro=new WeakSet,Io=function(){return B((function t(e,n,i){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];j(this,t),A(this,Ro),_(this,To,null),_(this,Po,!1),this._pageIndex=e,this._pageInfo=n,this._transport=i,this._stats=a?new Xt:null,this._pdfBug=a,this.commonObjs=i.commonObjs,this.objs=new nl,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}),[{key:"pageNumber",get:function(){return this._pageIndex+1}},{key:"rotate",get:function(){return this._pageInfo.rotate}},{key:"ref",get:function(){return this._pageInfo.ref}},{key:"userUnit",get:function(){return this._pageInfo.userUnit}},{key:"view",get:function(){return this._pageInfo.view}},{key:"getViewport",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.scale,n=t.rotation,i=void 0===n?this.rotate:n,a=t.offsetX,r=void 0===a?0:a,s=t.offsetY,o=void 0===s?0:s,l=t.dontFlip,h=void 0!==l&&l;return new jt({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:i,offsetX:r,offsetY:o,dontFlip:h})}},{key:"getAnnotations",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).intent,e=void 0===t?"display":t,n=this._transport.getRenderingIntent(e).renderingIntent;return this._transport.getAnnotations(this._pageIndex,n)}},{key:"getJSActions",value:function(){return this._transport.getPageJSActions(this._pageIndex)}},{key:"filterFactory",get:function(){return this._transport.filterFactory}},{key:"isPureXfa",get:function(){return gt(this,"isPureXfa",!!this._transport._htmlForXfa)}},{key:"getXfa",value:(t=T(w().mark((function t(){var e;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(null===(e=this._transport._htmlForXfa)||void 0===e?void 0:e.children[this._pageIndex])||null);case 1:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})},{key:"render",value:function(t){var e,n,i=this,a=t.canvasContext,r=t.viewport,s=t.intent,o=void 0===s?"display":s,l=t.annotationMode,h=void 0===l?tt.ENABLE:l,u=t.transform,c=void 0===u?null:u,d=t.background,f=void 0===d?null:d,v=t.optionalContentConfigPromise,p=void 0===v?null:v,g=t.annotationCanvasMap,y=void 0===g?null:g,m=t.pageColors,k=void 0===m?null:m,b=t.printAnnotationStorage,w=void 0===b?null:b,A=t.isEditing,_=void 0!==A&&A;null===(e=this._stats)||void 0===e||e.time("Overall");var x=this._transport.getRenderingIntent(o,h,w,_),S=x.renderingIntent,M=x.cacheKey;E(Po,this,!1),R(Ro,this,Do).call(this),p||(p=this._transport.getOptionalContentConfig(S));var C=this._intentStates.get(M);C||(C=Object.create(null),this._intentStates.set(M,C)),C.streamReaderCancelTimeout&&(clearTimeout(C.streamReaderCancelTimeout),C.streamReaderCancelTimeout=null);var T,P=!!(4&S);C.displayReadyCapability||(C.displayReadyCapability=Promise.withResolvers(),C.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},null===(T=this._stats)||void 0===T||T.time("Page Request"),this._pumpOperatorList(x));var L=function(t){var e;C.renderTasks.delete(D),(i._maybeCleanupAfterRender||P)&&E(Po,i,!0),R(Ro,i,Lo).call(i,!P),t?(D.capability.reject(t),i._abortOperatorList({intentState:C,reason:t instanceof Error?t:new Error(t)})):D.capability.resolve(),i._stats&&(i._stats.timeEnd("Rendering"),i._stats.timeEnd("Overall"),null!==(e=globalThis.Stats)&&void 0!==e&&e.enabled&&globalThis.Stats.add(i.pageNumber,i._stats))},D=new ol({callback:L,params:{canvasContext:a,viewport:r,transform:c,background:f},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:y,operatorList:C.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!P,pdfBug:this._pdfBug,pageColors:k});((n=C).renderTasks||(n.renderTasks=new Set)).add(D);var F=D.task;return Promise.all([C.displayReadyCapability.promise,p]).then((function(t){var e,n=I(t,2),a=n[0],r=n[1];if(i.destroyed)L();else{if(null===(e=i._stats)||void 0===e||e.time("Rendering"),!(r.renderingIntent&S))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");D.initializeGraphics({transparency:a,optionalContentConfig:r}),D.operatorListChanged()}})).catch(L),F}},{key:"getOperatorList",value:function(){var t,e,n,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=i.intent,r=void 0===a?"display":a,s=i.annotationMode,o=void 0===s?tt.ENABLE:s,l=i.printAnnotationStorage,h=void 0===l?null:l,u=i.isEditing,c=void 0!==u&&u,d=this._transport.getRenderingIntent(r,o,h,c,!0),f=this._intentStates.get(d.cacheKey);return f||(f=Object.create(null),this._intentStates.set(d.cacheKey,f)),f.opListReadCapability||((t=Object.create(null)).operatorListChanged=function(){f.operatorList.lastChunk&&(f.opListReadCapability.resolve(f.operatorList),f.renderTasks.delete(t))},f.opListReadCapability=Promise.withResolvers(),((e=f).renderTasks||(e.renderTasks=new Set)).add(t),f.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},null===(n=this._stats)||void 0===n||n.time("Page Request"),this._pumpOperatorList(d)),f.opListReadCapability.promise}},{key:"streamTextContent",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.includeMarkedContent,n=void 0!==e&&e,i=t.disableNormalization,a=void 0!==i&&i;return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:!0===n,disableNormalization:!0===a},{highWaterMark:100,size:function(t){return t.items.length}})}},{key:"getTextContent",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._transport._htmlForXfa)return this.getXfa().then((function(t){return yo.textContent(t)}));var e=this.streamTextContent(t);return new Promise((function(t,n){var i=e.getReader(),a={items:[],styles:Object.create(null),lang:null};!function e(){i.read().then((function(n){var i,r,s=n.value;n.done?t(a):(null!==(i=a.lang)&&void 0!==i||(a.lang=s.lang),Object.assign(a.styles,s.styles),(r=a.items).push.apply(r,k(s.items)),e())}),n)}()}))}},{key:"getStructTree",value:function(){return this._transport.getStructTree(this._pageIndex)}},{key:"_destroy",value:function(){this.destroyed=!0;var t,e=[],n=F(this._intentStates.values());try{for(n.s();!(t=n.n()).done;){var i=t.value;if(this._abortOperatorList({intentState:i,reason:new Error("Page was destroyed."),force:!0}),!i.opListReadCapability){var a,r=F(i.renderTasks);try{for(r.s();!(a=r.n()).done;){var s=a.value;e.push(s.completed),s.cancel()}}catch(t){r.e(t)}finally{r.f()}}}}catch(t){n.e(t)}finally{n.f()}return this.objs.clear(),E(Po,this,!1),R(Ro,this,Do).call(this),Promise.all(e)}},{key:"cleanup",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];E(Po,this,!0);var e=R(Ro,this,Lo).call(this,!1);return t&&e&&this._stats&&(this._stats=new Xt),e}},{key:"_startRenderPage",value:function(t,e){var n,i,a=this._intentStates.get(e);a&&(null===(n=this._stats)||void 0===n||n.timeEnd("Page Request"),null===(i=a.displayReadyCapability)||void 0===i||i.resolve(t))}},{key:"_renderPageChunk",value:function(t,e){for(var n=0,i=t.length;n<i;n++)e.operatorList.fnArray.push(t.fnArray[n]),e.operatorList.argsArray.push(t.argsArray[n]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;var a,r=F(e.renderTasks);try{for(r.s();!(a=r.n()).done;)a.value.operatorListChanged()}catch(t){r.e(t)}finally{r.f()}t.lastChunk&&R(Ro,this,Lo).call(this,!0)}},{key:"_pumpOperatorList",value:function(t){var e=this,n=t.renderingIntent,i=t.cacheKey,a=t.annotationStorageSerializable,r=t.modifiedIds,s=a.map,o=a.transfer,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:n,cacheKey:i,annotationStorage:s,modifiedIds:r},o).getReader(),h=this._intentStates.get(i);h.streamReader=l;var u=function(){l.read().then((function(t){var n=t.value;t.done?h.streamReader=null:e._transport.destroyed||(e._renderPageChunk(n,h),u())}),(function(t){if(h.streamReader=null,!e._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;var n,i=F(h.renderTasks);try{for(i.s();!(n=i.n()).done;)n.value.operatorListChanged()}catch(t){i.e(t)}finally{i.f()}R(Ro,e,Lo).call(e,!0)}if(h.displayReadyCapability)h.displayReadyCapability.reject(t);else{if(!h.opListReadCapability)throw t;h.opListReadCapability.reject(t)}}}))};u()}},{key:"_abortOperatorList",value:function(t){var e=this,n=t.intentState,i=t.reason,a=t.force,r=void 0!==a&&a;if(n.streamReader){if(n.streamReaderCancelTimeout&&(clearTimeout(n.streamReaderCancelTimeout),n.streamReaderCancelTimeout=null),!r){if(n.renderTasks.size>0)return;if(i instanceof zt){var s=100;return i.extraDelay>0&&i.extraDelay<1e3&&(s+=i.extraDelay),void(n.streamReaderCancelTimeout=setTimeout((function(){n.streamReaderCancelTimeout=null,e._abortOperatorList({intentState:n,reason:i,force:!0})}),s))}}if(n.streamReader.cancel(new xt(i.message)).catch((function(){})),n.streamReader=null,!this._transport.destroyed){var o,l=F(this._intentStates);try{for(l.s();!(o=l.n()).done;){var h=I(o.value,2),u=h[0];if(h[1]===n){this._intentStates.delete(u);break}}}catch(t){l.e(t)}finally{l.f()}this.cleanup()}}}},{key:"stats",get:function(){return this._stats}}]);var t}();function Lo(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(R(Ro,this,Do).call(this),!M(Po,this)||this.destroyed)return!1;if(e)return E(To,this,setTimeout((function(){E(To,t,null),R(Ro,t,Lo).call(t,!1)}),5e3)),!1;var n,i=F(this._intentStates.values());try{for(i.s();!(n=i.n()).done;){var a=n.value,r=a.renderTasks,s=a.operatorList;if(r.size>0||!s.lastChunk)return!1}}catch(t){i.e(t)}finally{i.f()}return this._intentStates.clear(),this.objs.clear(),E(Po,this,!1),!0}function Do(){M(To,this)&&(clearTimeout(M(To,this)),E(To,this,null))}var Fo=new WeakMap,No=new WeakMap,Oo=function(){return B((function t(){j(this,t),_(this,Fo,new Map),_(this,No,Promise.resolve())}),[{key:"postMessage",value:function(t,e){var n=this,i={data:structuredClone(t,e?{transfer:e}:null)};M(No,this).then((function(){var t,e=F(M(Fo,n));try{for(e.s();!(t=e.n()).done;)I(t.value,1)[0].call(n,i)}catch(t){e.e(t)}finally{e.f()}}))}},{key:"addEventListener",value:function(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=null;if((null==i?void 0:i.signal)instanceof AbortSignal){var r=i.signal;if(r.aborted)return void dt("LoopbackPort - cannot use an `aborted` signal.");var s=function(){return n.removeEventListener(t,e)};a=function(){return r.removeEventListener("abort",s)},r.addEventListener("abort",s)}M(Fo,this).set(e,a)}},{key:"removeEventListener",value:function(t,e){var n=M(Fo,this).get(e);null==n||n(),M(Fo,this).delete(e)}},{key:"terminate",value:function(){var t,e=F(M(Fo,this));try{for(e.s();!(t=e.n()).done;){var n=I(t.value,2)[1];null==n||n()}}catch(t){e.e(t)}finally{e.f()}M(Fo,this).clear()}}])}(),Wo=new WeakSet,Bo=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.name,i=void 0===n?null:n,a=e.port,r=void 0===a?null:a,s=e.verbosity,o=void 0===s?ut():s;if(j(this,t),A(this,Wo),this.name=i,this.destroyed=!1,this.verbosity=o,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,r){var l;if(null!==(l=Vo._)&&void 0!==l&&l.has(r))throw new Error("Cannot use more than one PDFWorker per port.");return(Vo._||(Vo._=new WeakMap)).set(r,this),void this._initializeFromPort(r)}this._initialize()}return B(t,[{key:"promise",get:function(){return this._readyCapability.promise}},{key:"port",get:function(){return this._port}},{key:"messageHandler",get:function(){return this._messageHandler}},{key:"_initializeFromPort",value:function(t){this._port=t,this._messageHandler=new Xr("main","worker",t),this._messageHandler.on("ready",(function(){})),R(Wo,this,Ho).call(this)}},{key:"_initialize",value:function(){var e=this;if(Go._||jo())this._setupFakeWorker();else{var n=t.workerSrc;try{t._isSameOrigin(window.location.href,n)||(n=t._createCDNWrapper(new URL(n,window.location).href));var i=new Worker(n,{type:"module"}),a=new Xr("main","worker",i),r=function(){s.abort(),a.destroy(),i.terminate(),e.destroyed?e._readyCapability.reject(new Error("Worker was destroyed")):e._setupFakeWorker()},s=new AbortController;i.addEventListener("error",(function(){e._webWorker||r()}),{signal:s.signal}),a.on("test",(function(t){s.abort(),!e.destroyed&&t?(e._messageHandler=a,e._port=i,e._webWorker=i,R(Wo,e,Ho).call(e)):r()})),a.on("ready",(function(t){if(s.abort(),e.destroyed)r();else try{o()}catch(t){e._setupFakeWorker()}}));var o=function(){var t=new Uint8Array;a.send("test",t,[t.buffer])};return void o()}catch(t){ct("The worker has been disabled.")}this._setupFakeWorker()}}},{key:"_setupFakeWorker",value:function(){var e=this;Go._||(dt("Setting up fake worker."),Go._=!0),t._setupFakeWorkerGlobal.then((function(t){var n,i;if(e.destroyed)e._readyCapability.reject(new Error("Worker was destroyed"));else{var a=new Oo;e._port=a;var r="fake".concat((zo._=(n=zo._,i=n++,n),i)),s=new Xr(r+"_worker",r,a);t.setup(s,a),e._messageHandler=new Xr(r,r+"_worker",a),R(Wo,e,Ho).call(e)}})).catch((function(t){e._readyCapability.reject(new Error('Setting up fake worker failed: "'.concat(t.message,'".')))}))}},{key:"destroy",value:function(){var t,e,n;this.destroyed=!0,null===(t=this._webWorker)||void 0===t||t.terminate(),this._webWorker=null,null===(e=Vo._)||void 0===e||e.delete(this._port),this._port=null,null===(n=this._messageHandler)||void 0===n||n.destroy(),this._messageHandler=null}}],[{key:"fromPort",value:function(e){var n;if(null==e||!e.port)throw new Error("PDFWorker.fromPort - invalid method signature.");var i=null===(n=R(t,this,Vo)._)||void 0===n?void 0:n.get(e.port);if(i){if(i._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return i}return new t(e)}},{key:"workerSrc",get:function(){if(Hr.workerSrc)return Hr.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}},{key:"_setupFakeWorkerGlobal",get:function(){var e=this,n=function(){var n=T(w().mark((function n(){var i;return w().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!S(t,e,jo)){n.next=2;break}return n.abrupt("return",S(t,e,jo));case 2:return n.next=4,import(e.workerSrc);case 4:return i=n.sent,n.abrupt("return",i.WorkerMessageHandler);case 6:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();return gt(this,"_setupFakeWorkerGlobal",n())}}])}();function Ho(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}function jo(t){try{var e;return(null===(e=globalThis.pdfjsWorker)||void 0===e?void 0:e.WorkerMessageHandler)||null}catch(t){return null}}r=Bo;var zo={_:0},Go={_:!1},Vo={_:void 0};Q&&(Go._=R(r,r,!0),Hr.workerSrc||(Hr.workerSrc="./pdf.worker.mjs")),r._isSameOrigin=function(t,e){var n;try{if(!(n=new URL(t)).origin||"null"===n.origin)return!1}catch(t){return!1}var i=new URL(e,n);return n.origin===i.origin},r._createCDNWrapper=function(t){var e='await import("'.concat(t,'");');return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};var Uo=new WeakMap,qo=new WeakMap,Xo=new WeakMap,Yo=new WeakMap,Ko=new WeakMap,Qo=new WeakSet,Jo=function(){return B((function t(e,n,i,a,r){j(this,t),A(this,Qo),_(this,Uo,new Map),_(this,qo,new Map),_(this,Xo,new Map),_(this,Yo,new Map),_(this,Ko,null),this.messageHandler=e,this.loadingTask=n,this.commonObjs=new nl,this.fontLoader=new Ma({ownerDocument:a.ownerDocument,styleElement:a.styleElement}),this.loadingParams=a.loadingParams,this._params=a,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}),[{key:"annotationStorage",get:function(){return gt(this,"annotationStorage",new wa)}},{key:"getRenderingIntent",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:tt.ENABLE,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=2,s=ga;switch(t){case"any":r=1;break;case"display":break;case"print":r=4;break;default:dt("getRenderingIntent - invalid intent: ".concat(t))}var o=4&r&&n instanceof xa?n:this.annotationStorage;switch(e){case tt.DISABLE:r+=64;break;case tt.ENABLE:break;case tt.ENABLE_FORMS:r+=16;break;case tt.ENABLE_STORAGE:r+=32,s=o.serializable;break;default:dt("getRenderingIntent - invalid annotationMode: ".concat(e))}i&&(r+=128),a&&(r+=256);var l=o.modifiedIds,h=l.ids,u=l.hash;return{renderingIntent:r,cacheKey:[r,s.hash,u].join("_"),annotationStorageSerializable:s,modifiedIds:h}}},{key:"destroy",value:function(){var t,e=this;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),null===(t=M(Ko,this))||void 0===t||t.reject(new Error("Worker was destroyed during onPassword callback"));var n,i=[],a=F(M(qo,this).values());try{for(a.s();!(n=a.n()).done;){var r=n.value;i.push(r._destroy())}}catch(t){a.e(t)}finally{a.f()}M(qo,this).clear(),M(Xo,this).clear(),M(Yo,this).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();var s=this.messageHandler.sendWithPromise("Terminate",null);return i.push(s),Promise.all(i).then((function(){var t,n;e.commonObjs.clear(),e.fontLoader.clear(),M(Uo,e).clear(),e.filterFactory.destroy(),io.cleanup(),null===(t=e._networkStream)||void 0===t||t.cancelAllRequests(new xt("Worker was terminated.")),null===(n=e.messageHandler)||void 0===n||n.destroy(),e.messageHandler=null,e.destroyCapability.resolve()}),this.destroyCapability.reject),this.destroyCapability.promise}},{key:"setupMessageHandler",value:function(){var t=this,e=this.messageHandler,n=this.loadingTask;e.on("GetReader",(function(e,n){vt(t._networkStream,"GetReader - no `IPDFStream` instance available."),t._fullReader=t._networkStream.getFullReader(),t._fullReader.onProgress=function(e){t._lastProgress={loaded:e.loaded,total:e.total}},n.onPull=function(){t._fullReader.read().then((function(t){var e=t.value;t.done?n.close():(vt(e instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),n.enqueue(new Uint8Array(e),1,[e]))})).catch((function(t){n.error(t)}))},n.onCancel=function(e){t._fullReader.cancel(e),n.ready.catch((function(e){if(!t.destroyed)throw e}))}})),e.on("ReaderHeadersReady",function(){var e=T(w().mark((function e(i){var a,r,s,o,l;return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t._fullReader.headersReady;case 2:return a=t._fullReader,r=a.isStreamingSupported,s=a.isRangeSupported,o=a.contentLength,r&&s||(t._lastProgress&&(null===(l=n.onProgress)||void 0===l||l.call(n,t._lastProgress)),t._fullReader.onProgress=function(t){var e;null===(e=n.onProgress)||void 0===e||e.call(n,{loaded:t.loaded,total:t.total})}),e.abrupt("return",{isStreamingSupported:r,isRangeSupported:s,contentLength:o});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.on("GetRangeReader",(function(e,n){vt(t._networkStream,"GetRangeReader - no `IPDFStream` instance available.");var i=t._networkStream.getRangeReader(e.begin,e.end);i?(n.onPull=function(){i.read().then((function(t){var e=t.value;t.done?n.close():(vt(e instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),n.enqueue(new Uint8Array(e),1,[e]))})).catch((function(t){n.error(t)}))},n.onCancel=function(e){i.cancel(e),n.ready.catch((function(e){if(!t.destroyed)throw e}))}):n.close()})),e.on("GetDoc",(function(e){var i=e.pdfInfo;t._numPages=i.numPages,t._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,n._capability.resolve(new Co(i,t))})),e.on("DocException",(function(t){var e;switch(t.name){case"PasswordException":e=new mt(t.message,t.code);break;case"InvalidPDFException":e=new bt(t.message);break;case"MissingPDFException":e=new wt(t.message);break;case"UnexpectedResponseException":e=new At(t.message,t.status);break;case"UnknownErrorException":e=new kt(t.message,t.details);break;default:ft("DocException - expected a valid Error.")}n._capability.reject(e)})),e.on("PasswordRequest",(function(e){if(E(Ko,t,Promise.withResolvers()),n.onPassword)try{n.onPassword((function(e){e instanceof Error?M(Ko,t).reject(e):M(Ko,t).resolve({password:e})}),e.code)}catch(e){M(Ko,t).reject(e)}else M(Ko,t).reject(new mt(e.message,e.code));return M(Ko,t).promise})),e.on("DataLoaded",(function(e){var i;null===(i=n.onProgress)||void 0===i||i.call(n,{loaded:e.length,total:e.length}),t.downloadInfoCapability.resolve(e)})),e.on("StartRenderPage",(function(e){t.destroyed||M(qo,t).get(e.pageIndex)._startRenderPage(e.transparency,e.cacheKey)})),e.on("commonobj",(function(n){var i,a=I(n,3),r=a[0],s=a[1],o=a[2];if(t.destroyed)return null;if(t.commonObjs.has(r))return null;switch(s){case"Font":var l=t._params,h=l.disableFontFace,u=l.fontExtraProperties,c=l.pdfBug;if("error"in o){var d=o.error;dt("Error during font loading: ".concat(d)),t.commonObjs.resolve(r,d);break}var f=c&&null!==(i=globalThis.FontInspector)&&void 0!==i&&i.enabled?function(t,e){return globalThis.FontInspector.fontAdded(t,e)}:null,v=new Ea(o,{disableFontFace:h,fontExtraProperties:u,inspectFont:f});t.fontLoader.bind(v).catch((function(){return e.sendWithPromise("FontFallback",{id:r})})).finally((function(){!u&&v.data&&(v.data=null),t.commonObjs.resolve(r,v)}));break;case"CopyLocalImage":var p=o.imageRef;vt(p,"The imageRef must be defined.");var g,y=F(M(qo,t).values());try{for(y.s();!(g=y.n()).done;){var m,k=F(g.value.objs);try{for(k.s();!(m=k.n()).done;){var b=I(m.value,2)[1];if((null==b?void 0:b.ref)===p)return b.dataLen?(t.commonObjs.resolve(r,structuredClone(b)),b.dataLen):null}}catch(t){k.e(t)}finally{k.f()}}}catch(t){y.e(t)}finally{y.f()}break;case"FontPath":case"Image":case"Pattern":t.commonObjs.resolve(r,o);break;default:throw new Error("Got unknown common object type ".concat(s))}return null})),e.on("obj",(function(e){var n=I(e,4),i=n[0],a=n[1],r=n[2],s=n[3];if(!t.destroyed){var o,l=M(qo,t).get(a);if(!l.objs.has(i))if(0!==l._intentStates.size)switch(r){case"Image":l.objs.resolve(i,s),(null==s?void 0:s.dataLen)>1e7&&(l._maybeCleanupAfterRender=!0);break;case"Pattern":l.objs.resolve(i,s);break;default:throw new Error("Got unknown object type ".concat(r))}else null==s||null===(o=s.bitmap)||void 0===o||o.close()}})),e.on("DocProgress",(function(e){var i;t.destroyed||null===(i=n.onProgress)||void 0===i||i.call(n,{loaded:e.loaded,total:e.total})})),e.on("FetchBuiltInCMap",function(){var e=T(w().mark((function e(n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.destroyed){e.next=2;break}throw new Error("Worker was destroyed.");case 2:if(t.cMapReaderFactory){e.next=4;break}throw new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter.");case 4:return e.abrupt("return",t.cMapReaderFactory.fetch(n));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.on("FetchStandardFontData",function(){var e=T(w().mark((function e(n){return w().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.destroyed){e.next=2;break}throw new Error("Worker was destroyed.");case 2:if(t.standardFontDataFactory){e.next=4;break}throw new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.");case 4:return e.abrupt("return",t.standardFontDataFactory.fetch(n));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"getData",value:function(){return this.messageHandler.sendWithPromise("GetData",null)}},{key:"saveDocument",value:function(){var t,e,n=this;this.annotationStorage.size<=0&&dt("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");var i=this.annotationStorage.serializable,a=i.map,r=i.transfer;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:a,filename:null!==(t=null===(e=this._fullReader)||void 0===e?void 0:e.filename)&&void 0!==t?t:null},r).finally((function(){n.annotationStorage.resetModified()}))}},{key:"getPage",value:function(t){var e=this;if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));var n=t-1,i=M(Xo,this).get(n);if(i)return i;var a=this.messageHandler.sendWithPromise("GetPage",{pageIndex:n}).then((function(i){if(e.destroyed)throw new Error("Transport destroyed");i.refStr&&M(Yo,e).set(i.refStr,t);var a=new Io(n,i,e,e._params.pdfBug);return M(qo,e).set(n,a),a}));return M(Xo,this).set(n,a),a}},{key:"getPageIndex",value:function(t){return xo(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}},{key:"getAnnotations",value:function(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}},{key:"getFieldObjects",value:function(){return R(Qo,this,Zo).call(this,"GetFieldObjects")}},{key:"hasJSActions",value:function(){return R(Qo,this,Zo).call(this,"HasJSActions")}},{key:"getCalculationOrderIds",value:function(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}},{key:"getDestinations",value:function(){return this.messageHandler.sendWithPromise("GetDestinations",null)}},{key:"getDestination",value:function(t){return"string"!=typeof t?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}},{key:"getPageLabels",value:function(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}},{key:"getPageLayout",value:function(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}},{key:"getPageMode",value:function(){return this.messageHandler.sendWithPromise("GetPageMode",null)}},{key:"getViewerPreferences",value:function(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}},{key:"getOpenAction",value:function(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}},{key:"getAttachments",value:function(){return this.messageHandler.sendWithPromise("GetAttachments",null)}},{key:"getDocJSActions",value:function(){return R(Qo,this,Zo).call(this,"GetDocJSActions")}},{key:"getPageJSActions",value:function(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}},{key:"getStructTree",value:function(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}},{key:"getOutline",value:function(){return this.messageHandler.sendWithPromise("GetOutline",null)}},{key:"getOptionalContentConfig",value:function(t){return R(Qo,this,Zo).call(this,"GetOptionalContentConfig").then((function(e){return new fs(e,t)}))}},{key:"getPermissions",value:function(){return this.messageHandler.sendWithPromise("GetPermissions",null)}},{key:"getMetadata",value:function(){var t=this,e="GetMetadata",n=M(Uo,this).get(e);if(n)return n;var i=this.messageHandler.sendWithPromise(e,null).then((function(e){var n,i,a,r;return{info:e[0],metadata:e[1]?new es(e[1]):null,contentDispositionFilename:null!==(n=null===(i=t._fullReader)||void 0===i?void 0:i.filename)&&void 0!==n?n:null,contentLength:null!==(a=null===(r=t._fullReader)||void 0===r?void 0:r.contentLength)&&void 0!==a?a:null}}));return M(Uo,this).set(e,i),i}},{key:"getMarkInfo",value:function(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}},{key:"startCleanup",value:(t=T(w().mark((function t(){var e,n,i,a,r=arguments;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=r.length>0&&void 0!==r[0]&&r[0],!this.destroyed){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,this.messageHandler.sendWithPromise("Cleanup",null);case 5:n=F(M(qo,this).values()),t.prev=6,n.s();case 8:if((i=n.n()).done){t.next=15;break}if((a=i.value).cleanup()){t.next=13;break}throw new Error("startCleanup: Page ".concat(a.pageNumber," is currently rendering."));case 13:t.next=8;break;case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(6),n.e(t.t0);case 20:return t.prev=20,n.f(),t.finish(20);case 23:this.commonObjs.clear(),e||this.fontLoader.clear(),M(Uo,this).clear(),this.filterFactory.destroy(!0),io.cleanup();case 28:case"end":return t.stop()}}),t,this,[[6,17,20,23]])}))),function(){return t.apply(this,arguments)})},{key:"cachedPageNumber",value:function(t){var e;if(!xo(t))return null;var n=0===t.gen?"".concat(t.num,"R"):"".concat(t.num,"R").concat(t.gen);return null!==(e=M(Yo,this).get(n))&&void 0!==e?e:null}}]);var t}();function Zo(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=M(Uo,this).get(t);if(n)return n;var i=this.messageHandler.sendWithPromise(t,e);return M(Uo,this).set(t,i),i}var $o=Symbol("INITIAL_DATA"),tl=new WeakMap,el=new WeakSet,nl=function(){return B((function t(){j(this,t),A(this,el),_(this,tl,Object.create(null))}),[{key:"get",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e){var n=R(el,this,il).call(this,t);return n.promise.then((function(){return e(n.data)})),null}var i=M(tl,this)[t];if(!i||i.data===$o)throw new Error("Requesting object that isn't resolved yet ".concat(t,"."));return i.data}},{key:"has",value:function(t){var e=M(tl,this)[t];return!!e&&e.data!==$o}},{key:"delete",value:function(t){var e=M(tl,this)[t];return!(!e||e.data===$o||(delete M(tl,this)[t],0))}},{key:"resolve",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=R(el,this,il).call(this,t);n.data=e,n.resolve()}},{key:"clear",value:function(){for(var t in M(tl,this)){var e,n=M(tl,this)[t].data;null==n||null===(e=n.bitmap)||void 0===e||e.close()}E(tl,this,Object.create(null))}},{key:Symbol.iterator,value:w().mark((function t(){var e,n;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.t0=w().keys(M(tl,this));case 1:if((t.t1=t.t0()).done){t.next=10;break}if(e=t.t1.value,(n=M(tl,this)[e].data)!==$o){t.next=6;break}return t.abrupt("continue",1);case 6:return t.next=8,[e,n];case 8:t.next=1;break;case 10:case"end":return t.stop()}}),t,this)}))}])}();function il(t){var e;return(e=M(tl,this))[t]||(e[t]=p(p({},Promise.withResolvers()),{},{data:$o}))}var al=new WeakMap,rl=function(){return B((function t(e){j(this,t),_(this,al,null),E(al,this,e),this.onContinue=null}),[{key:"promise",get:function(){return M(al,this).capability.promise}},{key:"cancel",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;M(al,this).cancel(null,t)}},{key:"separateAnnots",get:function(){var t=M(al,this).operatorList.separateAnnots;if(!t)return!1;var e=M(al,this).annotationCanvasMap;return t.form||t.canvas&&(null==e?void 0:e.size)>0}}])}(),sl=new WeakMap,ol=function(){return B((function t(e){var n=e.callback,i=e.params,a=e.objs,r=e.commonObjs,s=e.annotationCanvasMap,o=e.operatorList,l=e.pageIndex,h=e.canvasFactory,u=e.filterFactory,c=e.useRequestAnimationFrame,d=void 0!==c&&c,f=e.pdfBug,v=void 0!==f&&f,p=e.pageColors,g=void 0===p?null:p;j(this,t),_(this,sl,null),this.callback=n,this.params=i,this.objs=a,this.commonObjs=r,this.annotationCanvasMap=s,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=l,this.canvasFactory=h,this.filterFactory=u,this._pdfBug=v,this.pageColors=g,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=!0===d&&"undefined"!=typeof window,this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new rl(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=i.canvasContext.canvas}),[{key:"completed",get:function(){return this.capability.promise.catch((function(){}))}},{key:"initializeGraphics",value:function(t){var e,n,i=t.transparency,a=void 0!==i&&i,r=t.optionalContentConfig;if(!this.cancelled){if(this._canvas){if(ll._.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");ll._.add(this._canvas)}this._pdfBug&&null!==(e=globalThis.StepperManager)&&void 0!==e&&e.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());var s=this.params,o=s.canvasContext,l=s.viewport,h=s.transform,u=s.background;this.gfx=new Fr(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:r},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:h,viewport:l,transparency:a,background:u}),this.operatorListIdx=0,this.graphicsReady=!0,null===(n=this.graphicsReadyCallback)||void 0===n||n.call(this)}}},{key:"cancel",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.running=!1,this.cancelled=!0,null===(t=this.gfx)||void 0===t||t.endDrawing(),M(sl,this)&&(window.cancelAnimationFrame(M(sl,this)),E(sl,this,null)),ll._.delete(this._canvas),this.callback(e||new zt("Rendering cancelled, page ".concat(this._pageIndex+1),n))}},{key:"operatorListChanged",value:function(){var t;this.graphicsReady?(null===(t=this.stepper)||void 0===t||t.updateOperatorList(this.operatorList),this.running||this._continue()):this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound)}},{key:"_continue",value:function(){this.running=!0,this.cancelled||(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}},{key:"_scheduleNext",value:function(){var t=this;this._useRequestAnimationFrame?E(sl,this,window.requestAnimationFrame((function(){E(sl,t,null),t._nextBound().catch(t._cancelBound)}))):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}},{key:"_next",value:(t=T(w().mark((function t(){return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.cancelled){t.next=2;break}return t.abrupt("return");case 2:this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),ll._.delete(this._canvas),this.callback()));case 4:case"end":return t.stop()}}),t,this)}))),function(){return t.apply(this,arguments)})}]);var t}(),ll={_:new WeakSet},hl="4.9.206",ul="8fa439826";function cl(t){return Math.floor(255*Math.max(0,Math.min(1,t))).toString(16).padStart(2,"0")}function dl(t){return Math.max(0,Math.min(255,255*t))}var fl=function(){return B((function t(){j(this,t)}),null,[{key:"CMYK_G",value:function(t){var e=I(t,4),n=e[0],i=e[1],a=e[2],r=e[3];return["G",1-Math.min(1,.3*n+.59*a+.11*i+r)]}},{key:"G_CMYK",value:function(t){return["CMYK",0,0,0,1-I(t,1)[0]]}},{key:"G_RGB",value:function(t){var e=I(t,1)[0];return["RGB",e,e,e]}},{key:"G_rgb",value:function(t){var e=I(t,1)[0];return[e=dl(e),e,e]}},{key:"G_HTML",value:function(t){var e=cl(I(t,1)[0]);return"#".concat(e).concat(e).concat(e)}},{key:"RGB_G",value:function(t){var e=I(t,3);return["G",.3*e[0]+.59*e[1]+.11*e[2]]}},{key:"RGB_rgb",value:function(t){return t.map(dl)}},{key:"RGB_HTML",value:function(t){return"#".concat(t.map(cl).join(""))}},{key:"T_HTML",value:function(){return"#00000000"}},{key:"T_rgb",value:function(){return[null]}},{key:"CMYK_RGB",value:function(t){var e=I(t,4),n=e[0],i=e[1],a=e[2],r=e[3];return["RGB",1-Math.min(1,n+r),1-Math.min(1,a+r),1-Math.min(1,i+r)]}},{key:"CMYK_rgb",value:function(t){var e=I(t,4),n=e[0],i=e[1],a=e[2],r=e[3];return[dl(1-Math.min(1,n+r)),dl(1-Math.min(1,a+r)),dl(1-Math.min(1,i+r))]}},{key:"CMYK_HTML",value:function(t){var e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}},{key:"RGB_CMYK",value:function(t){var e=I(t,3),n=1-e[0],i=1-e[1],a=1-e[2];return["CMYK",n,i,a,Math.min(n,i,a)]}}])}(),vl=function(t){function e(){return j(this,e),z(this,e,arguments)}return U(e,t),B(e,[{key:"_createSVG",value:function(t){return document.createElementNS(Ot,t)}}])}(function(){return B((function t(){j(this,t)}),[{key:"create",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");var i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),n||(i.setAttribute("width","".concat(t,"px")),i.setAttribute("height","".concat(e,"px"))),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox","0 0 ".concat(t," ").concat(e)),i}},{key:"createElement",value:function(t){if("string"!=typeof t)throw new Error("Invalid SVG element type");return this._createSVG(t)}},{key:"_createSVG",value:function(t){ft("Abstract method `_createSVG` called.")}}])}()),pl=function(){return B((function t(){j(this,t)}),null,[{key:"setupStorage",value:function(t,e,n,i,a){var r=i.getValue(e,{value:null});switch(n.name){case"textarea":if(null!==r.value&&(t.textContent=r.value),"print"===a)break;t.addEventListener("input",(function(t){i.setValue(e,{value:t.target.value})}));break;case"input":if("radio"===n.attributes.type||"checkbox"===n.attributes.type){if(r.value===n.attributes.xfaOn?t.setAttribute("checked",!0):r.value===n.attributes.xfaOff&&t.removeAttribute("checked"),"print"===a)break;t.addEventListener("change",(function(t){i.setValue(e,{value:t.target.checked?t.target.getAttribute("xfaOn"):t.target.getAttribute("xfaOff")})}))}else{if(null!==r.value&&t.setAttribute("value",r.value),"print"===a)break;t.addEventListener("input",(function(t){i.setValue(e,{value:t.target.value})}))}break;case"select":if(null!==r.value){t.setAttribute("value",r.value);var s,o=F(n.children);try{for(o.s();!(s=o.n()).done;){var l=s.value;l.attributes.value===r.value?l.attributes.selected=!0:l.attributes.hasOwnProperty("selected")&&delete l.attributes.selected}}catch(t){o.e(t)}finally{o.f()}}t.addEventListener("input",(function(t){var n=t.target.options,a=-1===n.selectedIndex?"":n[n.selectedIndex].value;i.setValue(e,{value:a})}))}}},{key:"setAttributes",value:function(t){var e=t.html,n=t.element,i=t.storage,a=void 0===i?null:i,r=t.intent,s=t.linkService,o=n.attributes,l=e instanceof HTMLAnchorElement;"radio"===o.type&&(o.name="".concat(o.name,"-").concat(r));for(var h=0,u=Object.entries(o);h<u.length;h++){var c=I(u[h],2),d=c[0],f=c[1];if(null!=f)switch(d){case"class":f.length&&e.setAttribute(d,f.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",f);break;case"style":Object.assign(e.style,f);break;case"textContent":e.textContent=f;break;default:(!l||"href"!==d&&"newWindow"!==d)&&e.setAttribute(d,f)}}l&&s.addLinkAttributes(e,o.href,o.newWindow),a&&o.dataId&&this.setupStorage(e,o.dataId,n,a)}},{key:"render",value:function(t){var e=t.annotationStorage,n=t.linkService,i=t.xfaHtml,a=t.intent||"display",r=document.createElement(i.name);i.attributes&&this.setAttributes({html:r,element:i,intent:a,linkService:n});var s="richText"!==a,o=t.div;if(o.append(r),t.viewport){var l="matrix(".concat(t.viewport.transform.join(","),")");o.style.transform=l}s&&o.setAttribute("class","xfaLayer xfaFont");var h=[];if(0===i.children.length){if(i.value){var u=document.createTextNode(i.value);r.append(u),s&&yo.shouldBuildText(i.name)&&h.push(u)}return{textDivs:h}}for(var c=[[i,-1,r]];c.length>0;){var d,f,v=I(c.at(-1),3),p=v[0],g=v[1],y=v[2];if(g+1!==p.children.length){var m=p.children[++c.at(-1)[1]];if(null!==m){var k=m.name;if("#text"!==k){var b=null!=m&&null!==(d=m.attributes)&&void 0!==d&&d.xmlns?document.createElementNS(m.attributes.xmlns,k):document.createElement(k);if(y.append(b),m.attributes&&this.setAttributes({html:b,element:m,storage:e,intent:a,linkService:n}),(null===(f=m.children)||void 0===f?void 0:f.length)>0)c.push([m,-1,b]);else if(m.value){var w=document.createTextNode(m.value);s&&yo.shouldBuildText(k)&&h.push(w),b.append(w)}}else{var A=document.createTextNode(m.value);h.push(A),y.append(A)}}}else c.pop()}var _,x=F(o.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"));try{for(x.s();!(_=x.n()).done;)_.value.setAttribute("readOnly",!0)}catch(t){x.e(t)}finally{x.f()}return{textDivs:h}}},{key:"update",value:function(t){var e="matrix(".concat(t.viewport.transform.join(","),")");t.div.style.transform=e,t.div.hidden=!1}}])}(),gl=1e3,yl=new WeakSet;function ml(t){return{width:t[2]-t[0],height:t[3]-t[1]}}var kl=function(){return B((function t(){j(this,t)}),null,[{key:"create",value:function(t){switch(t.data.annotationType){case 2:return new El(t);case 1:return new Rl(t);case 20:switch(t.data.fieldType){case"Tx":return new Ll(t);case"Btn":return t.data.radioButton?new Nl(t):t.data.checkBox?new Fl(t):new Ol(t);case"Ch":return new Wl(t);case"Sig":return new Dl(t)}return new Il(t);case 16:return new Bl(t);case 3:return new gh(t);case 4:return new mh(t);case 5:return new bh(t);case 6:return new Ah(t);case 8:return new xh(t);case 14:return new Mh(t);case 15:return new Ph(t);case 7:return new Sh(t);case 9:return new Ih(t);case 10:return new Lh(t);case 11:return new Dh(t);case 12:return new Fh(t);case 13:return new Nh(t);case 17:return new Bh(t);default:return new xl(t)}}}])}(),bl=new WeakMap,wl=new WeakMap,Al=new WeakMap,_l=new WeakSet,xl=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=n.isRenderable,a=void 0!==i&&i,r=n.ignoreBorder,s=void 0!==r&&r,o=n.createQuadrilaterals,l=void 0!==o&&o;j(this,t),A(this,_l),_(this,bl,null),_(this,wl,!1),_(this,Al,null),this.isRenderable=a,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,a&&(this.container=this._createContainer(s)),l&&this._createQuadrilaterals()}return B(t,[{key:"_isEditable",get:function(){return this.data.isEditable}},{key:"hasPopupData",get:function(){return t._hasPopupData(this.data)}},{key:"updateEdited",value:function(t){var e;if(this.container){M(bl,this)||E(bl,this,{rect:this.data.rect.slice(0)});var n=t.rect;n&&R(_l,this,Sl).call(this,n),null===(e=M(Al,this))||void 0===e||e.popup.updateEdited(t)}}},{key:"resetEdited",value:function(){var t;M(bl,this)&&(R(_l,this,Sl).call(this,M(bl,this).rect),null===(t=M(Al,this))||void 0===t||t.popup.resetEdited(),E(bl,this,null))}},{key:"_createContainer",value:function(t){var e=this.data,n=this.parent,i=n.page,a=n.viewport,r=document.createElement("section");r.setAttribute("data-annotation-id",e.id),this instanceof Il||(r.tabIndex=gl);var s=r.style;if(s.zIndex=this.parent.zIndex++,e.alternativeText&&(r.title=e.alternativeText),e.noRotate&&r.classList.add("norotate"),!e.rect||this instanceof Bl){var o=e.rotation;return e.hasOwnCanvas||0===o||this.setRotation(o,r),r}var l=ml(e.rect),h=l.width,u=l.height;if(!t&&e.borderStyle.width>0){s.borderWidth="".concat(e.borderStyle.width,"px");var c=e.borderStyle.horizontalCornerRadius,d=e.borderStyle.verticalCornerRadius;if(c>0||d>0){var f="calc(".concat(c,"px * var(--scale-factor)) / calc(").concat(d,"px * var(--scale-factor))");s.borderRadius=f}else if(this instanceof Nl){var v="calc(".concat(h,"px * var(--scale-factor)) / calc(").concat(u,"px * var(--scale-factor))");s.borderRadius=v}switch(e.borderStyle.style){case 1:s.borderStyle="solid";break;case 2:s.borderStyle="dashed";break;case 3:dt("Unimplemented border style: beveled");break;case 4:dt("Unimplemented border style: inset");break;case 5:s.borderBottomStyle="solid"}var p=e.borderColor||null;p?(E(wl,this,!0),s.borderColor=Pt.makeHexColor(0|p[0],0|p[1],0|p[2])):s.borderWidth=0}var g=Pt.normalizeRect([e.rect[0],i.view[3]-e.rect[1]+i.view[1],e.rect[2],i.view[3]-e.rect[3]+i.view[1]]),y=a.rawDims,m=y.pageWidth,k=y.pageHeight,b=y.pageX,w=y.pageY;s.left="".concat(100*(g[0]-b)/m,"%"),s.top="".concat(100*(g[1]-w)/k,"%");var A=e.rotation;return e.hasOwnCanvas||0===A?(s.width="".concat(100*h/m,"%"),s.height="".concat(100*u/k,"%")):this.setRotation(A,r),r}},{key:"setRotation",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.container;if(this.data.rect){var n,i,a=this.parent.viewport.rawDims,r=a.pageWidth,s=a.pageHeight,o=ml(this.data.rect),l=o.width,h=o.height;t%180==0?(n=100*l/r,i=100*h/s):(n=100*h/r,i=100*l/s),e.style.width="".concat(n,"%"),e.style.height="".concat(i,"%"),e.setAttribute("data-main-rotation",(360-t)%360)}}},{key:"_commonActions",get:function(){var t=this,e=function(e,n,i){var a=i.detail[e],r=a[0],s=a.slice(1);i.target.style[n]=fl["".concat(r,"_HTML")](s),t.annotationStorage.setValue(t.data.id,P({},n,fl["".concat(r,"_rgb")](s)))};return gt(this,"_commonActions",{display:function(e){var n=e.detail.display,i=n%2==1;t.container.style.visibility=i?"hidden":"visible",t.annotationStorage.setValue(t.data.id,{noView:i,noPrint:1===n||2===n})},print:function(e){t.annotationStorage.setValue(t.data.id,{noPrint:!e.detail.print})},hidden:function(e){var n=e.detail.hidden;t.container.style.visibility=n?"hidden":"visible",t.annotationStorage.setValue(t.data.id,{noPrint:n,noView:n})},focus:function(t){setTimeout((function(){return t.target.focus({preventScroll:!1})}),0)},userName:function(t){t.target.title=t.detail.userName},readonly:function(t){t.target.disabled=t.detail.readonly},required:function(e){t._setRequired(e.target,e.detail.required)},bgColor:function(t){e("bgColor","backgroundColor",t)},fillColor:function(t){e("fillColor","backgroundColor",t)},fgColor:function(t){e("fgColor","color",t)},textColor:function(t){e("textColor","color",t)},borderColor:function(t){e("borderColor","borderColor",t)},strokeColor:function(t){e("strokeColor","borderColor",t)},rotation:function(e){var n=e.detail.rotation;t.setRotation(n),t.annotationStorage.setValue(t.data.id,{rotation:n})}})}},{key:"_dispatchEventFromSandbox",value:function(t,e){for(var n=this._commonActions,i=0,a=Object.keys(e.detail);i<a.length;i++){var r=a[i],s=t[r]||n[r];null==s||s(e)}}},{key:"_setDefaultPropertiesFromJS",value:function(t){if(this.enableScripting){var e=this.annotationStorage.getRawValue(this.data.id);if(e)for(var n=this._commonActions,i=0,a=Object.entries(e);i<a.length;i++){var r=I(a[i],2),s=r[0],o=r[1],l=n[s];l&&(l({detail:P({},s,o),target:t}),delete e[s])}}}},{key:"_createQuadrilaterals",value:function(){if(this.container){var t=this.data.quadPoints;if(t){var e=this.data.rect.map((function(t){return Math.fround(t)})),n=I(e,4),i=n[0],a=n[1],r=n[2],s=n[3];if(8===t.length){var o=I(t.subarray(2,6),4),l=o[0],h=o[1],u=o[2],c=o[3];if(r===l&&s===h&&i===u&&a===c)return}var d,f=this.container.style;if(M(wl,this)){var v=f.borderColor,p=f.borderWidth;f.borderWidth=0,d=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">','<g fill="transparent" stroke="'.concat(v,'" stroke-width="').concat(p,'">')],this.container.classList.add("hasBorder")}var g=r-i,y=s-a,m=this.svgFactory,k=m.createElement("svg");k.classList.add("quadrilateralsContainer"),k.setAttribute("width",0),k.setAttribute("height",0);var b=m.createElement("defs");k.append(b);var w=m.createElement("clipPath"),A="clippath_".concat(this.data.id);w.setAttribute("id",A),w.setAttribute("clipPathUnits","objectBoundingBox"),b.append(w);for(var _=2,x=t.length;_<x;_+=8){var S,E=t[_],C=t[_+1],T=t[_+2],P=t[_+3],R=m.createElement("rect"),L=(T-i)/g,D=(s-C)/y,F=(E-T)/g,N=(C-P)/y;R.setAttribute("x",L),R.setAttribute("y",D),R.setAttribute("width",F),R.setAttribute("height",N),w.append(R),null===(S=d)||void 0===S||S.push('<rect vector-effect="non-scaling-stroke" x="'.concat(L,'" y="').concat(D,'" width="').concat(F,'" height="').concat(N,'"/>'))}M(wl,this)&&(d.push("</g></svg>')"),f.backgroundImage=d.join("")),this.container.append(k),this.container.style.clipPath="url(#".concat(A,")")}}}},{key:"_createPopup",value:function(){var t=this.data,e=E(Al,this,new Bl({data:{color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,parentRect:t.rect,borderStyle:0,id:"popup_".concat(t.id),rotation:t.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(e.render())}},{key:"render",value:function(){ft("Abstract method `AnnotationElement.render` called")}},{key:"_getElementsByName",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=[];if(this._fieldObjects){var i=this._fieldObjects[t];if(i){var a,r=F(i);try{for(r.s();!(a=r.n()).done;){var s=a.value,o=s.page,l=s.id,h=s.exportValues;if(-1!==o&&l!==e){var u="string"==typeof h?h:null,c=document.querySelector('[data-element-id="'.concat(l,'"]'));!c||yl.has(c)?n.push({id:l,exportValue:u,domElement:c}):dt("_getElementsByName - element not allowed: ".concat(l))}}}catch(t){r.e(t)}finally{r.f()}}return n}var d,f=F(document.getElementsByName(t));try{for(f.s();!(d=f.n()).done;){var v=d.value,p=v.exportValue,g=v.getAttribute("data-element-id");g!==e&&yl.has(v)&&n.push({id:g,exportValue:p,domElement:v})}}catch(t){f.e(t)}finally{f.f()}return n}},{key:"show",value:function(){var t;this.container&&(this.container.hidden=!1),null===(t=this.popup)||void 0===t||t.maybeShow()}},{key:"hide",value:function(){var t;this.container&&(this.container.hidden=!0),null===(t=this.popup)||void 0===t||t.forceHide()}},{key:"getElementsToTriggerPopup",value:function(){return this.container}},{key:"addHighlightArea",value:function(){var t=this.getElementsToTriggerPopup();if(Array.isArray(t)){var e,n=F(t);try{for(n.s();!(e=n.n()).done;)e.value.classList.add("highlightArea")}catch(t){n.e(t)}finally{n.f()}}else t.classList.add("highlightArea")}},{key:"_editOnDoubleClick",value:function(){var t=this;if(this._isEditable){var e=this.annotationEditorType,n=this.data.id;this.container.addEventListener("dblclick",(function(){var i;null===(i=t.linkService.eventBus)||void 0===i||i.dispatch("switchannotationeditormode",{source:t,mode:e,editId:n})}))}}}],[{key:"_hasPopupData",value:function(t){var e=t.titleObj,n=t.contentsObj,i=t.richText;return!!(null!=e&&e.str||null!=n&&n.str||null!=i&&i.str)}}])}();function Sl(t){var e=this.container.style,n=this.data,i=n.rect,a=n.rotation,r=this.parent.viewport.rawDims,s=r.pageWidth,o=r.pageHeight,l=r.pageX,h=r.pageY;null==i||i.splice.apply(i,[0,4].concat(k(t)));var u=ml(t),c=u.width,d=u.height;e.left="".concat(100*(t[0]-l)/s,"%"),e.top="".concat(100*(o-t[3]+h)/o,"%"),0===a?(e.width="".concat(100*c/s,"%"),e.height="".concat(100*d/o,"%")):this.setRotation(a)}var Ml=new WeakSet,El=function(t){function e(t){var n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return j(this,e),A(n=z(this,e,[t,{isRenderable:!0,ignoreBorder:!(null==i||!i.ignoreBorder),createQuadrilaterals:!0}]),Ml),n.isTooltipOnly=t.data.isTooltipOnly,n}return U(e,t),B(e,[{key:"render",value:function(){var t=this.data,e=this.linkService,n=document.createElement("a");n.setAttribute("data-element-id",t.id);var i=!1;return t.url?(e.addLinkAttributes(n,t.url,t.newWindow),i=!0):t.action?(this._bindNamedAction(n,t.action),i=!0):t.attachment?(R(Ml,this,Tl).call(this,n,t.attachment,t.attachmentDest),i=!0):t.setOCGState?(R(Ml,this,Pl).call(this,n,t.setOCGState),i=!0):t.dest?(this._bindLink(n,t.dest),i=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(n,t),i=!0),t.resetForm?(this._bindResetFormAction(n,t.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(n,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&this.container.append(n),this.container}},{key:"_bindLink",value:function(t,e){var n=this;t.href=this.linkService.getDestinationHash(e),t.onclick=function(){return e&&n.linkService.goToDestination(e),!1},(e||""===e)&&R(Ml,this,Cl).call(this)}},{key:"_bindNamedAction",value:function(t,e){var n=this;t.href=this.linkService.getAnchorUrl(""),t.onclick=function(){return n.linkService.executeNamedAction(e),!1},R(Ml,this,Cl).call(this)}},{key:"_bindJSAction",value:function(t,e){var n=this;t.href=this.linkService.getAnchorUrl("");for(var i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]),a=function(){var a=s[r],o=i.get(a);if(!o)return 1;t[o]=function(){var t;return null===(t=n.linkService.eventBus)||void 0===t||t.dispatch("dispatcheventinsandbox",{source:n,detail:{id:e.id,name:a}}),!1}},r=0,s=Object.keys(e.actions);r<s.length;r++)a();t.onclick||(t.onclick=function(){return!1}),R(Ml,this,Cl).call(this)}},{key:"_bindResetFormAction",value:function(t,e){var n=this,i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),R(Ml,this,Cl).call(this),!this._fieldObjects)return dt('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),void(i||(t.onclick=function(){return!1}));t.onclick=function(){null==i||i();var t=e.fields,a=e.refs,r=e.include,s=[];if(0!==t.length||0!==a.length){var o,l=new Set(a),h=F(t);try{for(h.s();!(o=h.n()).done;){var u,c=o.value,d=F(n._fieldObjects[c]||[]);try{for(d.s();!(u=d.n()).done;){var f=u.value.id;l.add(f)}}catch(t){d.e(t)}finally{d.f()}}}catch(t){h.e(t)}finally{h.f()}for(var v=0,p=Object.values(n._fieldObjects);v<p.length;v++){var g,y=F(p[v]);try{for(y.s();!(g=y.n()).done;){var m=g.value;l.has(m.id)===r&&s.push(m)}}catch(t){y.e(t)}finally{y.f()}}}else for(var b=0,w=Object.values(n._fieldObjects);b<w.length;b++){var A=w[b];s.push.apply(s,k(A))}for(var _,x=n.annotationStorage,S=[],M=0,E=s;M<E.length;M++){var C=E[M],T=C.id;switch(S.push(T),C.type){case"text":var P=C.defaultValue||"";x.setValue(T,{value:P});break;case"checkbox":case"radiobutton":var R=C.defaultValue===C.exportValues;x.setValue(T,{value:R});break;case"combobox":case"listbox":var I=C.defaultValue||"";x.setValue(T,{value:I});break;default:continue}var L=document.querySelector('[data-element-id="'.concat(T,'"]'));L&&(yl.has(L)?L.dispatchEvent(new Event("resetform")):dt("_bindResetFormAction - element not allowed: ".concat(T)))}return n.enableScripting&&(null===(_=n.linkService.eventBus)||void 0===_||_.dispatch("dispatcheventinsandbox",{source:n,detail:{id:"app",ids:S,name:"ResetForm"}})),!1}}}])}(xl);function Cl(){this.container.setAttribute("data-internal-link","")}function Tl(t,e){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t.href=this.linkService.getAnchorUrl(""),e.description&&(t.title=e.description),t.onclick=function(){var t;return null===(t=n.downloadManager)||void 0===t||t.openOrDownloadData(e.content,e.filename,i),!1},R(Ml,this,Cl).call(this)}function Pl(t,e){var n=this;t.href=this.linkService.getAnchorUrl(""),t.onclick=function(){return n.linkService.executeSetOCGState(e),!1},R(Ml,this,Cl).call(this)}var Rl=function(t){function e(t){return j(this,e),z(this,e,[t,{isRenderable:!0}])}return U(e,t),B(e,[{key:"render",value:function(){this.container.classList.add("textAnnotation");var t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}])}(xl),Il=function(t){function e(){return j(this,e),z(this,e,arguments)}return U(e,t),B(e,[{key:"render",value:function(){return this.container}},{key:"showElementAndHideCanvas",value:function(t){var e;this.data.hasOwnCanvas&&("CANVAS"===(null===(e=t.previousSibling)||void 0===e?void 0:e.nodeName)&&(t.previousSibling.hidden=!0),t.hidden=!1)}},{key:"_getKeyModifier",value:function(t){return Ct.platform.isMac?t.metaKey:t.ctrlKey}},{key:"_setEventListener",value:function(t,e,n,i,a){var r=this;n.includes("mouse")?t.addEventListener(n,(function(t){var e;null===(e=r.linkService.eventBus)||void 0===e||e.dispatch("dispatcheventinsandbox",{source:r,detail:{id:r.data.id,name:i,value:a(t),shift:t.shiftKey,modifier:r._getKeyModifier(t)}})})):t.addEventListener(n,(function(t){var s;if("blur"===n){if(!e.focused||!t.relatedTarget)return;e.focused=!1}else if("focus"===n){if(e.focused)return;e.focused=!0}a&&(null===(s=r.linkService.eventBus)||void 0===s||s.dispatch("dispatcheventinsandbox",{source:r,detail:{id:r.data.id,name:i,value:a(t)}}))}))}},{key:"_setEventListeners",value:function(t,e,n,i){var a,r=F(n);try{for(r.s();!(a=r.n()).done;){var s,o,l,h=I(a.value,2),u=h[0],c=h[1];("Action"===c||null!==(s=this.data.actions)&&void 0!==s&&s[c])&&("Focus"!==c&&"Blur"!==c||e||(e={focused:!1}),this._setEventListener(t,e,u,c,i),"Focus"!==c||null!==(o=this.data.actions)&&void 0!==o&&o.Blur?"Blur"!==c||null!==(l=this.data.actions)&&void 0!==l&&l.Focus||this._setEventListener(t,e,"focus","Focus",null):this._setEventListener(t,e,"blur","Blur",null))}}catch(t){r.e(t)}finally{r.f()}}},{key:"_setBackgroundColor",value:function(t){var e=this.data.backgroundColor||null;t.style.backgroundColor=null===e?"transparent":Pt.makeHexColor(e[0],e[1],e[2])}},{key:"_setTextStyle",value:function(t){var e,n=this.data.defaultAppearanceData.fontColor,i=this.data.defaultAppearanceData.fontSize||9,a=t.style,r=function(t){return Math.round(10*t)/10};if(this.data.multiLine){var s=Math.abs(this.data.rect[3]-this.data.rect[1]-2),o=s/(Math.round(s/($*i))||1);e=Math.min(i,r(o/$))}else{var l=Math.abs(this.data.rect[3]-this.data.rect[1]-2);e=Math.min(i,r(l/$))}a.fontSize="calc(".concat(e,"px * var(--scale-factor))"),a.color=Pt.makeHexColor(n[0],n[1],n[2]),null!==this.data.textAlignment&&(a.textAlign=["left","center","right"][this.data.textAlignment])}},{key:"_setRequired",value:function(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}])}(xl),Ll=function(t){function e(t){return j(this,e),z(this,e,[t,{isRenderable:t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue}])}return U(e,t),B(e,[{key:"setPropertyOnSiblings",value:function(t,e,n,i){var a,r=this.annotationStorage,s=F(this._getElementsByName(t.name,t.id));try{for(s.s();!(a=s.n()).done;){var o=a.value;o.domElement&&(o.domElement[e]=n),r.setValue(o.id,P({},i,n))}}catch(t){s.e(t)}finally{s.f()}}},{key:"render",value:function(){var t=this,e=this.annotationStorage,n=this.data.id;this.container.classList.add("textWidgetAnnotation");var i=null;if(this.renderForms){var a,r=e.getValue(n,{value:this.data.fieldValue}),s=r.value||"",o=e.getValue(n,{charLimit:this.data.maxLen}).charLimit;o&&s.length>o&&(s=s.slice(0,o));var l=r.formattedValue||(null===(a=this.data.textContent)||void 0===a?void 0:a.join("\n"))||null;l&&this.data.comb&&(l=l.replaceAll(/\s+/g,""));var h,u,c={userValue:s,formattedValue:l,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?((i=document.createElement("textarea")).textContent=null!==(h=l)&&void 0!==h?h:s,this.data.doNotScroll&&(i.style.overflowY="hidden")):((i=document.createElement("input")).type="text",i.setAttribute("value",null!==(u=l)&&void 0!==u?u:s),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),yl.add(i),i.setAttribute("data-element-id",n),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=gl,this._setRequired(i,this.data.required),o&&(i.maxLength=o),i.addEventListener("input",(function(a){e.setValue(n,{value:a.target.value}),t.setPropertyOnSiblings(i,"value",a.target.value,"value"),c.formattedValue=null})),i.addEventListener("resetform",(function(e){var n,a=null!==(n=t.data.defaultFieldValue)&&void 0!==n?n:"";i.value=c.userValue=a,c.formattedValue=null}));var d=function(t){var e=c.formattedValue;null!=e&&(t.target.value=e),t.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){var f;i.addEventListener("focus",(function(e){var n;if(!c.focused){var i=e.target;c.userValue&&(i.value=c.userValue),c.lastCommittedValue=i.value,c.commitKey=1,null!==(n=t.data.actions)&&void 0!==n&&n.Focus||(c.focused=!0)}})),i.addEventListener("updatefromsandbox",(function(i){t.showElementAndHideCanvas(i.target);var a={value:function(t){var i;c.userValue=null!==(i=t.detail.value)&&void 0!==i?i:"",e.setValue(n,{value:c.userValue.toString()}),t.target.value=c.userValue},formattedValue:function(t){var i=t.detail.formattedValue;c.formattedValue=i,null!=i&&t.target!==document.activeElement&&(t.target.value=i),e.setValue(n,{formattedValue:i})},selRange:function(t){var e;(e=t.target).setSelectionRange.apply(e,k(t.detail.selRange))},charLimit:function(i){var a,r=i.detail.charLimit,s=i.target;if(0!==r){s.setAttribute("maxLength",r);var o=c.userValue;!o||o.length<=r||(o=o.slice(0,r),s.value=c.userValue=o,e.setValue(n,{value:o}),null===(a=t.linkService.eventBus)||void 0===a||a.dispatch("dispatcheventinsandbox",{source:t,detail:{id:n,name:"Keystroke",value:o,willCommit:!0,commitKey:1,selStart:s.selectionStart,selEnd:s.selectionEnd}}))}else s.removeAttribute("maxLength")}};t._dispatchEventFromSandbox(a,i)})),i.addEventListener("keydown",(function(e){var i;c.commitKey=1;var a=-1;if("Escape"===e.key?a=0:"Enter"!==e.key||t.data.multiLine?"Tab"===e.key&&(c.commitKey=3):a=2,-1!==a){var r=e.target.value;c.lastCommittedValue!==r&&(c.lastCommittedValue=r,c.userValue=r,null===(i=t.linkService.eventBus)||void 0===i||i.dispatch("dispatcheventinsandbox",{source:t,detail:{id:n,name:"Keystroke",value:r,willCommit:!0,commitKey:a,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}}))}}));var v=d;d=null,i.addEventListener("blur",(function(e){var i;if(c.focused&&e.relatedTarget){null!==(i=t.data.actions)&&void 0!==i&&i.Blur||(c.focused=!1);var a,r=e.target.value;c.userValue=r,c.lastCommittedValue!==r&&(null===(a=t.linkService.eventBus)||void 0===a||a.dispatch("dispatcheventinsandbox",{source:t,detail:{id:n,name:"Keystroke",value:r,willCommit:!0,commitKey:c.commitKey,selStart:e.target.selectionStart,selEnd:e.target.selectionEnd}})),v(e)}})),null!==(f=this.data.actions)&&void 0!==f&&f.Keystroke&&i.addEventListener("beforeinput",(function(e){var i;c.lastCommittedValue=null;var a=e.data,r=e.target,s=r.value,o=r.selectionStart,l=r.selectionEnd,h=o,u=l;switch(e.inputType){case"deleteWordBackward":var d=s.substring(0,o).match(/\w*[^\w]*$/);d&&(h-=d[0].length);break;case"deleteWordForward":var f=s.substring(o).match(/^[^\w]*\w*/);f&&(u+=f[0].length);break;case"deleteContentBackward":o===l&&(h-=1);break;case"deleteContentForward":o===l&&(u+=1)}e.preventDefault(),null===(i=t.linkService.eventBus)||void 0===i||i.dispatch("dispatcheventinsandbox",{source:t,detail:{id:n,name:"Keystroke",value:s,change:a||"",willCommit:!1,selStart:h,selEnd:u}})})),this._setEventListeners(i,c,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(function(t){return t.target.value}))}if(d&&i.addEventListener("blur",d),this.data.comb){var p=(this.data.rect[2]-this.data.rect[0])/o;i.classList.add("comb"),i.style.letterSpacing="calc(".concat(p,"px * var(--scale-factor) - 1ch)")}}else(i=document.createElement("div")).textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}])}(Il),Dl=function(t){function e(t){return j(this,e),z(this,e,[t,{isRenderable:!!t.data.hasOwnCanvas}])}return U(e,t),B(e)}(Il),Fl=function(t){function e(t){return j(this,e),z(this,e,[t,{isRenderable:t.renderForms}])}return U(e,t),B(e,[{key:"render",value:function(){var t=this,e=this.annotationStorage,n=this.data,i=n.id,a=e.getValue(i,{value:n.exportValue===n.fieldValue}).value;"string"==typeof a&&(a="Off"!==a,e.setValue(i,{value:a})),this.container.classList.add("buttonWidgetAnnotation","checkBox");var r=document.createElement("input");return yl.add(r),r.setAttribute("data-element-id",i),r.disabled=n.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=n.fieldName,a&&r.setAttribute("checked",!0),r.setAttribute("exportValue",n.exportValue),r.tabIndex=gl,r.addEventListener("change",(function(a){var r,s=a.target,o=s.name,l=s.checked,h=F(t._getElementsByName(o,i));try{for(h.s();!(r=h.n()).done;){var u=r.value,c=l&&u.exportValue===n.exportValue;u.domElement&&(u.domElement.checked=c),e.setValue(u.id,{value:c})}}catch(t){h.e(t)}finally{h.f()}e.setValue(i,{value:l})})),r.addEventListener("resetform",(function(t){var e=n.defaultFieldValue||"Off";t.target.checked=e===n.exportValue})),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",(function(n){var a={value:function(t){t.target.checked="Off"!==t.detail.value,e.setValue(i,{value:t.target.checked})}};t._dispatchEventFromSandbox(a,n)})),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(function(t){return t.target.checked}))),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}])}(Il),Nl=function(t){function e(t){return j(this,e),z(this,e,[t,{isRenderable:t.renderForms}])}return U(e,t),B(e,[{key:"render",value:function(){var t=this;this.container.classList.add("buttonWidgetAnnotation","radioButton");var e=this.annotationStorage,n=this.data,i=n.id,a=e.getValue(i,{value:n.fieldValue===n.buttonValue}).value;if("string"==typeof a&&(a=a!==n.buttonValue,e.setValue(i,{value:a})),a){var r,s=F(this._getElementsByName(n.fieldName,i));try{for(s.s();!(r=s.n()).done;){var o=r.value;e.setValue(o.id,{value:!1})}}catch(t){s.e(t)}finally{s.f()}}var l=document.createElement("input");if(yl.add(l),l.setAttribute("data-element-id",i),l.disabled=n.readOnly,this._setRequired(l,this.data.required),l.type="radio",l.name=n.fieldName,a&&l.setAttribute("checked",!0),l.tabIndex=gl,l.addEventListener("change",(function(n){var a,r=n.target,s=r.name,o=r.checked,l=F(t._getElementsByName(s,i));try{for(l.s();!(a=l.n()).done;){var h=a.value;e.setValue(h.id,{value:!1})}}catch(t){l.e(t)}finally{l.f()}e.setValue(i,{value:o})})),l.addEventListener("resetform",(function(t){var e=n.defaultFieldValue;t.target.checked=null!=e&&e===n.buttonValue})),this.enableScripting&&this.hasJSActions){var h=n.buttonValue;l.addEventListener("updatefromsandbox",(function(n){var a={value:function(n){var a,r=h===n.detail.value,s=F(t._getElementsByName(n.target.name));try{for(s.s();!(a=s.n()).done;){var o=a.value,l=r&&o.id===i;o.domElement&&(o.domElement.checked=l),e.setValue(o.id,{value:l})}}catch(t){s.e(t)}finally{s.f()}}};t._dispatchEventFromSandbox(a,n)})),this._setEventListeners(l,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],(function(t){return t.target.checked}))}return this._setBackgroundColor(l),this._setDefaultPropertiesFromJS(l),this.container.append(l),this.container}}])}(Il),Ol=function(t){function e(t){return j(this,e),z(this,e,[t,{ignoreBorder:t.data.hasAppearance}])}return U(e,t),B(e,[{key:"render",value:function(){var t=this,n=y(e,"render",this,3)([]);n.classList.add("buttonWidgetAnnotation","pushButton");var i=n.lastChild;return this.enableScripting&&this.hasJSActions&&i&&(this._setDefaultPropertiesFromJS(i),i.addEventListener("updatefromsandbox",(function(e){t._dispatchEventFromSandbox({},e)}))),n}}])}(El),Wl=function(t){function e(t){return j(this,e),z(this,e,[t,{isRenderable:t.renderForms}])}return U(e,t),B(e,[{key:"render",value:function(){var t=this;this.container.classList.add("choiceWidgetAnnotation");var e=this.annotationStorage,n=this.data.id,i=e.getValue(n,{value:this.data.fieldValue}),a=document.createElement("select");yl.add(a),a.setAttribute("data-element-id",n),a.disabled=this.data.readOnly,this._setRequired(a,this.data.required),a.name=this.data.fieldName,a.tabIndex=gl;var r=this.data.combo&&this.data.options.length>0;this.data.combo||(a.size=this.data.options.length,this.data.multiSelect&&(a.multiple=!0)),a.addEventListener("resetform",(function(e){var n,i=t.data.defaultFieldValue,r=F(a.options);try{for(r.s();!(n=r.n()).done;){var s=n.value;s.selected=s.value===i}}catch(t){r.e(t)}finally{r.f()}}));var s,o=F(this.data.options);try{for(o.s();!(s=o.n()).done;){var l=s.value,h=document.createElement("option");h.textContent=l.displayValue,h.value=l.exportValue,i.value.includes(l.exportValue)&&(h.setAttribute("selected",!0),r=!1),a.append(h)}}catch(t){o.e(t)}finally{o.f()}var u=null;if(r){var c=document.createElement("option");c.value=" ",c.setAttribute("hidden",!0),c.setAttribute("selected",!0),a.prepend(c),u=function(){c.remove(),a.removeEventListener("input",u),u=null},a.addEventListener("input",u)}var d=function(t){var e=t?"value":"textContent",n=a.options;return a.multiple?Array.prototype.filter.call(n,(function(t){return t.selected})).map((function(t){return t[e]})):-1===n.selectedIndex?null:n[n.selectedIndex][e]},f=d(!1),v=function(t){var e=t.target.options;return Array.prototype.map.call(e,(function(t){return{displayValue:t.textContent,exportValue:t.value}}))};return this.enableScripting&&this.hasJSActions?(a.addEventListener("updatefromsandbox",(function(i){var r={value:function(t){var i;null===(i=u)||void 0===i||i();var r,s=t.detail.value,o=new Set(Array.isArray(s)?s:[s]),l=F(a.options);try{for(l.s();!(r=l.n()).done;){var h=r.value;h.selected=o.has(h.value)}}catch(t){l.e(t)}finally{l.f()}e.setValue(n,{value:d(!0)}),f=d(!1)},multipleSelection:function(t){a.multiple=!0},remove:function(t){var i=a.options,r=t.detail.remove;if(i[r].selected=!1,a.remove(r),i.length>0){var s=Array.prototype.findIndex.call(i,(function(t){return t.selected}));-1===s&&(i[0].selected=!0)}e.setValue(n,{value:d(!0),items:v(t)}),f=d(!1)},clear:function(t){for(;0!==a.length;)a.remove(0);e.setValue(n,{value:null,items:[]}),f=d(!1)},insert:function(t){var i=t.detail.insert,r=i.index,s=i.displayValue,o=i.exportValue,l=a.children[r],h=document.createElement("option");h.textContent=s,h.value=o,l?l.before(h):a.append(h),e.setValue(n,{value:d(!0),items:v(t)}),f=d(!1)},items:function(t){for(var i=t.detail.items;0!==a.length;)a.remove(0);var r,s=F(i);try{for(s.s();!(r=s.n()).done;){var o=r.value,l=o.displayValue,h=o.exportValue,u=document.createElement("option");u.textContent=l,u.value=h,a.append(u)}}catch(t){s.e(t)}finally{s.f()}a.options.length>0&&(a.options[0].selected=!0),e.setValue(n,{value:d(!0),items:v(t)}),f=d(!1)},indices:function(t){var i,a=new Set(t.detail.indices),r=F(t.target.options);try{for(r.s();!(i=r.n()).done;){var s=i.value;s.selected=a.has(s.index)}}catch(t){r.e(t)}finally{r.f()}e.setValue(n,{value:d(!0)}),f=d(!1)},editable:function(t){t.target.disabled=!t.detail.editable}};t._dispatchEventFromSandbox(r,i)})),a.addEventListener("input",(function(i){var a,r=d(!0),s=d(!1);e.setValue(n,{value:r}),i.preventDefault(),null===(a=t.linkService.eventBus)||void 0===a||a.dispatch("dispatcheventinsandbox",{source:t,detail:{id:n,name:"Keystroke",value:f,change:s,changeEx:r,willCommit:!1,commitKey:1,keyDown:!1}})})),this._setEventListeners(a,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],(function(t){return t.target.value}))):a.addEventListener("input",(function(t){e.setValue(n,{value:d(!0)})})),this.data.combo&&this._setTextStyle(a),this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}])}(Il),Bl=function(t){function e(t){var n;j(this,e);var i=t.data,a=t.elements;return(n=z(this,e,[t,{isRenderable:xl._hasPopupData(i)}])).elements=a,n.popup=null,n}return U(e,t),B(e,[{key:"render",value:function(){this.container.classList.add("popupAnnotation");var t,e=this.popup=new sh({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),n=[],i=F(this.elements);try{for(i.s();!(t=i.n()).done;){var a=t.value;a.popup=e,a.container.ariaHasPopup="dialog",n.push(a.data.id),a.addHighlightArea()}}catch(t){i.e(t)}finally{i.f()}return this.container.setAttribute("aria-controls",n.map((function(t){return"".concat(Nt).concat(t)})).join(",")),this.container}}])}(xl),Hl=new WeakMap,jl=new WeakMap,zl=new WeakMap,Gl=new WeakMap,Vl=new WeakMap,Ul=new WeakMap,ql=new WeakMap,Xl=new WeakMap,Yl=new WeakMap,Kl=new WeakMap,Ql=new WeakMap,Jl=new WeakMap,Zl=new WeakMap,$l=new WeakMap,th=new WeakMap,eh=new WeakMap,nh=new WeakMap,ih=new WeakMap,ah=new WeakMap,rh=new WeakSet,sh=function(){return B((function t(e){var n=e.container,i=e.color,a=e.elements,r=e.titleObj,s=e.modificationDate,o=e.contentsObj,l=e.richText,h=e.parent,u=e.rect,c=e.parentRect,d=e.open;j(this,t),A(this,rh),_(this,Hl,R(rh,this,ch).bind(this)),_(this,jl,R(rh,this,ph).bind(this)),_(this,zl,R(rh,this,vh).bind(this)),_(this,Gl,R(rh,this,fh).bind(this)),_(this,Vl,null),_(this,Ul,null),_(this,ql,null),_(this,Xl,null),_(this,Yl,null),_(this,Kl,null),_(this,Ql,null),_(this,Jl,!1),_(this,Zl,null),_(this,$l,null),_(this,th,null),_(this,eh,null),_(this,nh,null),_(this,ih,null),_(this,ah,!1),E(Ul,this,n),E(nh,this,r),E(ql,this,o),E(eh,this,l),E(Kl,this,h),E(Vl,this,i),E(th,this,u),E(Ql,this,c),E(Yl,this,a),E(Xl,this,Zt.toDateObject(s)),this.trigger=a.flatMap((function(t){return t.getElementsToTriggerPopup()}));var f,v=F(this.trigger);try{for(v.s();!(f=v.n()).done;){var p=f.value;p.addEventListener("click",M(Gl,this)),p.addEventListener("mouseenter",M(zl,this)),p.addEventListener("mouseleave",M(jl,this)),p.classList.add("popupTriggerArea")}}catch(t){v.e(t)}finally{v.f()}var g,y=F(a);try{for(y.s();!(g=y.n()).done;){var m;null===(m=g.value.container)||void 0===m||m.addEventListener("keydown",M(Hl,this))}}catch(t){y.e(t)}finally{y.f()}M(Ul,this).hidden=!0,d&&R(rh,this,fh).call(this)}),[{key:"render",value:function(){if(!M(Zl,this)){var t=E(Zl,this,document.createElement("div"));if(t.className="popup",M(Vl,this)){var e=t.style.outlineColor=Pt.makeHexColor.apply(Pt,k(M(Vl,this)));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?t.style.backgroundColor="color-mix(in srgb, ".concat(e," 30%, white)"):t.style.backgroundColor=Pt.makeHexColor.apply(Pt,k(M(Vl,this).map((function(t){return Math.floor(.7*(255-t)+t)}))))}var n=document.createElement("span");n.className="header";var i=document.createElement("h1");n.append(i);var a=M(nh,this);if(i.dir=a.dir,i.textContent=a.str,t.append(n),M(Xl,this)){var r=document.createElement("span");r.classList.add("popupDate"),r.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),r.setAttribute("data-l10n-args",JSON.stringify({dateObj:M(Xl,this).valueOf()})),n.append(r)}var s=S(rh,this,oh);if(s)pl.render({xfaHtml:s,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{var o=this._formatContents(M(ql,this));t.append(o)}M(Ul,this).append(t)}}},{key:"_formatContents",value:function(t){var e=t.str,n=t.dir,i=document.createElement("p");i.classList.add("popupContent"),i.dir=n;for(var a=e.split(/(?:\r\n?|\n)/),r=0,s=a.length;r<s;++r){var o=a[r];i.append(document.createTextNode(o)),r<s-1&&i.append(document.createElement("br"))}return i}},{key:"updateEdited",value:function(t){var e,n=t.rect,i=t.popupContent;M(ih,this)||E(ih,this,{contentsObj:M(ql,this),richText:M(eh,this)}),n&&E($l,this,null),i&&(E(eh,this,R(rh,this,uh).call(this,i)),E(ql,this,null)),null===(e=M(Zl,this))||void 0===e||e.remove(),E(Zl,this,null)}},{key:"resetEdited",value:function(){var t;if(M(ih,this)){var e=M(ih,this);g(E,[ql,this])._=e.contentsObj,g(E,[eh,this])._=e.richText,E(ih,this,null),null===(t=M(Zl,this))||void 0===t||t.remove(),E(Zl,this,null),E($l,this,null)}}},{key:"forceHide",value:function(){E(ah,this,this.isVisible),M(ah,this)&&(M(Ul,this).hidden=!0)}},{key:"maybeShow",value:function(){M(ah,this)&&(M(Zl,this)||R(rh,this,vh).call(this),E(ah,this,!1),M(Ul,this).hidden=!1)}},{key:"isVisible",get:function(){return!1===M(Ul,this).hidden}}])}();function oh(t){var e=M(eh,t),n=M(ql,t);return null==e||!e.str||null!=n&&n.str&&n.str!==e.str?null:M(eh,t).html||null}function lh(t){var e;return(null===(e=S(rh,t,oh))||void 0===e||null===(e=e.attributes)||void 0===e||null===(e=e.style)||void 0===e?void 0:e.fontSize)||0}function hh(t){var e;return(null===(e=S(rh,t,oh))||void 0===e||null===(e=e.attributes)||void 0===e||null===(e=e.style)||void 0===e?void 0:e.color)||null}function uh(t){var e,n=[],i={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:n}]}},a={style:{color:S(rh,this,hh),fontSize:S(rh,this,lh)?"calc(".concat(S(rh,this,lh),"px * var(--scale-factor))"):""}},r=F(t.split("\n"));try{for(r.s();!(e=r.n()).done;){var s=e.value;n.push({name:"span",value:s,attributes:a})}}catch(t){r.e(t)}finally{r.f()}return i}function ch(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||("Enter"===t.key||"Escape"===t.key&&M(Jl,this))&&R(rh,this,fh).call(this)}function dh(){if(null===M($l,this)){var t,e=M(Kl,this),n=e.page.view,i=e.viewport.rawDims,a=i.pageWidth,r=i.pageHeight,s=i.pageX,o=i.pageY,l=!!M(Ql,this),h=M(l?Ql:th,this),u=F(M(Yl,this));try{for(u.s();!(t=u.n()).done;){var c=t.value;if(!h||null!==Pt.intersect(c.data.rect,h)){h=c.data.rect,l=!0;break}}}catch(t){u.e(t)}finally{u.f()}var d=Pt.normalizeRect([h[0],n[3]-h[1]+n[1],h[2],n[3]-h[3]+n[1]]),f=l?h[2]-h[0]+5:0,v=d[0]+f,p=d[1];E($l,this,[100*(v-s)/a,100*(p-o)/r]);var g=M(Ul,this).style;g.left="".concat(M($l,this)[0],"%"),g.top="".concat(M($l,this)[1],"%")}}function fh(){E(Jl,this,!M(Jl,this)),M(Jl,this)?(R(rh,this,vh).call(this),M(Ul,this).addEventListener("click",M(Gl,this)),M(Ul,this).addEventListener("keydown",M(Hl,this))):(R(rh,this,ph).call(this),M(Ul,this).removeEventListener("click",M(Gl,this)),M(Ul,this).removeEventListener("keydown",M(Hl,this)))}function vh(){M(Zl,this)||this.render(),this.isVisible?M(Jl,this)&&M(Ul,this).classList.add("focused"):(R(rh,this,dh).call(this),M(Ul,this).hidden=!1,M(Ul,this).style.zIndex=parseInt(M(Ul,this).style.zIndex)+1e3)}function ph(){M(Ul,this).classList.remove("focused"),!M(Jl,this)&&this.isVisible&&(M(Ul,this).hidden=!0,M(Ul,this).style.zIndex=parseInt(M(Ul,this).style.zIndex)-1e3)}var gh=function(t){function e(t){var n;return j(this,e),(n=z(this,e,[t,{isRenderable:!0,ignoreBorder:!0}])).textContent=t.data.textContent,n.textPosition=t.data.textPosition,n.annotationEditorType=et.FREETEXT,n}return U(e,t),B(e,[{key:"render",value:function(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){var t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");var e,n=F(this.textContent);try{for(n.s();!(e=n.n()).done;){var i=e.value,a=document.createElement("span");a.textContent=i,t.append(a)}}catch(t){n.e(t)}finally{n.f()}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}])}(xl),yh=new WeakMap,mh=function(t){function e(t){var n;return j(this,e),_(n=z(this,e,[t,{isRenderable:!0,ignoreBorder:!0}]),yh,null),n}return U(e,t),B(e,[{key:"render",value:function(){this.container.classList.add("lineAnnotation");var t=this.data,e=ml(t.rect),n=e.width,i=e.height,a=this.svgFactory.create(n,i,!0),r=E(yh,this,this.svgFactory.createElement("svg:line"));return r.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),r.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),r.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),r.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),r.setAttribute("stroke-width",t.borderStyle.width||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),a.append(r),this.container.append(a),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},{key:"getElementsToTriggerPopup",value:function(){return M(yh,this)}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}])}(xl),kh=new WeakMap,bh=function(t){function e(t){var n;return j(this,e),_(n=z(this,e,[t,{isRenderable:!0,ignoreBorder:!0}]),kh,null),n}return U(e,t),B(e,[{key:"render",value:function(){this.container.classList.add("squareAnnotation");var t=this.data,e=ml(t.rect),n=e.width,i=e.height,a=this.svgFactory.create(n,i,!0),r=t.borderStyle.width,s=E(kh,this,this.svgFactory.createElement("svg:rect"));return s.setAttribute("x",r/2),s.setAttribute("y",r/2),s.setAttribute("width",n-r),s.setAttribute("height",i-r),s.setAttribute("stroke-width",r||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),a.append(s),this.container.append(a),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},{key:"getElementsToTriggerPopup",value:function(){return M(kh,this)}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}])}(xl),wh=new WeakMap,Ah=function(t){function e(t){var n;return j(this,e),_(n=z(this,e,[t,{isRenderable:!0,ignoreBorder:!0}]),wh,null),n}return U(e,t),B(e,[{key:"render",value:function(){this.container.classList.add("circleAnnotation");var t=this.data,e=ml(t.rect),n=e.width,i=e.height,a=this.svgFactory.create(n,i,!0),r=t.borderStyle.width,s=E(wh,this,this.svgFactory.createElement("svg:ellipse"));return s.setAttribute("cx",n/2),s.setAttribute("cy",i/2),s.setAttribute("rx",n/2-r/2),s.setAttribute("ry",i/2-r/2),s.setAttribute("stroke-width",r||1),s.setAttribute("stroke","transparent"),s.setAttribute("fill","transparent"),a.append(s),this.container.append(a),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}},{key:"getElementsToTriggerPopup",value:function(){return M(wh,this)}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}])}(xl),_h=new WeakMap,xh=function(t){function e(t){var n;return j(this,e),_(n=z(this,e,[t,{isRenderable:!0,ignoreBorder:!0}]),_h,null),n.containerClassName="polylineAnnotation",n.svgElementName="svg:polyline",n}return U(e,t),B(e,[{key:"render",value:function(){this.container.classList.add(this.containerClassName);var t=this.data,e=t.rect,n=t.vertices,i=t.borderStyle,a=t.popupRef;if(!n)return this.container;for(var r=ml(e),s=r.width,o=r.height,l=this.svgFactory.create(s,o,!0),h=[],u=0,c=n.length;u<c;u+=2){var d=n[u]-e[0],f=e[3]-n[u+1];h.push("".concat(d,",").concat(f))}h=h.join(" ");var v=E(_h,this,this.svgFactory.createElement(this.svgElementName));return v.setAttribute("points",h),v.setAttribute("stroke-width",i.width||1),v.setAttribute("stroke","transparent"),v.setAttribute("fill","transparent"),l.append(v),this.container.append(l),!a&&this.hasPopupData&&this._createPopup(),this.container}},{key:"getElementsToTriggerPopup",value:function(){return M(_h,this)}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}])}(xl),Sh=function(t){function e(t){var n;return j(this,e),(n=z(this,e,[t])).containerClassName="polygonAnnotation",n.svgElementName="svg:polygon",n}return U(e,t),B(e)}(xh),Mh=function(t){function e(t){return j(this,e),z(this,e,[t,{isRenderable:!0,ignoreBorder:!0}])}return U(e,t),B(e,[{key:"render",value:function(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}])}(xl),Eh=new WeakMap,Ch=new WeakMap,Th=new WeakSet,Ph=function(t){function e(t){var n;return j(this,e),A(n=z(this,e,[t,{isRenderable:!0,ignoreBorder:!0}]),Th),_(n,Eh,null),_(n,Ch,[]),n.containerClassName="inkAnnotation",n.svgElementName="svg:polyline",n.annotationEditorType="InkHighlight"===n.data.it?et.HIGHLIGHT:et.INK,n}return U(e,t),B(e,[{key:"render",value:function(){this.container.classList.add(this.containerClassName);var t=this.data,e=t.rect,n=t.rotation,i=t.inkLists,a=t.borderStyle,r=t.popupRef,s=R(Th,this,Rh).call(this,n,e),o=s.transform,l=s.width,h=s.height,u=this.svgFactory.create(l,h,!0),c=E(Eh,this,this.svgFactory.createElement("svg:g"));u.append(c),c.setAttribute("stroke-width",a.width||1),c.setAttribute("stroke-linecap","round"),c.setAttribute("stroke-linejoin","round"),c.setAttribute("stroke-miterlimit",10),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),c.setAttribute("transform",o);for(var d=0,f=i.length;d<f;d++){var v=this.svgFactory.createElement(this.svgElementName);M(Ch,this).push(v),v.setAttribute("points",i[d].join(",")),c.append(v)}return!r&&this.hasPopupData&&this._createPopup(),this.container.append(u),this._editOnDoubleClick(),this.container}},{key:"updateEdited",value:function(t){y(e,"updateEdited",this,3)([t]);var n=t.thickness,i=t.points,a=t.rect,r=M(Eh,this);if(n>=0&&r.setAttribute("stroke-width",n||1),i)for(var s=0,o=M(Ch,this).length;s<o;s++)M(Ch,this)[s].setAttribute("points",i[s].join(","));if(a){var l=R(Th,this,Rh).call(this,this.data.rotation,a),h=l.transform,u=l.width,c=l.height;r.parentElement.setAttribute("viewBox","0 0 ".concat(u," ").concat(c)),r.setAttribute("transform",h)}}},{key:"getElementsToTriggerPopup",value:function(){return M(Ch,this)}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}])}(xl);function Rh(t,e){switch(t){case 90:return{transform:"rotate(90) translate(".concat(-e[0],",").concat(e[1],") scale(1,-1)"),width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:"rotate(180) translate(".concat(-e[2],",").concat(e[1],") scale(1,-1)"),width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:"rotate(270) translate(".concat(-e[2],",").concat(e[3],") scale(1,-1)"),width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:"translate(".concat(-e[0],",").concat(e[3],") scale(1,-1)"),width:e[2]-e[0],height:e[3]-e[1]}}}var Ih=function(t){function e(t){var n;return j(this,e),(n=z(this,e,[t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}])).annotationEditorType=et.HIGHLIGHT,n}return U(e,t),B(e,[{key:"render",value:function(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),this.container}}])}(xl),Lh=function(t){function e(t){return j(this,e),z(this,e,[t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}])}return U(e,t),B(e,[{key:"render",value:function(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}])}(xl),Dh=function(t){function e(t){return j(this,e),z(this,e,[t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}])}return U(e,t),B(e,[{key:"render",value:function(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}])}(xl),Fh=function(t){function e(t){return j(this,e),z(this,e,[t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}])}return U(e,t),B(e,[{key:"render",value:function(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}])}(xl),Nh=function(t){function e(t){var n;return j(this,e),(n=z(this,e,[t,{isRenderable:!0,ignoreBorder:!0}])).annotationEditorType=et.STAMP,n}return U(e,t),B(e,[{key:"render",value:function(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}])}(xl),Oh=new WeakMap,Wh=new WeakSet,Bh=function(t){function e(t){var n,i;j(this,e),A(i=z(this,e,[t,{isRenderable:!0}]),Wh),_(i,Oh,null);var a=i.data.file;return i.filename=a.filename,i.content=a.content,null===(n=i.linkService.eventBus)||void 0===n||n.dispatch("fileattachmentannotation",p({source:i},a)),i}return U(e,t),B(e,[{key:"render",value:function(){var t=this;this.container.classList.add("fileAttachmentAnnotation");var e,n=this.container,i=this.data;i.hasAppearance||0===i.fillAlpha?e=document.createElement("div"):((e=document.createElement("img")).src="".concat(this.imageResourcesPath,"annotation-").concat(/paperclip/i.test(i.name)?"paperclip":"pushpin",".svg"),i.fillAlpha&&i.fillAlpha<1&&(e.style="filter: opacity(".concat(Math.round(100*i.fillAlpha),"%);"))),e.addEventListener("dblclick",R(Wh,this,Hh).bind(this)),E(Oh,this,e);var a=Ct.platform.isMac;return n.addEventListener("keydown",(function(e){"Enter"===e.key&&(a?e.metaKey:e.ctrlKey)&&R(Wh,t,Hh).call(t)})),!i.popupRef&&this.hasPopupData?this._createPopup():e.classList.add("popupTriggerArea"),n.append(e),n}},{key:"getElementsToTriggerPopup",value:function(){return M(Oh,this)}},{key:"addHighlightArea",value:function(){this.container.classList.add("highlightArea")}}])}(xl);function Hh(){var t;null===(t=this.downloadManager)||void 0===t||t.openOrDownloadData(this.content,this.filename)}var jh=new WeakMap,zh=new WeakMap,Gh=new WeakMap,Vh=new WeakMap,Uh=new WeakSet,qh=function(){return B((function t(e){var n=e.div,i=e.accessibilityManager,a=e.annotationCanvasMap,r=e.annotationEditorUIManager,s=e.page,o=e.viewport,l=e.structTreeLayer;j(this,t),A(this,Uh),_(this,jh,null),_(this,zh,null),_(this,Gh,new Map),_(this,Vh,null),this.div=n,E(jh,this,i),E(zh,this,a),E(Vh,this,l||null),this.page=s,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=r}),[{key:"hasEditableAnnotations",value:function(){return M(Gh,this).size>0}},{key:"render",value:(t=T(w().mark((function t(e){var n,i,a,r,s,o,l,h,u,c,d,f,v,p,g,y;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.annotations,ae(i=this.div,this.viewport),a=new Map,r={data:null,layer:i,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:!1!==e.renderForms,svgFactory:new vl,annotationStorage:e.annotationStorage||new wa,enableScripting:!0===e.enableScripting,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null},s=F(n),t.prev=6,s.s();case 8:if((o=s.n()).done){t.next=35;break}if(!(l=o.value).noHTML){t.next=12;break}return t.abrupt("continue",33);case 12:if(h=16===l.annotationType){t.next=19;break}if(u=ml(l.rect),c=u.width,d=u.height,!(c<=0||d<=0)){t.next=17;break}return t.abrupt("continue",33);case 17:t.next=23;break;case 19:if(f=a.get(l.id)){t.next=22;break}return t.abrupt("continue",33);case 22:r.elements=f;case 23:if(r.data=l,(v=kl.create(r)).isRenderable){t.next=27;break}return t.abrupt("continue",33);case 27:return!h&&l.popupRef&&((p=a.get(l.popupRef))?p.push(v):a.set(l.popupRef,[v])),g=v.render(),l.hidden&&(g.style.visibility="hidden"),t.next=32,R(Uh,this,Xh).call(this,g,l.id);case 32:v._isEditable&&(M(Gh,this).set(v.data.id,v),null===(y=this._annotationEditorUIManager)||void 0===y||y.renderAnnotationElement(v));case 33:t.next=8;break;case 35:t.next=40;break;case 37:t.prev=37,t.t0=t.catch(6),s.e(t.t0);case 40:return t.prev=40,s.f(),t.finish(40);case 43:R(Uh,this,Kh).call(this);case 44:case"end":return t.stop()}}),t,this,[[6,37,40,43]])}))),function(e){return t.apply(this,arguments)})},{key:"update",value:function(t){var e=t.viewport,n=this.div;this.viewport=e,ae(n,{rotation:e.rotation}),R(Uh,this,Kh).call(this),n.hidden=!1}},{key:"getEditableAnnotations",value:function(){return Array.from(M(Gh,this).values())}},{key:"getEditableAnnotation",value:function(t){return M(Gh,this).get(t)}}]);var t}();function Xh(t,e){return Yh.apply(this,arguments)}function Yh(){return(Yh=T(w().mark((function t(e,n){var i,a,r,s,o,l,h,u,c,d;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.firstChild||e,s=r.id="".concat(Nt).concat(n),t.next=4,null===(i=M(Vh,this))||void 0===i?void 0:i.getAriaAttributes(s);case 4:if(o=t.sent){l=F(o);try{for(l.s();!(h=l.n()).done;)u=I(h.value,2),c=u[0],d=u[1],r.setAttribute(c,d)}catch(t){l.e(t)}finally{l.f()}}this.div.append(e),null===(a=M(jh,this))||void 0===a||a.moveElementInDOM(this.div,e,r,!1);case 8:case"end":return t.stop()}}),t,this)})))).apply(this,arguments)}function Kh(){if(M(zh,this)){var t,e=this.div,n=F(M(zh,this));try{for(n.s();!(t=n.n()).done;){var i=I(t.value,2),a=i[0],r=i[1],s=e.querySelector('[data-annotation-id="'.concat(a,'"]'));if(s){r.className="annotationContent";var o=s.firstChild;o?"CANVAS"===o.nodeName?o.replaceWith(r):o.classList.contains("annotationContent")?o.after(r):o.before(r):s.append(r)}}}catch(t){n.e(t)}finally{n.f()}M(zh,this).clear()}}var Qh=/\r\n?|\n/g,Jh=new WeakMap,Zh=new WeakMap,$h=new WeakMap,tu=new WeakMap,eu=new WeakMap,nu=new WeakSet,iu=function(t){function e(t){var n;return j(this,e),A(n=z(this,e,[p(p({},t),{},{name:"freeTextEditor"})]),nu),_(n,Jh,void 0),_(n,Zh,""),_(n,$h,"".concat(n.id,"-editor")),_(n,tu,null),_(n,eu,void 0),E(Jh,n,t.color||e._defaultColor||Yi._defaultLineColor),E(eu,n,t.fontSize||e._defaultFontSize),n}return U(e,t),B(e,[{key:"updateParams",value:function(t,e){switch(t){case nt.FREETEXT_SIZE:R(nu,this,au).call(this,e);break;case nt.FREETEXT_COLOR:R(nu,this,ru).call(this,e)}}},{key:"propertiesToUpdate",get:function(){return[[nt.FREETEXT_SIZE,M(eu,this)],[nt.FREETEXT_COLOR,M(Jh,this)]]}},{key:"_translateEmpty",value:function(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}},{key:"getInitialTranslation",value:function(){var t=this.parentScale;return[-e._internalPadding*t,-(e._internalPadding+M(eu,this))*t]}},{key:"rebuild",value:function(){this.parent&&(y(e,"rebuild",this,3)([]),null!==this.div&&(this.isAttachedToDOM||this.parent.add(this)))}},{key:"enableEditMode",value:function(){if(!this.isInEditMode()){this.parent.setEditingState(!1),this.parent.updateToolbar(et.FREETEXT),y(e,"enableEditMode",this,3)([]),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),E(tu,this,new AbortController);var t=this._uiManager.combinedSignal(M(tu,this));this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t})}}},{key:"disableEditMode",value:function(){var t;this.isInEditMode()&&(this.parent.setEditingState(!0),y(e,"disableEditMode",this,3)([]),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",M($h,this)),this._isDraggable=!0,null===(t=M(tu,this))||void 0===t||t.abort(),E(tu,this,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}},{key:"focusin",value:function(t){this._focusEventsAllowed&&(y(e,"focusin",this,3)([t]),t.target!==this.editorDiv&&this.editorDiv.focus())}},{key:"onceAdded",value:function(t){var e;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),null!==(e=this._initialOptions)&&void 0!==e&&e.isCentered&&this.center(),this._initialOptions=null)}},{key:"isEmpty",value:function(){return!this.editorDiv||""===this.editorDiv.innerText.trim()}},{key:"remove",value:function(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),y(e,"remove",this,3)([])}},{key:"commit",value:function(){var t=this;if(this.isInEditMode()){y(e,"commit",this,3)([]),this.disableEditMode();var n=M(Zh,this),i=E(Zh,this,R(nu,this,su).call(this).trimEnd());if(n!==i){var a=function(e){E(Zh,t,e),e?(R(nu,t,hu).call(t),t._uiManager.rebuild(t),R(nu,t,ou).call(t)):t.remove()};this.addCommands({cmd:function(){a(i)},undo:function(){a(n)},mustExec:!1}),R(nu,this,ou).call(this)}}}},{key:"shouldGetKeyboardEvents",value:function(){return this.isInEditMode()}},{key:"enterInEditMode",value:function(){this.enableEditMode(),this.editorDiv.focus()}},{key:"dblclick",value:function(t){this.enterInEditMode()}},{key:"keydown",value:function(t){t.target===this.div&&"Enter"===t.key&&(this.enterInEditMode(),t.preventDefault())}},{key:"editorDivKeydown",value:function(t){e._keyboardManager.exec(this,t)}},{key:"editorDivFocus",value:function(t){this.isEditing=!0}},{key:"editorDivBlur",value:function(t){this.isEditing=!1}},{key:"editorDivInput",value:function(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}},{key:"disableEditing",value:function(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}},{key:"enableEditing",value:function(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}},{key:"render",value:function(){if(this.div)return this.div;var t,n;this.width&&(t=this.x,n=this.y),y(e,"render",this,3)([]),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",M($h,this)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;var i=this.editorDiv.style;if(i.fontSize="calc(".concat(M(eu,this),"px * var(--scale-factor))"),i.color=M(Jh,this),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),Ce(this,this.div,["dblclick","keydown"]),this.width){var a=I(this.parentDimensions,2),r=a[0],s=a[1];if(this.annotationElementId){var o=this._initialData.position,l=I(this.getInitialTranslation(),2),h=l[0],u=l[1],c=I(this.pageTranslationToScreen(h,u),2);h=c[0],u=c[1];var d,f,v=I(this.pageDimensions,2),p=v[0],g=v[1],m=I(this.pageTranslation,2),k=m[0],b=m[1];switch(this.rotation){case 0:d=t+(o[0]-k)/p,f=n+this.height-(o[1]-b)/g;break;case 90:d=t+(o[0]-k)/p,f=n-(o[1]-b)/g;var w=[u,-h];h=w[0],u=w[1];break;case 180:d=t-this.width+(o[0]-k)/p,f=n-(o[1]-b)/g;var A=[-h,-u];h=A[0],u=A[1];break;case 270:d=t+(o[0]-k-this.height*g)/p,f=n+(o[1]-b-this.width*p)/g;var _=[-u,h];h=_[0],u=_[1]}this.setAt(d*r,f*s,h,u)}else this.setAt(t*r,n*s,this.width*r,this.height*s);R(nu,this,hu).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}},{key:"editorDivPaste",value:function(t){var n=t.clipboardData||window.clipboardData,i=n.types;if(1!==i.length||"text/plain"!==i[0]){t.preventDefault();var a=cu.call(e,n.getData("text")||"").replaceAll(Qh,"\n");if(a){var r=window.getSelection();if(r.rangeCount){this.editorDiv.normalize(),r.deleteFromDocument();var s=r.getRangeAt(0);if(!a.includes("\n"))return s.insertNode(document.createTextNode(a)),this.editorDiv.normalize(),void r.collapseToStart();var o=s.startContainer,l=s.startOffset,h=[],u=[];if(o.nodeType===Node.TEXT_NODE){var c=o.parentElement;if(u.push(o.nodeValue.slice(l).replaceAll(Qh,"")),c!==this.editorDiv){var d,f=h,v=F(this.editorDiv.childNodes);try{for(v.s();!(d=v.n()).done;){var p=d.value;p!==c?f.push(lu.call(e,p)):f=u}}catch(t){v.e(t)}finally{v.f()}}h.push(o.nodeValue.slice(0,l).replaceAll(Qh,""))}else if(o===this.editorDiv){var g,y=h,m=0,k=F(this.editorDiv.childNodes);try{for(k.s();!(g=k.n()).done;){var b=g.value;m++===l&&(y=u),y.push(lu.call(e,b))}}catch(t){k.e(t)}finally{k.f()}}E(Zh,this,"".concat(h.join("\n")).concat(a).concat(u.join("\n"))),R(nu,this,hu).call(this);var w,A=new Range,_=h.reduce((function(t,e){return t+e.length}),0),x=F(this.editorDiv.childNodes);try{for(x.s();!(w=x.n()).done;){var S=w.value.firstChild;if(S.nodeType===Node.TEXT_NODE){var M=S.nodeValue.length;if(_<=M){A.setStart(S,_),A.setEnd(S,_);break}_-=M}}}catch(t){x.e(t)}finally{x.f()}r.removeAllRanges(),r.addRange(A)}}}}},{key:"contentDiv",get:function(){return this.editorDiv}},{key:"serialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();var n=e._internalPadding*this.parentScale,i=this.getRect(n,n),a=Yi._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:M(Jh,this)),r={annotationType:et.FREETEXT,color:a,fontSize:M(eu,this),value:R(nu,this,uu).call(this),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?r:this.annotationElementId&&!R(nu,this,du).call(this,r)?null:(r.id=this.annotationElementId,r)}},{key:"renderAnnotationElement",value:function(t){var n=y(e,"renderAnnotationElement",this,3)([t]);if(this.deleted)return n;var i=n.style;i.fontSize="calc(".concat(M(eu,this),"px * var(--scale-factor))"),i.color=M(Jh,this),n.replaceChildren();var a,r=F(M(Zh,this).split("\n"));try{for(r.s();!(a=r.n()).done;){var s=a.value,o=document.createElement("div");o.append(s?document.createTextNode(s):document.createElement("br")),n.append(o)}}catch(t){r.e(t)}finally{r.f()}var l=e._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(l,l),popupContent:M(Zh,this)}),n}},{key:"resetAnnotationElement",value:function(t){y(e,"resetAnnotationElement",this,3)([t]),t.resetEdited()}}],[{key:"_keyboardManager",get:function(){var t=e.prototype,n=function(t){return t.isEmpty()},i=On.TRANSLATE_SMALL,a=On.TRANSLATE_BIG;return gt(this,"_keyboardManager",new Ve([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:n}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-a,0],checker:n}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:n}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[a,0],checker:n}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:n}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-a],checker:n}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:n}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,a],checker:n}]]))}},{key:"initialize",value:function(t,e){Yi.initialize(t,e);var n=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(n.getPropertyValue("--freetext-padding"))}},{key:"updateDefaultParams",value:function(t,n){switch(t){case nt.FREETEXT_SIZE:e._defaultFontSize=n;break;case nt.FREETEXT_COLOR:e._defaultColor=n}}},{key:"defaultPropertiesToUpdate",get:function(){return[[nt.FREETEXT_SIZE,e._defaultFontSize],[nt.FREETEXT_COLOR,e._defaultColor||Yi._defaultLineColor]]}},{key:"deserialize",value:(n=T(w().mark((function t(n,i,a){var r,s,o,l,h,u,c,d,f,v,p,g,m,b;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=null,!(n instanceof gh)){t.next=6;break}if(o=(s=n).data,l=o.defaultAppearanceData,h=l.fontSize,u=l.fontColor,c=o.rect,d=o.rotation,f=o.id,v=o.popupRef,p=s.textContent,g=s.textPosition,m=s.parent.page.pageNumber,p&&0!==p.length){t.next=5;break}return t.abrupt("return",null);case 5:r=n={annotationType:et.FREETEXT,color:Array.from(u),fontSize:h,value:p.join("\n"),position:g,pageIndex:m-1,rect:c.slice(0),rotation:d,id:f,deleted:!1,popupRef:v};case 6:return t.next=8,y(e,"deserialize",this,2)([n,i,a]);case 8:return b=t.sent,E(eu,b,n.fontSize),E(Jh,b,Pt.makeHexColor.apply(Pt,k(n.color))),E(Zh,b,cu.call(e,n.value)),b.annotationElementId=n.id||null,b._initialData=r,t.abrupt("return",b);case 15:case"end":return t.stop()}}),t,this)}))),function(t,e,i){return n.apply(this,arguments)})}]);var n}(Yi);function au(t){var e=this,n=function(t){e.editorDiv.style.fontSize="calc(".concat(t,"px * var(--scale-factor))"),e.translate(0,-(t-M(eu,e))*e.parentScale),E(eu,e,t),R(nu,e,ou).call(e)},i=M(eu,this);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:nt.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}function ru(t){var e=this,n=function(t){E(Jh,e,e.editorDiv.style.color=t)},i=M(Jh,this);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:nt.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}function su(){var t=[];this.editorDiv.normalize();var e,n=null,i=F(this.editorDiv.childNodes);try{for(i.s();!(e=i.n()).done;){var a,r=e.value;(null===(a=n)||void 0===a?void 0:a.nodeType)===Node.TEXT_NODE&&"BR"===r.nodeName||(t.push(lu.call(s,r)),n=r)}}catch(t){i.e(t)}finally{i.f()}return t.join("\n")}function ou(){var t,e=I(this.parentDimensions,2),n=e[0],i=e[1];if(this.isAttachedToDOM)t=this.div.getBoundingClientRect();else{var a=this.currentLayer,r=this.div,s=r.style.display,o=r.classList.contains("hidden");r.classList.remove("hidden"),r.style.display="hidden",a.div.append(this.div),t=r.getBoundingClientRect(),r.remove(),r.style.display=s,r.classList.toggle("hidden",o)}this.rotation%180==this.parentRotation%180?(this.width=t.width/n,this.height=t.height/i):(this.width=t.height/n,this.height=t.width/i),this.fixAndSetPosition()}function lu(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Qh,"")}function hu(){if(this.editorDiv.replaceChildren(),M(Zh,this)){var t,e=F(M(Zh,this).split("\n"));try{for(e.s();!(t=e.n()).done;){var n=t.value,i=document.createElement("div");i.append(n?document.createTextNode(n):document.createElement("br")),this.editorDiv.append(i)}}catch(t){e.e(t)}finally{e.f()}}}function uu(){return M(Zh,this).replaceAll(" "," ")}function cu(t){return t.replaceAll(" "," ")}function du(t){var e=this._initialData,n=e.value,i=e.fontSize,a=e.color,r=e.pageIndex;return this._hasBeenMoved||t.value!==n||t.fontSize!==i||t.color.some((function(t,e){return t!==a[e]}))||t.pageIndex!==r}s=iu,P(iu,"_freeTextDefaultContent",""),P(iu,"_internalPadding",0),P(iu,"_defaultColor",null),P(iu,"_defaultFontSize",10),P(iu,"_type","freetext"),P(iu,"_editorType",et.FREETEXT);var fu=function(){return B((function t(){j(this,t)}),[{key:"toSVGPath",value:function(){ft("Abstract method `toSVGPath` must be implemented.")}},{key:"box",get:function(){ft("Abstract getter `box` must be implemented.")}},{key:"serialize",value:function(t,e){ft("Abstract method `serialize` must be implemented.")}}],[{key:"_rescale",value:function(t,e,n,i,a,r){r||(r=new Float32Array(t.length));for(var s=0,o=t.length;s<o;s+=2)r[s]=e+t[s]*i,r[s+1]=n+t[s+1]*a;return r}},{key:"_rescaleAndSwap",value:function(t,e,n,i,a,r){r||(r=new Float32Array(t.length));for(var s=0,o=t.length;s<o;s+=2)r[s]=e+t[s+1]*i,r[s+1]=n+t[s]*a;return r}},{key:"_translate",value:function(t,e,n,i){i||(i=new Float32Array(t.length));for(var a=0,r=t.length;a<r;a+=2)i[a]=e+t[a],i[a+1]=n+t[a+1];return i}},{key:"svgRound",value:function(t){return Math.round(1e4*t)}},{key:"_normalizePoint",value:function(t,e,n,i,a){switch(a){case 90:return[1-e/n,t/i];case 180:return[1-t/n,1-e/i];case 270:return[e/n,1-t/i];default:return[t/n,e/i]}}},{key:"_normalizePagePoint",value:function(t,e,n){switch(n){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}},{key:"createBezierPoints",value:function(t,e,n,i,a,r){return[(t+5*n)/6,(e+5*i)/6,(5*n+a)/6,(5*i+r)/6,(n+a)/2,(i+r)/2]}}])}();P(fu,"PRECISION",1e-4);var vu=new WeakMap,pu=new WeakMap,gu=new WeakMap,yu=new WeakMap,mu=new WeakMap,ku=new WeakMap,bu=new WeakMap,wu=new WeakMap,Au=new WeakMap,_u=new WeakMap,xu=new WeakMap,Su=new WeakMap,Mu=new WeakMap,Eu=new WeakSet,Cu=function(){return B((function t(e,n,i,a,r){var s=e.x,o=e.y,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;j(this,t),A(this,Eu),_(this,vu,void 0),_(this,pu,[]),_(this,gu,void 0),_(this,yu,void 0),_(this,mu,[]),_(this,ku,new Float32Array(18)),_(this,bu,void 0),_(this,wu,void 0),_(this,Au,void 0),_(this,_u,void 0),_(this,xu,void 0),_(this,Su,void 0),_(this,Mu,[]),E(vu,this,n),E(Su,this,a*i),E(yu,this,r),M(ku,this).set([NaN,NaN,NaN,NaN,s,o],6),E(gu,this,l),E(_u,this,Nu._*i),E(Au,this,Ou._*i),E(xu,this,i),M(Mu,this).push(s,o)}),[{key:"isEmpty",value:function(){return isNaN(M(ku,this)[8])}},{key:"add",value:function(t){var e,n=t.x,i=t.y;E(bu,this,n),E(wu,this,i);var a=I(M(vu,this),4),r=a[0],s=a[1],o=a[2],l=a[3],h=I(M(ku,this).subarray(8,12),4),u=h[0],c=h[1],d=h[2],f=h[3],v=n-d,p=i-f,g=Math.hypot(v,p);if(g<M(Au,this))return!1;var y=g-M(_u,this),m=y/g,k=m*v,b=m*p,w=u,A=c;u=d,c=f,d+=k,f+=b,null===(e=M(Mu,this))||void 0===e||e.push(n,i);var _=k/y,x=-b/y*M(Su,this),S=_*M(Su,this);if(M(ku,this).set(M(ku,this).subarray(2,8),0),M(ku,this).set([d+x,f+S],4),M(ku,this).set(M(ku,this).subarray(14,18),12),M(ku,this).set([d-x,f-S],16),isNaN(M(ku,this)[6]))return 0===M(mu,this).length&&(M(ku,this).set([u+x,c+S],2),M(mu,this).push(NaN,NaN,NaN,NaN,(u+x-r)/o,(c+S-s)/l),M(ku,this).set([u-x,c-S],14),M(pu,this).push(NaN,NaN,NaN,NaN,(u-x-r)/o,(c-S-s)/l)),M(ku,this).set([w,A,u,c,d,f],6),!this.isEmpty();if(M(ku,this).set([w,A,u,c,d,f],6),Math.abs(Math.atan2(A-c,w-u)-Math.atan2(b,k))<Math.PI/2){var C=I(M(ku,this).subarray(2,6),4);u=C[0],c=C[1],d=C[2],f=C[3],M(mu,this).push(NaN,NaN,NaN,NaN,((u+d)/2-r)/o,((c+f)/2-s)/l);var T=I(M(ku,this).subarray(14,18),4);return u=T[0],c=T[1],w=T[2],A=T[3],M(pu,this).push(NaN,NaN,NaN,NaN,((w+u)/2-r)/o,((A+c)/2-s)/l),!0}var P=I(M(ku,this).subarray(0,6),6);w=P[0],A=P[1],u=P[2],c=P[3],d=P[4],f=P[5],M(mu,this).push(((w+5*u)/6-r)/o,((A+5*c)/6-s)/l,((5*u+d)/6-r)/o,((5*c+f)/6-s)/l,((u+d)/2-r)/o,((c+f)/2-s)/l);var R=I(M(ku,this).subarray(12,18),6);return d=R[0],f=R[1],u=R[2],c=R[3],w=R[4],A=R[5],M(pu,this).push(((w+5*u)/6-r)/o,((A+5*c)/6-s)/l,((5*u+d)/6-r)/o,((5*c+f)/6-s)/l,((u+d)/2-r)/o,((c+f)/2-s)/l),!0}},{key:"toSVGPath",value:function(){if(this.isEmpty())return"";var t=M(mu,this),e=M(pu,this);if(isNaN(M(ku,this)[6])&&!this.isEmpty())return R(Eu,this,Pu).call(this);var n=[];n.push("M".concat(t[4]," ").concat(t[5]));for(var i=6;i<t.length;i+=6)isNaN(t[i])?n.push("L".concat(t[i+4]," ").concat(t[i+5])):n.push("C".concat(t[i]," ").concat(t[i+1]," ").concat(t[i+2]," ").concat(t[i+3]," ").concat(t[i+4]," ").concat(t[i+5]));R(Eu,this,Iu).call(this,n);for(var a=e.length-6;a>=6;a-=6)isNaN(e[a])?n.push("L".concat(e[a+4]," ").concat(e[a+5])):n.push("C".concat(e[a]," ").concat(e[a+1]," ").concat(e[a+2]," ").concat(e[a+3]," ").concat(e[a+4]," ").concat(e[a+5]));return R(Eu,this,Ru).call(this,n),n.join(" ")}},{key:"newFreeDrawOutline",value:function(t,e,n,i,a,r){return new qu(t,e,n,i,a,r)}},{key:"getOutlines",value:function(){for(var t,e,n=M(mu,this),i=M(pu,this),a=M(ku,this),r=I(M(vu,this),4),s=r[0],o=r[1],l=r[2],h=r[3],u=new Float32Array((null!==(t=null===(e=M(Mu,this))||void 0===e?void 0:e.length)&&void 0!==t?t:0)+2),c=0,d=u.length-2;c<d;c+=2)u[c]=(M(Mu,this)[c]-s)/l,u[c+1]=(M(Mu,this)[c+1]-o)/h;if(u[u.length-2]=(M(bu,this)-s)/l,u[u.length-1]=(M(wu,this)-o)/h,isNaN(a[6])&&!this.isEmpty())return R(Eu,this,Lu).call(this,u);for(var f=new Float32Array(M(mu,this).length+24+M(pu,this).length),v=n.length,p=0;p<v;p+=2)isNaN(n[p])?f[p]=f[p+1]=NaN:(f[p]=n[p],f[p+1]=n[p+1]);v=R(Eu,this,Fu).call(this,f,v);for(var g=i.length-6;g>=6;g-=6)for(var y=0;y<6;y+=2)isNaN(i[g+y])?(f[v]=f[v+1]=NaN,v+=2):(f[v]=i[g+y],f[v+1]=i[g+y+1],v+=2);return R(Eu,this,Du).call(this,f,v),this.newFreeDrawOutline(f,u,M(vu,this),M(xu,this),M(gu,this),M(yu,this))}}])}();function Tu(){var t=M(ku,this).subarray(4,6),e=M(ku,this).subarray(16,18),n=I(M(vu,this),4),i=n[0],a=n[1],r=n[2],s=n[3];return[(M(bu,this)+(t[0]-e[0])/2-i)/r,(M(wu,this)+(t[1]-e[1])/2-a)/s,(M(bu,this)+(e[0]-t[0])/2-i)/r,(M(wu,this)+(e[1]-t[1])/2-a)/s]}function Pu(){var t=I(M(vu,this),4),e=t[0],n=t[1],i=t[2],a=t[3],r=I(R(Eu,this,Tu).call(this),4),s=r[0],o=r[1],l=r[2],h=r[3];return"M".concat((M(ku,this)[2]-e)/i," ").concat((M(ku,this)[3]-n)/a," L").concat((M(ku,this)[4]-e)/i," ").concat((M(ku,this)[5]-n)/a," L").concat(s," ").concat(o," L").concat(l," ").concat(h," L").concat((M(ku,this)[16]-e)/i," ").concat((M(ku,this)[17]-n)/a," L").concat((M(ku,this)[14]-e)/i," ").concat((M(ku,this)[15]-n)/a," Z")}function Ru(t){var e=M(pu,this);t.push("L".concat(e[4]," ").concat(e[5]," Z"))}function Iu(t){var e=I(M(vu,this),4),n=e[0],i=e[1],a=e[2],r=e[3],s=M(ku,this).subarray(4,6),o=M(ku,this).subarray(16,18),l=I(R(Eu,this,Tu).call(this),4),h=l[0],u=l[1],c=l[2],d=l[3];t.push("L".concat((s[0]-n)/a," ").concat((s[1]-i)/r," L").concat(h," ").concat(u," L").concat(c," ").concat(d," L").concat((o[0]-n)/a," ").concat((o[1]-i)/r))}function Lu(t){var e=M(ku,this),n=I(M(vu,this),4),i=n[0],a=n[1],r=n[2],s=n[3],o=I(R(Eu,this,Tu).call(this),4),l=o[0],h=o[1],u=o[2],c=o[3],d=new Float32Array(36);return d.set([NaN,NaN,NaN,NaN,(e[2]-i)/r,(e[3]-a)/s,NaN,NaN,NaN,NaN,(e[4]-i)/r,(e[5]-a)/s,NaN,NaN,NaN,NaN,l,h,NaN,NaN,NaN,NaN,u,c,NaN,NaN,NaN,NaN,(e[16]-i)/r,(e[17]-a)/s,NaN,NaN,NaN,NaN,(e[14]-i)/r,(e[15]-a)/s],0),this.newFreeDrawOutline(d,t,M(vu,this),M(xu,this),M(gu,this),M(yu,this))}function Du(t,e){var n=M(pu,this);return t.set([NaN,NaN,NaN,NaN,n[4],n[5]],e),e+6}function Fu(t,e){var n=M(ku,this).subarray(4,6),i=M(ku,this).subarray(16,18),a=I(M(vu,this),4),r=a[0],s=a[1],o=a[2],l=a[3],h=I(R(Eu,this,Tu).call(this),4),u=h[0],c=h[1],d=h[2],f=h[3];return t.set([NaN,NaN,NaN,NaN,(n[0]-r)/o,(n[1]-s)/l,NaN,NaN,NaN,NaN,u,c,NaN,NaN,NaN,NaN,d,f,NaN,NaN,NaN,NaN,(i[0]-r)/o,(i[1]-s)/l],e),e+24}var Nu={_:8},Ou={_:Nu._+2},Wu=new WeakMap,Bu=new WeakMap,Hu=new WeakMap,ju=new WeakMap,zu=new WeakMap,Gu=new WeakMap,Vu=new WeakMap,Uu=new WeakSet,qu=function(t){function e(t,n,i,a,r,s){var o;j(this,e),A(o=z(this,e),Uu),_(o,Wu,void 0),_(o,Bu,new Float32Array(4)),_(o,Hu,void 0),_(o,ju,void 0),_(o,zu,void 0),_(o,Gu,void 0),_(o,Vu,void 0),E(Vu,o,t),E(zu,o,n),E(Wu,o,i),E(Gu,o,a),E(Hu,o,r),E(ju,o,s),o.lastPoint=[NaN,NaN],R(Uu,o,Xu).call(o,s);for(var l=I(M(Bu,o),4),h=l[0],u=l[1],c=l[2],d=l[3],f=0,v=t.length;f<v;f+=2)t[f]=(t[f]-h)/c,t[f+1]=(t[f+1]-u)/d;for(var p=0,g=n.length;p<g;p+=2)n[p]=(n[p]-h)/c,n[p+1]=(n[p+1]-u)/d;return o}return U(e,t),B(e,[{key:"toSVGPath",value:function(){for(var t=["M".concat(M(Vu,this)[4]," ").concat(M(Vu,this)[5])],e=6,n=M(Vu,this).length;e<n;e+=6)isNaN(M(Vu,this)[e])?t.push("L".concat(M(Vu,this)[e+4]," ").concat(M(Vu,this)[e+5])):t.push("C".concat(M(Vu,this)[e]," ").concat(M(Vu,this)[e+1]," ").concat(M(Vu,this)[e+2]," ").concat(M(Vu,this)[e+3]," ").concat(M(Vu,this)[e+4]," ").concat(M(Vu,this)[e+5]));return t.push("Z"),t.join(" ")}},{key:"serialize",value:function(t,e){var n,i,a=I(t,4),r=a[0],s=a[1],o=a[2],l=a[3],h=o-r,u=l-s;switch(e){case 0:n=fu._rescale(M(Vu,this),r,l,h,-u),i=fu._rescale(M(zu,this),r,l,h,-u);break;case 90:n=fu._rescaleAndSwap(M(Vu,this),r,s,h,u),i=fu._rescaleAndSwap(M(zu,this),r,s,h,u);break;case 180:n=fu._rescale(M(Vu,this),o,s,-h,u),i=fu._rescale(M(zu,this),o,s,-h,u);break;case 270:n=fu._rescaleAndSwap(M(Vu,this),o,l,-h,-u),i=fu._rescaleAndSwap(M(zu,this),o,l,-h,-u)}return{outline:Array.from(n),points:[Array.from(i)]}}},{key:"box",get:function(){return M(Bu,this)}},{key:"newOutliner",value:function(t,e,n,i,a){return new Cu(t,e,n,i,a,arguments.length>5&&void 0!==arguments[5]?arguments[5]:0)}},{key:"getNewOutline",value:function(t,e){for(var n=I(M(Bu,this),4),i=n[0],a=n[1],r=n[2],s=n[3],o=I(M(Wu,this),4),l=o[0],h=o[1],u=o[2],c=o[3],d=r*u,f=s*c,v=i*u+l,p=a*c+h,g=this.newOutliner({x:M(zu,this)[0]*d+v,y:M(zu,this)[1]*f+p},M(Wu,this),M(Gu,this),t,M(ju,this),null!=e?e:M(Hu,this)),y=2;y<M(zu,this).length;y+=2)g.add({x:M(zu,this)[y]*d+v,y:M(zu,this)[y+1]*f+p});return g.getOutlines()}}])}(fu);function Xu(t){for(var e=M(Vu,this),n=e[4],i=e[5],a=n,r=i,s=n,o=i,l=n,h=i,u=t?Math.max:Math.min,c=6,d=e.length;c<d;c+=6){if(isNaN(e[c]))a=Math.min(a,e[c+4]),r=Math.min(r,e[c+5]),s=Math.max(s,e[c+4]),o=Math.max(o,e[c+5]),h<e[c+5]?(l=e[c+4],h=e[c+5]):h===e[c+5]&&(l=u(l,e[c+4]));else{var f=Pt.bezierBoundingBox.apply(Pt,[n,i].concat(k(e.slice(c,c+6))));a=Math.min(a,f[0]),r=Math.min(r,f[1]),s=Math.max(s,f[2]),o=Math.max(o,f[3]),h<f[3]?(l=f[2],h=f[3]):h===f[3]&&(l=u(l,f[2]))}n=e[c+4],i=e[c+5]}var v=M(Bu,this);v[0]=a-M(Hu,this),v[1]=r-M(Hu,this),v[2]=s-a+2*M(Hu,this),v[3]=o-r+2*M(Hu,this),this.lastPoint=[l,h]}var Yu=new WeakMap,Ku=new WeakMap,Qu=new WeakMap,Ju=new WeakMap,Zu=new WeakSet,$u=function(){return B((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];j(this,t),A(this,Zu),_(this,Yu,void 0),_(this,Ku,void 0),_(this,Qu,[]),_(this,Ju,[]);var r,s=1/0,o=-1/0,l=1/0,h=-1/0,u=Math.pow(10,-4),c=F(e);try{for(c.s();!(r=c.n()).done;){var d=r.value,f=d.x,v=d.y,p=d.width,g=d.height,y=Math.floor((f-n)/u)*u,m=Math.ceil((f+p+n)/u)*u,k=Math.floor((v-n)/u)*u,b=Math.ceil((v+g+n)/u)*u,w=[y,k,b,!0],x=[m,k,b,!1];M(Qu,this).push(w,x),s=Math.min(s,y),o=Math.max(o,m),l=Math.min(l,k),h=Math.max(h,b)}}catch(t){c.e(t)}finally{c.f()}var S,C=o-s+2*i,T=h-l+2*i,P=s-i,R=l-i,L=M(Qu,this).at(a?-1:-2),D=[L[0],L[2]],N=F(M(Qu,this));try{for(N.s();!(S=N.n()).done;){var O=S.value,W=I(O,3),B=W[0],H=W[1],z=W[2];O[0]=(B-P)/C,O[1]=(H-R)/T,O[2]=(z-R)/T}}catch(t){N.e(t)}finally{N.f()}E(Yu,this,new Float32Array([P,R,C,T])),E(Ku,this,D)}),[{key:"getOutlines",value:function(){M(Qu,this).sort((function(t,e){return t[0]-e[0]||t[1]-e[1]||t[2]-e[2]}));var t,e=[],n=F(M(Qu,this));try{for(n.s();!(t=n.n()).done;){var i=t.value;i[3]?(e.push.apply(e,k(R(Zu,this,ac).call(this,i))),R(Zu,this,nc).call(this,i)):(R(Zu,this,ic).call(this,i),e.push.apply(e,k(R(Zu,this,ac).call(this,i))))}}catch(t){n.e(t)}finally{n.f()}return R(Zu,this,tc).call(this,e)}}])}();function tc(t){var e,n=[],i=new Set,a=F(t);try{for(a.s();!(e=a.n()).done;){var r=e.value,s=I(r,3),o=s[0],l=s[1],h=s[2];n.push([o,l,r],[o,h,r])}}catch(t){a.e(t)}finally{a.f()}n.sort((function(t,e){return t[1]-e[1]||t[0]-e[0]}));for(var u=0,c=n.length;u<c;u+=2){var d=n[u][2],f=n[u+1][2];d.push(f),f.push(d),i.add(d),i.add(f)}for(var v,p=[];i.size>0;){var g=i.values().next().value,y=I(g,5),m=y[0],k=y[1],b=y[2],w=y[3],A=y[4];i.delete(g);var _=m,x=k;for(v=[m,b],p.push(v);;){var S=void 0;if(i.has(w))S=w;else{if(!i.has(A))break;S=A}i.delete(S);var E=I(S,5);m=E[0],k=E[1],b=E[2],w=E[3],A=E[4],_!==m&&(v.push(_,x,m,x===k?k:b),_=m),x=x===k?b:k}v.push(_,x)}return new oc(p,M(Yu,this),M(Ku,this))}function ec(t){for(var e=M(Ju,this),n=0,i=e.length-1;n<=i;){var a=n+i>>1,r=e[a][0];if(r===t)return a;r<t?n=a+1:i=a-1}return i+1}function nc(t){var e=I(t,3),n=e[1],i=e[2],a=R(Zu,this,ec).call(this,n);M(Ju,this).splice(a,0,[n,i])}function ic(t){for(var e=I(t,3),n=e[1],i=e[2],a=R(Zu,this,ec).call(this,n),r=a;r<M(Ju,this).length;r++){var s=I(M(Ju,this)[r],2),o=s[0],l=s[1];if(o!==n)break;if(o===n&&l===i)return void M(Ju,this).splice(r,1)}for(var h=a-1;h>=0;h--){var u=I(M(Ju,this)[h],2),c=u[0],d=u[1];if(c!==n)break;if(c===n&&d===i)return void M(Ju,this).splice(h,1)}}function ac(t){for(var e=I(t,3),n=e[0],i=e[1],a=e[2],r=[[n,i,a]],s=R(Zu,this,ec).call(this,a),o=0;o<s;o++)for(var l=I(M(Ju,this)[o],2),h=l[0],u=l[1],c=0,d=r.length;c<d;c++){var f=I(r[c],3),v=f[1],p=f[2];if(!(u<=v||p<=h))if(v>=h)if(p>u)r[c][1]=u;else{if(1===d)return[];r.splice(c,1),c--,d--}else r[c][2]=h,p>u&&r.push([n,u,p])}return r}var rc=new WeakMap,sc=new WeakMap,oc=function(t){function e(t,n,i){var a;return j(this,e),_(a=z(this,e),rc,void 0),_(a,sc,void 0),E(sc,a,t),E(rc,a,n),a.lastPoint=i,a}return U(e,t),B(e,[{key:"toSVGPath",value:function(){var t,e=[],n=F(M(sc,this));try{for(n.s();!(t=n.n()).done;){var i=t.value,a=I(i,2),r=a[0],s=a[1];e.push("M".concat(r," ").concat(s));for(var o=2;o<i.length;o+=2){var l=i[o],h=i[o+1];l===r?(e.push("V".concat(h)),s=h):h===s&&(e.push("H".concat(l)),r=l)}e.push("Z")}}catch(t){n.e(t)}finally{n.f()}return e.join(" ")}},{key:"serialize",value:function(t,e){var n,i=I(t,4),a=i[0],r=i[1],s=i[2],o=i[3],l=[],h=s-a,u=o-r,c=F(M(sc,this));try{for(c.s();!(n=c.n()).done;){for(var d=n.value,f=new Array(d.length),v=0;v<d.length;v+=2)f[v]=a+d[v]*h,f[v+1]=o-d[v+1]*u;l.push(f)}}catch(t){c.e(t)}finally{c.f()}return l}},{key:"box",get:function(){return M(rc,this)}},{key:"classNamesForOutlining",get:function(){return["highlightOutline"]}}])}(fu),lc=function(t){function e(){return j(this,e),z(this,e,arguments)}return U(e,t),B(e,[{key:"newFreeDrawOutline",value:function(t,e,n,i,a,r){return new hc(t,e,n,i,a,r)}}])}(Cu),hc=function(t){function e(){return j(this,e),z(this,e,arguments)}return U(e,t),B(e,[{key:"newOutliner",value:function(t,e,n,i,a){return new lc(t,e,n,i,a,arguments.length>5&&void 0!==arguments[5]?arguments[5]:0)}}])}(qu),uc=new WeakMap,cc=new WeakMap,dc=new WeakMap,fc=new WeakMap,vc=new WeakMap,pc=new WeakMap,gc=new WeakMap,yc=new WeakMap,mc=new WeakMap,kc=new WeakMap,bc=new WeakMap,wc=new WeakSet,Ac=function(){function t(e){var n,i=e.editor,a=void 0===i?null:i,r=e.uiManager,s=void 0===r?null:r;j(this,t),A(this,wc),_(this,uc,null),_(this,cc,null),_(this,dc,void 0),_(this,fc,null),_(this,vc,!1),_(this,pc,!1),_(this,gc,null),_(this,yc,void 0),_(this,mc,null),_(this,kc,null),_(this,bc,void 0),a?(E(pc,this,!1),E(bc,this,nt.HIGHLIGHT_COLOR),E(gc,this,a)):(E(pc,this,!0),E(bc,this,nt.HIGHLIGHT_DEFAULT_COLOR)),E(kc,this,(null==a?void 0:a._uiManager)||s),E(yc,this,M(kc,this)._eventBus),E(dc,this,(null==a?void 0:a.color)||(null===(n=M(kc,this))||void 0===n?void 0:n.highlightColors.values().next().value)||"#FFFF98"),Tc._||(Tc._=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}return B(t,[{key:"renderButton",value:function(){var t=E(uc,this,document.createElement("button"));t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.setAttribute("aria-haspopup",!0);var e=M(kc,this)._signal;t.addEventListener("click",R(wc,this,Mc).bind(this),{signal:e}),t.addEventListener("keydown",R(wc,this,Sc).bind(this),{signal:e});var n=E(cc,this,document.createElement("span"));return n.className="swatch",n.setAttribute("aria-hidden",!0),n.style.backgroundColor=M(dc,this),t.append(n),t}},{key:"renderMainDropdown",value:function(){var t=E(fc,this,R(wc,this,_c).call(this));return t.setAttribute("aria-orientation","horizontal"),t.setAttribute("aria-labelledby","highlightColorPickerLabel"),t}},{key:"_colorSelectFromKeyboard",value:function(t){if(t.target!==M(uc,this)){var e=t.target.getAttribute("data-color");e&&R(wc,this,xc).call(this,e,t)}else R(wc,this,Mc).call(this,t)}},{key:"_moveToNext",value:function(t){var e,n;S(wc,this,Cc)?t.target!==M(uc,this)?null===(e=t.target.nextSibling)||void 0===e||e.focus():null===(n=M(fc,this).firstChild)||void 0===n||n.focus():R(wc,this,Mc).call(this,t)}},{key:"_moveToPrevious",value:function(t){var e,n;t.target!==(null===(e=M(fc,this))||void 0===e?void 0:e.firstChild)&&t.target!==M(uc,this)?(S(wc,this,Cc)||R(wc,this,Mc).call(this,t),null===(n=t.target.previousSibling)||void 0===n||n.focus()):S(wc,this,Cc)&&this._hideDropdownFromKeyboard()}},{key:"_moveToBeginning",value:function(t){var e;S(wc,this,Cc)?null===(e=M(fc,this).firstChild)||void 0===e||e.focus():R(wc,this,Mc).call(this,t)}},{key:"_moveToEnd",value:function(t){var e;S(wc,this,Cc)?null===(e=M(fc,this).lastChild)||void 0===e||e.focus():R(wc,this,Mc).call(this,t)}},{key:"hideDropdown",value:function(){var t,e;null===(t=M(fc,this))||void 0===t||t.classList.add("hidden"),null===(e=M(mc,this))||void 0===e||e.abort(),E(mc,this,null)}},{key:"_hideDropdownFromKeyboard",value:function(){var t;M(pc,this)||(S(wc,this,Cc)?(this.hideDropdown(),M(uc,this).focus({preventScroll:!0,focusVisible:M(vc,this)})):null===(t=M(gc,this))||void 0===t||t.unselect())}},{key:"updateColor",value:function(t){if(M(cc,this)&&(M(cc,this).style.backgroundColor=t),M(fc,this)){var e,n=M(kc,this).highlightColors.values(),i=F(M(fc,this).children);try{for(i.s();!(e=i.n()).done;)e.value.setAttribute("aria-selected",n.next().value===t)}catch(t){i.e(t)}finally{i.f()}}}},{key:"destroy",value:function(){var t,e;null===(t=M(uc,this))||void 0===t||t.remove(),E(uc,this,null),E(cc,this,null),null===(e=M(fc,this))||void 0===e||e.remove(),E(fc,this,null)}}],[{key:"_keyboardManager",get:function(){return gt(this,"_keyboardManager",new Ve([[["Escape","mac+Escape"],t.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],t.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],t.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],t.prototype._moveToPrevious],[["Home","mac+Home"],t.prototype._moveToBeginning],[["End","mac+End"],t.prototype._moveToEnd]]))}}])}();function _c(){var t=document.createElement("div"),e=M(kc,this)._signal;t.addEventListener("contextmenu",Kt,{signal:e}),t.className="dropdown",t.role="listbox",t.setAttribute("aria-multiselectable",!1),t.setAttribute("aria-orientation","vertical"),t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");var n,i=F(M(kc,this).highlightColors);try{for(i.s();!(n=i.n()).done;){var a=I(n.value,2),r=a[0],s=a[1],o=document.createElement("button");o.tabIndex="0",o.role="option",o.setAttribute("data-color",s),o.title=r,o.setAttribute("data-l10n-id",Tc._[r]);var l=document.createElement("span");o.append(l),l.className="swatch",l.style.backgroundColor=s,o.setAttribute("aria-selected",s===M(dc,this)),o.addEventListener("click",R(wc,this,xc).bind(this,s),{signal:e}),t.append(o)}}catch(t){i.e(t)}finally{i.f()}return t.addEventListener("keydown",R(wc,this,Sc).bind(this),{signal:e}),t}function xc(t,e){e.stopPropagation(),M(yc,this).dispatch("switchannotationeditorparams",{source:this,type:M(bc,this),value:t})}function Sc(t){o._keyboardManager.exec(this,t)}function Mc(t){if(S(wc,this,Cc))this.hideDropdown();else if(E(vc,this,0===t.detail),M(mc,this)||(E(mc,this,new AbortController),window.addEventListener("pointerdown",R(wc,this,Ec).bind(this),{signal:M(kc,this).combinedSignal(M(mc,this))})),M(fc,this))M(fc,this).classList.remove("hidden");else{var e=E(fc,this,R(wc,this,_c).call(this));M(uc,this).append(e)}}function Ec(t){var e;null!==(e=M(fc,this))&&void 0!==e&&e.contains(t.target)||this.hideDropdown()}function Cc(t){return M(fc,t)&&!M(fc,t).classList.contains("hidden")}o=Ac;var Tc={_:null},Pc=new WeakMap,Rc=new WeakMap,Ic=new WeakMap,Lc=new WeakMap,Dc=new WeakMap,Fc=new WeakMap,Nc=new WeakMap,Oc=new WeakMap,Wc=new WeakMap,Bc=new WeakMap,Hc=new WeakMap,jc=new WeakMap,zc=new WeakMap,Gc=new WeakMap,Vc=new WeakMap,Uc=new WeakMap,qc=new WeakMap,Xc=new WeakMap,Yc=new WeakSet,Kc=function(t){function e(t){var n;return j(this,e),A(n=z(this,e,[p(p({},t),{},{name:"highlightEditor"})]),Yc),_(n,Pc,null),_(n,Rc,0),_(n,Ic,void 0),_(n,Lc,null),_(n,Dc,null),_(n,Fc,null),_(n,Nc,null),_(n,Oc,0),_(n,Wc,null),_(n,Bc,null),_(n,Hc,null),_(n,jc,!1),_(n,zc,null),_(n,Gc,void 0),_(n,Vc,null),_(n,Uc,""),_(n,qc,void 0),_(n,Xc,""),n.color=t.color||e._defaultColor,E(qc,n,t.thickness||e._defaultThickness),E(Gc,n,t.opacity||e._defaultOpacity),E(Ic,n,t.boxes||null),E(Xc,n,t.methodOfCreation||""),E(Uc,n,t.text||""),n._isDraggable=!1,t.highlightId>-1?(E(jc,n,!0),R(Yc,n,Jc).call(n,t),R(Yc,n,nd).call(n)):M(Ic,n)&&(E(Pc,n,t.anchorNode),E(Rc,n,t.anchorOffset),E(Nc,n,t.focusNode),E(Oc,n,t.focusOffset),R(Yc,n,Qc).call(n),R(Yc,n,nd).call(n),n.rotate(n.rotation)),n}return U(e,t),B(e,[{key:"telemetryInitialData",get:function(){return{action:"added",type:M(jc,this)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:M(qc,this),methodOfCreation:M(Xc,this)}}},{key:"telemetryFinalData",get:function(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}},{key:"translateInPage",value:function(t,e){}},{key:"toolbarPosition",get:function(){return M(zc,this)}},{key:"updateParams",value:function(t,e){switch(t){case nt.HIGHLIGHT_COLOR:R(Yc,this,Zc).call(this,e);break;case nt.HIGHLIGHT_THICKNESS:R(Yc,this,$c).call(this,e)}}},{key:"propertiesToUpdate",get:function(){return[[nt.HIGHLIGHT_COLOR,this.color||e._defaultColor],[nt.HIGHLIGHT_THICKNESS,M(qc,this)||e._defaultThickness],[nt.HIGHLIGHT_FREE,M(jc,this)]]}},{key:"addEditToolbar",value:(i=T(w().mark((function t(){var n;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y(e,"addEditToolbar",this,3)([]);case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return",null);case 5:return this._uiManager.highlightColors&&(E(Dc,this,new Ac({editor:this})),n.addColorPicker(M(Dc,this))),t.abrupt("return",n);case 7:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"disableEditing",value:function(){y(e,"disableEditing",this,3)([]),this.div.classList.toggle("disabled",!0)}},{key:"enableEditing",value:function(){y(e,"enableEditing",this,3)([]),this.div.classList.toggle("disabled",!1)}},{key:"fixAndSetPosition",value:function(){return y(e,"fixAndSetPosition",this,3)([R(Yc,this,sd).call(this)])}},{key:"getBaseTranslation",value:function(){return[0,0]}},{key:"getRect",value:function(t,n){return y(e,"getRect",this,3)([t,n,R(Yc,this,sd).call(this)])}},{key:"onceAdded",value:function(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}},{key:"remove",value:function(){R(Yc,this,ed).call(this),this._reportTelemetry({action:"deleted"}),y(e,"remove",this,3)([])}},{key:"rebuild",value:function(){this.parent&&(y(e,"rebuild",this,3)([]),null!==this.div&&(R(Yc,this,nd).call(this),this.isAttachedToDOM||this.parent.add(this)))}},{key:"setParent",value:function(t){var n=!1;if(this.parent&&!t)R(Yc,this,ed).call(this);else if(t){var i;R(Yc,this,nd).call(this,t),n=!this.parent&&(null===(i=this.div)||void 0===i?void 0:i.classList.contains("selectedEditor"))}y(e,"setParent",this,3)([t]),this.show(this._isVisible),n&&this.select()}},{key:"rotate",value:function(t){var n,i=this.parent.drawLayer;M(jc,this)?(t=(t-this.rotation+360)%360,n=id.call(e,M(Bc,this).box,t)):n=id.call(e,[this.x,this.y,this.width,this.height],t),i.updateProperties(M(Hc,this),{bbox:n,root:{"data-main-rotation":t}}),i.updateProperties(M(Vc,this),{bbox:id.call(e,M(Fc,this).box,t),root:{"data-main-rotation":t}})}},{key:"render",value:function(){if(this.div)return this.div;var t=y(e,"render",this,3)([]);M(Uc,this)&&(t.setAttribute("aria-label",M(Uc,this)),t.setAttribute("role","mark")),M(jc,this)?t.classList.add("free"):this.div.addEventListener("keydown",R(Yc,this,ad).bind(this),{signal:this._uiManager._signal});var n=E(Wc,this,document.createElement("div"));t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",n.style.clipPath=M(Lc,this);var i=I(this.parentDimensions,2),a=i[0],r=i[1];return this.setDims(this.width*a,this.height*r),Ce(this,M(Wc,this),["pointerover","pointerleave"]),this.enableEditing(),t}},{key:"pointerover",value:function(){var t;this.isSelected||null===(t=this.parent)||void 0===t||t.drawLayer.updateProperties(M(Vc,this),{rootClass:{hovered:!0}})}},{key:"pointerleave",value:function(){var t;this.isSelected||null===(t=this.parent)||void 0===t||t.drawLayer.updateProperties(M(Vc,this),{rootClass:{hovered:!1}})}},{key:"_moveCaret",value:function(t){switch(this.parent.unselect(this),t){case 0:case 2:R(Yc,this,rd).call(this,!0);break;case 1:case 3:R(Yc,this,rd).call(this,!1)}}},{key:"select",value:function(){var t;y(e,"select",this,3)([]),M(Vc,this)&&(null===(t=this.parent)||void 0===t||t.drawLayer.updateProperties(M(Vc,this),{rootClass:{hovered:!1,selected:!0}}))}},{key:"unselect",value:function(){var t;y(e,"unselect",this,3)([]),M(Vc,this)&&(null===(t=this.parent)||void 0===t||t.drawLayer.updateProperties(M(Vc,this),{rootClass:{selected:!1}}),M(jc,this)||R(Yc,this,rd).call(this,!1))}},{key:"_mustFixPosition",get:function(){return!M(jc,this)}},{key:"show",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this._isVisible;y(e,"show",this,3)([t]),this.parent&&(this.parent.drawLayer.updateProperties(M(Hc,this),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(M(Vc,this),{rootClass:{hidden:!t}}))}},{key:"serialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();var e=this.getRect(0,0),n=Yi._colorManager.convert(this.color),i={annotationType:et.HIGHLIGHT,color:n,opacity:M(Gc,this),thickness:M(qc,this),quadPoints:R(Yc,this,od).call(this),outlines:R(Yc,this,ld).call(this,e),pageIndex:this.pageIndex,rect:e,rotation:R(Yc,this,sd).call(this),structTreeParentId:this._structTreeParentId};return this.annotationElementId&&!R(Yc,this,cd).call(this,i)?null:(i.id=this.annotationElementId,i)}},{key:"renderAnnotationElement",value:function(t){return t.updateEdited({rect:this.getRect(0,0)}),null}}],[{key:"_keyboardManager",get:function(){var t=e.prototype;return gt(this,"_keyboardManager",new Ve([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}},{key:"computeTelemetryFinalData",value:function(t){return{numberOfColors:t.get("color").size}}},{key:"initialize",value:function(t,n){var i;Yi.initialize(t,n),e._defaultColor||(e._defaultColor=(null===(i=n.highlightColors)||void 0===i?void 0:i.values().next().value)||"#fff066")}},{key:"updateDefaultParams",value:function(t,n){switch(t){case nt.HIGHLIGHT_DEFAULT_COLOR:e._defaultColor=n;break;case nt.HIGHLIGHT_THICKNESS:e._defaultThickness=n}}},{key:"defaultPropertiesToUpdate",get:function(){return[[nt.HIGHLIGHT_DEFAULT_COLOR,e._defaultColor],[nt.HIGHLIGHT_THICKNESS,e._defaultThickness]]}},{key:"startHighlighting",value:function(t,n,i){var a=this,r=i.target,s=i.x,o=i.y,l=r.getBoundingClientRect(),h=l.x,u=l.y,c=l.width,d=l.height,f=new AbortController,v=t.combinedSignal(f),p=function(n){f.abort(),R(e,a,ud).call(a,t,n)};window.addEventListener("blur",p,{signal:v}),window.addEventListener("pointerup",p,{signal:v}),window.addEventListener("pointerdown",Qt,{capture:!0,passive:!1,signal:v}),window.addEventListener("contextmenu",Kt,{signal:v}),r.addEventListener("pointermove",R(e,this,hd).bind(this,t),{signal:v}),this._freeHighlight=new lc({x:s,y:o},[h,u,c,d],t.scale,this._defaultThickness/2,n,.001);var g=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0);this._freeHighlightId=g.id,this._freeHighlightClipId=g.clipPathId}},{key:"deserialize",value:(n=T(w().mark((function t(n,i,a){var r,s,o,l,h,u,c,d,f,v,p,g,m,b,A,_,x,S,C,T,P,L,D,F,N,O,W,B,H,j,z,G,V,U,q,X,Y,K,Q,J,Z,$,tt;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=null,n instanceof Ih?(o=(s=n).data,l=o.quadPoints,h=o.rect,u=o.rotation,c=o.id,d=o.color,f=o.opacity,v=o.popupRef,p=s.parent.page.pageNumber,r=n={annotationType:et.HIGHLIGHT,color:Array.from(d),opacity:f,quadPoints:l,boxes:null,pageIndex:p-1,rect:h.slice(0),rotation:u,id:c,deleted:!1,popupRef:v}):n instanceof Ph&&(m=(g=n).data,b=m.inkLists,A=m.rect,_=m.rotation,x=m.id,S=m.color,C=m.borderStyle.rawWidth,T=m.popupRef,P=g.parent.page.pageNumber,r=n={annotationType:et.HIGHLIGHT,color:Array.from(S),thickness:C,inkLists:b,boxes:null,pageIndex:P-1,rect:A.slice(0),rotation:_,id:x,deleted:!1,popupRef:T}),D=(L=n).color,F=L.quadPoints,N=L.inkLists,O=L.opacity,t.next=5,y(e,"deserialize",this,2)([n,i,a]);case 5:if((W=t.sent).color=Pt.makeHexColor.apply(Pt,k(D)),E(Gc,W,O||1),N&&E(qc,W,n.thickness),W.annotationElementId=n.id||null,W._initialData=r,B=I(W.pageDimensions,2),H=B[0],j=B[1],z=I(W.pageTranslation,2),G=z[0],V=z[1],F){for(U=E(Ic,W,[]),q=0;q<F.length;q+=8)U.push({x:(F[q]-G)/H,y:1-(F[q+1]-V)/j,width:(F[q+2]-F[q])/H,height:(F[q+1]-F[q+5])/j});R(Yc,W,Qc).call(W),R(Yc,W,nd).call(W),W.rotate(W.rotation)}else if(N){for(E(jc,W,!0),X=N[0],Y={x:X[0]-G,y:j-(X[1]-V)},K=new lc(Y,[0,0,H,j],1,M(qc,W)/2,!0,.001),Q=0,J=X.length;Q<J;Q+=2)Y.x=X[Q]-G,Y.y=j-(X[Q+1]-V),K.add(Y);Z=i.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:W.color,"fill-opacity":W._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:K.toSVGPath()}},!0,!0),$=Z.id,tt=Z.clipPathId,R(Yc,W,Jc).call(W,{highlightOutlines:K.getOutlines(),highlightId:$,clipPathId:tt}),R(Yc,W,nd).call(W)}return t.abrupt("return",W);case 15:case"end":return t.stop()}}),t,this)}))),function(t,e,i){return n.apply(this,arguments)})},{key:"canCreateNewEmptyEditor",value:function(){return!1}}]);var n,i}(Yi);function Qc(){var t=new $u(M(Ic,this),.001);E(Bc,this,t.getOutlines());var e=I(M(Bc,this).box,4);this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3];var n=new $u(M(Ic,this),.0025,.001,"ltr"===this._uiManager.direction);E(Fc,this,n.getOutlines());var i=M(Fc,this).lastPoint;E(zc,this,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height])}function Jc(t){var e=t.highlightOutlines,n=t.highlightId,i=t.clipPathId;if(E(Bc,this,e),E(Fc,this,e.getNewOutline(M(qc,this)/2+1.5,.0025)),n>=0)E(Hc,this,n),E(Lc,this,i),this.parent.drawLayer.finalizeDraw(n,{bbox:e.box,path:{d:e.toSVGPath()}}),E(Vc,this,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:M(Fc,this).box,path:{d:M(Fc,this).toSVGPath()}},!0));else if(this.parent){var a=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(M(Hc,this),{bbox:id.call(l,M(Bc,this).box,(a-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(M(Vc,this),{bbox:id.call(l,M(Fc,this).box,a),path:{d:M(Fc,this).toSVGPath()}})}var r=I(e.box,4),s=r[0],o=r[1],h=r[2],u=r[3];switch(this.rotation){case 0:this.x=s,this.y=o,this.width=h,this.height=u;break;case 90:var c=I(this.parentDimensions,2),d=c[0],f=c[1];this.x=o,this.y=1-s,this.width=h*f/d,this.height=u*d/f;break;case 180:this.x=1-s,this.y=1-o,this.width=h,this.height=u;break;case 270:var v=I(this.parentDimensions,2),p=v[0],g=v[1];this.x=1-o,this.y=s,this.width=h*g/p,this.height=u*p/g}var y=M(Fc,this).lastPoint;E(zc,this,[(y[0]-s)/h,(y[1]-o)/u])}function Zc(t){var e=this,n=function(t,n){var i,a;e.color=t,E(Gc,e,n),null===(i=e.parent)||void 0===i||i.drawLayer.updateProperties(M(Hc,e),{root:{fill:t,"fill-opacity":n}}),null===(a=M(Dc,e))||void 0===a||a.updateColor(t)},i=this.color,a=M(Gc,this);this.addCommands({cmd:n.bind(this,t,l._defaultOpacity),undo:n.bind(this,i,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:nt.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)}function $c(t){var e=this,n=M(qc,this),i=function(t){E(qc,e,t),R(Yc,e,td).call(e,t)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:nt.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}function td(t){if(M(jc,this)){R(Yc,this,Jc).call(this,{highlightOutlines:M(Bc,this).getNewOutline(t/2)}),this.fixAndSetPosition();var e=I(this.parentDimensions,2),n=e[0],i=e[1];this.setDims(this.width*n,this.height*i)}}function ed(){null!==M(Hc,this)&&this.parent&&(this.parent.drawLayer.remove(M(Hc,this)),E(Hc,this,null),this.parent.drawLayer.remove(M(Vc,this)),E(Vc,this,null))}function nd(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parent;if(null===M(Hc,this)){var e=t.drawLayer.draw({bbox:M(Bc,this).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":M(Gc,this)},rootClass:{highlight:!0,free:M(jc,this)},path:{d:M(Bc,this).toSVGPath()}},!1,!0);g(E,[Hc,this])._=e.id,g(E,[Lc,this])._=e.clipPathId,E(Vc,this,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:M(jc,this)},bbox:M(Fc,this).box,path:{d:M(Fc,this).toSVGPath()}},M(jc,this))),M(Wc,this)&&(M(Wc,this).style.clipPath=M(Lc,this))}}function id(t,e){var n=I(t,4),i=n[0],a=n[1],r=n[2],s=n[3];switch(e){case 90:return[1-a-s,i,s,r];case 180:return[1-i-r,1-a-s,r,s];case 270:return[a,1-i-r,s,r]}return[i,a,r,s]}function ad(t){l._keyboardManager.exec(this,t)}function rd(t){if(M(Pc,this)){var e=window.getSelection();t?e.setPosition(M(Pc,this),M(Rc,this)):e.setPosition(M(Nc,this),M(Oc,this))}}function sd(){return M(jc,this)?this.rotation:0}function od(){if(M(jc,this))return null;var t,e=I(this.pageDimensions,2),n=e[0],i=e[1],a=I(this.pageTranslation,2),r=a[0],s=a[1],o=M(Ic,this),l=new Float32Array(8*o.length),h=0,u=F(o);try{for(u.s();!(t=u.n()).done;){var c=t.value,d=c.x,f=c.y,v=c.width,p=c.height,g=d*n+r,y=(1-f)*i+s;l[h]=l[h+4]=g,l[h+1]=l[h+3]=y,l[h+2]=l[h+6]=g+v*n,l[h+5]=l[h+7]=y-p*i,h+=8}}catch(t){u.e(t)}finally{u.f()}return l}function ld(t){return M(Bc,this).serialize(t,R(Yc,this,sd).call(this))}function hd(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}function ud(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}function cd(t){var e=this._initialData.color;return t.color.some((function(t,n){return t!==e[n]}))}l=Kc,P(Kc,"_defaultColor",null),P(Kc,"_defaultOpacity",1),P(Kc,"_defaultThickness",12),P(Kc,"_type","highlight"),P(Kc,"_editorType",et.HIGHLIGHT),P(Kc,"_freeHighlightId",-1),P(Kc,"_freeHighlight",null),P(Kc,"_freeHighlightClipId","");var dd=new WeakMap,fd=function(){return B((function t(){j(this,t),_(this,dd,Object.create(null))}),[{key:"updateProperty",value:function(t,e){this[t]=e,this.updateSVGProperty(t,e)}},{key:"updateProperties",value:function(t){if(t)for(var e=0,n=Object.entries(t);e<n.length;e++){var i=I(n[e],2),a=i[0],r=i[1];this.updateProperty(a,r)}}},{key:"updateSVGProperty",value:function(t,e){M(dd,this)[t]=e}},{key:"toSVGProperties",value:function(){var t=M(dd,this);return E(dd,this,Object.create(null)),{root:t}}},{key:"reset",value:function(){E(dd,this,Object.create(null))}},{key:"updateAll",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this;this.updateProperties(t)}},{key:"clone",value:function(){ft("Not implemented")}}])}(),vd=new WeakMap,pd=new WeakMap,gd=new WeakSet,yd=function(t){function e(t){var n;return j(this,e),A(n=z(this,e,[t]),gd),_(n,vd,null),_(n,pd,void 0),P(n,"_drawId",null),E(pd,n,t.mustBeCommitted||!1),t.drawOutlines&&(R(gd,n,md).call(n,t),R(gd,n,wd).call(n)),n}return U(e,t),B(e,[{key:"updateParams",value:function(t,e){var n=this.constructor.typesMap.get(t);n&&this._updateProperty(t,n,e)}},{key:"propertiesToUpdate",get:function(){var t,e=[],n=this._drawingOptions,i=F(this.constructor.typesMap);try{for(i.s();!(t=i.n()).done;){var a=I(t.value,2),r=a[0],s=a[1];e.push([r,n[s]])}}catch(t){i.e(t)}finally{i.f()}return e}},{key:"_updateProperty",value:function(t,e,n){var i=this,a=this._drawingOptions,r=a[e],s=function(t){var n;a.updateProperty(e,t);var r=M(vd,i).updateProperty(e,t);r&&R(gd,i,xd).call(i,r),null===(n=i.parent)||void 0===n||n.drawLayer.updateProperties(i._drawId,a.toSVGProperties())};this.addCommands({cmd:s.bind(this,n),undo:s.bind(this,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}},{key:"_onResizing",value:function(){var t;null===(t=this.parent)||void 0===t||t.drawLayer.updateProperties(this._drawId,e._mergeSVGProperties(M(vd,this).getPathResizingSVGProperties(R(gd,this,_d).call(this)),{bbox:R(gd,this,Sd).call(this)}))}},{key:"_onResized",value:function(){var t;null===(t=this.parent)||void 0===t||t.drawLayer.updateProperties(this._drawId,e._mergeSVGProperties(M(vd,this).getPathResizedSVGProperties(R(gd,this,_d).call(this)),{bbox:R(gd,this,Sd).call(this)}))}},{key:"_onTranslating",value:function(t,e){var n;null===(n=this.parent)||void 0===n||n.drawLayer.updateProperties(this._drawId,{bbox:R(gd,this,Sd).call(this,t,e)})}},{key:"_onTranslated",value:function(){var t;null===(t=this.parent)||void 0===t||t.drawLayer.updateProperties(this._drawId,e._mergeSVGProperties(M(vd,this).getPathTranslatedSVGProperties(R(gd,this,_d).call(this),this.parentDimensions),{bbox:R(gd,this,Sd).call(this)}))}},{key:"_onStartDragging",value:function(){var t;null===(t=this.parent)||void 0===t||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}},{key:"_onStopDragging",value:function(){var t;null===(t=this.parent)||void 0===t||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}},{key:"commit",value:function(){y(e,"commit",this,3)([]),this.disableEditMode(),this.disableEditing()}},{key:"disableEditing",value:function(){y(e,"disableEditing",this,3)([]),this.div.classList.toggle("disabled",!0)}},{key:"enableEditing",value:function(){y(e,"enableEditing",this,3)([]),this.div.classList.toggle("disabled",!1)}},{key:"getBaseTranslation",value:function(){return[0,0]}},{key:"isResizable",get:function(){return!0}},{key:"onceAdded",value:function(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,M(pd,this)&&(E(pd,this,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}},{key:"remove",value:function(){R(gd,this,bd).call(this),y(e,"remove",this,3)([])}},{key:"rebuild",value:function(){this.parent&&(y(e,"rebuild",this,3)([]),null!==this.div&&(R(gd,this,wd).call(this),R(gd,this,xd).call(this,M(vd,this).box),this.isAttachedToDOM||this.parent.add(this)))}},{key:"setParent",value:function(t){var n=!1;if(this.parent&&!t)this._uiManager.removeShouldRescale(this),R(gd,this,bd).call(this);else if(t){var i;this._uiManager.addShouldRescale(this),R(gd,this,wd).call(this,t),n=!this.parent&&(null===(i=this.div)||void 0===i?void 0:i.classList.contains("selectedEditor"))}y(e,"setParent",this,3)([t]),n&&this.select()}},{key:"rotate",value:function(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,e._mergeSVGProperties({bbox:R(gd,this,Sd).call(this)},M(vd,this).updateRotation((this.parentRotation-this.rotation+360)%360)))}},{key:"onScaleChanging",value:function(){this.parent&&R(gd,this,xd).call(this,M(vd,this).updateParentDimensions(this.parentDimensions,this.parent.scale))}},{key:"render",value:function(){if(this.div)return this.div;var t=y(e,"render",this,3)([]);t.classList.add("draw");var n=document.createElement("div");t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal";var i=I(this.parentDimensions,2),a=i[0],r=i[1];return this.setDims(this.width*a,this.height*r),this._uiManager.addShouldRescale(this),this.disableEditing(),t}},{key:"createDrawingOptions",value:function(t){}},{key:"serializeDraw",value:function(t){var e=I(this.pageTranslation,2),n=e[0],i=e[1],a=I(this.pageDimensions,2),r=a[0],s=a[1];return M(vd,this).serialize([n,i,r,s],t)}},{key:"renderAnnotationElement",value:function(t){return t.updateEdited({rect:this.getRect(0,0)}),null}}],[{key:"_mergeSVGProperties",value:function(t,e){for(var n=new Set(Object.keys(t)),i=0,a=Object.entries(e);i<a.length;i++){var r=I(a[i],2),s=r[0],o=r[1];n.has(s)?Object.assign(t[s],o):t[s]=o}return t}},{key:"getDefaultDrawingOptions",value:function(t){ft("Not implemented")}},{key:"typesMap",get:function(){ft("Not implemented")}},{key:"isDrawer",get:function(){return!0}},{key:"supportMultipleDrawings",get:function(){return!1}},{key:"updateDefaultParams",value:function(t,e){var n=this.typesMap.get(t);n&&this._defaultDrawingOptions.updateProperty(n,e),this._currentParent&&(Md._.updateProperty(n,e),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}},{key:"defaultPropertiesToUpdate",get:function(){var t,e=[],n=this._defaultDrawingOptions,i=F(this.typesMap);try{for(i.s();!(t=i.n()).done;){var a=I(t.value,2),r=a[0],s=a[1];e.push([r,n[s]])}}catch(t){i.e(t)}finally{i.f()}return e}},{key:"onScaleChangingWhenDrawing",value:function(){}},{key:"createDrawerInstance",value:function(t,e,n,i,a){ft("Not implemented")}},{key:"startDrawing",value:function(t,e,n,i){var a,r,s=this,o=i.target,l=i.offsetX,h=i.offsetY,u=i.pointerId,c=i.pointerType;if(!Pd._||Pd._===c){var d=t.viewport.rotation,f=o.getBoundingClientRect(),v=f.width,p=f.height,g=Ed._=new AbortController,y=t.combinedSignal(g);if(Td._||(Td._=u),null!==(a=Pd._)&&void 0!==a||(Pd._=c),window.addEventListener("pointerup",(function(t){var e;Td._===t.pointerId?s._endDraw(t):null===(e=Rd._)||void 0===e||e.delete(t.pointerId)}),{signal:y}),window.addEventListener("pointercancel",(function(t){var e;Td._===t.pointerId?s._currentParent.endDrawingSession():null===(e=Rd._)||void 0===e||e.delete(t.pointerId)}),{signal:y}),window.addEventListener("pointerdown",(function(t){Pd._===t.pointerType&&((Rd._||(Rd._=new Set)).add(t.pointerId),Md._.isCancellable()&&(Md._.removeLastElement(),Md._.isEmpty()?s._currentParent.endDrawingSession(!0):s._endDraw(null)))}),{capture:!0,passive:!1,signal:y}),window.addEventListener("contextmenu",Kt,{signal:y}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:y}),o.addEventListener("touchmove",(function(t){t.timeStamp===Id._&&Qt(t)}),{signal:y}),t.toggleDrawing(),null===(r=e._editorUndoBar)||void 0===r||r.hide(),Md._)t.drawLayer.updateProperties(this._currentDrawId,Md._.startNew(l,h,v,p,d));else{e.updateUIForDefaultProperties(this),Md._=this.createDrawerInstance(l,h,v,p,d),Cd._=this.getDefaultDrawingOptions(),this._currentParent=t;var m=t.drawLayer.draw(this._mergeSVGProperties(Cd._.toSVGProperties(),Md._.defaultSVGProperties),!0,!1);this._currentDrawId=m.id}}}},{key:"_drawMove",value:function(t){var e;if(Id._=-1,Md._){var n=t.offsetX,i=t.offsetY,a=t.pointerId;Td._===a&&((null===(e=Rd._)||void 0===e?void 0:e.size)>=1?this._endDraw(t):(this._currentParent.drawLayer.updateProperties(this._currentDrawId,Md._.add(n,i)),Id._=t.timeStamp,Qt(t)))}}},{key:"_cleanup",value:function(t){t&&(this._currentDrawId=-1,this._currentParent=null,Md._=null,Cd._=null,Pd._=null,Id._=NaN),Ed._&&(Ed._.abort(),Ed._=null,Td._=NaN,Rd._=null)}},{key:"_endDraw",value:function(t){var e=this._currentParent;if(e)if(e.toggleDrawing(!0),this._cleanup(!1),t&&e.drawLayer.updateProperties(this._currentDrawId,Md._.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){var n=Md._,i=this._currentDrawId,a=n.getLastElement();e.addCommands({cmd:function(){e.drawLayer.updateProperties(i,n.setLastElement(a))},undo:function(){e.drawLayer.updateProperties(i,n.removeLastElement())},mustExec:!1,type:nt.DRAW_STEP})}else this.endDrawing(!1)}},{key:"endDrawing",value:function(t){var e=this._currentParent;if(!e)return null;if(e.toggleDrawing(!0),e.cleanUndoStack(nt.DRAW_STEP),!Md._.isEmpty()){var n=I(e.pageDimensions,2),i=n[0],a=n[1],r=e.scale,s=e.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:Md._.getOutlines(i*r,a*r,r,this._INNER_MARGIN),drawingOptions:Cd._,mustBeCommitted:!t});return this._cleanup(!0),s}return e.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}},{key:"deserializeDraw",value:function(t,e,n,i,a,r){ft("Not implemented")}},{key:"deserialize",value:(n=T(w().mark((function t(n,i,a){var r,s,o,l,h,u,c;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=i.viewport.rawDims,s=r.pageWidth,o=r.pageHeight,l=r.pageX,h=r.pageY,u=this.deserializeDraw(l,h,s,o,this._INNER_MARGIN,n),t.next=4,y(e,"deserialize",this,2)([n,i,a]);case 4:return(c=t.sent).createDrawingOptions(n),R(gd,c,md).call(c,{drawOutlines:u}),R(gd,c,wd).call(c),c.onScaleChanging(),c.rotate(),t.abrupt("return",c);case 11:case"end":return t.stop()}}),t,this)}))),function(t,e,i){return n.apply(this,arguments)})},{key:"canCreateNewEmptyEditor",value:function(){return!1}}]);var n}(Yi);function md(t){var e=t.drawOutlines,n=t.drawId,i=t.drawingOptions;E(vd,this,e),this._drawingOptions||(this._drawingOptions=i),n>=0?(this._drawId=n,this.parent.drawLayer.finalizeDraw(n,e.defaultProperties)):this._drawId=R(gd,this,kd).call(this,e,this.parent),R(gd,this,xd).call(this,e.box)}function kd(t,e){return e.drawLayer.draw(h._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1).id}function bd(){null!==this._drawId&&this.parent&&(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}function wd(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.parent;null!==this._drawId&&this.parent===t||(null===this._drawId?(this._drawingOptions.updateAll(),this._drawId=R(gd,this,kd).call(this,M(vd,this),t)):this.parent.drawLayer.updateParent(this._drawId,t.drawLayer))}function Ad(t){var e=I(t,4),n=e[0],i=e[1],a=e[2],r=e[3],s=I(this.parentDimensions,2),o=s[0],l=s[1];switch(this.rotation){case 90:return[i,1-n,a*(l/o),r*(o/l)];case 180:return[1-n,1-i,a,r];case 270:return[1-i,n,a*(l/o),r*(o/l)];default:return[n,i,a,r]}}function _d(){var t=this.x,e=this.y,n=this.width,i=this.height,a=I(this.parentDimensions,2),r=a[0],s=a[1];switch(this.rotation){case 90:return[1-e,t,n*(r/s),i*(s/r)];case 180:return[1-t,1-e,n,i];case 270:return[e,1-t,n*(r/s),i*(s/r)];default:return[t,e,n,i]}}function xd(t){var e=I(R(gd,this,Ad).call(this,t),4);if(this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3],this.div){this.fixAndSetPosition();var n=I(this.parentDimensions,2),i=n[0],a=n[1];this.setDims(this.width*i,this.height*a)}this._onResized()}function Sd(){var t=this.x,e=this.y,n=this.width,i=this.height,a=this.rotation,r=this.parentRotation,s=I(this.parentDimensions,2),o=s[0],l=s[1];switch((4*a+r)/90){case 1:return[1-e-i,t,i,n];case 2:return[1-t-n,1-e-i,n,i];case 3:return[e,1-t-n,i,n];case 4:return[t,e-n*(o/l),i*(l/o),n*(o/l)];case 5:return[1-e,t,n*(o/l),i*(l/o)];case 6:return[1-t-i*(l/o),1-e,i*(l/o),n*(o/l)];case 7:return[e-n*(o/l),1-t-i*(l/o),n*(o/l),i*(l/o)];case 8:return[t-n,e-i,n,i];case 9:return[1-e,t-n,i,n];case 10:return[1-t,1-e,n,i];case 11:return[e-i,1-t,i,n];case 12:return[t-i*(l/o),e,i*(l/o),n*(o/l)];case 13:return[1-e-n*(o/l),t-i*(l/o),n*(o/l),i*(l/o)];case 14:return[1-t,1-e-n*(o/l),i*(l/o),n*(o/l)];case 15:return[e,1-t,n*(o/l),i*(l/o)];default:return[t,e,n,i]}}h=yd,P(yd,"_currentDrawId",-1),P(yd,"_currentParent",null);var Md={_:null},Ed={_:null},Cd={_:null},Td={_:NaN},Pd={_:null},Rd={_:null},Id={_:NaN};P(yd,"_INNER_MARGIN",3);var Ld=new WeakMap,Dd=new WeakMap,Fd=new WeakMap,Nd=new WeakMap,Od=new WeakMap,Wd=new WeakMap,Bd=new WeakMap,Hd=new WeakMap,jd=new WeakMap,zd=new WeakMap,Gd=new WeakMap,Vd=new WeakSet,Ud=function(){return B((function t(e,n,i,a,r,s){j(this,t),A(this,Vd),_(this,Ld,new Float64Array(6)),_(this,Dd,void 0),_(this,Fd,void 0),_(this,Nd,void 0),_(this,Od,void 0),_(this,Wd,void 0),_(this,Bd,""),_(this,Hd,0),_(this,jd,new af),_(this,zd,void 0),_(this,Gd,void 0),E(zd,this,i),E(Gd,this,a),E(Nd,this,r),E(Od,this,s);var o=I(R(Vd,this,qd).call(this,e,n),2);e=o[0],n=o[1];var l=E(Dd,this,[NaN,NaN,NaN,NaN,e,n]);E(Wd,this,[e,n]),E(Fd,this,[{line:l,points:M(Wd,this)}]),M(Ld,this).set(l,0)}),[{key:"updateProperty",value:function(t,e){"stroke-width"===t&&E(Od,this,e)}},{key:"isEmpty",value:function(){return!M(Fd,this)||0===M(Fd,this).length}},{key:"isCancellable",value:function(){return M(Wd,this).length<=10}},{key:"add",value:function(t,e){var n,i=I(R(Vd,this,qd).call(this,t,e),2);t=i[0],e=i[1];var a=I(M(Ld,this).subarray(2,6),4),r=a[0],s=a[1],o=a[2],l=a[3],h=t-o,u=e-l;return Math.hypot(M(zd,this)*h,M(Gd,this)*u)<=2?null:(M(Wd,this).push(t,e),isNaN(r)?(M(Ld,this).set([o,l,t,e],2),M(Dd,this).push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(M(Ld,this)[0])&&M(Dd,this).splice(6,6),M(Ld,this).set([r,s,o,l,t,e],0),(n=M(Dd,this)).push.apply(n,k(fu.createBezierPoints(r,s,o,l,t,e))),{path:{d:this.toSVGPath()}}))}},{key:"end",value:function(t,e){return this.add(t,e)||(2===M(Wd,this).length?{path:{d:this.toSVGPath()}}:null)}},{key:"startNew",value:function(t,e,n,i,a){E(zd,this,n),E(Gd,this,i),E(Nd,this,a);var r=I(R(Vd,this,qd).call(this,t,e),2);t=r[0],e=r[1];var s=E(Dd,this,[NaN,NaN,NaN,NaN,t,e]);E(Wd,this,[t,e]);var o=M(Fd,this).at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),M(Fd,this).push({line:s,points:M(Wd,this)}),M(Ld,this).set(s,0),E(Hd,this,0),this.toSVGPath(),null}},{key:"getLastElement",value:function(){return M(Fd,this).at(-1)}},{key:"setLastElement",value:function(t){return M(Fd,this)?(M(Fd,this).push(t),E(Dd,this,t.line),E(Wd,this,t.points),E(Hd,this,0),{path:{d:this.toSVGPath()}}):M(jd,this).setLastElement(t)}},{key:"removeLastElement",value:function(){if(!M(Fd,this))return M(jd,this).removeLastElement();M(Fd,this).pop(),E(Bd,this,"");for(var t=0,e=M(Fd,this).length;t<e;t++){var n=M(Fd,this)[t],i=n.line,a=n.points;E(Dd,this,i),E(Wd,this,a),E(Hd,this,0),this.toSVGPath()}return{path:{d:M(Bd,this)}}}},{key:"toSVGPath",value:function(){var t=fu.svgRound(M(Dd,this)[4]),e=fu.svgRound(M(Dd,this)[5]);if(2===M(Wd,this).length)return E(Bd,this,"".concat(M(Bd,this)," M ").concat(t," ").concat(e," Z")),M(Bd,this);if(M(Wd,this).length<=6){var n=M(Bd,this).lastIndexOf("M");E(Bd,this,"".concat(M(Bd,this).slice(0,n)," M ").concat(t," ").concat(e)),E(Hd,this,6)}if(4===M(Wd,this).length){var i=fu.svgRound(M(Dd,this)[10]),a=fu.svgRound(M(Dd,this)[11]);return E(Bd,this,"".concat(M(Bd,this)," L ").concat(i," ").concat(a)),E(Hd,this,12),M(Bd,this)}var r=[];0===M(Hd,this)&&(r.push("M ".concat(t," ").concat(e)),E(Hd,this,6));for(var s=M(Hd,this),o=M(Dd,this).length;s<o;s+=6){var l=I(M(Dd,this).slice(s,s+6).map(fu.svgRound),6),h=l[0],u=l[1],c=l[2],d=l[3],f=l[4],v=l[5];r.push("C".concat(h," ").concat(u," ").concat(c," ").concat(d," ").concat(f," ").concat(v))}return E(Bd,this,M(Bd,this)+r.join(" ")),E(Hd,this,M(Dd,this).length),M(Bd,this)}},{key:"getOutlines",value:function(t,e,n,i){var a=M(Fd,this).at(-1);return a.line=new Float32Array(a.line),a.points=new Float32Array(a.points),M(jd,this).build(M(Fd,this),t,e,n,M(Nd,this),M(Od,this),i),E(Ld,this,null),E(Dd,this,null),E(Fd,this,null),E(Bd,this,null),M(jd,this)}},{key:"defaultSVGProperties",get:function(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}])}();function qd(t,e){return fu._normalizePoint(t,e,M(zd,this),M(Gd,this),M(Nd,this))}var Xd=new WeakMap,Yd=new WeakMap,Kd=new WeakMap,Qd=new WeakMap,Jd=new WeakMap,Zd=new WeakMap,$d=new WeakMap,tf=new WeakMap,ef=new WeakMap,nf=new WeakSet,af=function(t){function e(){var t;j(this,e);for(var n=arguments.length,i=new Array(n),a=0;a<n;a++)i[a]=arguments[a];return A(t=z(this,e,[].concat(i)),nf),_(t,Xd,void 0),_(t,Yd,0),_(t,Kd,void 0),_(t,Qd,void 0),_(t,Jd,void 0),_(t,Zd,void 0),_(t,$d,void 0),_(t,tf,void 0),_(t,ef,void 0),t}return U(e,t),B(e,[{key:"build",value:function(t,e,n,i,a,r,s){E(Jd,this,e),E(Zd,this,n),E($d,this,i),E(tf,this,a),E(ef,this,r),E(Kd,this,null!=s?s:0),E(Qd,this,t),R(nf,this,of).call(this)}},{key:"setLastElement",value:function(t){return M(Qd,this).push(t),{path:{d:this.toSVGPath()}}}},{key:"removeLastElement",value:function(){return M(Qd,this).pop(),{path:{d:this.toSVGPath()}}}},{key:"toSVGPath",value:function(){var t,e=[],n=F(M(Qd,this));try{for(n.s();!(t=n.n()).done;){var i=t.value.line;if(e.push("M".concat(fu.svgRound(i[4])," ").concat(fu.svgRound(i[5]))),6!==i.length)if(12!==i.length)for(var a=6,r=i.length;a<r;a+=6){var s=I(i.subarray(a,a+6).map(fu.svgRound),6),o=s[0],l=s[1],h=s[2],u=s[3],c=s[4],d=s[5];e.push("C".concat(o," ").concat(l," ").concat(h," ").concat(u," ").concat(c," ").concat(d))}else e.push("L".concat(fu.svgRound(i[10])," ").concat(fu.svgRound(i[11])));else e.push("Z")}}catch(t){n.e(t)}finally{n.f()}return e.join("")}},{key:"serialize",value:function(t,e){var n,i,a,r,s,o,l,h,u,c=I(t,4),d=c[0],f=c[1],v=c[2],p=c[3],g=[],y=[],m=I(R(nf,this,sf).call(this),4),k=m[0],b=m[1],w=m[2],A=m[3];switch(M(tf,this)){case 0:u=fu._rescale,n=d,i=f+p,a=v,r=-p,s=d+k*v,o=f+(1-b-A)*p,l=d+(k+w)*v,h=f+(1-b)*p;break;case 90:u=fu._rescaleAndSwap,n=d,i=f,a=v,r=p,s=d+b*v,o=f+k*p,l=d+(b+A)*v,h=f+(k+w)*p;break;case 180:u=fu._rescale,n=d+v,i=f,a=-v,r=p,s=d+(1-k-w)*v,o=f+b*p,l=d+(1-k)*v,h=f+(b+A)*p;break;case 270:u=fu._rescaleAndSwap,n=d+v,i=f+p,a=-v,r=-p,s=d+(1-b-A)*v,o=f+(1-k-w)*p,l=d+(1-b)*v,h=f+(1-k)*p}var _,x=F(M(Qd,this));try{for(x.s();!(_=x.n()).done;){var S=_.value,E=S.line,C=S.points;g.push(u(E,n,i,a,r,e?new Array(E.length):null)),y.push(u(C,n,i,a,r,e?new Array(C.length):null))}}catch(t){x.e(t)}finally{x.f()}return{lines:g,points:y,rect:[s,o,l,h]}}},{key:"box",get:function(){return M(Xd,this)}},{key:"updateProperty",value:function(t,e){return"stroke-width"===t?R(nf,this,lf).call(this,e):null}},{key:"updateParentDimensions",value:function(t,e){var n=I(t,2),i=n[0],a=n[1],r=I(R(nf,this,rf).call(this),2),s=r[0],o=r[1];E(Jd,this,i),E(Zd,this,a),E($d,this,e);var l=I(R(nf,this,rf).call(this),2),h=l[0]-s,u=l[1]-o,c=M(Xd,this);return c[0]-=h,c[1]-=u,c[2]+=2*h,c[3]+=2*u,c}},{key:"updateRotation",value:function(t){return E(Yd,this,t),{path:{transform:this.rotationTransform}}}},{key:"viewBox",get:function(){return M(Xd,this).map(fu.svgRound).join(" ")}},{key:"defaultProperties",get:function(){var t=I(M(Xd,this),2),e=t[0],n=t[1];return{root:{viewBox:this.viewBox},path:{"transform-origin":"".concat(fu.svgRound(e)," ").concat(fu.svgRound(n))}}}},{key:"rotationTransform",get:function(){var t=I(M(Xd,this),4),e=t[2],n=t[3],i=0,a=0,r=0,s=0,o=0,l=0;switch(M(Yd,this)){case 90:a=n/e,r=-e/n,o=e;break;case 180:i=-1,s=-1,o=e,l=n;break;case 270:a=-n/e,r=e/n,l=n;break;default:return""}return"matrix(".concat(i," ").concat(a," ").concat(r," ").concat(s," ").concat(fu.svgRound(o)," ").concat(fu.svgRound(l),")")}},{key:"getPathResizingSVGProperties",value:function(t){var e=I(t,4),n=e[0],i=e[1],a=e[2],r=e[3],s=I(R(nf,this,rf).call(this),2),o=s[0],l=s[1],h=I(M(Xd,this),4),u=h[0],c=h[1],d=h[2],f=h[3];if(Math.abs(d-o)<=fu.PRECISION||Math.abs(f-l)<=fu.PRECISION){var v=n+a/2-(u+d/2),p=i+r/2-(c+f/2);return{path:{"transform-origin":"".concat(fu.svgRound(n)," ").concat(fu.svgRound(i)),transform:"".concat(this.rotationTransform," translate(").concat(v," ").concat(p,")")}}}var g=(a-2*o)/(d-2*o),y=(r-2*l)/(f-2*l),m=d/a,k=f/r;return{path:{"transform-origin":"".concat(fu.svgRound(u)," ").concat(fu.svgRound(c)),transform:"".concat(this.rotationTransform," scale(").concat(m," ").concat(k,") ")+"translate(".concat(fu.svgRound(o)," ").concat(fu.svgRound(l),") scale(").concat(g," ").concat(y,") ")+"translate(".concat(fu.svgRound(-o)," ").concat(fu.svgRound(-l),")")}}}},{key:"getPathResizedSVGProperties",value:function(t){var e=I(t,4),n=e[0],i=e[1],a=e[2],r=e[3],s=I(R(nf,this,rf).call(this),2),o=s[0],l=s[1],h=M(Xd,this),u=I(h,4),c=u[0],d=u[1],f=u[2],v=u[3];if(h[0]=n,h[1]=i,h[2]=a,h[3]=r,Math.abs(f-o)<=fu.PRECISION||Math.abs(v-l)<=fu.PRECISION){var p,g=n+a/2-(c+f/2),y=i+r/2-(d+v/2),m=F(M(Qd,this));try{for(m.s();!(p=m.n()).done;){var k=p.value,b=k.line,w=k.points;fu._translate(b,g,y,b),fu._translate(w,g,y,w)}}catch(t){m.e(t)}finally{m.f()}return{root:{viewBox:this.viewBox},path:{"transform-origin":"".concat(fu.svgRound(n)," ").concat(fu.svgRound(i)),transform:this.rotationTransform||null,d:this.toSVGPath()}}}var A=(a-2*o)/(f-2*o),_=(r-2*l)/(v-2*l),x=-A*(c+o)+n+o,S=-_*(d+l)+i+l;if(1!==A||1!==_||0!==x||0!==S){var E,C=F(M(Qd,this));try{for(C.s();!(E=C.n()).done;){var T=E.value,P=T.line,L=T.points;fu._rescale(P,x,S,A,_,P),fu._rescale(L,x,S,A,_,L)}}catch(t){C.e(t)}finally{C.f()}}return{root:{viewBox:this.viewBox},path:{"transform-origin":"".concat(fu.svgRound(n)," ").concat(fu.svgRound(i)),transform:this.rotationTransform||null,d:this.toSVGPath()}}}},{key:"getPathTranslatedSVGProperties",value:function(t,e){var n=I(t,2),i=n[0],a=n[1],r=I(e,2),s=r[0],o=r[1],l=M(Xd,this),h=i-l[0],u=a-l[1];if(M(Jd,this)===s&&M(Zd,this)===o){var c,d=F(M(Qd,this));try{for(d.s();!(c=d.n()).done;){var f=c.value,v=f.line,p=f.points;fu._translate(v,h,u,v),fu._translate(p,h,u,p)}}catch(t){d.e(t)}finally{d.f()}}else{var g=M(Jd,this)/s,y=M(Zd,this)/o;E(Jd,this,s),E(Zd,this,o);var m,k=F(M(Qd,this));try{for(k.s();!(m=k.n()).done;){var b=m.value,w=b.line,A=b.points;fu._rescale(w,h,u,g,y,w),fu._rescale(A,h,u,g,y,A)}}catch(t){k.e(t)}finally{k.f()}l[2]*=g,l[3]*=y}return l[0]=i,l[1]=a,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":"".concat(fu.svgRound(i)," ").concat(fu.svgRound(a))}}}},{key:"defaultSVGProperties",get:function(){var t=M(Xd,this);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":"".concat(fu.svgRound(t[0])," ").concat(fu.svgRound(t[1])),transform:this.rotationTransform||null},bbox:t}}}],[{key:"deserialize",value:function(t,n,i,a,r,s){var o,l,h,u,c,d=s.paths,f=d.lines,v=d.points,p=s.rotation,g=s.thickness,y=[];switch(p){case 0:c=fu._rescale,o=-t/i,l=n/a+1,h=1/i,u=-1/a;break;case 90:c=fu._rescaleAndSwap,o=-n/a,l=-t/i,h=1/a,u=1/i;break;case 180:c=fu._rescale,o=t/i+1,l=-n/a,h=-1/i,u=1/a;break;case 270:c=fu._rescaleAndSwap,o=n/a+1,l=t/i+1,h=-1/a,u=-1/i}if(!f){f=[];var m,k=F(v);try{for(k.s();!(m=k.n()).done;){var b=m.value,w=b.length;if(2!==w)if(4!==w){var A=new Float32Array(3*(w-2));f.push(A);var _=I(b.subarray(0,4),4),x=_[0],S=_[1],M=_[2],E=_[3];A.set([NaN,NaN,NaN,NaN,x,S],0);for(var C=4;C<w;C+=2){var T=b[C],P=b[C+1];A.set(fu.createBezierPoints(x,S,M,E,T,P),3*(C-2));var R=[M,E,T,P];x=R[0],S=R[1],M=R[2],E=R[3]}}else f.push(new Float32Array([NaN,NaN,NaN,NaN,b[0],b[1],NaN,NaN,NaN,NaN,b[2],b[3]]));else f.push(new Float32Array([NaN,NaN,NaN,NaN,b[0],b[1]]))}}catch(t){k.e(t)}finally{k.f()}}for(var L=0,D=f.length;L<D;L++)y.push({line:c(f[L].map((function(t){return null!=t?t:NaN})),o,l,h,u),points:c(v[L].map((function(t){return null!=t?t:NaN})),o,l,h,u)});var N=new e;return N.build(y,i,a,1,p,g,r),N}}])}(fu);function rf(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M(ef,this),e=M(Kd,this)+t/2*M($d,this);return M(tf,this)%180==0?[e/M(Jd,this),e/M(Zd,this)]:[e/M(Zd,this),e/M(Jd,this)]}function sf(){var t=I(M(Xd,this),4),e=t[0],n=t[1],i=t[2],a=t[3],r=I(R(nf,this,rf).call(this,0),2),s=r[0],o=r[1];return[e+s,n+o,i-2*s,a-2*o]}function of(){var t,e=E(Xd,this,new Float32Array([1/0,1/0,-1/0,-1/0])),n=F(M(Qd,this));try{for(n.s();!(t=n.n()).done;){var i=t.value.line;if(i.length<=12)for(var a=4,r=i.length;a<r;a+=6){var s=I(i.subarray(a,a+2),2),o=s[0],l=s[1];e[0]=Math.min(e[0],o),e[1]=Math.min(e[1],l),e[2]=Math.max(e[2],o),e[3]=Math.max(e[3],l)}else for(var h=i[4],u=i[5],c=6,d=i.length;c<d;c+=6){var f=I(i.subarray(c,c+6),6),v=f[0],p=f[1],g=f[2],y=f[3],m=f[4],k=f[5];Pt.bezierBoundingBox(h,u,v,p,g,y,m,k,e),h=m,u=k}}}catch(t){n.e(t)}finally{n.f()}var b=I(R(nf,this,rf).call(this),2),w=b[0],A=b[1];e[0]=Math.min(1,Math.max(0,e[0]-w)),e[1]=Math.min(1,Math.max(0,e[1]-A)),e[2]=Math.min(1,Math.max(0,e[2]+w)),e[3]=Math.min(1,Math.max(0,e[3]+A)),e[2]-=e[0],e[3]-=e[1]}function lf(t){var e=I(R(nf,this,rf).call(this),2),n=e[0],i=e[1];E(ef,this,t);var a=I(R(nf,this,rf).call(this),2),r=a[0]-n,s=a[1]-i,o=M(Xd,this);return o[0]-=r,o[1]-=s,o[2]+=2*r,o[3]+=2*s,o}var hf=new WeakMap,uf=function(t){function e(t){var n;return j(this,e),_(n=z(this,e),hf,void 0),E(hf,n,t),y(e,"updateProperties",n,3)([{fill:"none",stroke:Yi._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10}]),n}return U(e,t),B(e,[{key:"updateSVGProperty",value:function(t,n){var i;"stroke-width"===t&&(null!==(i=n)&&void 0!==i||(n=this["stroke-width"]),n*=M(hf,this).realScale),y(e,"updateSVGProperty",this,3)([t,n])}},{key:"clone",value:function(){var t=new e(M(hf,this));return t.updateAll(this),t}}])}(fd),cf=new WeakSet,df=function(t){function e(t){var n;return j(this,e),A(n=z(this,e,[p(p({},t),{},{name:"inkEditor"})]),cf),n._willKeepAspectRatio=!0,n}return U(e,t),B(e,[{key:"onScaleChanging",value:function(){if(this.parent){y(e,"onScaleChanging",this,3)([]);var t=this._drawId,n=this._drawingOptions,i=this.parent;n.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(t,n.toSVGProperties())}}},{key:"createDrawingOptions",value:function(t){var n=t.color,i=t.thickness,a=t.opacity;this._drawingOptions=e.getDefaultDrawingOptions({stroke:Pt.makeHexColor.apply(Pt,k(n)),"stroke-width":i,"stroke-opacity":a})}},{key:"serialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();var e=this.serializeDraw(t),n=e.lines,i=e.points,a=e.rect,r=this._drawingOptions,s=r.stroke,o=r["stroke-opacity"],l=r["stroke-width"],h={annotationType:et.INK,color:Yi._colorManager.convert(s),opacity:o,thickness:l,paths:{lines:n,points:i},pageIndex:this.pageIndex,rect:a,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?h:this.annotationElementId&&!R(cf,this,ff).call(this,h)?null:(h.id=this.annotationElementId,h)}},{key:"renderAnnotationElement",value:function(t){var e=this.serializeDraw(!1),n=e.points,i=e.rect;return t.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:n}),null}}],[{key:"initialize",value:function(t,e){Yi.initialize(t,e),this._defaultDrawingOptions=new uf(e.viewParameters)}},{key:"getDefaultDrawingOptions",value:function(t){var e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}},{key:"supportMultipleDrawings",get:function(){return!0}},{key:"typesMap",get:function(){return gt(this,"typesMap",new Map([[nt.INK_THICKNESS,"stroke-width"],[nt.INK_COLOR,"stroke"],[nt.INK_OPACITY,"stroke-opacity"]]))}},{key:"createDrawerInstance",value:function(t,e,n,i,a){return new Ud(t,e,n,i,a,this._defaultDrawingOptions["stroke-width"])}},{key:"deserializeDraw",value:function(t,e,n,i,a,r){return af.deserialize(t,e,n,i,a,r)}},{key:"deserialize",value:(n=T(w().mark((function t(n,i,a){var r,s,o,l,h,u,c,d,f,v,p,g,m;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=null,n instanceof Ph&&(o=(s=n).data,l=o.inkLists,h=o.rect,u=o.rotation,c=o.id,d=o.color,f=o.opacity,v=o.borderStyle.rawWidth,p=o.popupRef,g=s.parent.page.pageNumber,r=n={annotationType:et.INK,color:Array.from(d),thickness:v,opacity:f,paths:{points:l},boxes:null,pageIndex:g-1,rect:h.slice(0),rotation:u,id:c,deleted:!1,popupRef:p}),t.next=4,y(e,"deserialize",this,2)([n,i,a]);case 4:return(m=t.sent).annotationElementId=n.id||null,m._initialData=r,t.abrupt("return",m);case 8:case"end":return t.stop()}}),t,this)}))),function(t,e,i){return n.apply(this,arguments)})},{key:"onScaleChangingWhenDrawing",value:function(){var t=this._currentParent;t&&(y(e,"onScaleChangingWhenDrawing",this,2)([]),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}}]);var n}(yd);function ff(t){var e=this._initialData,n=e.color,i=e.thickness,a=e.opacity,r=e.pageIndex;return this._hasBeenMoved||this._hasBeenResized||t.color.some((function(t,e){return t!==n[e]}))||t.thickness!==i||t.opacity!==a||t.pageIndex!==r}P(df,"_type","ink"),P(df,"_editorType",et.INK),P(df,"_defaultDrawingOptions",null);var vf=new WeakMap,pf=new WeakMap,gf=new WeakMap,yf=new WeakMap,mf=new WeakMap,kf=new WeakMap,bf=new WeakMap,wf=new WeakMap,Af=new WeakMap,_f=new WeakMap,xf=new WeakSet,Sf=function(t){function e(t){var n;return j(this,e),A(n=z(this,e,[p(p({},t),{},{name:"stampEditor"})]),xf),_(n,vf,null),_(n,pf,null),_(n,gf,null),_(n,yf,null),_(n,mf,null),_(n,kf,""),_(n,bf,null),_(n,wf,null),_(n,Af,!1),_(n,_f,!1),E(yf,n,t.bitmapUrl),E(mf,n,t.bitmapFile),n}return U(e,t),B(e,[{key:"altTextFinish",value:function(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),y(e,"altTextFinish",this,3)([])}},{key:"telemetryFinalData",get:function(){var t;return{type:"stamp",hasAltText:!(null===(t=this.altTextData)||void 0===t||!t.altText)}}},{key:"mlGuessAltText",value:(i=T(w().mark((function t(){var e,n,i,a,r,s,o,l,h,u=arguments;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=u.length>0&&void 0!==u[0]?u[0]:null,n=!(u.length>1&&void 0!==u[1])||u[1],!this.hasAltTextData()){t.next=4;break}return t.abrupt("return",null);case 4:if(i=this._uiManager.mlManager){t.next=7;break}throw new Error("No ML.");case 7:return t.next=9,i.isEnabledFor("altText");case 9:if(t.sent){t.next=11;break}throw new Error("ML isn't enabled for alt text.");case 11:return a=e||this.copyCanvas(null,null,!0).imageData,r=a.data,s=a.width,o=a.height,t.next=14,i.guess({name:"altText",request:{data:r,width:s,height:o,channels:r.length/(s*o)}});case 14:if(l=t.sent){t.next=17;break}throw new Error("No response from the AI service.");case 17:if(!l.error){t.next=19;break}throw new Error("Error from the AI service.");case 19:if(!l.cancel){t.next=21;break}return t.abrupt("return",null);case 21:if(l.output){t.next=23;break}throw new Error("No valid response from the AI service.");case 23:return h=l.output,t.next=26,this.setGuessedAltText(h);case 26:return n&&!this.hasAltTextData()&&(this.altTextData={alt:h,decorative:!1}),t.abrupt("return",h);case 28:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"remove",value:function(){var t;M(pf,this)&&(E(vf,this,null),this._uiManager.imageManager.deleteId(M(pf,this)),null===(t=M(bf,this))||void 0===t||t.remove(),E(bf,this,null),M(wf,this)&&(clearTimeout(M(wf,this)),E(wf,this,null))),y(e,"remove",this,3)([])}},{key:"rebuild",value:function(){this.parent?(y(e,"rebuild",this,3)([]),null!==this.div&&(M(pf,this)&&null===M(bf,this)&&R(xf,this,Cf).call(this),this.isAttachedToDOM||this.parent.add(this))):M(pf,this)&&R(xf,this,Cf).call(this)}},{key:"onceAdded",value:function(t){this._isDraggable=!0,t&&this.div.focus()}},{key:"isEmpty",value:function(){return!(M(gf,this)||M(vf,this)||M(yf,this)||M(mf,this)||M(pf,this))}},{key:"isResizable",get:function(){return!0}},{key:"render",value:function(){if(this.div)return this.div;var t,n;if(this.width&&(t=this.x,n=this.y),y(e,"render",this,3)([]),this.div.hidden=!0,this.div.setAttribute("role","figure"),this.addAltTextButton(),M(vf,this)?R(xf,this,Tf).call(this):R(xf,this,Cf).call(this),this.width&&!this.annotationElementId){var i=I(this.parentDimensions,2),a=i[0],r=i[1];this.setAt(t*a,n*r,this.width*a,this.height*r)}return this._uiManager.addShouldRescale(this),this.div}},{key:"_onResized",value:function(){this.onScaleChanging()}},{key:"onScaleChanging",value:function(){var t=this;this.parent&&(null!==M(wf,this)&&clearTimeout(M(wf,this)),E(wf,this,setTimeout((function(){E(wf,t,null),R(xf,t,Rf).call(t)}),200)))}},{key:"copyCanvas",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t||(t=224);var i=M(vf,this),a=i.width,r=i.height,s=new re,o=M(vf,this),l=a,h=r,u=null;if(e){var c,d;if(a>e||r>e){var f=Math.min(e/a,e/r);l=Math.floor(a*f),h=Math.floor(r*f)}var v=(u=document.createElement("canvas")).width=Math.ceil(l*s.sx),p=u.height=Math.ceil(h*s.sy);M(Af,this)||(o=R(xf,this,Pf).call(this,v,p));var g=u.getContext("2d");g.filter=this._uiManager.hcmFilter;var y="white",m="#cfcfd8";"none"!==this._uiManager.hcmFilter?m="black":null!==(c=(d=window).matchMedia)&&void 0!==c&&c.call(d,"(prefers-color-scheme: dark)").matches&&(y="#8f8f9d",m="#42414d");var k=15*s.sx,b=15*s.sy,w=new OffscreenCanvas(2*k,2*b),A=w.getContext("2d");A.fillStyle=y,A.fillRect(0,0,2*k,2*b),A.fillStyle=m,A.fillRect(0,0,k,b),A.fillRect(k,b,k,b),g.fillStyle=g.createPattern(w,"repeat"),g.fillRect(0,0,v,p),g.drawImage(o,0,0,o.width,o.height,0,0,v,p)}var _=null;if(n){var x,S;if(s.symmetric&&o.width<t&&o.height<t)x=o.width,S=o.height;else if(o=M(vf,this),a>t||r>t){var E=Math.min(t/a,t/r);x=Math.floor(a*E),S=Math.floor(r*E),M(Af,this)||(o=R(xf,this,Pf).call(this,x,S))}var C=new OffscreenCanvas(x,S).getContext("2d",{willReadFrequently:!0});C.drawImage(o,0,0,o.width,o.height,0,0,x,S),_={width:x,height:S,data:C.getImageData(0,0,x,S).data}}return{canvas:u,width:l,height:h,imageData:_}}},{key:"getImageForAltText",value:function(){return M(bf,this)}},{key:"serialize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();var n={annotationType:et.STAMP,bitmapId:M(pf,this),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:M(Af,this),structTreeParentId:this._structTreeParentId};if(t)return n.bitmapUrl=R(xf,this,If).call(this,!0),n.accessibilityData=this.serializeAltText(!0),n;var i=this.serializeAltText(!1),a=i.decorative,r=i.altText;if(!a&&r&&(n.accessibilityData={type:"Figure",alt:r}),this.annotationElementId){var s,o=R(xf,this,Lf).call(this,n);if(o.isSame)return null;o.isSameAltText?delete n.accessibilityData:n.accessibilityData.structParent=null!==(s=this._initialData.structParent)&&void 0!==s?s:-1}if(n.id=this.annotationElementId,null===e)return n;e.stamps||(e.stamps=new Map);var l=M(Af,this)?(n.rect[2]-n.rect[0])*(n.rect[3]-n.rect[1]):null;if(e.stamps.has(M(pf,this))){if(M(Af,this)){var h=e.stamps.get(M(pf,this));l>h.area&&(h.area=l,h.serialized.bitmap.close(),h.serialized.bitmap=R(xf,this,If).call(this,!1))}}else e.stamps.set(M(pf,this),{area:l,serialized:n}),n.bitmap=R(xf,this,If).call(this,!1);return n}},{key:"renderAnnotationElement",value:function(t){return t.updateEdited({rect:this.getRect(0,0)}),null}}],[{key:"initialize",value:function(t,e){Yi.initialize(t,e)}},{key:"supportedTypes",get:function(){return gt(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map((function(t){return"image/".concat(t)})))}},{key:"supportedTypesStr",get:function(){return gt(this,"supportedTypesStr",this.supportedTypes.join(","))}},{key:"isHandlingMimeForPasting",value:function(t){return this.supportedTypes.includes(t)}},{key:"paste",value:function(t,e){e.pasteEditor(et.STAMP,{bitmapFile:t.getAsFile()})}},{key:"computeTelemetryFinalData",value:function(t){var e,n,i=t.get("hasAltText");return{hasAltText:null!==(e=i.get(!0))&&void 0!==e?e:0,hasNoAltText:null!==(n=i.get(!1))&&void 0!==n?n:0}}},{key:"deserialize",value:(n=T(w().mark((function t(n,i,a){var r,s,o,l,h,u,c,d,f,v,p,g,m,k,b,A,_,x,S,M,C,T,P,R,L;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=null,!(n instanceof Nh)){t.next=22;break}return l=(o=n).data,h=l.rect,u=l.rotation,c=l.id,d=l.structParent,f=l.popupRef,v=o.container,p=o.parent.page.pageNumber,g=v.querySelector("canvas"),m=a.imageManager.getFromCanvas(v.id,g),g.remove(),t.next=8,i._structTree.getAriaAttributes("".concat(Nt).concat(c));case 8:if(t.t2=s=t.sent,t.t1=null===t.t2,t.t1){t.next=12;break}t.t1=void 0===s;case 12:if(!t.t1){t.next=16;break}t.t3=void 0,t.next=17;break;case 16:t.t3=s.get("aria-label");case 17:if(t.t0=t.t3,t.t0){t.next=20;break}t.t0="";case 20:k=t.t0,r=n={annotationType:et.STAMP,bitmapId:m.id,bitmap:m.bitmap,pageIndex:p-1,rect:h.slice(0),rotation:u,id:c,deleted:!1,accessibilityData:{decorative:!1,altText:k},isSvg:!1,structParent:d,popupRef:f};case 22:return t.next=24,y(e,"deserialize",this,2)([n,i,a]);case 24:return b=t.sent,_=(A=n).rect,x=A.bitmap,S=A.bitmapUrl,M=A.bitmapId,C=A.isSvg,T=A.accessibilityData,M&&a.imageManager.isValidId(M)?(E(pf,b,M),x&&E(vf,b,x)):E(yf,b,S),E(Af,b,C),P=I(b.pageDimensions,2),R=P[0],L=P[1],b.width=(_[2]-_[0])/R,b.height=(_[3]-_[1])/L,b.annotationElementId=n.id||null,T&&(b.altTextData=T),b._initialData=r,E(_f,b,!!r),t.abrupt("return",b);case 36:case"end":return t.stop()}}),t,this)}))),function(t,e,i){return n.apply(this,arguments)})}]);var n,i}(Yi);function Mf(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t?(E(vf,this,t.bitmap),e||(E(pf,this,t.id),E(Af,this,t.isSvg)),t.file&&E(kf,this,t.file.name),R(xf,this,Tf).call(this)):this.remove()}function Ef(){if(E(gf,this,null),this._uiManager.enableWaiting(!1),M(bf,this)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&M(vf,this))return this._editToolbar.hide(),void this._uiManager.editAltText(this,!0);if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&M(vf,this)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch(t){}}this.div.focus()}}function Cf(){var t=this;if(M(pf,this))return this._uiManager.enableWaiting(!0),void this._uiManager.imageManager.getFromId(M(pf,this)).then((function(e){return R(xf,t,Mf).call(t,e,!0)})).finally((function(){return R(xf,t,Ef).call(t)}));if(M(yf,this)){var e=M(yf,this);return E(yf,this,null),this._uiManager.enableWaiting(!0),void E(gf,this,this._uiManager.imageManager.getFromUrl(e).then((function(e){return R(xf,t,Mf).call(t,e)})).finally((function(){return R(xf,t,Ef).call(t)})))}if(M(mf,this)){var n=M(mf,this);return E(mf,this,null),this._uiManager.enableWaiting(!0),void E(gf,this,this._uiManager.imageManager.getFromFile(n).then((function(e){return R(xf,t,Mf).call(t,e)})).finally((function(){return R(xf,t,Ef).call(t)})))}var i=document.createElement("input");i.type="file",i.accept=u.supportedTypesStr;var a=this._uiManager._signal;E(gf,this,new Promise((function(e){i.addEventListener("change",T(w().mark((function n(){var a;return w().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i.files&&0!==i.files.length){n.next=4;break}t.remove(),n.next=10;break;case 4:return t._uiManager.enableWaiting(!0),n.next=7,t._uiManager.imageManager.getFromFile(i.files[0]);case 7:a=n.sent,t._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:t._uiManager.useNewAltTextFlow}}),R(xf,t,Mf).call(t,a);case 10:e();case 11:case"end":return n.stop()}}),n)}))),{signal:a}),i.addEventListener("cancel",(function(){t.remove(),e()}),{signal:a})})).finally((function(){return R(xf,t,Ef).call(t)}))),i.click()}function Tf(){var t,e=this.div,n=M(vf,this),i=n.width,a=n.height,r=I(this.pageDimensions,2),s=r[0],o=r[1],l=.75;if(this.width)i=this.width*s,a=this.height*o;else if(i>l*s||a>l*o){var h=Math.min(l*s/i,l*o/a);i*=h,a*=h}var u=I(this.parentDimensions,2),c=u[0],d=u[1];this.setDims(i*c/s,a*d/o),this._uiManager.enableWaiting(!1);var f=E(bf,this,document.createElement("canvas"));f.setAttribute("role","img"),this.addContainer(f),this.width=i/s,this.height=a/o,null!==(t=this._initialOptions)&&void 0!==t&&t.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&!this.annotationElementId||(e.hidden=!1),R(xf,this,Rf).call(this),M(_f,this)||(this.parent.addUndoableEditor(this),E(_f,this,!0)),this._reportTelemetry({action:"inserted_image"}),M(kf,this)&&f.setAttribute("aria-label",M(kf,this))}function Pf(t,e){for(var n=M(vf,this),i=n.width,a=n.height,r=M(vf,this);i>2*t||a>2*e;){var s=i,o=a;i>2*t&&(i=i>=16384?Math.floor(i/2)-1:Math.ceil(i/2)),a>2*e&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2));var l=new OffscreenCanvas(i,a);l.getContext("2d").drawImage(r,0,0,s,o,0,0,i,a),r=l.transferToImageBitmap()}return r}function Rf(){var t=I(this.parentDimensions,2),e=t[0],n=t[1],i=this.width,a=this.height,r=new re,s=Math.ceil(i*e*r.sx),o=Math.ceil(a*n*r.sy),l=M(bf,this);if(l&&(l.width!==s||l.height!==o)){l.width=s,l.height=o;var h=M(Af,this)?M(vf,this):R(xf,this,Pf).call(this,s,o),u=l.getContext("2d");u.filter=this._uiManager.hcmFilter,u.drawImage(h,0,0,h.width,h.height,0,0,s,o)}}function If(t){if(t){if(M(Af,this)){var e=this._uiManager.imageManager.getSvgUrl(M(pf,this));if(e)return e}var n=document.createElement("canvas"),i=M(vf,this);return n.width=i.width,n.height=i.height,n.getContext("2d").drawImage(M(vf,this),0,0),n.toDataURL()}if(M(Af,this)){var a=I(this.pageDimensions,2),r=a[0],s=a[1],o=Math.round(this.width*r*Wt.PDF_TO_CSS_UNITS),l=Math.round(this.height*s*Wt.PDF_TO_CSS_UNITS),h=new OffscreenCanvas(o,l);return h.getContext("2d").drawImage(M(vf,this),0,0,M(vf,this).width,M(vf,this).height,0,0,o,l),h.transferToImageBitmap()}return structuredClone(M(vf,this))}function Lf(t){var e,n=this._initialData,i=n.pageIndex,a=n.accessibilityData.altText,r=t.pageIndex===i,s=((null===(e=t.accessibilityData)||void 0===e?void 0:e.alt)||"")===a;return{isSame:!this._hasBeenMoved&&!this._hasBeenResized&&r&&s,isSameAltText:s}}u=Sf,P(Sf,"_type","stamp"),P(Sf,"_editorType",et.STAMP);var Df=new WeakMap,Ff=new WeakMap,Nf=new WeakMap,Of=new WeakMap,Wf=new WeakMap,Bf=new WeakMap,Hf=new WeakMap,jf=new WeakMap,zf=new WeakMap,Gf=new WeakMap,Vf=new WeakMap,Uf=new WeakMap,qf=new WeakMap,Xf=new WeakMap,Yf=new WeakSet,Kf=function(){return B((function t(e){var n=e.uiManager,i=e.pageIndex,a=e.div,r=e.structTreeLayer,s=e.accessibilityManager,o=e.annotationLayer,l=e.drawLayer,h=e.textLayer,u=e.viewport,c=e.l10n;j(this,t),A(this,Yf),_(this,Df,void 0),_(this,Ff,!1),_(this,Nf,null),_(this,Of,null),_(this,Wf,null),_(this,Bf,new Map),_(this,Hf,!1),_(this,jf,!1),_(this,zf,!1),_(this,Gf,null),_(this,Vf,null),_(this,Uf,null),_(this,qf,null),_(this,Xf,void 0);var d=k(ev._.values());if(!t._initialized){t._initialized=!0;var f,v=F(d);try{for(v.s();!(f=v.n()).done;)f.value.initialize(c,n)}catch(t){v.e(t)}finally{v.f()}}n.registerEditorTypes(d),E(Xf,this,n),this.pageIndex=i,this.div=a,E(Df,this,s),E(Nf,this,o),this.viewport=u,E(Uf,this,h),this.drawLayer=l,this._structTree=r,M(Xf,this).addLayer(this)}),[{key:"isEmpty",get:function(){return 0===M(Bf,this).size}},{key:"isInvisible",get:function(){return this.isEmpty&&M(Xf,this).getMode()===et.NONE}},{key:"updateToolbar",value:function(t){M(Xf,this).updateToolbar(t)}},{key:"updateMode",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M(Xf,this).getMode();switch(R(Yf,this,tv).call(this),t){case et.NONE:return this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),void this.disableClick();case et.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case et.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);var e,n=this.div.classList,i=F(ev._.values());try{for(i.s();!(e=i.n()).done;){var a=e.value;n.toggle("".concat(a._type,"Editing"),t===a._editorType)}}catch(t){i.e(t)}finally{i.f()}this.div.hidden=!1}},{key:"hasTextLayer",value:function(t){var e;return t===(null===(e=M(Uf,this))||void 0===e?void 0:e.div)}},{key:"setEditingState",value:function(t){M(Xf,this).setEditingState(t)}},{key:"addCommands",value:function(t){M(Xf,this).addCommands(t)}},{key:"cleanUndoStack",value:function(t){M(Xf,this).cleanUndoStack(t)}},{key:"toggleDrawing",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.div.classList.toggle("drawing",!t)}},{key:"togglePointerEvents",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.div.classList.toggle("disabled",!t)}},{key:"toggleAnnotationLayerPointerEvents",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];null===(t=M(Nf,this))||void 0===t||t.div.classList.toggle("disabled",!e)}},{key:"enable",value:(e=T(w().mark((function t(){var e,n,i,a,r,s,o,l,h;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:E(zf,this,!0),this.div.tabIndex=0,this.togglePointerEvents(!0),e=new Set,n=F(M(Bf,this).values());try{for(n.s();!(i=n.n()).done;)(a=i.value).enableEditing(),a.show(!0),a.annotationElementId&&(M(Xf,this).removeChangedExistingAnnotation(a),e.add(a.annotationElementId))}catch(t){n.e(t)}finally{n.f()}if(M(Nf,this)){t.next=9;break}return E(zf,this,!1),t.abrupt("return");case 9:r=M(Nf,this).getEditableAnnotations(),s=F(r),t.prev=11,s.s();case 13:if((o=s.n()).done){t.next=29;break}if((l=o.value).hide(),!M(Xf,this).isDeletedAnnotationElement(l.data.id)){t.next=18;break}return t.abrupt("continue",27);case 18:if(!e.has(l.data.id)){t.next=20;break}return t.abrupt("continue",27);case 20:return t.next=22,this.deserialize(l);case 22:if(h=t.sent){t.next=25;break}return t.abrupt("continue",27);case 25:this.addOrRebuild(h),h.enableEditing();case 27:t.next=13;break;case 29:t.next=34;break;case 31:t.prev=31,t.t0=t.catch(11),s.e(t.t0);case 34:return t.prev=34,s.f(),t.finish(34);case 37:E(zf,this,!1);case 38:case"end":return t.stop()}}),t,this,[[11,31,34,37]])}))),function(){return e.apply(this,arguments)})},{key:"disable",value:function(){E(jf,this,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);var t,e=new Map,n=new Map,i=F(M(Bf,this).values());try{for(i.s();!(t=i.n()).done;){var a,r=t.value;r.disableEditing(),r.annotationElementId&&(null===r.serialize()?(n.set(r.annotationElementId,r),null===(a=this.getEditableAnnotation(r.annotationElementId))||void 0===a||a.show(),r.remove()):e.set(r.annotationElementId,r))}}catch(t){i.e(t)}finally{i.f()}if(M(Nf,this)){var s,o=F(M(Nf,this).getEditableAnnotations());try{for(o.s();!(s=o.n()).done;){var l=s.value,h=l.data.id;if(!M(Xf,this).isDeletedAnnotationElement(h)){var u=n.get(h);u?(u.resetAnnotationElement(l),u.show(!1),l.show()):((u=e.get(h))&&(M(Xf,this).addChangedExistingAnnotation(u),u.renderAnnotationElement(l)&&u.show(!1)),l.show())}}}catch(t){o.e(t)}finally{o.f()}}R(Yf,this,tv).call(this),this.isEmpty&&(this.div.hidden=!0);var c,d=this.div.classList,f=F(ev._.values());try{for(f.s();!(c=f.n()).done;){var v=c.value;d.remove("".concat(v._type,"Editing"))}}catch(t){f.e(t)}finally{f.f()}this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),E(jf,this,!1)}},{key:"getEditableAnnotation",value:function(t){var e;return(null===(e=M(Nf,this))||void 0===e?void 0:e.getEditableAnnotation(t))||null}},{key:"setActiveEditor",value:function(t){M(Xf,this).getActive()!==t&&M(Xf,this).setActiveEditor(t)}},{key:"enableTextSelection",value:function(){var t;if(this.div.tabIndex=-1,null!==(t=M(Uf,this))&&void 0!==t&&t.div&&!M(qf,this)){E(qf,this,new AbortController);var e=M(Xf,this).combinedSignal(M(qf,this));M(Uf,this).div.addEventListener("pointerdown",R(Yf,this,Qf).bind(this),{signal:e}),M(Uf,this).div.classList.add("highlighting")}}},{key:"disableTextSelection",value:function(){var t;this.div.tabIndex=0,null!==(t=M(Uf,this))&&void 0!==t&&t.div&&M(qf,this)&&(M(qf,this).abort(),E(qf,this,null),M(Uf,this).div.classList.remove("highlighting"))}},{key:"enableClick",value:function(){if(!M(Of,this)){E(Of,this,new AbortController);var t=M(Xf,this).combinedSignal(M(Of,this));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});var e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}}},{key:"disableClick",value:function(){var t;null===(t=M(Of,this))||void 0===t||t.abort(),E(Of,this,null)}},{key:"attach",value:function(t){M(Bf,this).set(t.id,t);var e=t.annotationElementId;e&&M(Xf,this).isDeletedAnnotationElement(e)&&M(Xf,this).removeDeletedAnnotationElement(t)}},{key:"detach",value:function(t){var e;M(Bf,this).delete(t.id),null===(e=M(Df,this))||void 0===e||e.removePointerInTextLayer(t.contentDiv),!M(jf,this)&&t.annotationElementId&&M(Xf,this).addDeletedAnnotationElement(t)}},{key:"remove",value:function(t){this.detach(t),M(Xf,this).removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}},{key:"changeParent",value:function(t){var e;t.parent!==this&&(t.parent&&t.annotationElementId&&(M(Xf,this).addDeletedAnnotationElement(t.annotationElementId),Yi.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),null===(e=t.parent)||void 0===e||e.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}},{key:"add",value:function(t){if(t.parent!==this||!t.isAttachedToDOM){if(this.changeParent(t),M(Xf,this).addEditor(t),this.attach(t),!t.isAttachedToDOM){var e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!M(zf,this)),M(Xf,this).addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}},{key:"moveEditorInDOM",value:function(t){var e,n=this;if(t.isAttachedToDOM){var i=document.activeElement;t.div.contains(i)&&!M(Wf,this)&&(t._focusEventsAllowed=!1,E(Wf,this,setTimeout((function(){E(Wf,n,null),t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",(function(){t._focusEventsAllowed=!0}),{once:!0,signal:M(Xf,n)._signal}),i.focus())}),0))),t._structTreeParentId=null===(e=M(Df,this))||void 0===e?void 0:e.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}}},{key:"addOrRebuild",value:function(t){t.needsToBeRebuilt()?(t.parent||(t.parent=this),t.rebuild(),t.show()):this.add(t)}},{key:"addUndoableEditor",value:function(t){this.addCommands({cmd:function(){return t._uiManager.rebuild(t)},undo:function(){t.remove()},mustExec:!1})}},{key:"getNextId",value:function(){return M(Xf,this).getId()}},{key:"combinedSignal",value:function(t){return M(Xf,this).combinedSignal(t)}},{key:"canCreateNewEmptyEditor",value:function(){var t;return null===(t=S(Yf,this,Jf))||void 0===t?void 0:t.canCreateNewEmptyEditor()}},{key:"pasteEditor",value:function(t,e){M(Xf,this).updateToolbar(t),M(Xf,this).updateMode(t);var n=R(Yf,this,$f).call(this),i=n.offsetX,a=n.offsetY,r=this.getNextId(),s=R(Yf,this,Zf).call(this,p({parent:this,id:r,x:i,y:a,uiManager:M(Xf,this),isCentered:!0},e));s&&this.add(s)}},{key:"deserialize",value:(t=T(w().mark((function t(e){var n,i;return w().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,null===(n=ev._.get(null!==(i=e.annotationType)&&void 0!==i?i:e.annotationEditorType))||void 0===n?void 0:n.deserialize(e,this,M(Xf,this));case 2:if(t.t0=t.sent,t.t0){t.next=5;break}t.t0=null;case 5:return t.abrupt("return",t.t0);case 6:case"end":return t.stop()}}),t,this)}))),function(e){return t.apply(this,arguments)})},{key:"createAndAddNewEditor",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this.getNextId(),a=R(Yf,this,Zf).call(this,p({parent:this,id:i,x:t.offsetX,y:t.offsetY,uiManager:M(Xf,this),isCentered:e},n));return a&&this.add(a),a}},{key:"addNewEditor",value:function(){this.createAndAddNewEditor(R(Yf,this,$f).call(this),!0)}},{key:"setSelected",value:function(t){M(Xf,this).setSelected(t)}},{key:"toggleSelected",value:function(t){M(Xf,this).toggleSelected(t)}},{key:"unselect",value:function(t){M(Xf,this).unselect(t)}},{key:"pointerup",value:function(t){var e,n=Ct.platform.isMac;0!==t.button||t.ctrlKey&&n||t.target===this.div&&M(Hf,this)&&(E(Hf,this,!1),null!==(e=S(Yf,this,Jf))&&void 0!==e&&e.isDrawer&&S(Yf,this,Jf).supportMultipleDrawings||(M(Ff,this)?M(Xf,this).getMode()!==et.STAMP?this.createAndAddNewEditor(t,!1):M(Xf,this).unselectAll():E(Ff,this,!0)))}},{key:"pointerdown",value:function(t){var e;if(M(Xf,this).getMode()===et.HIGHLIGHT&&this.enableTextSelection(),M(Hf,this))E(Hf,this,!1);else{var n=Ct.platform.isMac;if(!(0!==t.button||t.ctrlKey&&n)&&t.target===this.div)if(E(Hf,this,!0),null!==(e=S(Yf,this,Jf))&&void 0!==e&&e.isDrawer)this.startDrawingSession(t);else{var i=M(Xf,this).getActive();E(Ff,this,!i||i.isEmpty())}}}},{key:"startDrawingSession",value:function(t){var e=this;if(this.div.focus(),M(Gf,this))S(Yf,this,Jf).startDrawing(this,M(Xf,this),!1,t);else{M(Xf,this).setCurrentDrawingSession(this),E(Gf,this,new AbortController);var n=M(Xf,this).combinedSignal(M(Gf,this));this.div.addEventListener("blur",(function(t){var n=t.relatedTarget;n&&!e.div.contains(n)&&(E(Vf,e,null),e.commitOrRemove())}),{signal:n}),S(Yf,this,Jf).startDrawing(this,M(Xf,this),!1,t)}}},{key:"pause",value:function(t){var e=this;if(t){var n=document.activeElement;this.div.contains(n)&&E(Vf,this,n)}else M(Vf,this)&&setTimeout((function(){var t;null===(t=M(Vf,e))||void 0===t||t.focus(),E(Vf,e,null)}),0)}},{key:"endDrawingSession",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return M(Gf,this)?(M(Xf,this).setCurrentDrawingSession(null),M(Gf,this).abort(),E(Gf,this,null),E(Vf,this,null),S(Yf,this,Jf).endDrawing(t)):null}},{key:"findNewParent",value:function(t,e,n){var i=M(Xf,this).findParent(e,n);return null!==i&&i!==this&&(i.changeParent(t),!0)}},{key:"commitOrRemove",value:function(){return!!M(Gf,this)&&(this.endDrawingSession(),!0)}},{key:"onScaleChanging",value:function(){M(Gf,this)&&S(Yf,this,Jf).onScaleChangingWhenDrawing(this)}},{key:"destroy",value:function(){var t;this.commitOrRemove(),(null===(t=M(Xf,this).getActive())||void 0===t?void 0:t.parent)===this&&(M(Xf,this).commitOrRemove(),M(Xf,this).setActiveEditor(null)),M(Wf,this)&&(clearTimeout(M(Wf,this)),E(Wf,this,null));var e,n=F(M(Bf,this).values());try{for(n.s();!(e=n.n()).done;){var i,a=e.value;null===(i=M(Df,this))||void 0===i||i.removePointerInTextLayer(a.contentDiv),a.setParent(null),a.isAttachedToDOM=!1,a.div.remove()}}catch(t){n.e(t)}finally{n.f()}this.div=null,M(Bf,this).clear(),M(Xf,this).removeLayer(this)}},{key:"render",value:function(t){var e=t.viewport;this.viewport=e,ae(this.div,e);var n,i=F(M(Xf,this).getEditors(this.pageIndex));try{for(i.s();!(n=i.n()).done;){var a=n.value;this.add(a),a.rebuild()}}catch(t){i.e(t)}finally{i.f()}this.updateMode()}},{key:"update",value:function(t){var e=t.viewport;M(Xf,this).commitOrRemove(),R(Yf,this,tv).call(this);var n=this.viewport.rotation,i=e.rotation;if(this.viewport=e,ae(this.div,{rotation:i}),n!==i){var a,r=F(M(Bf,this).values());try{for(r.s();!(a=r.n()).done;)a.value.rotate(i)}catch(t){r.e(t)}finally{r.f()}}}},{key:"pageDimensions",get:function(){var t=this.viewport.rawDims;return[t.pageWidth,t.pageHeight]}},{key:"scale",get:function(){return M(Xf,this).viewParameters.realScale}}]);var t,e}();function Qf(t){var e=this;M(Xf,this).unselectAll();var n=t.target;if(n===M(Uf,this).div||("img"===n.getAttribute("role")||n.classList.contains("endOfContent"))&&M(Uf,this).div.contains(n)){var i=Ct.platform.isMac;if(0!==t.button||t.ctrlKey&&i)return;M(Xf,this).showAllEditors("highlight",!0,!0),M(Uf,this).div.classList.add("free"),this.toggleDrawing(),Kc.startHighlighting(this,"ltr"===M(Xf,this).direction,{target:M(Uf,this).div,x:t.x,y:t.y}),M(Uf,this).div.addEventListener("pointerup",(function(){M(Uf,e).div.classList.remove("free"),e.toggleDrawing(!0)}),{once:!0,signal:M(Xf,this)._signal}),t.preventDefault()}}function Jf(t){return ev._.get(M(Xf,t).getMode())}function Zf(t){var e=S(Yf,this,Jf);return e?new e.prototype.constructor(t):null}function $f(){var t=this.div.getBoundingClientRect(),e=t.x,n=t.y,i=t.width,a=t.height,r=Math.max(0,e),s=Math.max(0,n),o=(r+Math.min(window.innerWidth,e+i))/2-e,l=(s+Math.min(window.innerHeight,n+a))/2-n,h=I(this.viewport.rotation%180==0?[o,l]:[l,o],2);return{offsetX:h[0],offsetY:h[1]}}function tv(){var t,e=F(M(Bf,this).values());try{for(e.s();!(t=e.n()).done;){var n=t.value;n.isEmpty()&&n.remove()}}catch(t){e.e(t)}finally{e.f()}}P(Kf,"_initialized",!1);var ev={_:new Map([iu,df,Sf,Kc].map((function(t){return[t._editorType,t]})))},nv=new WeakMap,iv=new WeakMap,av=new WeakMap,rv=new WeakMap,sv=new WeakSet,ov=function(){function t(e){var n=e.pageIndex;j(this,t),A(this,sv),_(this,nv,null),_(this,iv,0),_(this,av,new Map),_(this,rv,new Map),this.pageIndex=n}return B(t,[{key:"setParent",value:function(t){if(M(nv,this)){if(M(nv,this)!==t){if(M(av,this).size>0){var e,n=F(M(av,this).values());try{for(n.s();!(e=n.n()).done;){var i=e.value;i.remove(),t.append(i)}}catch(t){n.e(t)}finally{n.f()}}E(nv,this,t)}}else E(nv,this,t)}},{key:"draw",value:function(e){var n,i,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=(E(iv,this,(n=M(iv,this),i=n++,n)),i),o=R(sv,this,hv).call(this),l=t._svgFactory.createElement("defs");o.append(l);var h=t._svgFactory.createElement("path");l.append(h);var u="path_p".concat(this.pageIndex,"_").concat(s);h.setAttribute("id",u),h.setAttribute("vector-effect","non-scaling-stroke"),a&&M(rv,this).set(s,h);var c=r?R(sv,this,uv).call(this,l,u):null,d=t._svgFactory.createElement("use");return o.append(d),d.setAttribute("href","#".concat(u)),this.updateProperties(o,e),M(av,this).set(s,o),{id:s,clipPathId:"url(#".concat(c,")")}}},{key:"drawOutline",value:function(e,n){var i,a,r=(E(iv,this,(i=M(iv,this),a=i++,i)),a),s=R(sv,this,hv).call(this),o=t._svgFactory.createElement("defs");s.append(o);var l=t._svgFactory.createElement("path");o.append(l);var h,u="path_p".concat(this.pageIndex,"_").concat(r);if(l.setAttribute("id",u),l.setAttribute("vector-effect","non-scaling-stroke"),n){var c=t._svgFactory.createElement("mask");o.append(c),h="mask_p".concat(this.pageIndex,"_").concat(r),c.setAttribute("id",h),c.setAttribute("maskUnits","objectBoundingBox");var d=t._svgFactory.createElement("rect");c.append(d),d.setAttribute("width","1"),d.setAttribute("height","1"),d.setAttribute("fill","white");var f=t._svgFactory.createElement("use");c.append(f),f.setAttribute("href","#".concat(u)),f.setAttribute("stroke","none"),f.setAttribute("fill","black"),f.setAttribute("fill-rule","nonzero"),f.classList.add("mask")}var v=t._svgFactory.createElement("use");s.append(v),v.setAttribute("href","#".concat(u)),h&&v.setAttribute("mask","url(#".concat(h,")"));var p=v.cloneNode();return s.append(p),v.classList.add("mainOutline"),p.classList.add("secondaryOutline"),this.updateProperties(s,e),M(av,this).set(r,s),r}},{key:"finalizeDraw",value:function(t,e){M(rv,this).delete(t),this.updateProperties(t,e)}},{key:"updateProperties",value:function(e,n){if(n){var i=n.root,a=n.bbox,r=n.rootClass,s=n.path,o="number"==typeof e?M(av,this).get(e):e;if(o){if(i&&R(sv,this,cv).call(this,o,i),a&&lv.call(t,o,a),r)for(var l=o.classList,h=0,u=Object.entries(r);h<u.length;h++){var c=I(u[h],2),d=c[0],f=c[1];l.toggle(d,f)}if(s){var v=o.firstChild.firstChild;R(sv,this,cv).call(this,v,s)}}}}},{key:"updateParent",value:function(t,e){if(e!==this){var n=M(av,this).get(t);n&&(M(nv,e).append(n),M(av,this).delete(t),M(av,e).set(t,n))}}},{key:"remove",value:function(t){M(rv,this).delete(t),null!==M(nv,this)&&(M(av,this).get(t).remove(),M(av,this).delete(t))}},{key:"destroy",value:function(){E(nv,this,null);var t,e=F(M(av,this).values());try{for(e.s();!(t=e.n()).done;)t.value.remove()}catch(t){e.e(t)}finally{e.f()}M(av,this).clear(),M(rv,this).clear()}}],[{key:"_svgFactory",get:function(){return gt(this,"_svgFactory",new vl)}}])}();function lv(t,e){var n=I(e,4),i=n[0],a=n[1],r=n[2],s=n[3],o=t.style;o.top="".concat(100*a,"%"),o.left="".concat(100*i,"%"),o.width="".concat(100*r,"%"),o.height="".concat(100*s,"%")}function hv(){var t=c._svgFactory.create(1,1,!0);return M(nv,this).append(t),t.setAttribute("aria-hidden",!0),t}function uv(t,e){var n=c._svgFactory.createElement("clipPath");t.append(n);var i="clip_".concat(e);n.setAttribute("id",i),n.setAttribute("clipPathUnits","objectBoundingBox");var a=c._svgFactory.createElement("use");return n.append(a),a.setAttribute("href","#".concat(e)),a.classList.add("clip"),i}function cv(t,e){for(var n=0,i=Object.entries(e);n<i.length;n++){var a=I(i[n],2),r=a[0],s=a[1];null===s?t.removeAttribute(r):t.setAttribute(r,s)}}c=ov;var dv=new WeakMap,fv=new WeakMap,vv=new WeakMap,pv=new WeakMap,gv=new WeakMap,yv=new WeakMap,mv=new WeakMap,kv=new WeakMap,bv=new WeakMap,wv=new WeakMap,Av=new WeakSet,_v=function(){return B((function t(e){var n=e.container,i=e.isPinchingDisabled,a=void 0===i?null:i,r=e.isPinchingStopped,s=void 0===r?null:r,o=e.onPinching,l=void 0===o?null:o,h=e.onPinchEnd,u=void 0===h?null:h,c=e.signal;j(this,t),A(this,Av),_(this,dv,void 0),_(this,fv,!1),_(this,vv,null),_(this,pv,void 0),_(this,gv,void 0),_(this,yv,void 0),_(this,mv,void 0),_(this,kv,null),_(this,bv,void 0),_(this,wv,null),E(dv,this,n),E(vv,this,s),E(pv,this,a),E(gv,this,l),E(yv,this,u),E(bv,this,new AbortController),E(mv,this,AbortSignal.any([c,M(bv,this).signal])),n.addEventListener("touchstart",R(Av,this,xv).bind(this),{passive:!1,signal:M(mv,this)})}),[{key:"MIN_TOUCH_DISTANCE_TO_PINCH",get:function(){return gt(this,"MIN_TOUCH_DISTANCE_TO_PINCH",35/(window.devicePixelRatio||1))}},{key:"destroy",value:function(){var t;null===(t=M(bv,this))||void 0===t||t.abort(),E(bv,this,null)}}])}();function xv(t){var e,n;if(!(null!==(e=M(pv,this))&&void 0!==e&&e.call(this)||t.touches.length<2)){if(!M(wv,this)){E(wv,this,new AbortController);var i=AbortSignal.any([M(mv,this),M(wv,this).signal]),a=M(dv,this),r={signal:i,passive:!1};a.addEventListener("touchmove",R(Av,this,Sv).bind(this),r),a.addEventListener("touchend",R(Av,this,Mv).bind(this),r),a.addEventListener("touchcancel",R(Av,this,Mv).bind(this),r)}if(t.preventDefault(),2!==t.touches.length||null!==(n=M(vv,this))&&void 0!==n&&n.call(this))E(kv,this,null);else{var s=I(t.touches,2),o=s[0],l=s[1];if(o.identifier>l.identifier){var h=[l,o];o=h[0],l=h[1]}E(kv,this,{touch0X:o.screenX,touch0Y:o.screenY,touch1X:l.screenX,touch1Y:l.screenY})}}}function Sv(t){var e;if(M(kv,this)&&2===t.touches.length){var n=I(t.touches,2),i=n[0],a=n[1];if(i.identifier>a.identifier){var r=[a,i];i=r[0],a=r[1]}var s=i,o=s.screenX,l=s.screenY,h=a,u=h.screenX,c=h.screenY,f=M(kv,this),v=f.touch0X,p=f.touch0Y,g=f.touch1X-v,y=f.touch1Y-p,m=u-o,k=c-l,b=Math.hypot(m,k)||1,w=Math.hypot(g,y)||1;if(M(fv,this)||!(Math.abs(w-b)<=d.MIN_TOUCH_DISTANCE_TO_PINCH))if(f.touch0X=o,f.touch0Y=l,f.touch1X=u,f.touch1Y=c,t.preventDefault(),M(fv,this)){var A=[(o+u)/2,(l+c)/2];null===(e=M(gv,this))||void 0===e||e.call(this,A,w,b)}else E(fv,this,!0)}}function Mv(t){var e;(M(wv,this).abort(),E(wv,this,null),M(kv,this))&&(M(fv,this)&&(null===(e=M(yv,this))||void 0===e||e.call(this),E(fv,this,!1)),t.preventDefault(),E(kv,this,null))}d=_v,globalThis.pdfjsTestingUtils={HighlightOutliner:$u}})();